var leadManager=leadManager||{name:"leadManager.",preloaded:!1,increaseScore:function(t,e){console.log(this.name+"increaseScore "+t+" "+e)}},achManager=achManager||{name:"achManager.",preloaded:!1,unlockAchievement:function(t){console.log(this.name+"unlockAchievement "+t)}},constants=constants||{};constants.CLIENT_ID="921591657608-3q0q6jlnhed0alruukva957jrpiccbif.apps.googleusercontent.com",constants.ACH_FIRST_VICTORY="CgkIiOmSmekaEAIQBA",constants.ACH_TOTAL_WINS_4TH="CgkIiOmSmekaEAIQBQ",constants.ACH_TOTAL_WINS_3RD="CgkIiOmSmekaEAIQBg",constants.ACH_TOTAL_WINS_2ND="CgkIiOmSmekaEAIQBw",constants.ACH_TOTAL_WINS_1ST="CgkIiOmSmekaEAIQCA",constants.ACH_WINS_IN_ROW_4TH="CgkIiOmSmekaEAIQCQ",constants.ACH_WINS_IN_ROW_3RD="CgkIiOmSmekaEAIQCg",constants.ACH_WINS_IN_ROW_2ND="CgkIiOmSmekaEAIQCw",constants.ACH_WINS_IN_ROW_1ST="CgkIiOmSmekaEAIQDA",constants.ACH_QUICKEST_WINS_4TH="CgkIiOmSmekaEAIQDQ",constants.ACH_QUICKEST_WINS_3RD="CgkIiOmSmekaEAIQDg",constants.ACH_QUICKEST_WINS_2ND="CgkIiOmSmekaEAIQDw",constants.ACH_QUICKEST_WINS_1ST="CgkIiOmSmekaEAIQEA",constants.LEAD_TOTAL_WINS="CgkIiOmSmekaEAIQAA",constants.LEAD_WINS_IN_ROW="CgkIiOmSmekaEAIQAg",constants.LEAD_QUICKEST_3_WINS="CgkIiOmSmekaEAIQAw";var leadTimeUnit=6e4,playService={score:864e5,loginComplete:!1,mainStarted:!1,name:"playService.",achievements:[{id:constants.ACH_FIRST_VICTORY,type:1,data:1,name:"First Victory",desc:"Hooray! It's your first victory!",state:"REVEALED",claim:!1,icon:"ach-wins.png"},{id:constants.ACH_TOTAL_WINS_4TH,type:1,data:3,name:"Win 3 Games",desc:"New highscore in Total Wins!",state:"HIDDEN",claim:!1,icon:"ach-wins.png"},{id:constants.ACH_TOTAL_WINS_3RD,type:1,data:5,name:"Win 5 Games",desc:"New highscore in Total Wins!",state:"HIDDEN",claim:!1,icon:"ach-wins.png"},{id:constants.ACH_TOTAL_WINS_2ND,type:1,data:7,name:"Win 7 Games",desc:"New highscore in Total Wins",state:"HIDDEN",claim:!1,icon:"ach-wins.png"},{id:constants.ACH_TOTAL_WINS_1ST,type:1,data:9,name:"Win 9 Games",desc:"New highscore in Total Wins",state:"HIDDEN",claim:!1,icon:"ach-wins.png"},{id:constants.ACH_WINS_IN_ROW_4TH,type:2,data:2,name:"Win Fair Level",desc:"New highscore! Win Fair Level.",state:"REVEALED",claim:!1,icon:"ach-inrow.png"},{id:constants.ACH_WINS_IN_ROW_3RD,type:2,data:3,name:"Win Hard Level",desc:"New highscore! Win Hard Level!",state:"HIDDEN",claim:!1,icon:"ach-inrow.png"},{id:constants.ACH_WINS_IN_ROW_2ND,type:2,data:5,name:"Win 5 in row",desc:"New highscore! Win 5 games in a row!",state:"HIDDEN",claim:!1,icon:"ach-inrow.png"},{id:constants.ACH_WINS_IN_ROW_1ST,type:2,data:6,name:"Win 6 in row",desc:"New highscore! Win 6 games in a row!",state:"HIDDEN",claim:!1,icon:"ach-inrow.png"},{id:constants.ACH_QUICKEST_WINS_1ST,type:3,data:7*leadTimeUnit,name:"3 Wins in 7:00",desc:"You reached top time on fastest wins!",state:"REVEALED",claim:!1,icon:"ach-inrow-time.png"}],leadScores:[{id:"me",rank:5,avatar:"avatar-me.png",name:"You",wins:0,inRow:0,time:0,playerId:null},{id:"1",rank:1,avatar:"avatar-0.png",name:"Astronaut",wins:9,inRow:6,time:8*leadTimeUnit},{id:"2",rank:2,avatar:"avatar-1.png",name:"Rocketeer",wins:7,inRow:5,time:9*leadTimeUnit},{id:"3",rank:3,avatar:"avatar-2.png",name:"Eagle",wins:5,inRow:4,time:10*leadTimeUnit},{id:"4",rank:4,avatar:"avatar-3.png",name:"Birdie",wins:3,inRow:3,time:11*leadTimeUnit},{id:"5",rank:5,avatar:"avatar-4.png",name:"Duckling",wins:1,inRow:2,time:12*leadTimeUnit}],getAchievement:function(t){for(var e=0;e<this.achievements.length;e++)if(this.achievements[e].id===t)return this.achievements[e]},getPlayer:function(t){for(var e=0;e<this.leadScores.length;e++)if(this.leadScores[e].id===t)return this.leadScores[e];return null},getAchievements:function(t,e,i){var a,s=[];for(a=0;a<this.achievements.length&&(this.achievements[a].state===t&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id,icon:this.achievements[a].icon}),!(e>0&&s.length>=e));a++);if(i)for(a=0;a<this.achievements.length&&(this.achievements[a].claim&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id}),!(e>0&&s.length>=e));a++);return s},getScores:function(){var t=[],e=playService.getPlayer("me");return t.push(e.wins),t.push(e.inRow),t.push(e.time),t},resize:function(t,e,i){var a=document.getElementById("login-buttons");a&&(a.style.left=Math.floor(t*i)+"px",a.style.top=Math.floor(e*i)+"px"),(a=document.getElementById("login-image"))&&(a.style.width=Math.floor(64*i)+"px",a.style.height=Math.floor(64*i)+"px")},showLogin:function(){if(!this.loggedIn&&this.mainStarted&&this.loginComplete){var t=document.getElementById("login-buttons");t&&(t.style.display="block")}},downloadedScore:function(t,e){var i=playService.getPlayer("me"),a=!1;return t===constants.LEAD_TOTAL_WINS&&(e>i.wins?(i.wins=e,a=!0):i.wins>e&&leadManager.increaseScore(t,i.wins)),t===constants.LEAD_WINS_IN_ROW&&(e>i.inRow?(i.inRow=e,a=!0):i.inRow>e&&leadManager.increaseScore(t,i.inRow)),t===constants.LEAD_QUICKEST_3_WINS&&(e>0&&(e<i.time||0===i.time)?(i.time=e,a=!0):i.time>0&&i.time<e&&leadManager.increaseScore(t,i.time)),a},downloadedAchievements:function(t){for(var e=!1,i=0;i<t.length;i++){var a=t[i],s=this.getAchievement(a.id);if(s)if("UNLOCKED"===a.achievementState){if(s&&"UNLOCKED"!==s.state){s.state="UNLOCKED";for(var o=0;o<this.achievements.length-1;o++)this.achievements[o]===s&&this.achievements[o+1].type===s.type&&(this.achievements[o+1].state="REVEALED");e=!0}}else s&&"UNLOCKED"===s.state&&achManager.unlockAchievement(a.id)}e&&(dataStorage.saveAchievements(),mainState.updateAchievements())},loadedScores:function(t){var e=playService.getPlayer("me"),i=!1;t[0]>e.wins&&(e.wins=parseInt(t[0]),i=!0),t[1]>e.inRow&&(e.inRow=parseInt(t[1]),i=!0),t[2]>e.time&&(e.time=parseInt(t[2]),i=!0),i&&mainState.updateScores()},loadedAchievements:function(t){var e,i=!1;for(e=0;e<t.length;e++){var a=this.getAchievement(t[e]);if("UNLOCKED"!==a.state)for(i=!0,a.state="UNLOCKED",achManager.unlockAchievement(t[e]),e=0;e<this.achievements.length-1;e++)this.achievements[e]===a&&this.achievements[e+1].type===a.type&&(this.achievements[e+1].state="REVEALED")}i&&mainState.updateAchievements()},showAchievements:function(t){for(var e=[],i=0;i<this.achievements.length&&(this.achievements[i].claim&&(this.achievements[i].claim=!1,e.push({name:this.achievements[i].name,desc:this.achievements[i].desc})),!(t>0&&e.length>=t));i++);return e},setScore:function(t,e,i){var a,s;for(playerData=playService.getPlayer("me"),playerData.wins+=t,a=0;a<this.achievements.length;a++)if(1===(s=this.achievements[a]).type&&"REVEALED"===s.state&&playerData.wins>=s.data){this.unlockAchievement(s.id,!0);break}leadManager.increaseScore(constants.LEAD_TOTAL_WINS,playerData.wins);var o=!1;if(e>playerData.inRow){for(playerData.inRow=e,a=0;a<this.achievements.length;a++)if(2===(s=this.achievements[a]).type&&"REVEALED"===s.state&&playerData.inRow>=s.data){this.unlockAchievement(s.id,!0);break}o=!0,leadManager.increaseScore(constants.LEAD_WINS_IN_ROW,playerData.inRow)}if(e>=3&&(0===playerData.time||i<playerData.time)){for(playerData.time=i,a=0;a<this.achievements.length;a++)if(3===(s=this.achievements[a]).type&&"REVEALED"===s.state&&playerData.time<=s.data){this.unlockAchievement(s.id,!0);break}o=!0,leadManager.increaseScore(constants.LEAD_QUICKEST_3_WINS,playerData.time)}return dataStorage.saveScores(),o},unlockAchievement:function(t,e){var i=this.getAchievement(t);if("UNLOCKED"!==i.state){i.state="UNLOCKED",i.claim=!0,achManager.unlockAchievement(t),dataStorage.saveAchievements(),!0;for(var a=0;a<this.achievements.length-1;a++)this.achievements[a]===i&&this.achievements[a+1].type===i.type&&(this.achievements[a+1].state="REVEALED")}},hide:function(){var t=document.getElementById("login-buttons");t&&(t.style.display="none")},signedIn:function(t){this.loginComplete=!0,t?(this.loggedIn=!0,this.hide()):this.showLogin()},claimAchievements:function(){for(var t=0;t<this.achievements.length;t++)this.achievements[t].claim&&(achManager.unlockAchievement(this.achievements[t].id),this.achievements[t].claim=!1)},addPlayer:function(t,e,i,a){var s=playService.getPlayer("me");i&&(s.name=i),a&&!s.iconLoaded&&(s.iconLoaded=!0,s.icon=a,mainState.updatePlayerIcon(s)),this.downloadedScore(t,e)&&(dataStorage.saveScores(),mainState.updateScores())}};function getProfilePic(t){}function loadUpFriends(){gapi.client.plus.people.list({collection:"visible",orderBy:"alphabetical",userId:"me",maxResults:20}).execute(function(t){if(t.hasOwnProperty("items"))for(var e=0;e<t.items.length;e++);})}leadManager.preloaded=!1,leadManager.leaderboards={},leadManager.preloadData=function(){leadManager.showLeaderboard(constants.LEAD_TOTAL_WINS),leadManager.showLeaderboard(constants.LEAD_WINS_IN_ROW),leadManager.showLeaderboard(constants.LEAD_QUICKEST_3_WINS)},leadManager.getScore=function(){gapi.client.games.scores.get({playerId:"me",timeSpan:"ALL_TIME",leaderboardId:"ALL"}).execute(function(t){if(!t.error){var e=[];if(t.items&&t.items.length>0)for(var i=0;i<t.items.length;i++)e.push({id:t.items[i].leaderboard_id,value:t.items[i].scoreValue});playService.downloadedScore(e)}}),leadManager.preloaded=!0},leadManager.increaseScore=function(t,e){leadManager.preloaded&&gapi.client.games.scores.submit({leaderboardId:t,score:e}).execute(function(t){if(t.hasOwnProperty("beatenScoreTimeSpans"))for(var e=0;e<t.beatenScoreTimeSpans.length;e++)"ALL_TIME"===t.beatenScoreTimeSpans[e]&&!0})},leadManager.showLeaderboard=function(t){gapi.client.games.scores.list({collection:"SOCIAL",leaderboardId:t,timeSpan:"ALL_TIME"}).execute(function(e){if(e.message,e.hasOwnProperty("items")&&e.playerScore){var i=e.playerScore,a=i.player,s=a.displayName;(!s||s>15)&&a.name&&a.name.givenName&&(s=a.name.givenName);var o=a.avatarImageUrl;o&&(o+="?sz=74"),playService.addPlayer(t,i.scoreValue,s,o)}})},achManager.achievements={},achManager.preloaded=!1,achManager.preloadData=function(){gapi.client.games.achievementDefinitions.list().execute(function(t){if("games#achievementDefinitionsListResponse"===t.kind&&t.hasOwnProperty("items")){for(var e=0;e<t.items.length;e++)achManager.achievements[t.items[e].id]=t.items[e],achManager.achievements[t.items[e].id].achievementState=t.items[e].initialState;achManager.loadAchievementsEarnedByPlayer()}})},achManager.loadAchievementsEarnedByPlayer=function(){gapi.client.games.achievements.list({playerId:"me"}).execute(function(t){if("games#playerAchievementListResponse"===t.kind&&t.hasOwnProperty("items")){for(var e=[],i=0;i<t.items.length;i++){var a=t.items[i];achManager.achievements[a.id].achievementState=a.achievementState,a.hasOwnProperty("formattedCurrentStepsString")&&(achManager.achievements[a.id].formattedCurrentStepsString=a.formattedCurrentStepsString),e.push(achManager.achievements[a.id])}playService.downloadedAchievements(e),achManager.preloaded=!0}else console.log("**Unexpected response **",t)})},achManager.unlockAchievement=function(t){achManager.preloaded&&gapi.client.games.achievements.unlock({achievementId:t}).execute(function(t){t.newlyUnlocked})},achManager.reset=function(t){};var login=login||{};login.loadClient=function(){gapi.client.load("games","v1",function(){leadManager.preloadData(),achManager.preloadData()})},login.handleAuthResult=function(t){t&&!t.error?(login.loadClient(),playService.signedIn(!0)):playService.signedIn(!1)},login.showLoginDialog=function(){gapi.auth.signIn()},login.logout=function(){gapi.auth.signOut()};var googleLoginCallback=function(t){login.handleAuthResult(t)};function copy(t){var e,i,a;for(a in e=Array.isArray(t)?[]:{},t)i=t[a],e[a]="object"==typeof i?copy(i):i;return e}function addText(t,e,i,a,s,o){var h=this.game.add.text(0,0,t,{fill:"#"+a,fontWeight:"normal",font:dataStorage.fontContent},this.textGroup);return h.anchor.set(.5),h.dx=.5+e,h.dy=.5+i,h.size=Math.floor(s),h.x=h.dx*this.size.width,h.y=h.dy*this.size.height,o&&h.kill(),h}function addSpriteFromFile(t,e,i){var a;return a=this.create(0,0,t),void 0===e&&(a.kill(),e=i=0),a.anchor.set(.5),a.dx=.5+e,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a}function setTexture(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e}function addSprite(t,e,i,a,s){var o;return s||(s=this),o=dataStorage.debug?s.create(0,0,t):s.create(0,0,a,t),s&&(o.noscale=!0),o.anchor.set(.5),void 0===e&&(o.kill(),e=i=0),o.dx=.5+e,o.dy=.5+i,o.x=o.dx*this.size.width,o.y=o.dy*this.size.height,o}function makeSprite(t,e,i,a){return dataStorage.debug?t.make.sprite(i,a,e):t.make.sprite(i,a,"atlas",e)}function lockInputbak(t){t||(t=500),this.inputLockTime=this.time.now+t}function handleInputWidgetbak(){if(!this.inputWidget){if(this.game.input.activePointer.targetObject){var t=this;this.inputWidgets.forEach(function(e){e.input()&&t.showInputWidget(e)})}return null!==this.inputWidget}return hideInputWidget(this),!0}function dimmOverlaybak(t){var e=window.dimmGraphics;if(e){if(e.width===window.innerWidth&&e.height===window.innerHeight)return}else e=window.dimmGraphics=t.make.graphics(0,0);return e.clear(),e.beginFill(0),e.drawRect(0,0,window.innerWidth,window.innerHeight),e.endFill(),e}function onResize(t,e){0!==e.width&&0!==e.height||(e.width=640,e.height=480);var i=e.width,a=e.height;this.width===i&&this.height,this.width=i,this.height=a;var s=i>=a,o=0,h=0;this.headerGroup&&(this.headerGroup.size=s?this.headerGroup.landSize:this.headerGroup.portSize,o+=this.headerGroup.size.width,h+=this.headerGroup.size.height),this.boardGroup&&(this.boardGroup.size=s?this.boardGroup.landSize:this.boardGroup.portSize,o+=this.boardGroup.size.width,h+=this.boardGroup.size.height),this.controlGroup&&(this.controlGroup.size=s?this.controlGroup.landSize:this.controlGroup.portSize,o+=this.controlGroup.size.width,h+=this.controlGroup.size.height),this.adGroup&&(this.adGroup.size=s?this.adGroup.landSize:this.adGroup.portSize);var r=i/o,n=a/h,l=Math.min(r,n);l>1&&(l=1);var d,p=0,c=0;if((d=this.bgGroup)&&d.resize(l,p,c,i-p,a-c),(d=this.headerGroup)&&(d.resize(l,p,c,i-p,a-c),p+=d.size.width*d.scale.x,c+=d.size.height*d.scale.y),d=this.boardGroup){var u=0,g=0;this.controlGroup&&(u=this.controlGroup.size.width*l,g=this.controlGroup.size.height*l),d.resize(l,p,c,i-p-u,a-c-g),s?p+=d.size.width*d.scale.x:c+=d.size.height*d.scale.y}return(d=this.controlGroup)&&d.resize(l,p,c,i-p,a-c),(d=this.adGroup)&&d.resize(l,0,0,i,a),(d=this.popupGroup)&&d.resize(l,0,0,i,a),(d=this.effectGroup)&&d.resize(l,0,0,i,a),(d=this.tutorialGroup)&&d.resize(l,0,0,i,a),l}var dimOverlay=null;function fadeOutEffect(t){playService.hide();var e=t.game.add.graphics(0,0);t.world.remove(e),e.beginFill(2,0,1);var i=t.game.width,a=t.game.height,s=Math.max(i,a),o={step:s};e.drawCircle(i/2,a/2,o.step);var h=t.add.tween(o).to({step:0},500,Phaser.Easing.Quadratic.InOut,!0).onUpdateCallback(function(){e.clear(),e.beginFill(2,0,1),e.drawCircle(i/2,a/2,o.step)},this);return t.world.mask=e,h}function addPointer(t,e,i){t.add.sprite(e,i,"atlas","sudokugarden-play.png").anchor.set(.5)}function formatTime(t){var e=Math.floor(t/60);return e+":"+("0"+(t-60*e)).substr(-2)}function renderBg(t){var e=this.game.width,i=this.game.height;this.cache.checkBitmapDataKey("bmd-bg")||((a=this.make.bitmapData(e,i)).smoothed=!1,this.cache.addBitmapData("bmd-bg",a));var a=this.cache.getBitmapData("bmd-bg");a.width===e&&a.height===i||a.resize(e,i),a.clear();var s=a.ctx.createLinearGradient(0,0,0,a.height);s.addColorStop(0,"#f1e5e5"),s.addColorStop(.25,"#f1e5e5"),s.addColorStop(.5,"#2244ff"),s.addColorStop(.5,"#187d31"),s.addColorStop(1,"#8ba45d"),a.ctx.fillStyle=s,a.ctx.fillRect(0,0,e,i);var o=makeSprite(this.game,"bg-top.png",0,0);o.scale.set(t),o.width=e;var h=o.height;a.draw(o,0,0),o.destroy(),(o=makeSprite(this.game,"bg-top-below.png",0,0)).scale.set(t),a.draw(o,a.width-o.width>>1,h),o.destroy(),(o=makeSprite(this.game,"bg-grass.png",0,0)).scale.set(t),o.width=e,h=i-o.height,a.draw(o,0,i-o.height),o.destroy(),(o=makeSprite(this.game,"bg-grass-above.png",0,0)).scale.set(t),a.draw(o,a.width-o.width>>1,h-o.height),o.destroy(),this.bg||(this.bg=this.game.add.image(0,0,a),this.bg.sendToBack())}var dataStorage={URL:"http://minimindgames.com/",title:"Super Tic Tac Toe",name:"ultimate-tic-tac-toe-",fontContent:"monospace",fontHeader:"monospace",debug:!1,isAudio:!0,init:function(){if(bootState.config.app){var t=window.localStorage.getItem("option-sound")||"0";return this.isAudio="1"===t,void(this.isMusic=!1)}if("undefined"!=typeof Storage)try{var e=localStorage.getItem("audio");null!==e&&"null"!==e&&(this.isAudio="on"===e),null!==(e=localStorage.getItem(this.name+"scores"))&&"null"!==e&&playService.loadedScores(e.trim().split(" "),this),null!==(e=localStorage.getItem(this.name+"achievements"))&&"null"!==e&&playService.loadedAchievements(e.trim().split(" "),this)}catch(t){alert("err")}},setAudio:function(t){if(this.isAudio=t,!t&&this.musicPlaying&&this.musicPlaying.fadeOut(),"undefined"!=typeof Storage)try{localStorage.setItem("audio",t?"on":"off")}catch(t){}},reset:function(){if(console.log("reset dataStorage"),"undefined"!=typeof Storage)try{localStorage.removeItem(this.name+"scores"),localStorage.removeItem(this.name+"achievements")}catch(t){}},saveScores:function(){if("undefined"!=typeof Storage)try{var t=playService.getScores(),e="";t.forEach(function(t){e+=t+" "}),localStorage.setItem(this.name+"scores",e),console.log("saveScores "+e)}catch(t){}},saveAchievements:function(){if("undefined"!=typeof Storage)try{var t=playService.getAchievements("UNLOCKED"),e="";t.forEach(function(t){e+=t.id+" "}),localStorage.setItem(this.name+"achievements",e),console.log("saveAchievements "+e)}catch(t){}}};EffectGroup=function(t,e,i){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},EffectGroup.prototype=Object.create(Phaser.Group.prototype),EffectGroup.prototype.constructor=EffectGroup,EffectGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},EffectGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},EffectGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,this.spriteAtlas)},EffectGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},EffectGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t)},EffectGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=Math.floor(t.dx*this.size.width),t.y=Math.floor(t.dy*this.size.height)},EffectGroup.prototype.moveTo=function(t,e){t.dx=e.dx,t.dy=e.dy,t.x=Math.floor(t.dx*this.size.width),t.y=Math.floor(t.dy*this.size.height)},EffectGroup.prototype.enable=function(t){"sparkle"===t&&((e=this.sparkle=this.game.add.emitter(0,0,15)).makeParticles(["atlas"],["effect-star.png"]),e.setRotation(0,0),e.gravity=0,e.minRotation=-90,e.maxRotation=90,e.setAlpha(1,0,1750,Phaser.Easing.Quadratic.InOut),this.add(e));"leaf"===t&&((e=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-leaf.png"]),this.add(e));"snowflake.png"===t&&((e=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-snowflake.png"]),this.add(e));if("snowing"===t){var e=this.snowing=this.game.add.emitter(this.game.world.centerX,-32,300);this.add(e)}},EffectGroup.prototype.start=function(t,e,i,a){if(this.snowing){var s=this.snowing;this.rain?(s.makeParticles(["atlas"],["effect-rain-drop.png"]),s.maxRotation=0,s.setYSpeed(200,300),s.setXSpeed(-5,5)):(s.makeParticles(["atlas"],["effect-snowflake-1.png","effect-snowflake-2.png","effect-snowflake-3.png"]),s.setYSpeed(40,100),s.maxRotation=40),s.maxParticleScale=1,s.minParticleScale=.5,s.gravity=0,s.width=i,s.minRotation=0,s.start(!1,2e4,500)}else if(this.leaf){(s=this.leaf).x=t/this.scale.x,s.width=i,s.height=a,s.y=e/this.scale.y,s.start(!1,5e3,1450,0)}else{(s=this.sparkle).width=i,s.height=a,s.x=t/this.scale.x,s.y=e/this.scale.y,s.flow(1750,50,1,15)}},PopupGroup=function(t,e){this.size=e,Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},PopupGroup.prototype=Object.create(Phaser.Group.prototype),PopupGroup.prototype.constructor=PopupGroup,PopupGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},PopupGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},PopupGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},PopupGroup.prototype.resize=function(t,e,i,a,s){if(this.width=a,this.height=s,this.scale.set(t),this.dim.width=a,this.dim.height=s,this.banner){this.banner.x=a/2/t,this.banner.y=s/2/t,this.bannerBg.x=this.banner.x,this.bannerBg.y=this.banner.y,this.bannerBg.width=a/t;var o=2*a/3/t,h=s/2/t-.9*this.banner.height;this.quackSad&&(this.quackSad.x=o,this.quackSad.y=h),this.quack&&(this.quack.x=o,this.quack.y=h),this.bannerText.x=a/2,this.bannerText.y=s/2,this.bannerText.fontSize=32*t,this.bannerText.wordWrapWidth=500*t}this.dialogBg&&(this.dialogBg.x=a/2/this.scale.x,this.dialogBg.y=s/2/this.scale.y,this.dialogTitle.x=a/2,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogTitle.fontSize=this.dialogTitle.baseFontSize*t,this.dialogText.x=a/2,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.fontSize=32*t,this.dialogText.wordWrapWidth=500*t,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.fontSize=28*t,this.dialogTip.wordWrapWidth=500*t)},PopupGroup.prototype.enable=function(t){if(this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.5,this.dim.kill()),"popup-kid.png"===t){(l=this.banner=this.addSprite("popup-banner.png")).scale.set(.5);var e={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};(d=this.bannerText=this.game.add.text(0,0,"",e)).kill(),d.anchor.set(.5),d.wordWrap=!0,this.textGroup.add(d)}if("popup-banner.png"===t||"popup-gauge.png"===t){l=this.bannerBg=this.addSprite("popup-banner-bg.png"),l=this.banner=this.addSprite("popup-banner.png"),(l=bootState.config.app?this.quack=this.addSprite("quack-sad.png"):this.quack=this.addSpriteFromFile("quack.png")).scale.set(.375),(l=this.quackSad=this.addSprite("quack-sad.png")).scale.set(.75);e={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};if((d=this.bannerText=this.game.add.text(0,0,"",e)).kill(),d.anchor.set(.5),d.wordWrap=!0,this.textGroup.add(d),"popup-gauge.png"===t){var i=this.gaugeBg=makeSprite(this.game,"popup-gauge.png",0,16);i.anchor.set(.5),this.banner.addChild(i);var a=2*dataStorage.scoreMax,s=this.game.make.bitmapData(5*a,32);s.smoothed=!1,s.clear();var o,h=s.ctx.createLinearGradient(0,0,s.width,s.height);h.addColorStop(0,"#00ff00"),h.addColorStop(.5,"#ffff00"),h.addColorStop(1,"#ff0000"),s.ctx.fillStyle=h,s.ctx.fillRect(0,0,5*a,32),this.game.cache.removeBitmapData("bmd-gauge"),this.game.cache.addBitmapData("bmd-gauge",s),(o=this.gauge=this.game.make.sprite(0,0,this.game.cache.getBitmapData("bmd-gauge"))).anchor.set(.5),o.loadTexture(this.game.cache.getBitmapData("bmd-gauge")),this.gaugeBg.addChild(o);var r=5*-a/2;dataStorage.score<15?r+=7.5*dataStorage.score:dataStorage.score<30?(r+=112.5,r+=5*(dataStorage.score-15)):(r+=112.5,r+=75,r+=2.5*(dataStorage.score-30));var n=this.gaugePointer=this.game.make.sprite(r,0,"atlas","popup-gauge-pointer.png");n.anchor.set(.5),o.addChild(n),i.kill()}}if("popup-dialog.png"===t||"popup-dialog-quit.png"===t){var l;(l=this.dialogBg=this.addSprite("popup-dialog-bg.png")).inputEnabled=!0,l.input.useHandCursor=!1;var d;e={fill:"#83472e",align:"left",fontWeight:"bold",font:dataStorage.fontHeader};(d=this.dialogTitle=this.game.add.text(0,0,dataStorage.title,e)).baseFontSize=34,d.kill(),d.anchor.set(.6,0),d.wordWrap=!1,this.textGroup.add(d),e={fill:"#83472e",align:"left",fontWeight:"normal",font:dataStorage.fontContent},(d=this.dialogText=this.game.add.text(0,0,"",e)).kill(),d.anchor.set(.5,0),d.wordWrap=!0,this.textGroup.add(d),(d=this.dialogTip=this.game.add.text(0,0,"",e)).kill(),d.anchor.set(.5),d.wordWrap=!0,this.textGroup.add(d),this.play=makeSprite(this.game,"popup-dialog-play.png"),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0,this.play.input.priorityID=1,this.play.anchor.set(.5),l.addChild(this.play),this.claim=makeSprite(this.game,"popup-dialog-claim.png"),this.claim.inputEnabled=!0,this.claim.input.useHandCursor=!0,this.claim.input.priorityID=1,this.claim.anchor.set(.5),this.claim.kill(),this.claim.y=200,l.addChild(this.claim),"popup-dialog-quit.png"===t&&(this.quit=makeSprite(this.game,"popup-dialog-quit.png"),this.quit.inputEnabled=!0,this.quit.input.useHandCursor=!0,this.quit.anchor.set(.5),this.quit.input.priorityID=1,this.quit.y=100,l.addChild(this.quit),this.play.kill()),this.close=makeSprite(this.game,"popup-dialog-close.png"),this.close.inputEnabled=!0,this.close.input.useHandCursor=!0,this.close.input.priorityID=1,this.close.x=200,this.close.y=-250,l.addChild(this.close),this.achievementIcon=makeSprite(this.game,"popup-achievement-icon.png",115,80),this.dialogBg.addChild(this.achievementIcon),this.achievementIcon.kill()}},PopupGroup.prototype.enableGauge=function(t,e,i){this.gaugeEnabled=t},PopupGroup.prototype.gaugeX=function(){var t=dataStorage.score,e=dataStorage.scoreMax;t=45,t++;var i=5*e*2,a=Math.log(1)/Math.log(10),s=Math.log(e)/Math.log(10)-a,o=(Math.log(t)/Math.log(10)-a)/s*i;return o-=5*e,alert(o),o},PopupGroup.prototype.showBanner=function(t,e,i,a){if(this.visible||this.hideTimeout)this.hide();else{var s;this.visible=!0,this.textGroup.visible=!0,this.shade&&this.shade.revive(),this.dim.revive(),this.bannerText.revive(),this.quack.kill(),this.quackSad.kill(),(s=a?this.quackSad:this.quack).revive(),this.bannerBg.revive(),this.banner.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.hideCallback=i,this.bannerText.text=t,s.y=-this.banner.height/2-.9*this.banner.height,this.bannerBg.y=this.banner.y=-this.banner.height/2,this.gaugeBg&&(this.gaugeEnabled?this.gaugeBg.revive():this.gaugeBg.kill()),this.bannerText.y=this.banner.y*this.scale.y;var o=this.game.height,h=o/2/this.scale.y-.9*this.banner.height,r=o/2/this.scale.y,n=o/2;this.game.add.tween(s).to({y:h},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.banner).to({y:r},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerBg).to({y:r},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerText).to({y:n},750,Phaser.Easing.Back.Out,!0,500),e&&(this.hideTimeout=this.game.time.events.add(e,function(){this.hideBanner()},this)),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)}},PopupGroup.prototype.hideBanner=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var t,e=this.game.height;t=this.quack.visible?this.quack:this.quackSad;var i=Phaser.Easing.Quadratic.In,a=e/this.scale.y+this.banner.height,s=e/this.scale.y+this.banner.height+t.height/2;this.game.add.tween(t).to({y:a},500,i,!0),this.game.add.tween(this.banner).to({y:s},500,i,!0),this.game.add.tween(this.bannerBg).to({y:s},500,i,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.shade&&this.shade.kill(),this.dim.kill(),this.bannerText.kill(),this.banner.kill(),this.bannerBg.kill(),this.hideCallback&&this.hideCallback.popupHidden.call(this.hideCallback)},this);var o=s*this.scale.y;this.game.add.tween(this.bannerText).to({y:o},500,i,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},PopupGroup.prototype.showDialog=function(t,e,i,a,s,o,h){if(this.visible||this.hideTimeout)this.hide();else{this.visible=!0,this.textGroup.visible=!0,this.claim.kill(),o?(this.dialogTitle.text=o,this.achievementIcon.revive(),h&&(this.claim.revive(),this.play.kill())):(this.dialogTitle.text=dataStorage.title,this.achievementIcon.kill()),this.dim.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.quit&&(s?this.quit.revive():this.quit.kill()),this.dialogBg.revive(),this.dialogText.text=t,this.dialogText.revive(),this.dialogTitle.revive(),e&&(this.dialogTip.text=e,this.dialogTip.revive()),this.hideCallback=i;var r=this.game.width/this.scale.x,n=this.game.height/this.scale.y,l=-this.dialogBg.width/2;this.dialogBg.x=l,this.dialogBg.y=n/2,this.play.y="ACHIEVEMENT"!==e?200:0,this.dialogTitle.x=l*this.scale.x,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogText.x=l*this.scale.x,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.wordWrapWidth=500*this.scale.y,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.wordWrapWidth=500*this.scale.y;var d=600;a||(d=1);var p=r/2;this.game.add.tween(this.dialogBg).to({x:p},d,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTitle).to({x:p*this.scale.x},d,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogText).to({x:p*this.scale.x},d,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTip).to({x:p*this.scale.x},d,Phaser.Easing.Back.Out,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)}},PopupGroup.prototype.hideDialog=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var t=-this.dialogBg.width/2;this.game.add.tween(this.dialogTitle).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogText).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogTip).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogBg).to({x:t},500,Phaser.Easing.Back.In,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.dialogBg.kill(),this.dialogTitle.kill(),this.dialogText.kill(),this.dialogTip.kill(),this.achievementIcon.kill()},this),this.hideCallback&&this.hideCallback.popupHidden.call(this.hideCallback),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},PopupGroup.prototype.hide=function(){this.banner&&this.banner.visible?this.hideBanner():this.dialogBg&&this.dialogBg.visible&&this.hideDialog()},TutorialGroup=function(t,e){this.size=e,Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},TutorialGroup.prototype=Object.create(Phaser.Group.prototype),TutorialGroup.prototype.constructor=TutorialGroup,TutorialGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},TutorialGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},TutorialGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},TutorialGroup.prototype.resize=function(t,e,i,a,s){this.width=a,this.height=s,this.scale.set(t),this.dim&&(this.dim.width=a,this.dim.height=s/4),this.targetSprite&&this.handPosition()},TutorialGroup.prototype.enable=function(t){this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.75,this.dim.kill()),this.hand=this.addSprite("popup-hand.png",0,0);var e={fill:"#ffffff",align:"center",font:dataStorage.fontContent},i=this.handText=this.game.add.text(0,0,"",e);i.anchor.set(.5),i.wordWrap=!0,this.textGroup.add(i)},TutorialGroup.prototype.handPosition=function(){this.game.world.bringToTop(this),this.handText.x=this.game.width/2,this.handText.y=this.game.height/8,this.handText.fontSize=32*this.scale.x,this.handText.wordWrapWidth=400*this.scale.x;var t=this.targetSprite,e=this.targetGroup;this.hand.x=e.centerX(t)-this.hand.width/2*this.scale.x,this.hand.y=e.centerY(t),this.hand.x/=this.scale.x,this.hand.y/=this.scale.y},TutorialGroup.prototype.pointHand=function(t,e,i){this.visible=!0,this.hand.revive(),this.targetSprite=t,this.targetGroup=e,this.handPosition(),this.game.time.events.add(i,function(){this.hide()},this)},TutorialGroup.prototype.showHand=function(t,e,i){this.visible=!0,this.textGroup.visible=!0,this.step=1,this.dim.revive(),this.hand.revive(),this.targetSprite=e,this.targetGroup=i,this.handPosition(),this.handText.text=t,this.game.world.bringToTop(this.textGroup),this.handText.bringToTop(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},TutorialGroup.prototype.hideHand=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},TutorialGroup.prototype.hide=function(){this.hideHand()},TutorialGroup.prototype.nextStep=function(t,e,i){var a,s;(this.step++,this.handText.text=t,void 0!==e)&&(a=i.centerX(e)-this.hand.width/2*this.scale.x,s=i.centerY(e),a/=this.scale.x,s/=this.scale.y,this.targetSprite=e,this.targetGroup=i,this.game.add.tween(this.hand).to({x:a,y:s},750,Phaser.Easing.Back.InOut,!0).onComplete.add(function(){},this))},TutorialGroup.prototype.handTarget=function(){return this.targetSprite},AdGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.main=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},AdGroup.prototype=Object.create(Phaser.Group.prototype),AdGroup.prototype.constructor=AdGroup,AdGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},AdGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},AdGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},AdGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t),this.size===this.landSize?(this.exit.x=this.exit.width,this.exit.y=s/2/t):(this.exit.x=this.exit.width,this.exit.y=s/t-this.exit.height)},AdGroup.prototype.enable=function(t){this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0},BgGroup=function(t){Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.spriteAtlas="atlas",this.size={width:t.width,height:t.height}},BgGroup.prototype=Object.create(Phaser.Group.prototype),BgGroup.prototype.constructor=BgGroup,BgGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},BgGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},BgGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,this.spriteAtlas)},BgGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},BgGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t),this.size.width=a,this.size.height=s;var o=a,h=s;this.children.forEach(function(e){"cache/atlas/bg-top.png"===e.frameName?(e.x=a/2/t,e.y=e.height/2,e.width=Math.floor(a/t),this.topY=e.height):"cache/atlas/bg-top-below.png"===e.frameName?(e.x=a/2/t,e.y=this.topY+e.height/2):"cache/atlas/bg-grass.png"===e.frameName?(e.x=a/2/t,e.y=h*t-e.height,e.width=Math.floor(a/t),this.bottomY=e.height):"cache/atlas/bg-bottom-above.png"===e.frameName?(e.x=a/2/t,e.y=h/t-this.bottomY-e.height/2):(1===e.dx?e.x=o*e.dx/t-e.width/2:e.x=o/2/t,1!==e.dy?e.y=h*e.dy/t:e.y=h/t-e.height/2)},this)},BoardGroup=function(t,e,i){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},BoardGroup.prototype=Object.create(Phaser.Group.prototype),BoardGroup.prototype.constructor=BoardGroup,BoardGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},BoardGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},BoardGroup.prototype.addSprite=function(t,e,i,a){var s=this;return a&&(s=this.textGroup),addSprite.call(this,t,e,i,this.spriteAtlas,s)},BoardGroup.prototype.addBitmap=function(t,e,i){var a;return a=this.create(0,0,t),void 0===e&&(a.kill(),e=i=0),a.anchor.set(.5),a.dx=.5+e,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a},BoardGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},BoardGroup.prototype.resize=function(t,e,i,a,s){if(this.scale.set(t),bootState.config.app){a>s?e-=80:i-=70;var o=a>s?a/s:s/a;o<=1.4&&(a>s?e-=10:i-=30)}var h=this.size.width,r=this.size.height;this.textGroup.x=this.x=(a-h*t)/2+e,this.textGroup.y=this.y=(s-r*t)/2+i,this.children.forEach(function(t){t.x=t.dx*h,t.y=t.dy*r},this),this.textGroup.forEach(function(e){var i=t;e.x=e.dx*h*i,e.y=e.dy*r*i,e.fontSize=Math.floor(e.size*i)+"px"},this),this.worldX=this.x+this.size.width/2*t,this.worldY=this.y+this.size.height/2*t,bootState.config.app&&this.techButton&&(o<=1.4&&(a>s?this.techButton.x-=40:this.techButton.y-=30),a>s?(this.techButton.x+=this.width/2/t+1*this.techButton.width,this.adButton.x=this.techButton.x,this.adButton.y=this.techButton.y+1.5*this.techButton.height,this.helpText.x=-this.techButton.width/2):(this.techButton.y+=this.height/2/t+1.25*this.techButton.height,this.adButton.x=this.techButton.x-1.75*this.techButton.width,this.adButton.y=this.techButton.y,this.helpText.x=-this.helpText.width/2,this.problemDone&&this.adButton.visible&&(this.techButton.x+=1*this.techButton.width,this.helpText.x-=1.25*this.techButton.width)))},BoardGroup.prototype.getCenterX=function(t){return this.x+t.dx*this.size.width*this.scale.x},BoardGroup.prototype.getCenterY=function(t){return this.y+t.dy*this.size.height*this.scale.y},BoardGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},BoardGroup.prototype.moveTo=function(t,e){t.dx=e.dx,t.dy=e.dy,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},BoardGroup.prototype.xy=function(t,e){return{x:t*this.size.width,y:e*this.size.height}},ControlGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.smallScreen=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},ControlGroup.prototype=Object.create(Phaser.Group.prototype),ControlGroup.prototype.constructor=ControlGroup,ControlGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},ControlGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},ControlGroup.prototype.addSprite=function(t,e,i,a,s){var o=addSprite.call(this,t,e,i,this.spriteAtlas);return o.portx=a,o.porty=s,o},ControlGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},ControlGroup.prototype.resize=function(t,e,i,a,s){if(this.scale.set(t),this.size===this.landSize){this.exit&&this.exit.kill();var o=this.size.width,h=s;this.children.forEach(function(t){t.x=t.dx*o,t.y=t.dy*h},this)}else{this.exit&&this.exit.revive();o=a,h=this.size.height;this.children.forEach(function(t){t.x=t.portx*o,t.y=t.porty*h},this)}this.textGroup.x=this.x=(a-o*t)/2+e,this.textGroup.y=this.y=(s-h*t)/2+i,this.textGroup.forEach(function(e){e.x=e.dx*o*t,e.y=e.dy*h*t,e.fontSize=Math.floor(e.size*t)+"px"},this)},ControlGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},ControlGroup.prototype.getCenterX=function(t){return this.x+t.x*this.scale.x},ControlGroup.prototype.getCenterY=function(t){return this.y+t.y*this.scale.y},HeaderGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.state=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group()},HeaderGroup.prototype=Object.create(Phaser.Group.prototype),HeaderGroup.prototype.constructor=HeaderGroup,HeaderGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},HeaderGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},HeaderGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},HeaderGroup.prototype.resize=function(t,e,i,a,s){var o,h;t<.5&&(t=.5),this.scale.set(t);var r=10*t;if(this.option&&(o=this.option.width,h=this.option.height,this.size===this.landSize?(this.optionBg.x=this.option.x=o/2+r,this.optionBg.y=this.option.y=s/t-h/2-r,this.optionSound.x=120,this.optionSound.y=-100,this.optionFullscreen.x=50,this.optionFullscreen.y=-150,this.optionReset.x=170,this.optionReset.y=-0,playService.resize(r,r,t),this.info&&(this.info.x=this.option.x,this.info.y=this.option.y-h-2*r)):(this.optionBg.x=this.option.x=a/t-o/2-r,this.optionBg.y=this.option.y=h/2+r,this.optionSound.x=-120,this.optionSound.y=100,this.optionFullscreen.x=-155,this.optionFullscreen.y=25,this.optionReset.x=0,this.optionReset.y=165,playService.resize(r,r,t),this.info&&(this.info.x=this.option.x-o-2*r,this.info.y=this.option.y))),this.exit&&(this.size===this.landSize?(this.exit.revive(),o=this.exit.width,h=this.exit.height,this.exit.x=o/2+r,this.exit.y=h/2+r):(o=this.exit.width,h=this.exit.height,this.exit.x=o/2+r,this.exit.y=h/2+r)),this.score&&(o=this.score.width,h=this.score.height,this.size===this.landSize?(this.score.frameName!=="header-"+this.scoreTime+"-land.png"&&this.setTexture(this.score,"header-"+this.scoreTime+"-land.png"),this.score.x=this.score.width/2+r/2,this.exit,this.score.y=s/2/t,this.scoreLabel.x=this.score.x*t,this.scoreLabel.y=(this.score.y+24)*t):(this.score.frameName!=="header-"+this.scoreTime+"-port.png"&&this.setTexture(this.score,"header-"+this.scoreTime+"-port.png"),this.score.x=a/2/t,this.score.y=h/2+r,this.scoreLabel.x=(this.score.x+25)*t,this.scoreLabel.y=(this.score.y+6)*t),this.scoreLabel.fontSize=Math.floor(38*t)),this.health&&this.health.length)if(o=this.health[0].width,h=this.health[0].height,this.size===this.landSize)for(var n=0;n<this.health.length;n++)this.health[n].x=this.size.width/2-o/2,this.health[n].y=s/2/t-h+n*h*5/4;else for(n=0;n<this.health.length;n++)this.health[n].x=a/2/t-o+n*o*5/4,this.health[n].y=this.size.height/2-h/2},HeaderGroup.prototype.enable=function(t){if("header-option.png"===t)this.optionBg=this.addSprite("header-option-bg.png",0,0),this.optionBg.kill(),this.optionSound=this.addSprite("header-option-sound.png",0,0),this.optionSound.inputEnabled=!0,this.optionSound.input.useHandCursor=!0,this.optionBg.addChild(this.optionSound),this.optionFullscreen=this.addSprite("header-option-fullscreen.png",0,0),this.optionFullscreen.inputEnabled=!0,this.optionFullscreen.input.useHandCursor=!0,this.optionFullscreen.events.onInputDown.add(this.onFullscreen,this),this.optionBg.addChild(this.optionFullscreen),this.optionReset=this.addSprite("header-option-reset.png",0,0),this.optionReset.inputEnabled=!0,this.optionReset.input.useHandCursor=!0,this.optionBg.addChild(this.optionReset),this.optionReset.kill(),this.option=this.addSprite(t,0,0),this.option.inputEnabled=!0,this.option.input.useHandCursor=!0;else if("header-health.png"===t){this.health=[];for(var e=0;e<3;e++)this.health[e]=this.addSprite("header-health.png",0,0),this.health[e].inputEnabled=!0,this.health[e].input.useHandCursor=!0}else if("header-score.png"===t||"header-time.png"===t||"header-bug.png"===t){this.scoreTime="header-bug.png"===t?"bug":"header-time.png"===t?"time":"score",this.score=this.addSprite("header-"+this.scoreTime+"-land.png",0,0),this.score.inputEnabled=!0,this.score.input.useHandCursor=!0;var i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5)}else if("header-exit.png"===t)this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-quack.png"===t)this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-ad.png"===t);else if("header-info.png"===t){var a=this.info=this.addSprite("header-info.png",0,0);a.inputEnabled=!0,a.input.useHandCursor=!0}},HeaderGroup.prototype.onFullscreen=function(){this.game.scale.isFullScreen?(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart,this.game.scale.stopFullScreen()):(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart+1,this.game.scale.startFullScreen(!1)),this.state.popupGroup.dim.kill()},HeaderGroup.prototype.showOption=function(){this.game.world.bringToTop(this),this.scoreLabel&&this.scoreLabel.bringToTop(),this.game.scale.isFullScreen?this.setTexture(this.optionFullscreen,"header-option-fullscreen-active.png"):this.setTexture(this.optionFullscreen,"header-option-fullscreen.png"),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"),this.optionBg.scale.set(0),this.optionBg.revive();this.game.add.tween(this.optionBg.scale).to({x:1,y:1},500,Phaser.Easing.Back.InOut,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},HeaderGroup.prototype.hideOption=function(){this.game.add.tween(this.optionBg.scale).to({x:0,y:0},500,Phaser.Easing.Back.InOut,!0).onComplete.addOnce(function(){this.optionBg.kill()},this),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},HeaderGroup.prototype.select=function(t){t===this.optionSound&&(dataStorage.setAudio(!dataStorage.isAudio),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"))},HeaderGroup.prototype.setScore=function(t){this.scoreLabel&&(this.scoreLabel.text=t)},playLogic={row:3,col:3,init:function(t,e,i){this.grid=t,this.time=e,this.rnd=i,this.winMultipliers||(this.winMultipliers=[[[79,78,77,40,41,42,43,44,30,21,22,23,24],[69,68,67,30,31,32,33,34,20,11,12,13,14]],[[89,88,87,51,52,53,54,65,51,31,32,33,34],[79,78,77,40,41,42,43,44,30,21,22,23,24]]]),this.aiWinCount||(this.aiWinCount=[0,0,0])},start:function(t){this.gameOver=!1,playState.trainAI&&(this.wins||(this.wins=0));for(var e=0;e<3;e++)for(var i=0;i<3;i++)for(var a=this.grid.cells[e][i],s=0;s<3;s++)for(var o=0;o<3;o++){var h=a[s][o];if(h.weights)for(var r=0;r<2;r++)h.weights[r][0]=h.weights[r][1]=0,h.totalWeights[r][0]=h.totalWeights[r][1]=0,h.weight=0;else h.weights=[[0,0],[0,0]],h.totalWeights=[[0,0],[0,0]],h.weight=0}},updateMultipliers:function(t){this.aiWinCount[t-1]++,console.log("Winners "+this.aiWinCount)},turn:function(t){var e,i;for(r=0;r<3;r++)for(n=0;n<3;n++)for(i=0;i<3;i++)for(p=0;p<3;p++){var a=this.grid.cells[r][n];a[i][p].weight=0;for(var s=0;s<2;s++)a[i][p].weights[0][s]=a[i][p].weights[1][s]=0,a[i][p].totalWeights[0][s]=a[i][p].totalWeights[1][s]=0}if(null===this.grid.board){for(var o=[],h=0,r=0;r<3;r++)for(var n=0;n<3;n++)if(this.grid.solvedBoards[r][n]<1||this.grid.solvedBoards[r][n]>3){var l=this.bestMove(t,n,r);l.weight>=h&&(h=l.weight,o.push(l))}for(var d=0,p=0,c=o.length;p<c;p++)o[p].weight===h&&d++;for(s=this.rnd.integerInRange(0,d-1),p=0;s>=0;p++)o[p].weight===h&&(s--,e=o[p])}else e=this.bestMove(t,this.grid.boardX,this.grid.boardY);return e},rand:function(t){for(var e=t.length-1;e>=0;e--){var i=this.rnd.integerInRange(0,e),a=t[e];t[e]=t[i],t[i]=a}return t},calcBoards:function(t,e){this.matchFreeCell(t,e),this.matchCellBoard(t,e),this.matchRow(t,e),this.match2ToRow(t,e),this.matchFreeRow(t,e);var i=this.grid.cells[e][t];this.grid.possibleRows(i,1),this.grid.possibleRows(i,2)},matchFreeCell:function(t,e){var i,a,s=this.grid.cells[e][t];for(a=0;a<3;a++)for(i=0;i<3;i++){var o=s[a][i];0===o.val?o.isFree=1:o.isFree=0}},matchCellBoard:function(t,e){var i=this.grid.cells[e][t][e][t];0===i.val?i.isCellToBoard=1:i.isCellToBoard=0},matchRow:function(t,e){var i,a,s,o=this.grid.cells[e][t];for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatchRow)for(i=0;i<2;i++)h.isMatchRow[i]=0;else h.isMatchRow=[0,0]}for(i=0;i<2;i++){var h,r=i+1;0===(h=(o=this.grid.cells[e][t])[0][0]).val&&(o[0][1].val===r&&o[0][2].val===r&&h.isMatchRow[i]++,o[1][0].val===r&&o[2][0].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][2].val===r&&h.isMatchRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val===r&&o[0][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][1].val===r&&h.isMatchRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val===r&&o[0][1].val===r&&h.isMatchRow[i]++,o[1][2].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][1]).val&&(o[0][1].val===r&&o[2][1].val===r&&h.isMatchRow[i]++,o[1][0].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val===r&&o[1][1].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[2][2].val===r&&h.isMatchRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val===r&&o[1][0].val===r&&h.isMatchRow[i]++,o[2][1].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[0][2].val===r&&h.isMatchRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[0][1].val===r&&h.isMatchRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val===r&&o[2][1].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[1][1].val===r&&h.isMatchRow[i]++)}},match2ToRow:function(t,e){var i,a,s,o=this.grid.cells[e][t];for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatch2ToRow)for(i=0;i<2;i++)h.isMatch2ToRow[i]=0;else h.isMatch2ToRow=[0,0]}for(i=0;i<2;i++){var h,r=i+1;0===(h=(o=this.grid.cells[e][t])[0][0]).val&&(o[0][1].val!==r&&o[0][2].val!==r||0!==o[0][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][0].val!==r&&o[2][0].val!==r||0!==o[1][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][2].val!==r||0!==o[1][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val!==r&&o[0][2].val!==r||0!==o[0][0].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][1].val!==r||0!==o[1][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val!==r&&o[0][1].val!==r||0!==o[0][0].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++,o[1][2].val!==r&&o[2][2].val!==r||0!==o[1][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][0].val!==r||0!==o[1][1].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val!==r&&o[1][2].val!==r||0!==o[1][1].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[2][0].val!==r||0!==o[0][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][1]).val&&(o[1][0].val!==r&&o[1][2].val!==r||0!==o[1][0].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][1].val!==r&&o[2][1].val!==r||0!==o[0][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[2][2].val!==r||0!==o[0][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[2][0].val!==r||0!==o[0][2].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val!==r&&o[1][1].val!==r||0!==o[1][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[2][2].val!==r||0!==o[0][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val!==r&&o[1][0].val!==r||0!==o[0][0].val&&0!==o[1][0].val||h.isMatch2ToRow[i]++,o[2][1].val!==r&&o[2][2].val!==r||0!==o[2][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[0][2].val!==r||0!==o[1][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val!==r&&o[2][2].val!==r||0!==o[2][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[0][1].val!==r||0!==o[1][1].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val!==r&&o[2][1].val!==r||0!==o[2][0].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[1][2].val!==r||0!==o[0][2].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[1][1].val!==r||0!==o[0][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++)}},matchFreeRow:function(t,e){var i,a,s=this.grid.cells[e][t];for(a=0;a<3;a++)for(i=0;i<3;i++){s[a][i].isMatchFreeRow=0}for(i=0;i<3;i++)0===s[i][0].val&&0===s[i][1].val&&0===s[i][2].val&&(s[i][0].isMatchFreeRow++,s[i][1].isMatchFreeRow++,s[i][2].isMatchFreeRow++);for(i=0;i<3;i++)0===s[0][i].val&&0===s[1][i].val&&0===s[2][i].val&&(s[0][i].isMatchFreeRow++,s[1][i].isMatchFreeRow++,s[2][i].isMatchFreeRow++);0===s[0][0].val&&0===s[1][1].val&&0===s[2][2].val&&(s[0][0].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][2].isMatchFreeRow++),0===s[0][2].val&&0===s[1][1].val&&0===s[2][0].val&&(s[0][2].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][0].isMatchFreeRow++)},fuzzyBoard:function(t,e,i,a,s){this.calcBoards(t,e);for(var o=this.grid.cells[e][t],h=0,r=0;r<2;r++){var n,l,d=this.winMultipliers[r][a];for(l=0;l<3;l++)for(n=0;n<3;n++){var p=o[l][n];if(0===p.val){var c=0,u=0;1===p.isMatchRow[r]?(c=Math.max(d[0],c),u+=d[0]):2===p.isMatchRow[r]?(c=Math.max(d[1],c),u+=d[1]):3===p.isMatchRow[r]&&(c=Math.max(d[2],c),u+=d[2]),1===p.isMatch2ToRow[r]?(c=Math.max(d[3],c),u+=d[3]):2===p.isMatch2ToRow[r]?(c=Math.max(d[4],c),u+=d[4]):3===p.isMatch2ToRow[r]?(c=Math.max(d[5],c),u+=d[5]):4===p.isMatch2ToRow[r]?(c=Math.max(d[6],c),u+=d[6]):5===p.isMatch2ToRow[r]&&(c=Math.max(d[7],c),u+=d[7]),p.isCellToBoard&&(c=Math.max(d[8],c),u+=d[8]),1===p.isMatchFreeRow?(c=Math.max(d[9],c),u+=d[9]):2===p.isMatchFreeRow?(c=Math.max(d[10],c),u+=d[10]):3===p.isMatchFreeRow?(c=Math.max(d[11],c),u+=d[11]):4===p.isMatchFreeRow&&(c=Math.max(d[12],c),u+=d[12]),c=Math.max(1,c),s?h=Math.max(h,c):(p.weights[a][r]=c,p.totalWeights[a][r]=u)}}}return s?h:o},boardWeight:function(t,e,i,a,s){var o,h,r=0,n=this.grid.cells[e][t];if(this.grid.solvedBoards[e][t]>=1&&this.grid.solvedBoards[e][t]<=3)return n[0][0].weight;for(h=0;h<3;h++)for(o=0;o<3;o++)n[h][o].weights[s][i-1]>r&&(r=n[h][o].weights[s][i-1]),n[h][o].weights[s][a-1]>r&&(r=n[h][o].weights[s][a-1]);return r},countLines:function(t,e,i,a){var s,o,h=0,r=0,n=0,l=0,d=0,p=0,c=0;for(s=0;s<3;s++){if(3===this.grid.solvedBoards[a][s]||4===this.grid.solvedBoards[a][s]){h++,c=0;break}if(1===this.grid.solvedBoards[a][s]||2===this.grid.solvedBoards[a][s])if(p>0){if(this.grid.solvedBoards[a][s]!==p){h++,c=0;break}c++}else(p=this.grid.solvedBoards[a][s])>0&&c++}for(2===c&&(p===t?r++:n++),1===c&&(p===t?l++:d++),p=0,c=0,s=0;s<3;s++){if(3===this.grid.solvedBoards[s][i]||4===this.grid.solvedBoards[s][i]){h++,c=0;break}if(1===this.grid.solvedBoards[s][i]||2===this.grid.solvedBoards[s][i])if(p>0){if(this.grid.solvedBoards[s][i]!==p){h++,c=0;break}c++}else(p=this.grid.solvedBoards[s][i])>0&&c++}if(2===c&&(p===t?r++:n++),1===c&&(p===t?l++:d++),0===i&&0===a||1===i&&1===a||2===i&&2===a){for(p=0,c=0,s=0;s<3;s++){if(3===this.grid.solvedBoards[s][s]||4===this.grid.solvedBoards[s][s]){h++,c=0;break}if(1===this.grid.solvedBoards[s][s]||2===this.grid.solvedBoards[s][s])if(p>0){if(this.grid.solvedBoards[s][s]!==p){h++,c=0;break}c++}else(p=this.grid.solvedBoards[s][s])>0&&c++}2===c&&(p===t?r++:n++),1===c&&(p===t?l++:d++)}if(2===i&&0===a||1===i&&1===a||0===i&&2===a){for(p=0,c=0,s=0;s<3;s++){if(3===this.grid.solvedBoards[s][2-s]||4===this.grid.solvedBoards[s][2-s]){h++,c=0;break}if(1===this.grid.solvedBoards[s][2-s]||2===this.grid.solvedBoards[s][2-s])if(p>0){if(this.grid.solvedBoards[s][2-s]!==p){h++,c=0;break}c++}else(p=this.grid.solvedBoards[s][2-s])>0&&c++}2===c&&(p===t?r++:n++),1===c&&(p===t?l++:d++)}return(0===i&&0===a||2===i&&0===a||0===i&&2===a||2===i&&2===a)&&(o=3),(1===i&&0===a||0===i&&1===a||2===i&&1===a||1===i&&2===a)&&(o=2),1===i&&1===a&&(o=4),{possible:o-h,myWinLines:r,oppWinLines:n,myLines:l,oppLines:d}},fuzzyLines:function(t,e,i,a,s){var o,h;for(h=0;h<3;h++)i[h]=0,a[h]=0,s[h]=0;for(h=0;h<3;h++){var r=0;for(o=0;o<3;o++){if(3===this.grid.solvedBoards[h][o]||4===this.grid.solvedBoards[h][o]){i[h]=1;break}if(this.grid.solvedBoards[h][o]>0)if(r>0){if(this.grid.solvedBoards[h][o]!==r){i[h]=1;break}}else r=this.grid.solvedBoards[h][o]}}for(h=0;h<3;h++)if(0===i[h])for(o=0;o<3;o++)this.grid.solvedBoards[h][o]===t&&a[h]++,this.grid.solvedBoards[h][o]===e&&s[h]++},winBoard:function(t,e,i){var a,s;for(s=0;s<3;s++)for(a=0;a<3;a++){var o=e[s][a];if(0===o.val&&o.isMatchRow[t-1]>0)return o}return null},easyMove:function(t,e,i,a){var s,o,h=this.fuzzyBoard(i,a,t,0);for(o=0;o<3;o++)for(s=0;s<3;s++)h[o][s].weights[0][t-1]>=h[o][s].weights[0][e-1]?(h[o][s].weight=h[o][s].weights[0][t-1],h[o][s].totalWeight=h[o][s].totalWeights[0][t-1]):h[o][s].weights[0][e-1]>0&&(h[o][s].weight=h[o][s].weights[0][e-1],h[o][s].totalWeight=h[o][s].totalWeights[0][e-1]);if(0===this.countLines(t,e,i,a).possible)for(o=0;o<3;o++)for(s=0;s<3;s++)for(var r=0;r<2;r++)h[o][s].weight>0&&(h[o][s].weight=100,h[o][s].totalWeight=100);return this.randBestWeight(t-1,e-1,h)},fairMove:function(t,e,i,a){var s=this.fuzzyBoard(i,a,t,0);if((p=this.countLines(t,e,i,a)).myWinLines>0){var o=this.winBoard(t,s,0);if(o&&o.weight>75)return o}if(0===p.possible)for(n=0;n<3;n++)for(r=0;r<3;r++)for(var h=0;h<2;h++)s[n][r].weight>0&&(s[n][r].weight=100,s[n][r].totalWeight=100);else{var r,n;for(n=0;n<3;n++)for(r=0;r<3;r++)s[n][r].weights[0][t-1]>=s[n][r].weights[0][e-1]?(s[n][r].weight=s[n][r].weights[0][t-1],s[n][r].totalWeight=s[n][r].totalWeights[0][t-1]):s[n][r].weights[0][e-1]>0&&(s[n][r].weight=s[n][r].weights[0][e-1],s[n][r].totalWeight=s[n][r].totalWeights[0][e-1])}for(n=0;n<3;n++)for(r=0;r<3;r++)if(0===s[n][r].val){var l=s[n][r].val;s[n][r].val=t,this.grid.solvedBoards[n][r]>0&&this.grid.solvedBoards[n][r]<4?this.bestOfAllBoards(r,n,e,1):this.fuzzyBoard(r,n,e,1),s[n][r].val=l}for(n=0;n<3;n++)for(r=0;r<3;r++){var d,p;if(0===s[n][r].val)d=0===(p=this.countLines(t,e,i,a)).possible&&(this.grid.solvedBoards[n][r]<1||this.grid.solvedBoards[n][r]>3)?100:100-this.boardWeight(r,n,e,t,1),s[n][r].weight>60&&(s[n][r].weight+=50),s[n][r].weight+=d}return this.randBestWeight(t-1,e-1,s)},hardMove:function(t,e,i,a){var s,o,h=this.fuzzyBoard(i,a,t,0);if((f=this.countLines(t,e,i,a)).myWinLines>0){var r=this.winBoard(t,h);if(r)return r.weight=r.totalWeight=1e3,r}if(2===f.oppWinLines){var n=this.winBoard(t,h);if(null===n&&(n=this.winBoard(e,h)),n)return n.weight=n.totalWeight=999,n}if(0===f.possible)for(p=0;p<3;p++)for(d=0;d<3;d++)for(var l=0;l<2;l++)h[p][d].weight>0&&(h[p][d].weight=100,h[p][d].totalWeight=100);else{var d,p;for(p=0;p<3;p++)for(d=0;d<3;d++)h[p][d].weights[0][t-1]>=h[p][d].weights[0][e-1]?(h[p][d].weight=h[p][d].weights[0][t-1],h[p][d].totalWeight=h[p][d].totalWeights[0][t-1]):h[p][d].weights[0][e-1]>0&&(h[p][d].weight=h[p][d].weights[0][e-1],h[p][d].totalWeight=h[p][d].totalWeights[0][e-1])}for(p=0;p<3;p++)for(d=0;d<3;d++)if(0===h[p][d].val){var c=h[p][d].val;h[p][d].val=t,this.grid.solvedBoards[p][d]>0&&this.grid.solvedBoards[p][d]<4?this.bestOfAllBoards(d,p,e,1):this.fuzzyBoard(d,p,e,1),h[p][d].val=c}for(o=0;o<3;o++){var u=0,g=0;for(s=0;s<3;s++)if(this.grid.solvedBoards[o][s]<1){var m=this.grid.cells[o][s];u+=this.grid.possibleRows(m,t),g+=this.grid.possibleRows(m,e)}if(u>g)v=-Math.floor((u-g)/3);else{if(!(g>u))continue;v=-Math.floor((g-u)/3)}for(s=0;s<3;s++)0===h[o][s].val&&(h[o][s].weight+=v,h[o][s].weight<1&&(h[o][s].weight=1))}for(s=0;s<3;s++){u=0,g=0;for(o=0;o<3;o++)if(this.grid.solvedBoards[o][s]<1){m=this.grid.cells[o][s];u+=this.grid.possibleRows(m,t),g+=this.grid.possibleRows(m,e)}if(u>g)v=-Math.floor((u-g)/3);else{if(!(g>u))continue;v=-Math.floor((g-u)/3)}for(o=0;o<3;o++)0===h[o][s].val&&(h[o][s].weight+=v,h[o][s].weight<1&&(h[o][s].weight=1))}for(p=0;p<3;p++){u=0,g=0;if(this.grid.solvedBoards[p][p]<1){m=this.grid.cells[p][p];u+=this.grid.possibleRows(m,t),g+=this.grid.possibleRows(m,e)}if(u>g)v=-Math.floor((u-g)/3);else{if(!(g>u))continue;v=-Math.floor((g-u)/3)}for(d=0;d<3;d++)0===h[d][d].val&&(h[d][d].weight+=v,h[d][d].weight<1&&(h[d][d].weight=1))}for(p=0;p<3;p++){var v;u=0,g=0;if(this.grid.solvedBoards[p][2-p]<1){m=this.grid.cells[p][2-p];u+=this.grid.possibleRows(m,t),g+=this.grid.possibleRows(m,e)}if(u>g)v=-Math.floor((u-g)/3);else{if(!(g>u))continue;v=-Math.floor((g-u)/3)}for(d=0;d<3;d++)0===h[d][2-d].val&&(h[d][2-d].weight+=v,h[d][2-d].weight<1&&(h[d][2-d].weight=1))}for(p=0;p<3;p++)for(d=0;d<3;d++){var f,w;if(0===h[p][d].val)(f=this.countLines(t,e,d,p)).myWinLines>0&&(h[p][d].weight-=40),f.oppWinLines>0&&(h[p][d].weight-=30),f.myLines>0&&(h[p][d].weight-=25),f.oppLines>0&&(h[p][d].weight-=20),h[p][d].weight<1&&(h[p][d].weight=1),w=0===f.possible&&(this.grid.solvedBoards[p][d]<1||this.grid.solvedBoards[p][d]>3)?100:100-this.boardWeight(d,p,e,t,1),h[p][d].weight>60&&(h[p][d].weight+=50),h[p][d].weight+=w}return this.randBestWeight(t-1,e-1,h)},bestOfAllBoards:function(t,e,i,a){var s,o,h=this.grid.cells[e][t],r=0;for(o=0;o<3;o++)for(s=0;s<3;s++)(this.grid.solvedBoards[o][s]<1||this.grid.solvedBoards[o][s]>3)&&(r=Math.max(r,this.fuzzyBoard(s,o,i,a,h)));h[0][0].weight=r},randBestWeight:function(t,e,i){var a,s,o=0;for(s=0;s<3;s++)for(a=0;a<3;a++)0===i[s][a].val&&i[s][a].weight>o&&(o=i[s][a].weight,a,s);var h=0,r=-11;for(s=0;s<3;s++)for(a=0;a<3;a++){var n=i[s][a];0===i[s][a].val&&n.weight===o&&(n.totalWeight>r+10?(r=n.totalWeight,h=1):n.totalWeight===r&&h++)}var l,d=this.rnd.integerInRange(0,h-1);for(s=0;s<3&&d>=0;s++)for(a=0;a<3&&d>=0;a++){n=i[s][a];0===i[s][a].val&&n.weight===o&&n.totalWeight===r&&(d--,a,s,l=i[s][a])}return l},bestMove:function(t,e,i){var a=t,s=1===a?2:1,o=mainState.level;return playState.trainAI&&(o=1===t?playState.trainAIPlayerSkill:playState.trainAICPUSkill),"EASY"===o?this.easyMove(a,s,e,i):"FAIR"===o?this.fairMove(a,s,e,i):"HARD"===o?this.hardMove(a,s,e,i):void alert("Level is too high for me!")}},playGrid={board:null,init:function(t){this.rnd=t,this.width=this.height=this.cols=this.rows=3},start:function(t){this.solvedBoards=[[0,0,0],[0,0,0],[0,0,0]]},setBoard:function(t,e,i){this.solvedBoards[e][t]>0&&this.solvedBoards[e][t]<4?this.board=null:(this.board=this.cells[e][t],this.boardX=t,this.boardY=e)},updateSolvedBoards:function(t,e){var i,a,s=this.cells[t.h][t.w];for(a=0;a<3;a++)if(s[a][0].val===e&&s[a][1].val===e&&s[a][2].val===e)return this.solvedBoards[t.h][t.w]=e,!0;for(i=0;i<3;i++)if(s[0][i].val===e&&s[1][i].val===e&&s[2][i].val===e)return this.solvedBoards[t.h][t.w]=e,!0;if(s[0][0].val===e&&s[1][1].val===e&&s[2][2].val===e)return this.solvedBoards[t.h][t.w]=e,!0;if(s[0][2].val===e&&s[1][1].val===e&&s[2][0].val===e)return this.solvedBoards[t.h][t.w]=e,!0;var o=!1;for(a=0;a<3;a++)for(i=0;i<3;i++)0===s[a][i].val&&(o=!0);o?0===this.possibleRows(s,e)&&(this.solvedBoards[t.h][t.w]=4):this.solvedBoards[t.h][t.w]=3},possibleRows:function(t,e){var i,a,s=e-1;for(a=0;a<3;a++)for(i=0;i<3;i++){(r=t[a][i]).possibleRows?r.possibleRows[s]=0:r.possibleRows=[0,0]}var o=2===e?1:2;0===(r=t[0][0]).val&&(t[0][1].val!==o&&t[0][2].val!==o&&r.possibleRows[s]++,t[1][0].val!==o&&t[2][0].val!==o&&r.possibleRows[s]++,t[1][1].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++),0===(r=t[0][1]).val&&(t[0][0].val!==o&&t[0][2].val!==o&&r.possibleRows[s]++,t[1][1].val!==o&&t[2][1].val!==o&&r.possibleRows[s]++),0===(r=t[0][2]).val&&(t[0][0].val!==o&&t[0][1].val!==o&&r.possibleRows[s]++,t[1][2].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++,t[1][1].val!==o&&t[2][0].val!==o&&r.possibleRows[s]++),0===(r=t[1][0]).val&&(t[1][1].val!==o&&t[1][2].val!==o&&r.possibleRows[s]++,t[0][0].val!==o&&t[2][0].val!==o&&r.possibleRows[s]++),0===(r=t[1][1]).val&&(t[1][0].val!==o&&t[1][2].val!==o&&r.possibleRows[s]++,t[0][1].val!==o&&t[2][1].val!==o&&r.possibleRows[s]++,t[0][0].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++,t[0][2].val!==o&&t[2][0].val!==o&&r.possibleRows[s]++),0===(r=t[1][2]).val&&(t[1][0].val!==o&&t[1][1].val!==o&&r.possibleRows[s]++,t[0][2].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++),0===(r=t[2][0]).val&&(t[0][0].val!==o&&t[1][0].val!==o&&r.possibleRows[s]++,t[2][1].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++,t[1][1].val!==o&&t[0][2].val!==o&&r.possibleRows[s]++),0===(r=t[2][1]).val&&(t[2][0].val!==o&&t[2][2].val!==o&&r.possibleRows[s]++,t[1][1].val!==o&&t[0][1].val!==o&&r.possibleRows[s]++),0===(r=t[2][2]).val&&(t[2][0].val!==o&&t[2][1].val!==o&&r.possibleRows[s]++,t[0][2].val!==o&&t[1][2].val!==o&&r.possibleRows[s]++,t[0][0].val!==o&&t[1][1].val!==o&&r.possibleRows[s]++);var h=0;for(a=0;a<3;a++)for(i=0;i<3;i++){var r;h+=(r=t[a][i]).possibleRows[s]}return h},winBoard:function(t,e){return this.updateSolvedBoards(t,e)},checkWinner:function(t){for(var e=0;e<3;e++){if(this.solvedBoards[e][0]===t&&this.solvedBoards[e][1]===t&&this.solvedBoards[e][2]===t)return t;if(this.solvedBoards[0][e]===t&&this.solvedBoards[1][e]===t&&this.solvedBoards[2][e]===t)return t}if(this.solvedBoards[0][0]===t&&this.solvedBoards[1][1]===t&&this.solvedBoards[2][2]===t)return t;if(this.solvedBoards[0][2]===t&&this.solvedBoards[1][1]===t&&this.solvedBoards[2][0]===t)return t;var i=0,a=!1,s=!1,o=!1;for(e=0;e<3;e++){for(a=!1,s=!1,o=!1,h=0;h<3;h++)1===this.solvedBoards[e][h]&&(a=!0),2===this.solvedBoards[e][h]&&(s=!0),3!==this.solvedBoards[e][h]&&4!==this.solvedBoards[e][h]||(o=!0);(a&&s||o)&&i++}for(e=0;e<3;e++){a=!1,s=!1,o=!1;for(var h=0;h<3;h++)1===this.solvedBoards[h][e]&&(a=!0),2===this.solvedBoards[h][e]&&(s=!0),3!==this.solvedBoards[h][e]&&4!==this.solvedBoards[h][e]||(o=!0);(a&&s||o)&&i++}for(a=!1,s=!1,o=!1,h=0;h<3;h++)1===this.solvedBoards[h][h]&&(a=!0),2===this.solvedBoards[h][h]&&(s=!0),3!==this.solvedBoards[h][h]&&4!==this.solvedBoards[h][h]||(o=!0);for((a&&s||o)&&i++,a=!1,s=!1,o=!1,h=0;h<3;h++)1===this.solvedBoards[h][2-h]&&(a=!0),2===this.solvedBoards[h][2-h]&&(s=!0),3!==this.solvedBoards[h][2-h]&&4!==this.solvedBoards[h][2-h]||(o=!0);return(a&&s||o)&&i++,8===i?3:0}};var volume=.3,buttonDisabled=0,buttonEnabled=1,buttonSelected=2,buttonAllowed=3,playState={spriteAtlas:"atlas",winsInRowTime1:0,winsInRowTime2:0,winsInRowTime3:0,winsInRowTime:0,winsInRow:0,playerID:1,playerCPU:2,trainAI:!1,trainAIPlayerSkill:"FAIR",trainAICPUSkill:"HARD",resize:function(){this.controlGroup&&(this.controlGroup.landSize.width=width,this.controlGroup.portSize.height=height);var t=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});this.helpText.fontSize=48*t,this.renderBoard(t),bootState.config.app||renderBg.call(this,t)},init:function(){this.grid=playGrid;var t=new Phaser.RandomDataGenerator([1]);this.grid.init(t),t.sow([Date.now()]),this.logic=playLogic,this.logic.init(this.grid,this.time,t)},preload:function(){if(bootState.config.app){let t=120;this.load.spritesheet("ui-button","cache/button-square.png",t,t),t=80,this.load.spritesheet("ui-button-icon","cache/button-square-icons.png",t,t),t=80,this.load.spritesheet("ui-button-number","cache/button-square-numbers.png",t,t)}if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){if(this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(t,e){this.soundEffects.sounds[t].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.createHeader(),this.createBoard(),this.createTutorial(),this.boardGroup.problemDone=!1,bootState.config.app){var t=this.boardGroup.addSpriteFromFile("ui-button",0,0);t.frame=buttonEnabled,t.inputEnabled=!0,t.input.useHandCursor=!0,t.isButton=!0,t.isTech=!0,this.boardGroup.techButton=t,text=this.add.text(80,0,"Guide",{fill:"#000",fontWeight:"normal",font:"32px monospace"},this.textGroup),text.anchor.set(0,.5),t.addChild(text),this.boardGroup.techButtonText=text,icon=this.boardGroup.addSpriteFromFile("ui-button-number",0,0);let i=parseInt(window.localStorage.getItem("supertictactoelevelNo"))||0;icon.frame=3===i?11:i,icon.x=0,icon.y=0,t.icon=icon,t.addChild(icon);this.boardGroup.helpText=this.add.text(-t.width/2,-120," PROBLEM SOLVED ",{offsetX:100,font:"32px",fill:"#333",backgroundColor:"#fff",wordWrap:!1,fontWeight:"normal",align:"center",font:"32px monospace"}),this.boardGroup.helpText.setShadow(2,2,"rgba(99, 99, 99,1)",2),this.boardGroup.helpText.anchor.set(0),this.boardGroup.helpText.visible=!1,t.addChild(this.boardGroup.helpText);var e=this.boardGroup.addSpriteFromFile("ui-button",0,0);e.frame=buttonDisabled,e.inputEnabled=!0,e.input.useHandCursor=!0,this.boardGroup.adButton=e,text=this.add.text(80,0,"Restart",{fill:"#000",fontWeight:"normal",font:"32px monospace"},this.textGroup),text.anchor.set(0,.5),e.addChild(text),this.boardGroup.adButtonText=text,icon=this.boardGroup.addSpriteFromFile("ui-button-icon",0,0),icon.frame=1,icon.x=0,icon.y=0,icon.scale.x=-1,e.icon=icon,e.addChild(icon),e.visible=!1}this.helpText=this.boardGroup.addText("",0,0,"333333",48),this.helpText.kill(),this.createPopup(),this.world.mask&&this.world.mask.destroy(),this.world.mask=null,this.grid.start(0),this.logic.start(0),this.start(bootState.config.app?0:1250),this.effectGroup=new EffectGroup(this.game,{width:720,height:720},{width:720,height:720}),this.effectGroup.enable("sparkle"),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.startTime=this.time.time;var i=playService.getPlayer("me");bootState.config.app?this.time.events.add(.25*Phaser.Timer.SECOND,function(){document.getElementById("loader")&&(document.getElementById("loader").style.display="none"),"undefined"!=typeof webapp_ad&&this.time.events.add(1*Phaser.Timer.SECOND,function(){this.loadAd()},this)},this):i.wins>0?(this.inputLockTime=this.time.now+500,this.popupGroup.showBanner("Ready to play!\nOpponent begins.",2e3,this)):this.popupGroup.showBanner("Ready to play!\nOpponent begins.",2e3,this)},loadAd:function(){Android.loadAd()||this.time.events.add(1*Phaser.Timer.SECOND,function(){this.loadAd()},this)},start:function(t=1250){this.isGameOver=!1,this.time.events.add(t,function(){this.turn(2)},this)},createHeader:function(){let t=bootState.config.app?0:180,e=bootState.config.app?0:120;this.headerGroup=new HeaderGroup(this.game,{width:t,height:0},{width:0,height:e},this),bootState.config.app||(this.headerGroup.enable("header-option.png"),this.headerGroup.enable("header-time.png"),this.headerGroup.enable("header-exit.png"))},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog-quit.png")},createTutorial:function(){this.tutorialGroup=new TutorialGroup(this.game,{width:this.game.width,height:this.game.height}),this.tutorialGroup.enable("popup-hand.png")},adShown:function(t){this.fadeoutQuit(0)},update:function(){var t=Math.floor((this.time.time-this.startTime)/1e3);if(this.headerGroup.setScore(formatTime(t)),!(this.inputLockTime>=this.time.now||this.world.mask))if(this.isGameOver){if(this.boardGroup.helpText.visible){var e=this.game.input.activePointer;this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame&&(e.targetObject&&e.targetObject.sprite===this.boardGroup.techButton&&(this.inputLockTime=this.time.now+1750,e.targetObject.sprite.frame=buttonSelected,"PROBLEM FAILED"===this.boardGroup.helpText.text?webapp_ad.show(this.adShown.bind(this)):this.time.events.add(500,function(){this.fadeoutQuit()},this)),e.targetObject&&e.targetObject.sprite===this.boardGroup.adButton&&(e.targetObject.sprite.frame=buttonSelected,this.inputLockTime=this.time.now+1750,this.fadeoutQuit()))}}else if(this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame)if((e=this.game.input.activePointer)&&e.targetObject){var i=e.targetObject.sprite;if(bootState.config.app&&e.targetObject.sprite===this.boardGroup.techButton){if(this.inputLockTime=this.time.now+750,dataStorage.isAudio,this.boardGroup.problemDone){this.inputLockTime=this.time.time+2500;var a=window.localStorage.getItem("sudokulevels").split(",");let t=parseInt(window.localStorage.getItem("sudokulevelNo")||"0"),e=a.splice([t],1);return a.push(e[0]),window.localStorage.setItem("sudokulevels",a),void this.gameOver(!0)}return document.getElementById("canvas").style.visibility="hidden",document.getElementById("guide").style.display="block",void("undefined"!=typeof webapp_ad&&webapp_ad.showGuide(!0))}if(this.tutorialGroup.visible)1===this.tutorialGroup.step?(this.inputLockTime=this.time.now+750,i===this.tutorialGroup.handTarget()&&this.tutorialGroup.nextStep("HOW TO PLAY\n2 / 2\nSelect missing number.",this.controls[0],this.controlGroup)):i===this.tutorialGroup.handTarget()&&(this.tutorialGroup.nextStep("That was tutorial.\n\nNow fill the rest."),this.tutorialGroup.hand.kill(),this.time.events.add(4*Phaser.Timer.SECOND,function(){this.tutorialGroup.hide(),this.inputLockTime=this.time.now+500},this));else if(this.popupGroup.visible)i===this.popupGroup.quit?(this.inputLockTime=this.time.now+1e3,this.backToMenu(),this.updatePlayerData(-1)):i!==this.popupGroup.dialogBg&&this.popupGroup.hide();else if(this.headerGroup.optionBg&&this.headerGroup.optionBg.visible)this.inputLockTime=this.time.now+250,i===this.headerGroup.optionSound?(this.headerGroup.select(this.headerGroup.optionSound),dataStorage.isAudio&&this.soundEffects.play("tic",volume)):(this.headerGroup.hideOption(),this.popupGroup.dim.kill());else if(i===this.headerGroup.option)this.inputLockTime=this.time.now+500,this.headerGroup.showOption(this),this.popupGroup.dim.revive();else if(i===this.headerGroup.score)this.inputLockTime=this.time.now+500,this.popupGroup.showBanner("Level "+mainState.level+"\nTime "+this.headerGroup.scoreLabel.text,2e3,this);else if(i===this.headerGroup.exit)this.inputLockTime=this.time.now+750,this.popupGroup.showDialog("Are you sure to quit this game?\nThat will reset also your current Level progress.",null,this,!0,!0);else for(var s=0;s<this.grid.height;s++)for(var o=0;o<this.grid.width;o++)for(var h=0;h<this.grid.rows;h++)for(var r=0;r<this.grid.cols;r++){var n=this.grid.cells[s][o][h][r];if(n.inputEnabled=!1,i===n)return this.inputLockTime=this.time.now+500,this.boardGroup.moveTo(this.selectPointer,n),this.selectPointer.target=n,this.selectPointer.revive(),void this.time.events.add(.25*Phaser.Timer.SECOND,function(){this.grid.setBoard(n.w,n.h),this.selectCell(this.playerID,n),this.turn(2)},this)}}else{if(bootState.config.app)return;this.headerGroup.optionBg.visible?(this.headerGroup.hideOption(),this.popupGroup.dim.kill()):this.popupGroup.visible&&this.popupGroup.hide()}},doGameOver:function(t){let e=parseInt(window.localStorage.getItem("supertictactoelevelNo"))||0;this.boardGroup.problemDone=!0,this.boardGroup.helpText.visible=!0,t===this.playerID?(this.boardGroup.techButton.icon.loadTexture("ui-button-icon"),this.boardGroup.techButton.icon.frame=2,e<3&&(e++,window.localStorage.setItem("supertictactoelevelNo",""+e),this.boardGroup.helpText.text="PROBLEM SOLVED",this.boardGroup.techButtonText.text="Next\nLevel"),3===e&&(this.boardGroup.helpText.text="ALL SOLVED",this.boardGroup.techButtonText.text="Continue\nplaying")):(this.boardGroup.helpText.text="PROBLEM FAILED",this.boardGroup.techButton.icon.loadTexture("ui-button-icon"),this.boardGroup.techButton.frame=1,this.boardGroup.techButton.icon.frame=2,this.boardGroup.techButtonText.text="Retry\n(Ad)"),this.resize()},fadeoutQuit:function(t=500){this.backToMenu()},selectCell:function(t,e){var i=e;if(i.alpha=1,0===i.val){if(i.val=t,i.tint=16777215,this.boardGroup.setTexture(i,"play-token-"+i.val+".png"),i.input&&(i.inputEnabled=!1),i.scale.set(0),this.add.tween(i.scale).to({x:1,y:1},500,Phaser.Easing.Back.InOut,!0),this.selectPointer.target=null,this.selectPointer.kill(),this.grid.winBoard(i,t)){for(var a=i,s=this.grid.cells[a.h][a.w][1][1],o=this.boardGroup.getCenterX(s),h=this.boardGroup.getCenterY(s),r=this.boardGroup.addSprite("play-token-"+t+"-big.png",s.dx-.5,s.dy-.5),n=0;n<3;n++)for(var l=0;l<3;l++)this.grid.cells[a.h][a.w][n][l].alpha=.25;r.alpha=.1,this.add.tween(r).to({alpha:1},500,Phaser.Easing.Quadratic.InOut,!0,750),240,240,this.effectGroup.start(o,h,240,240),dataStorage.isAudio&&(t===this.playerID?this.soundEffects.play("boardWin",volume):this.soundEffects.play("boardLose",volume))}else dataStorage.isAudio&&this.soundEffects.play((this.playerID,"tic"),volume);var d=this.grid.checkWinner(t);0,d>0&&(this.trainAI&&this.logic.updateMultipliers(d),bootState.config.app?this.doGameOver(d):this.time.events.add(.5*Phaser.Timer.SECOND,function(){if(d===this.playerID){var e="\n[ wins in row "+(this.winsInRow+1)+" ]";this.updatePlayerData(t),this.popupGroup.showBanner("You win!"+e,3e3,this)}else if(d===this.playerCPU)this.popupGroup.showBanner("Oh dear,\nYou lose...",3e3,this,"quack-sad.png"),this.updatePlayerData(t);else{var i=this.time.time-this.startTime;this.winsInRowTime1+=i,this.popupGroup.showBanner("It's a tie.",3e3,this)}},this),this.isGameOver=!0),this.time.events.add(.5*Phaser.Timer.SECOND,function(){this.isGameOver||this.selectBoard(t===this.playerID?this.playerCPU:this.playerID,i.i,i.j)},this),this.trainAI&&this.time.events.add(0*Phaser.Timer.SECOND,function(){this.turn(t===this.playerID?this.playerCPU:this.playerID)},this)}else alert("BROKEN! "+i.val)},updatePlayerData:function(t){if(1===t){this.winsInRowTime3=this.winsInRowTime2,this.winsInRowTime2=this.winsInRowTime1;var e=this.time.time-this.startTime;if(this.winsInRowTime1=e,this.winsInRow++,this.winsInRowTime=this.winsInRowTime1+this.winsInRowTime2+this.winsInRowTime3,playService.setScore(1,this.winsInRow,this.winsInRowTime))return!0}else this.winsInRow=0,this.winsInRowTime=this.winsInRowTime3=this.winsInRowTime2=this.winsInRowTime1=0;return!1},turn:function(t){if(!this.isGameOver){var e=bootState.config.app?1:1.75;this.trainAI&&(e=.5),this.time.events.add(Phaser.Timer.SECOND*e,function(){var e=this.logic.turn(t);this.selectBoard(2,e.w,e.h),this.boardGroup.moveTo(this.selectPointer,e),this.selectPointer.revive(),this.time.events.add(.25*Phaser.Timer.SECOND,function(){this.selectCell(t,e)},this)},this)}},showText:function(t,e,i){this.helpText.text=t,this.helpText.x=e,this.helpText.y=i,this.helpText.alpha=1,this.helpText.revive(),this.add.tween(this.helpText).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.helpText.kill()},this)},backToMenu:function(){for(var t in this.texture=this.textureSprite=this.textureBg=this.textureBgSprite=null,this.boardTexture=null,PIXI.BaseTextureCache)delete PIXI.BaseTextureCache[t];for(var t in PIXI.TextureCache)delete PIXI.TextureCache[t];bootState.config.app?this.state.start("mainState"):this.time.events.add(.1*Phaser.Timer.SECOND,function(){fadeOutEffect(this).onComplete.addOnce(function(){this.state.start("mainState")},this)},this)},popupHidden:function(){this.isGameOver&&(this.trainAI?this.game.state.restart():this.backToMenu())},renderBoard:function(t){var e=Math.floor(this.boardGroup.size.width*t),i=Math.floor(this.boardGroup.size.height*t),a=e/9,s=this.boardGroup.x+this.boardGroup.size.width/2*t,o=this.boardGroup.y+this.boardGroup.size.height/2*t,h=40*t;this.cache.checkBitmapDataKey("bmd-board-bg")||(r=this.make.bitmapData(e+2*h,i+2*h),this.cache.addBitmapData("bmd-board-bg",r));var r=this.cache.getBitmapData("bmd-board-bg");if(r.width===e&&r.height===i||r.resize(e+3+2*h,i+3+2*h),r.clear(),!bootState.config.app){var n=makeSprite(this.game,"play-bg.png",0,0);n.scale.set(t),r.draw(n,0,0),n.destroy()}var l=s,d=o,p=r.ctx;p.lineWidth=1,p.strokeStyle="#83472e";var c=15*t,u=Math.floor(9*a/3),g=h;p.beginPath();for(s=0;s<3;s++)for(o=1;o<9;o++)3!==o&&6!==o&&(p.moveTo(s*u+g+0*u+c,g+o*a),p.lineTo(s*u+g+1*u-c,g+o*a));for(s=1;s<9;s++)for(o=0;o<3;o++)3!==s&&6!==s&&(p.moveTo(g+s*a,o*u+g+0*u+c),p.lineTo(g+s*a,o*u+g+1*u-c));p.stroke(),this.boardBg?(this.boardBg.x=l,this.boardBg.y=d):(this.boardBg=this.game.add.image(l,d,r),this.boardBg.anchor.set(.5),this.boardBg.sendToBack())},createBoard:function(){this.boardGroup=new BoardGroup(this.game,{width:720,height:720},{width:720,height:720}),this.grid.cells=[];for(var t=[],e=0;e<this.grid.height;e++){this.grid.cells[e]=[];for(var i=0;i<this.grid.width;i++){this.grid.cells[e][i]=[];for(var a=0;a<this.grid.rows;a++){this.grid.cells[e][i][a]=[];for(var s=3*e+a,o=0;o<this.grid.cols;o++){for(var h=3*i+o,r=0,n=0;n<t.length;n++){var l=t[n];l.x===i&&l.y===e&&l.i===o&&l.j===a&&(r=l.val)}if(this.trainAI)var d=this.boardGroup.addSprite("play-token-"+r+".png",(h-4)/9-.001,(s-4)/9);var p=this.boardGroup.addSprite("play-token-"+r+".png",(h-4)/9-.001,(s-4)/9);this.grid.cells[e][i][a][o]=p,p.val=r,p.alpha=0===r?0:1,p.h=e,p.w=i,p.j=a,p.i=o,this.trainAI&&(p.alpha=.5,p.trainAI=d)}}}}this.selectPointer=this.boardGroup.addSprite("play-selected.png"),this.selectPointer.anchor.set(.5)},shutdown:function(){this.bg=this.boardBg=null},selectBoard:function(t,e,i){this.grid.setBoard(e,i,2);for(var a=0;a<3;a++)for(var s=0;s<3;s++)for(var o=0;o<3;o++)for(var h=0;h<3;h++){if(0===(r=this.grid.cells[a][s][o][h]).val&&(r.alpha=0,r.inputEnabled=!1),playState.trainAI)r.trainAI.alpha=0}if(this.grid.board)for(o=0;o<3;o++)for(h=0;h<3;h++){0===(r=this.grid.board[o][h]).val&&(r.alpha=1,2===t?r.tint=16751001:(r.tint=11184895,r.inputEnabled=!0,r.input.useHandCursor=!0))}else for(a=0;a<3;a++)for(s=0;s<3;s++)if(0===this.grid.solvedBoards[a][s])for(var o=0;o<3;o++)for(var h=0;h<3;h++){var r;0===(r=this.grid.cells[a][s][o][h]).val&&(r.alpha=1,2===t?r.tint=16751001:(r.tint=11184895,r.inputEnabled=!0,r.input.useHandCursor=!0))}}},mainState={name:"mainState",spriteAtlas:"atlas",goal:"Play Super Tic Tac Toe game online.\n\nGame sounds by NoiseForFun.com",resize:function(){var t=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});renderBg.call(this,t)},init:function(){this.dataLoaded||(this.dataLoaded=!0,dataStorage.init())},startPlay:function(){let t=parseInt(window.localStorage.getItem("supertictactoelevelNo"))||0;t>2&&(t=2),this.level=["EASY","FAIR","HARD"][t],this.state.add("playState",playState,!0)},preload:function(){if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){if(bootState.config.app)this.startPlay(0);else{playState.winsInRow<1?this.level="EASY":playState.winsInRow<2?this.level="FAIR":this.level="HARD",this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(t,e){this.soundEffects.sounds[t].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.controlGroup=new ControlGroup(this.game,{width:260,height:0},{width:0,height:280}),this.boardGroup=new BoardGroup(this.game,{width:720,height:720},{width:720,height:720});var t=this.boardGroup.addSprite("main-board-bg.png",0,.05);t=this.controlGroup.addSprite("main-play-cloud.png",-.15,0,.7,.5);this.playBg=makeSprite(this.game,"main-play-bg.png",74,62),this.playBg.anchor.set(.5),t.addChild(this.playBg),this.add.tween(this.playBg.scale).to({x:.95,y:.9},500,Phaser.Easing.Sinusoidal.In,!0).repeat(Number.MAX_VALUE).yoyo(!0),this.add.tween(this.playBg).to({angle:360},1e4,Phaser.Easing.Linear.None,!0).repeat(Number.MAX_VALUE),this.play=makeSprite(this.game,"main-play.png",74,62),this.play.anchor.set(.5),t.addChild(this.play),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0,(a=this.levelText=this.game.make.text(-40,-34,this.level,{fill:"#ffffff",fontWeight:"normal",font:dataStorage.fontContent,fontSize:32})).inputEnabled=!0,a.input.useHandCursor=!0,a.anchor.set(.5),t.addChild(a);var e,i=-.446;(t=this.leadWinsTotal=this.boardGroup.addSprite("main-button-bg.png",-.3,i)).inputEnabled=!0,t.input.useHandCursor=!0,(e=makeSprite(this.game,"main-button-1.png",0,0)).anchor.set(.5),t.addChild(e),(t=this.leadWinsRows=this.boardGroup.addSprite("main-button-bg.png",-.125,i)).sendToBack(),t.tint=13421772,t.inputEnabled=!0,t.input.useHandCursor=!0,(e=makeSprite(this.game,"main-button-2.png",0,0)).anchor.set(.5),t.addChild(e),(t=this.leadWinsFastest=this.boardGroup.addSprite("main-button-bg.png",.05,i)).sendToBack(),t.tint=13421772,t.inputEnabled=!0,t.input.useHandCursor=!0,(e=makeSprite(this.game,"main-button-3.png",0,0)).anchor.set(.5),t.addChild(e),(t=this.achievement=this.boardGroup.addSprite("main-button-bg.png",.3,i)).sendToBack(),t.tint=13421772,t.inputEnabled=!0,t.input.useHandCursor=!0,(e=makeSprite(this.game,"main-button-4.png",0,0)).anchor.set(.5),t.addChild(e),this.leadAvatar=[],this.leadName=[],this.leadScore=[];i=-.35;var a=this.leadTitle=this.boardGroup.addText("",0,i+.03,"000000",42);this.rankIcons=[];for(var s=0;s<5&&s<playService.leadScores.length;s++)this.addLeaderScore(s);this.selectButton(this.achievement),this.createHeader(),this.createPopup(),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.start()}},addLeaderScore:function(t){var e=playService.leadScores[t].rank,i=playService.leadScores[t].name,a=playService.leadScores[t].wins,s=-.175,o=2.5*.165+-.15*(4-t),h=this.boardGroup.addSprite("medal.png",s-.05,o);switch(e){case 0:h.tint=16711935;break;case 1:h.tint=16738047;break;case 2:h.tint=16755455;break;case 3:h.tint=16777062;break;case 4:h.tint=16777215}this.rankIcons[t]=h,(h=this.leadAvatar[t]=this.boardGroup.addSprite("avatar-"+t+".png",-.155,o)).anchor.x=0;var r=this.leadName[t]=this.boardGroup.addText(i,s+.2,o-.03,"000000",28);r.anchor.x=0,(h=this.boardGroup.addSprite("main-board-score-bg.png",s+.2,o+.02)).anchor.x=0,r=this.leadScore[t]=this.boardGroup.addText(a,s+.33,o+.025,"ffffff",28)},updateLeaderScore:function(t){if(this.currentButton=t,t===this.achievement){for(var e=playService.getAchievements("REVEALED",5,!0),i=0;i<5;i++)this.leadAvatar[i].kill(),this.leadName[i].text="",this.leadScore[i].text="";for(i=0;i<e.length;i++)this.leadAvatar[i].revive(),e[i].icon?setTexture(this.leadAvatar[i],e[i].icon):setTexture(this.leadAvatar[i],"achievement.png"),this.leadName[i].text=e[i].name,"UNLOCKED"===e[i].state?this.leadScore[i].text="ACHIEVED":this.leadScore[i].text="OPEN"}else{for(i=0;i<5;i++)this.leadAvatar[i].kill(),this.leadName[i].text="",this.leadScore[i].text="";var a=0;for(i=0;a<5&&i<playService.leadScores.length;i++){var s;if(t===this.leadWinsTotal)playService.leadScores.sort(function(t,e){return t.wins>e.wins?-1:t.wins<e.wins?1:0}),s=playService.leadScores[i].wins;else if(t===this.leadWinsRows)playService.leadScores.sort(function(t,e){return t.inRow>e.inRow?-1:t.inRow<e.inRow?1:0}),s=playService.leadScores[i].inRow;else if(t===this.leadWinsFastest){if(playService.leadScores.sort(function(t,e){return t.time<e.time?-1:t.time>e.time?1:0}),!playService.leadScores[i].time)continue;s=formatTime(playService.leadScores[i].time/1e3)}this.leadAvatar[a].revive(),playService.leadScores[i].avatar?setTexture(this.leadAvatar[a],playService.leadScores[i].avatar):setTexture(this.leadAvatar[a],"avatar-"+i+".png"),this.leadName[a].text=playService.leadScores[i].name,this.leadScore[a].text=s,a++}}},createHeader:function(){this.headerGroup=new HeaderGroup(this.game,{width:260,height:0,maxHeight:1200},{width:0,height:90,maxWidth:1200},this),this.headerGroup.enable("header-option.png"),this.headerGroup.enable("header-ad.png"),this.headerGroup.enable("header-info.png")},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog.png")},updateProgress:function(){},selectButton:function(t){this.updateLeaderScore(t),this.leadWinsRows.sendToBack(),this.leadWinsRows.tint=13421772,this.leadWinsTotal.sendToBack(),this.leadWinsTotal.tint=13421772,this.leadWinsFastest.sendToBack(),this.leadWinsFastest.tint=13421772,this.achievement.sendToBack(),this.achievement.tint=13421772,t===this.leadWinsRows?this.leadTitle.text="WINS IN ROW":t===this.leadWinsTotal?this.leadTitle.text="TOTAL WINS":t===this.leadWinsFastest?this.leadTitle.text="FASTEST 3 IN ROW":t===this.achievement&&(this.leadTitle.text="ACHIEVEMENTS"),t.bringToTop(),t.tint=16777215},update:function(){if(!(this.inputLockTime>=this.time.now||this.world.mask)&&this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame){var t=this.game.input.activePointer;if(t.targetObject){var e=t.targetObject.sprite;if(this.popupGroup.visible)e===this.popupGroup.close||e===this.popupGroup.claim?(this.inputLockTime=this.time.now+1e3,this.popupGroup.hide()):e===this.popupGroup.play&&(this.inputLockTime=this.time.now+1e3,this.popupHidden(),fadeOutEffect(this).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this));else if(this.headerGroup.optionBg.visible)this.inputLockTime=this.time.now+250,e===this.headerGroup.optionSound?(this.headerGroup.select(this.headerGroup.optionSound),dataStorage.isAudio&&this.soundEffects.play("tic")):e===this.headerGroup.optionReset?(dataStorage.reset(),this.headerGroup.hideOption(),this.popupGroup.dim.kill()):(this.headerGroup.hideOption(),this.popupGroup.dim.kill());else if(e===this.leadWinsRows||e===this.leadWinsTotal||e===this.leadWinsFastest||e===this.achievement)this.selectButton(e),this.inputLockTime=this.time.now+100;else if(e===this.levelText)this.popupGroup.showBanner("Win in row to level!\nWins "+playState.winsInRow+" in time "+formatTime(Math.floor(playState.winsInRowTime/1e3)),4e3,this),this.inputLockTime=this.time.now+250;else{if(e===this.headerGroup.option)return this.inputLockTime=this.time.now+500,this.headerGroup.showOption(this),void this.popupGroup.dim.revive();if(e===this.headerGroup.info)return this.inputLockTime=this.time.now+500,void this.popupGroup.showDialog(this.goal,null,this,!0);e===this.play&&fadeOutEffect(this).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this)}}else this.headerGroup.optionBg.visible?(this.headerGroup.hideOption(),this.popupGroup.dim.kill()):this.popupGroup.visible&&(this.inputLockTime=this.time.now+1e3,this.popupGroup.hide())}},showAchievement:function(t){var e;if(t){if((e=playService.showAchievements(5)).length<=0)return}else(e=playService.getAchievements("REVEALED",3)).length<=0&&e.push({title:"Congratulations",text:"You have achieved everything!"});var i="";e.forEach(function(t){i+=t.name+": "+t.desc+"\n"}),this.selectButton(this.achievement),this.popupGroup.showDialog(i,null,this,!0,!1,"Achievements",t)},start:function(){this.world.mask&&this.world.mask.destroy(),this.world.mask=null,playService.mainStarted=!0,playService.showLogin(),this.updateProgress(),this.showAchievement(!0),this.started=!0,this.time.events.add(3e3,function(){},this)},popupHidden:function(){},shutdown:function(){this.bg=null},updatePlayerIcon:function(t){t&&t.icon&&(this.load.crossOrigin="Anonymous",this.load.image(t.icon),this.load.onFileComplete.add(this.iconComplete,this),console.log("updatePlayerIcon: "+t.icon),this.load.start())},updateScores:function(){this.currentButton&&this.updateLeaderScore(this.currentButton)},updateAchievements:function(){this.currentButton&&this.updateLeaderScore(this.currentButton)},loadComplete:function(){console.log("loadComplete")},iconComplete:function(t,e,i,a,s){console.log("Loading "+t+" %"),console.log(i+" "+e),i&&e&&this.boardGroup.addSpriteFromFile(e,.1,.1)},printCache:function(t){var e=this.cache.getKeys(t),i="";for(var a in e)i+=a+" ";e.length>0&&console.log(t+":"+i),this.cacheItems+=e.length},showPhaserCache:function(){this.printCache(Phaser.Cache.CANVAS),this.printCache(Phaser.Cache.IMAGE),this.printCache(Phaser.Cache.TEXTURE),this.printCache(Phaser.Cache.SOUND),this.printCache(Phaser.Cache.TEXT),this.printCache(Phaser.Cache.PHYSICS),this.printCache(Phaser.Cache.TILEMAP),this.printCache(Phaser.Cache.BINARY),this.printCache(Phaser.Cache.BITMAPDATA),this.printCache(Phaser.Cache.BITMAPFONT),this.printCache(Phaser.Cache.JSON),this.printCache(Phaser.Cache.XML)},showPixiCache:function(){var t="";for(var e in PIXI.BaseTextureCache)t+=e+" ",this.cacheItems++;for(var e in PIXI.TextureCache)t+=e+" ",this.cacheItems++;console.log("PIXI Base/TextureCache: "+t)},showCache:function(t){this.cacheItems=0,console.log(t),this.showPhaserCache(),this.showPixiCache(),console.log("world length: "+this.world.children.length),console.log("cache length: "+this.cacheItems)}},bootState={config:{app:!0},soundEffects:function(){return bootState.config.app?{spritemap:{tik:{start:0,end:.02,loop:!1},tok:{start:1.6,end:2.1,loop:!1},tak2:{start:.15,end:.17,loop:!1},good2:{start:.6,end:1.55,loop:!1},deny2:{start:1.6,end:2.1,loop:!1},notify2:{start:2.1,end:2.96,loop:!1},good:{start:.6,end:1.6,loop:!1}}}:{spritemap:{tik:{start:0,end:.05,loop:!1},tok:{start:.1,end:.12,loop:!1},tak2:{start:.15,end:.17,loop:!1},good2:{start:.6,end:1.55,loop:!1},deny2:{start:1.6,end:2.1,loop:!1},notify2:{start:2.1,end:2.96,loop:!1},good:{start:2.96,end:3.2,loop:!1}}}},name:"bootState",spriteAtlas:"atlas",resize:function(){onResize.call(this,this.scale,{width:this.game.width,height:this.game.height})},init:function(){Phaser.Plugin.Debug},preload:function(){Phaser.Canvas.setTouchAction(game.canvas,"auto"),this.game.input.touch.preventDefault=!1,this.game.forceSingleUpdate=!0,this.game.renderer.renderSession.roundPixels=!0,this.stage.smoothed=!0,this.game.renderer.clearBeforeRender=!0,this.stage.backgroundColor=bootState.config.app?"#fff":"#f7fbfd",this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.scale.fullScreenScaleMode=Phaser.ScaleManager.RESIZE,this.scale.setShowAll(),this.scale.refresh()},loadComplete:function(){if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}this.state.add("mainState",mainState,!0)},create:function(){if(-1===window.location.href.indexOf("localhost:8383")&&(bootState.config.app||(this.load.path="/supertictactoe/")),this.input.maxPointers=1,this.boardGroup=new BoardGroup(this.game,{width:640,height:720},{width:640,height:720}),bootState.config.app||(this.boardGroup.addText(dataStorage.title,0,.2,"c98dd0",60),this.boardGroup.addText("minimindgames.com",0,.3,"98a1c1",48),this.loadText=this.boardGroup.addText("Loading ...",0,.4,"666666",32),this.load.image("quack.png","cache/quack.png",400,400)),bootState.config.app){var t={spritemap:{tic:{start:0,end:.02,loop:!1},boardWin:{start:.6,end:1.6,loop:!1},boardLose:{start:1.6,end:2.1,loop:!1},toc:{start:2.2,end:2.24,loop:!1}}};bootState.config.app?this.load.audiosprite("sound-effects",["cache/tracks.ogg","cache/sound-effects.mp3"],null,t):this.load.audiosprite("sound-effects",["cache/sound-effects.ogg","cache/sound-effects.mp3"],null,t)}this.time.events.add(10,function(){this.load.atlasXML("atlas","cache/atlas/sprites.png","cache/atlas/sprites.xml"),this.load.onFileComplete.add(this.fileComplete,this),this.load.onLoadComplete.addOnce(this.loadComplete,this),this.load.start()},this),this.game.scale.setResizeCallback(this.onResize,this),this.resize()},fileComplete:function(t,e,i,a,s){this.loadText&&this.loadText.setText("Loading "+t+" %"),i&&"quack.png"===e&&this.boardGroup.addSpriteFromFile(e,0,-.2)},shutdown:function(){}};function createGame(){var t=window;if(!t||t.innerWidth<=0||t.innerHeight<=0)setTimeout(function(){createGame()},100);else{var e={width:t.innerWidth,height:t.innerHeight},i={type:Phaser.AUTO,parent:"canvas",width:e.width,height:e.height,antialias:!bootState.config.cleanBoard};window.game=new Phaser.Game(i),window.game.state.add("bootState",bootState,!0)}}