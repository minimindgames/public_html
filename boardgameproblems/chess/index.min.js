/*! Copyright chess 14-11-2021 */

class Unit extends Phaser.GameObjects.PathFollower{constructor(e,t,i,s,n,r){super(e,null,n,r,i,s),this.player=t,this.id=Unit.id++}getValidMoves(){let e=[];this.select();let t=this.scene.getBoard();for(let i=0;i<t.layer.layer.height;i++)for(let s=0;s<t.layer.layer.width;s++)if(65280===t.layer.getTileAt(s,i).tint){let t={sx:this.tile.x,sy:this.tile.y,tx:s,ty:i};this.check(t)&&e.push(t)}return t.deselect(),e}check(e){return!0}toString(){return this.id}static preload(e,t){}}Unit.id=1;class UnitChess extends Unit{constructor(e,t,i,s,n,r,a){super(e,t,i,s,n,r),this.piece=a,this.name=a,this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.tile}movePath(e,t){let i=new Phaser.Curves.Path(this.x,this.y);for(let t=0,s=e.length;t<s;t++)i.lineTo(e[t].x,e[t].y);this.visible=!1;let s=this.scene.add.follower(i,this.x,this.y,this.texture.key,this.frame.name);s.setPath(i),s.startFollow({ease:"Power2",duration:500*e.length,onComplete:(i,n)=>{s&&(this.x=e[e.length-1].x,this.y=e[e.length-1].y,this.visible=!0,s.stopFollow(),s.visible=!1,s.destroy(),t(this))}})}pointerDown(){}select(){this.scene.getBoard();return this}deselect(){this.scene.getBoard();return this.tile.tint=16777215,null}static preload(e,t){}preUpdate2(){"K"===this.name&&console.log(this.y),super.preUpdate()}}class Board extends Phaser.GameObjects.Group{constructor(e){super(e),this.auto=!1,this.depth=2*this.scene.level.moves-1,this.auto||this.depth--;let t=e.textures.get("board-squares").getSourceImage();let i=e.make.tilemap({data:[[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1]],tileWidth:t.height,tileHeight:t.height});var s=i.addTilesetImage("board-squares");this.layer=i.createDynamicLayer(0,s),this.layer.name="board",this.selected=null,e.input.on(Phaser.Input.Events.POINTER_UP,(e,t)=>{if(this.scene.adText.visible)return this.scene.adTextYes.getBounds().contains(e.x,e.y)&&this.scene.onAd(!0),void(this.scene.adTextNo.getBounds().contains(e.x,e.y)&&this.scene.onAd(!1));const{x:i,y:s}=e;let n=this.layer.worldToTileXY(i,s);this.doSelectTile(n)},this),this.players=[],this.chess=new Chess,this.chess.clear(),this.moveCount=0,this.helpSelect=!1,this.helpMove=null}doSelectTile(e){let t=this.layer.getTileAt(e.x,e.y);if(e.moveTo);else if(!t||this.selected&&t===this.selected.tile)return;if(this.auto)this.nextTurn();else{if(!this.selected){if(t.unit){this.validTiles=[];let e=String.fromCharCode("a".charCodeAt(0)+t.x)+""+(7-t.y+1),i=this.chess.moves({square:e});i.length>0&&(this.scene.playSound("select"),this.selected=t.unit,this.selected.tile.tint=16711935),i.forEach(function(e){let t;for(let i=e.length-1;i>0;i--)if(e[i]>="0"&&e[i]<="9"){t=e[i-1]+e[i];break}const{x:i,y:s}=this.squareToXY(t);let n=this.layer.getTileAt(i,s);n.tint=65280,n.move=e,this.validTiles.push(n)},this)}if(!e.moveTo)return}if(this.selected){let i=!1;if(this.validTiles.includes(t)&&(i=!0,this.scene.playSound("select")),this.clearSelect(),i||e.moveTo){this.helpSelect&&(this.helpSelect=!1,this.clearSelect());let i=t.move;e.moveTo&&(i=e.moveTo),this.do_move(i)}}}}clearSelect(){this.selected&&(this.helpSelect||(this.selected.tile.tint=16777215,this.selected=null,this.validTiles.forEach(function(e){e.tint=16777215}),this.validTiles=[]))}squareToXY(e){return{x:e.charCodeAt(0)-"a".charCodeAt(0),y:7-(e.charAt(1)-1)}}unitMoved(e){let t=e.tile;t.unit&&t.unit.destroy(),e.upgradePawn&&(e.setFrame(LevelFactory.getFrame(e.upgradePawn)),e.upgradePawn=null),t.unit=e,this.chess.game_over()||0===this.depth?this.isGameOver():"w"===this.chess.turn()?(this.moveCount++,EventDispatcher.getInstance().emit("GameStatus",{turn:this.chess.turn(),move:this.moveCount}),this.scene.input.enabled=!0):this.nextTurn()}getSquare(e){this.chess.move(e);let t=this.chess.history({verbose:!0});this.chess.undo();let i=t[t.length-1],s=this.squareToXY(i.from);return this.layer.getTileAt(s.x,s.y)}do_move(e){"w"===this.chess.turn()&&EventDispatcher.getInstance().emit("GameStatus",{turn:"b",move:this.moveCount}),this.scene.input.enabled=!1,this.chess.move(e);let t=this.chess.history({verbose:!0}),i=t[t.length-1],s=this.squareToXY(i.from),n=this.layer.getTileAt(s.x,s.y),r=n.unit;r.depth=this.moveCount+1,n.unit=null;let a,o=this.squareToXY(i.to),h=this.layer.getTileAt(o.x,o.y),l=h.getCenterX(),u=h.getCenterY();return"N"===e.charAt(0)?(a=Math.abs(l-r.x)>Math.abs(u-r.y)?[{x:l,y:r.y}]:[{x:r.x,y:u}]).push({x:l,y:u}):a=[{x:l,y:u}],r.tile=h,"="===e.charAt(e.length-2)&&(r.upgradePawn=e[e.length-1]),r.movePath(a,this.unitMoved.bind(this)),!this.chess.game_over()}load(e){this.chess.load(e)}deselect(){this.layer.forEachTile(function(e){e.tint=16777215},this),this.selected=null}addPlayer(e){this.players.push(e)}start(){this.player=this.players[0],"b"===this.chess.turn()&&this.nextTurn()}getPieceValue(e,t,i){if(null===e)return 0;var s=function(e){if("p"===e.type)return 10;if("r"===e.type)return 50;if("n"===e.type)return 30;if("b"===e.type)return 30;if("q"===e.type)return 90;if("k"===e.type)return 900;throw"Unknown piece type: "+e.type}(e);return"w"===e.color?s:-s}minimax(e,t,i,s,n){if(0===e){let e=0;return t.game_over()&&(e=n?-1:1),e}var r,a=t.moves();if(n){r=-9999;for(let n=0;n<a.length&&(t.move(a[n]),r=Math.max(r,this.minimax(e-1,t,i,s,!1)),t.undo(),!(r>=s));n++)return r;return r}r=9999;for(let n=0;n<a.length&&(t.move(a[n]),r=Math.min(r,this.minimax(e-1,t,i,s,!0)),t.undo(),!(r<=i));n++)return r;return r}minimaxRoot(e,t,i){var s,n=t.moves(),r=-9999;let a=[];for(var o=0;o<n.length;o++){this.positionCount=0;var h=n[o];t.move(h);var l=this.minimax(e-1,t,-1e4,1e4,!i);t.undo(),l>=r&&(a.push(h),r=l,s=h)}if(!s||r<=0){let e=[];a.forEach(function(t){-1!==t.indexOf("x")&&e.push(t)},this),e.length>0&&(s=e[Math.floor(Math.random()*e.length)]),s||(s=a[Math.floor(Math.random()*a.length)])}return s}isGameOver(){let e=EventDispatcher.getInstance(),t=null;return 0===this.depth?t="+":this.chess.game_over()&&(t=this.chess.in_draw()?"=":this.chess.in_threefold_repetition()?"3":this.chess.insufficient_material()?"-":"w"),!!t&&("w"===t?e.emit("GameOver",{result:t,moves:this.chess.history().length}):(e.emit("GameOver",{result:t}),this.scene.playSound("down"),this.scene.cameras.main.shake(50,.002)),!0)}nextTurn(e=0){this.scene.time.delayedCall(200,function(){this.doNextTurn()},[],this)}doNextTurn(e=0){this.player=this.player===this.players[0]?this.players[1]:this.players[0];this.chess.moves();var t=this.minimaxRoot(this.depth+e,this.chess,!0);return 0!==e?this.helpMove=t:this.depth--,0===e?this.do_move(t):t}move_piece(e,t){e.x=t.pixelX+t.width/2,e.y=t.pixelY+t.height/2,e.tile.unit=null,e.tile=t,e.tile.unit=e}addUnit(e,t,i){e.tile&&(e.tile.unit=null,e.tile=null);let s=this.layer.getTileAt(t,i);e.x=s.pixelX+s.width/2,e.y=s.pixelY+s.height/2,s.unit=e,e.tile=s,this.add(e,!0)}selectUnit(e){this.selected=e}}class Button extends Phaser.GameObjects.Container{constructor(e,t,i="button-square-icons"){super(e),this.scene.add.existing(this),this.iconName=i,this.setData("states",t);let s=this.scene.add.image(this.x,this.y,"button-square",1);this.buttonImage=s,s.setInteractive().on("pointerover",()=>this.pointerover()).on("pointerout",()=>this.pointerout()).on("pointerdown",()=>this.pointerdown()).on("pointerup",()=>this.pointerup()),s.setOrigin(.5),this.add(s);let n=this.scene.add.image(0,0,i);this.add(n),this.icon=n;let r=this.scene.add.text(60*this.scene.game.resolution,0,t[0],{fontSize:16*this.scene.game.resolution,color:"#000",align:"left"});r.setOrigin(.5),this.textLabel=r,this.add(r)}next(){let e=this.getData("states").indexOf(this.text());e+1>=this.getData("states").length?e=0:e++,this.set(this.getData("states")[e])}set tint(e){this.tintOriginal=e,this.buttonImage.setTint(e)}get tint(){return this.getAt(0).getTint()}get label(){return this.getAt(1)?this.getAt(1).text:null}doDisable(e){this.isDisabled=e,this.isDisabled?this.buttonImage.setFrame(0):this.buttonImage.setFrame(1)}set label(e){this.textLabel.text=e}pointerover(){this.isDisabled}pointerout(){this.isDisabled||this.buttonImage.setFrame(1)}pointerdown(){this.isDisabled||this.buttonImage.setFrame(2)}pointerup(){if(this.isDisabled)return;this.buttonImage.setFrame(1);let e=Date.now();this.lastTime+200>e||(this.lastTime=e,EventDispatcher.getInstance().emit("Button",this.textLabel.text))}get width(){return this.buttonImage.width}get height(){return this.buttonImage.height}}let instance=null;class EventDispatcher extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return null===instance&&(instance=new EventDispatcher),instance}}class GameOverScene extends Phaser.Scene{constructor(e){super({key:e})}init(){this.cameras.main.setRoundPixels(!0)}preload(){this.load.path=this.registry.get("path")}create(){let e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.gameName+"\n\n"+Text.gameOverCongratulations,{align:"center"}).setOrigin(.5);e.setColor("#333"),this.title=e,e.setFontSize(16*this.game.resolution),this.scene.get("LoaderScene").levelStarted()}resize(e,t,i){this.title.setPosition(this.cameras.main.centerX,this.cameras.main.centerY)}handleLoseFocus(){}}var study=!1;class GameScene extends Phaser.Scene{constructor(e,t){super({key:e})}init(){this.cameras.main.visible=!1,this.levelNo=parseInt(this.game.restore("levelNo")||0),this.level=this.registry.get("level")}preload(){this.load.path=this.registry.get("path");let e=this.scene.get("LoaderScene");e.loadImages(this,["board-squares"]),e.loadSpritesheets(this,[{name:"piece-whites",size:32},{name:"piece-blacks",size:32}]),"1"===(window.localStorage.getItem("option-sound")||"0")&&(this.load.audio("sfx",["sfx/tracks.ogg"],{}),this.soundMarkers=[{name:"select",start:0,duration:.02},{name:"fail",start:.02,duration:.15},{name:"ok",start:.19,duration:.41},{name:"win",start:.6,duration:1},{name:"down",start:1.6,duration:.5}]),this.soundTime=0}playSound(e){if(!this.soundMarkers)return;let t=Date.now();if(!(t<this.soundTime)){this.soundTime=t+150;for(let t=0;t<this.soundMarkers.length;t++)if(this.soundMarkers[t].name===e){this.sound.setVolume(.3),this.sound.play("sfx",this.soundMarkers[t]);break}}}showHelp(e){let t;if(0===e&&this.board.clearSelect(),study){if(!this.board.helpMove)return void this.time.delayedCall(10,function(){this.showHelp()},[],this);t=this.helpSquare}else t=this.level.initialMove;this.adText.visible=!1;let i=e>0?this.level.initialMoveTo:null;this.time.delayedCall(250,function(){this.board.doSelectTile({x:t[0],y:t[1],moveTo:i}),this.game.input.enabled=!0},[],this),this.board.helpSelect=!0,this.board.helpMove=null}create(e){this.uiButtonSize=e.layout.button.w,this.eventDispather=EventDispatcher.getInstance();let t=this.input.keyboard.createCursorKeys();this.input.keyboard.on("keydown-SPACE",function(){},this),this.cursors=t,this.gamepad=null,this.input.gamepad.once("connected",function(e){this.gamepad=e,this.gamepad.on(Phaser.Input.Gamepad.Events.BUTTON_DOWN,function(e){this.gamepad.left||this.gamepad.right||this.openUI()},this)},this),this.level=this.registry.get("level"),this.board=new Board(this),this.levelFactory=new LevelFactory(this,this.level,this.board),this.board.start(),this.adText=this.add.text(0,0,"Watch Ad for Hint.\n\nThank You.",{font:16*this.game.resolution+"px monospace",color:"#fff",align:"center",backgroundColor:"#000"}).setOrigin(.5,.5).setPadding(16*this.game.resolution),this.adTextNo=this.add.text(0,0,"NO",{font:16*this.game.resolution+"px monospace",color:"#fff",width:this.adText.width+"px",align:"center",backgroundColor:"gray"}).setOrigin(.5,.5).setPadding(10*this.game.resolution),this.adTextNo.setDisplaySize(this.adText.width/3,this.adTextNo.height),this.adTextYes=this.add.text(0,0,"YES",{font:16*this.game.resolution+"px monospace",color:"#fff",width:this.adText.width+"px",align:"center",backgroundColor:"green"}).setOrigin(.5,.5).setPadding(10*this.game.resolution),this.adTextYes.setDisplaySize(this.adText.width/3,this.adTextNo.height),this.setAdVisible(!1);let i=this.scene.get("LoaderScene");if(i.levelStarted(),0===i.levelNo){let e=this.add.text(0,0," White to mate in two moves. \n\nWatch Ad if need Hint.",{font:16*this.game.resolution+"px monospace",align:"center",backgroundColor:"#000"}).setOrigin(.5,.5);e.setPadding(16*this.game.resolution),this.tutorText=e,this.tutorText.alpha=.75,e.setColor("#fff"),this.tutorText.setPosition(this.board.layer.x+this.board.layer.width/2,this.board.layer.y+this.board.layer.height/2)}}onAd(e){this.setAdVisible(!1),e?(this.game.input.enabled=!1,webapp_ad.show(this.adButtonScene.adShown.bind(this.adButtonScene)),window.localStorage.setItem("option-hint","1")):this.adButton.doDisable(!1)}setAdVisible(e){this.adText.visible=e,this.adTextNo.visible=e,this.adTextYes.visible=e}findHelp(e,t){if(this.adText.visible)return;this.adButton=e,this.adButtonScene=t;this.game.input.enabled=!1,webapp_ad.show(this.adButtonScene.adShown.bind(this.adButtonScene)),study&&(this.board.nextTurn(1),this.helpSquare=this.board.getSquare(this.board.helpMove))}resize(e,t,i){this.adText.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),e?(this.board.layer.x=Math.round(this.cameras.main.centerX-this.board.layer.width/2-1*this.uiButtonSize),this.board.layer.y=Math.round(this.cameras.main.centerY-this.board.layer.height/2)):(this.board.layer.x=Math.round(this.cameras.main.centerX-this.board.layer.width/2),this.board.layer.y=Math.round(this.cameras.main.centerY-this.board.layer.height/2-1.5*this.uiButtonSize));let s=this.board.getChildren();for(let e=0;e<s.length;e++){let t=s[e];t.x=Math.round(t.tile.getCenterX()),t.y=Math.round(t.tile.getCenterY())}this.adText.setPosition(this.cameras.main.centerX,this.cameras.main.centerY);let n=4*this.game.resolution;this.adTextNo.setPosition(this.adText.x-this.adTextYes.width/2-n,this.adText.y+this.adText.height/2+this.adTextYes.height/2+n),this.adTextYes.setPosition(this.adText.x+this.adTextYes.width/2+n,this.adText.y+this.adText.height/2+this.adTextYes.height/2+n),this.tutorText&&this.tutorText.setPosition(this.board.layer.x+this.board.layer.width/2,this.board.layer.y+this.board.layer.height/2)}getBoard(){return this.board}update(){var e=this.input.activePointer;e.isDown&&(e.x,this.cameras.main.centerX,this.tutorText&&(this.tutorText.destroy(),this.tutorText=null)),this.gamepad&&(this.gamepad.left||this.gamepad.leftStick.x<=-.5||this.gamepad.rightStick.x,this.gamepad.A||this.gamepad.B)}}class LevelFactory{constructor(e,t,i){t.data={players:[]};for(let s=0;s<t.players.length;s++)t.data.players[s]=new Player(s,e),t.data.players[s].id=s,i.addPlayer(t.data.players[s]);if(t.board)for(let s=0;s<8;s++)for(let n=0;n<8;n++){let r=t.board[s].charAt(n);if("."!==r){let a=LevelFactory.getFrame(r.toUpperCase()),o=r.toUpperCase()===r?"w":"b",h="w"===o?"piece-whites":"piece-blacks",l=i.layer.getTileAt(n,s),u=l.getCenterX(),d=l.getCenterY(),c=new UnitChess(e,"w"===o?t.data.players[0]:t.data.players[1],h,a,u,d,r);l.unit=c,c.tile=l,i.add(c,!0);let f=String.fromCharCode("a".charCodeAt(0)+n)+""+(7-s+1);i.chess.put({type:r.toLowerCase(),color:o},f)}}else 0}static getFrame(e){let t=-1;switch(e){case"P":t=0;break;case"K":t=1;break;case"Q":t=2;break;case"B":t=3;break;case"N":t=4;break;case"R":t=5}return t}createUnits(e,t,i,s,n){let r=[];if(t)for(let a=0;a<t.length;a++){let o=new i(e,s,n,t[a]);r.push(o.sprite)}return r}static preload(e,t){}}class LoaderScene extends Phaser.Scene{constructor(e){super({key:"LoaderScene",visible:!1}),this.loadProgress=0,this.levelList=e}init(){}preload(){this.load.path=this.registry.get("path");this.game.getImage=this.getImage;let e=this.game.config.width<this.game.config.height?this.game.config.width:this.game.config.height;(e-=36)>=576?(this.res="res-hi",this.game.resolution=2):e>=432?(this.res="res-mid",this.game.resolution=1.5):(this.res="res-lo",this.game.resolution=1),this.game.res=this.res,this.levelNo=parseInt(this.game.restore("levelNo")||0);for(let e=0;e<this.levelList.length;e++)if(this.levelList[e]===LEVEL){this.levelNo=e,console.log("Level "+LEVEL);break}this.load.json("level/"+this.levelList[this.levelNo])}create(){EventDispatcher.getInstance();let e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.gameName,{font:"32px Arial",fill:"#333"}).setOrigin(.5);this.loadProgressText=e,e.visible=!1,this.load.on("loadProgress",function(t){e.text=Text.loading+" "+parseInt(100*t)+" %"},this),this.startLevel()}loadLevel(){this.levelList&&this.levelNo>=this.levelList.length||(this.registry.set("level",null),this.load.json("level/"+this.levelList[this.levelNo]),this.load.start())}closeLevel(){this.scene.setVisible(!0),this.scene.bringToTop(),this.cameras.main.alpha=1,this.cameras.main.once("camerafadeoutcomplete",()=>{this.startLevel()}),this.cameras.main.fadeOut(500,255,255,255)}startLevel(){let e=EventDispatcher.getInstance();if(e.shutdown(),e.on("Button",function(e){e===Text.next&&(this.game.input.enabled=!1,this.levelNo++,this.game.save("levelNo",this.levelNo),this.loadLevel(this.levelNo),this.closeLevel()),e===Text.restart&&(this.game.input.enabled=!1,this.closeLevel())},this),this.scene.manager.scenes.length>1)return this.scene.manager.scenes.forEach(function(e){e!==this&&this.scene.remove(e)},this),void this.time.delayedCall(10,function(){this.startLevel()},[],this);let t=this.cache.json.get("level/"+this.levelList[this.levelNo]);if(!t)return this.load.once("complete",function(){this.startLevel()},this),this.load.json("level/"+this.levelList[this.levelNo]),void this.load.start();this.registry.set("level",t),this.scene.setVisible(!1),t.moves?this.scene.add("UIScene",new UIScene("UIScene"),!0):this.scene.add("GameOverScene",new GameOverScene("GameOverScene"),!0)}levelStarted(){this.game.input.enabled=!0,window.addEventListener("resize",this.resize.bind(this),!1),window.dispatchEvent(new Event("resize")),document.getElementById("loader")&&(document.getElementById("loader").style.display="none")}resize(e){let t=window.innerWidth,i=window.innerHeight;this.game.scale.resize(t,i),this.scene.manager.scenes.forEach(function(e){e!==this&&(e.resize(t>i,t,i),e.cameras.main.visible=!0)},this),this.loadProgressText&&this.loadProgressText.setPosition(this.cameras.main.centerX,this.cameras.main.centerY)}getImage(e,t,i,s){return this.cache.json.get("sprites").frames[s+".png"]?new Phaser.GameObjects.Image(e,t,i,"sprites",s):new Phaser.GameObjects.Image(e,t,i,s)}loadBitmap(e,t){this.bitmaps={frames:[]},t.forEach(function(t){e===this||this.sprites.frames[t+".png"]||(console.log("img/"+this.res+"/"+t+".png"),e.load.bitmapFont(t,"img/"+this.res+"/"+t+".png","img/"+this.res+"/"+t+".xml"))},this)}loadImages(e,t){this.sprites={frames:[]},t.forEach(function(t){e===this||this.sprites.frames[t+".png"]||e.load.image(t,"img/"+this.res+"/"+t+".png")},this)}loadSpritesheets(e,t){t.forEach(function(t){let i=t.width?t.width:t.size,s=t.height?t.height:t.size;e.load.spritesheet(t.name,"img/"+this.res+"/"+t.name+".png",{frameWidth:i*this.game.resolution,frameHeight:s*this.game.resolution})},this)}}class Player{constructor(e,t){}}var Text={id:"chess",gameName:"CHESS PROBLEM",loading:"Loading",next:"Next\nLevel",play:"PLAY",quit:"QUIT",pause:"PAUSE",resume:"RESUME",restart:"Retry",gameOverCongratulations:"You solved all problems.\n\nCongratulations!",info:"Problem:\nWhite to mate in",moves:"moves",tooManyMoves:"Out of moves. Retry?",draw:"Draw.",win:"PROBLEM SOLVED",wait:"Wait for computer.",setLang(e){"fi"===e&&(this.gameName="SHAKKIPULMA",this.loading="Ladataan",this.next="JATKA",this.play="PELAA",this.quit="POISTU",this.pause="PAUSE",this.resume="RESUME",this.restart="ALOITA\nALUSTA",this.gameOverCongratulations="Kaikki tasot selvitetty.\n\nOnnittelut!",this.info="Valkoinen pelaa,\nmatti",this.moves="siirrossa",this.tooManyMoves="Liikaa siirtoja. Yritä,\nuudelleen täydellistä peliä.",this.draw="TASAN",this.win="VOITIT\nJatka seuraavaan pulmaan.",this.wait="Odota tietokonetta,\nvoi kestää minuutin.")}};function callme(e){e(!0)}class UIScene extends Phaser.Scene{constructor(e){super({key:e})}init(){this.cameras.main.visible=!1,this.cameras.main.setRoundPixels(!0),this.firstGameToday=!1,parseInt(0|this.game.restore("lastPlayTime"))+43200<(Date.now()/1e3|0)&&(this.firstGameToday=!0)}preload(){this.load.path=this.registry.get("path");this.scene.get("LoaderScene").loadSpritesheets(this,[{name:"button-square",size:60},{name:"button-square-icons",size:40},{name:"button-square-numbers",size:40}])}gameStatus(e){e.move>0&&(this.adButton.doDisable(!0),this.adButton.info.visible=!1);let t=this.registry.get("level");if(e.turn){let i=t.moves-e.move;"w"===e.turn?(this.info.text=Text.info+" "+t.moves+" "+Text.moves+".",this.infoButton.icon.setFrame(i)):this.info.text=Text.wait}}gameOver(e){let t,i;this.adButton.visible=!1,this.gameOverText.visible=!0;let s=window.innerWidth,n=window.innerHeight;switch(this.resize(s>n,s,n),this.gameOverText.text="PROBLEM FAILED",e.result){case"+":t=Text.tooManyMoves,i=Text.restart,this.infoButton.icon.setFrame(0);break;case"-":case"3":t=Text.draw,i=Text.restart;break;case"w":default:this.gameScene.playSound("win"),this.gameOverText.text="PROBLEM SOLVED",this.playButton.icon.flipX=0,this.playButton.icon.setFrame(2),t=Text.win,i=Text.next,this.infoButton.icon.setFrame(0)}this.playButton.label=i,this.info.setText(t)}loadAd(){Android.loadAd()?this.adButton.doDisable(!1):this.time.delayedCall(1e3,function(){this.loadAd()},[],this)}adShown(e){if(!e)return this.adButton.info.text="Failed",void(this.game.input.enabled=!0);this.gameScene.showHelp(this.helpCount),this.adButton.info.text="More",this.helpCount++,this.helpCount<2&&this.loadAd()}create(){let e=EventDispatcher.getInstance();e.on("GameStatus",this.gameStatus.bind(this)),e.once("GameOver",this.gameOver.bind(this)),this.helpCount=0,e.on("Button",function(e){e===Text.restart&&this.gameScene.playSound("select"),"Hint\n(Ad)"===e&&(this.gameScene.playSound("select"),this.adButton.info.visible||(this.adButton.info.visible=!0),"undefined"!=typeof webapp_ad&&this.gameScene.findHelp(this.adButton,this)),"Moves"===e&&(this.gameScene.playSound("select"),document.getElementById("canvas").style.display="none",document.getElementById("guide").style.display="block","undefined"!=typeof webapp_ad&&webapp_ad.showGuide(!0))},this);let t=new Button(this,[Text.restart,Text.continue]);t.icon.setFrame(1),t.icon.flipX=1,this.playButton=t,this.adButton=new Button(this,["Hint\n(Ad)",Text.continue]),this.adButton.doDisable(!0),this.infoButton=new Button(this,["Moves",Text.continue],"button-square-numbers"),this.adButton.info=this.add.text(0,0,"More",{font:12*this.game.resolution+"px monospace",align:"center"}).setOrigin(.5,.5),this.adButton.info.setColor("#333"),this.adButton.info.visible=!1,this.gameOverText=this.add.text(100,100,"PROBLEM SOLVED",{font:16*this.game.resolution+" monospace",align:"center"}).setOrigin(.5,.5),this.gameOverText.setFontSize(16*this.game.resolution),this.gameOverText.setColor("#333"),this.gameOverText.visible=!1;let i=this.add.text(0,0,"",{font:16*this.game.resolution+"px monospace",align:"center"}).setOrigin(.5,.5);i.y=t.y,this.info=i,this.info.setColor("#333"),this.info.visible=!1,EventDispatcher.getInstance().emit("GameStatus",{turn:"w",move:0}),this.scene.sendToBack(),"undefined"!=typeof webapp_ad&&this.time.delayedCall(1e3,function(){this.loadAd()},[],this);this.scene.get("GameScene")||this.scene.add("GameScene",new GameScene("GameScene",this.gameEvent));let s=this.scene.get("GameScene");this.gameScene=s;this.scene.run(s,{layout:{button:{w:this.adButton.width},y:4,x:4,h:this.cameras.main.height-4,w:this.cameras.main.width-4}})}resize(e,t,i){let s=36*this.game.resolution,n=4*s,r=2*this.playButton.width+16*this.game.resolution,a=this.playButton.height+3*this.game.resolution*16,o=this.gameScene.board.layer;if(e){let e=Math.round(this.cameras.main.centerX+n+r-this.playButton.width/2-1.75*this.playButton.width),t=Math.round(this.cameras.main.centerY-2*a/2);this.info.x=this.cameras.main.width-e,this.info.y=t,this.info.setWordWrapWidth(r+s/2),this.adButton.x=e,this.adButton.y=t,t+=a,this.infoButton.x=e,this.infoButton.y=t,t+=a,this.playButton.x=e,this.playButton.y=t,this.gameOverText.visible&&(this.gameOverText.setWordWrapWidth(r),this.gameOverText.setOrigin(0,.5))}else{let e=this.cameras.main.centerX-1*r/2,i=this.cameras.main.centerY+o.height/2-.5*this.playButton.height;this.info.x=this.cameras.main.centerX,this.info.setWordWrapWidth(t),this.gameOverText.setWordWrapWidth(4*r),this.adButton.x=this.cameras.main.centerX,this.adButton.y=i,i+=.75*a,this.infoButton.x=e,this.infoButton.y=i,e+=r,this.playButton.x=e,this.playButton.y=i,this.gameOverText.setOrigin(.5,.5)}this.gameOverText.setPosition(this.adButton.x,this.adButton.y),this.gameOverText.visible&&e&&(this.gameOverText.x-=this.adButton.width/2),this.adButton.info.x=this.adButton.x,this.adButton.info.y=this.adButton.y+this.adButton.height/2+this.adButton.info.height/2*1.5}}var Chess=function(e){var t="b",i="w",s=-1,n="p",r="n",a="b",o="r",h="q",l="k",u="pnbrqkPNBRQK",d="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",c=["1-0","0-1","1/2-1/2","*"],f={b:[16,32,17,15],w:[-16,-32,-17,-15]},g={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},p=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],m=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],v={p:0,n:1,b:2,r:3,q:4,k:5},y={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},b={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},x=7,w=6,T=1,S=0,E={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},A={w:[{square:E.a1,flag:b.QSIDE_CASTLE},{square:E.h1,flag:b.KSIDE_CASTLE}],b:[{square:E.a8,flag:b.QSIDE_CASTLE},{square:E.h8,flag:b.KSIDE_CASTLE}]},C=new Array(128),P={w:s,b:s},O=i,I={w:0,b:0},L=s,B=0,_=1,k=[],N={},D={};function R(e){void 0===e&&(e=!1),C=new Array(128),P={w:s,b:s},O=i,I={w:0,b:0},L=s,B=0,_=1,k=[],e||(N={}),D={},K(Y())}function M(){for(var e=[],t={},i=function(e){e in D&&(t[e]=D[e])};k.length>0;)e.push(ne());for(i(Y());e.length>0;)se(e.pop()),i(Y());D=t}function U(){q(d)}function q(e,n){void 0===n&&(n=!1);var r=e.split(/\s+/),a=r[0],o=0;if(!G(e).valid)return!1;R(n);for(var h=0;h<a.length;h++){var l=a.charAt(h);if("/"===l)o+=8;else if(-1!=="0123456789".indexOf(l))o+=parseInt(l,10);else{var u=l<"a"?i:t;j({type:l.toLowerCase(),color:u},he(o)),o++}}return O=r[1],r[2].indexOf("K")>-1&&(I.w|=b.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(I.w|=b.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(I.b|=b.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(I.b|=b.QSIDE_CASTLE),L="-"===r[3]?s:E[r[3]],B=parseInt(r[4],10),_=parseInt(r[5],10),K(Y()),!0}function G(e){var t="No errors.",i="FEN string must contain six space-delimited fields.",s="6th field (move number) must be a positive integer.",n="5th field (half move counter) must be a non-negative integer.",r="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",o="2nd field (side to move) is invalid.",h="1st field (piece positions) does not contain 8 '/'-delimited rows.",l="1st field (piece positions) is invalid [consecutive numbers].",u="1st field (piece positions) is invalid [invalid piece].",d="1st field (piece positions) is invalid [row too large].",c="Illegal en-passant square",f=e.split(/\s+/);if(6!==f.length)return{valid:!1,error_number:1,error:i};if(isNaN(f[5])||parseInt(f[5],10)<=0)return{valid:!1,error_number:2,error:s};if(isNaN(f[4])||parseInt(f[4],10)<0)return{valid:!1,error_number:3,error:n};if(!/^(-|[abcdefgh][36])$/.test(f[3]))return{valid:!1,error_number:4,error:r};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(f[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(f[1]))return{valid:!1,error_number:6,error:o};var g=f[0].split("/");if(8!==g.length)return{valid:!1,error_number:7,error:h};for(var p=0;p<g.length;p++){for(var m=0,v=!1,y=0;y<g[p].length;y++)if(isNaN(g[p][y])){if(!/^[prnbqkPRNBQK]$/.test(g[p][y]))return{valid:!1,error_number:9,error:u};m+=1,v=!1}else{if(v)return{valid:!1,error_number:8,error:l};m+=parseInt(g[p][y],10),v=!0}if(8!==m)return{valid:!1,error_number:10,error:d}}return"3"==f[3][1]&&"w"==f[1]||"6"==f[3][1]&&"b"==f[1]?{valid:!1,error_number:11,error:c}:{valid:!0,error_number:0,error:t}}function Y(){for(var e=0,n="",r=E.a8;r<=E.h1;r++){if(null==C[r])e++;else{e>0&&(n+=e,e=0);var a=C[r].color,o=C[r].type;n+=a===i?o.toUpperCase():o.toLowerCase()}r+1&136&&(e>0&&(n+=e),r!==E.h1&&(n+="/"),e=0,r+=8)}var h="";I[i]&b.KSIDE_CASTLE&&(h+="K"),I[i]&b.QSIDE_CASTLE&&(h+="Q"),I[t]&b.KSIDE_CASTLE&&(h+="k"),I[t]&b.QSIDE_CASTLE&&(h+="q"),h=h||"-";var l=L===s?"-":he(L);return[n,O,h,l,B,_].join(" ")}function F(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(N[e[t]]=e[t+1]);return N}function K(e){k.length>0||(e!==d?(N.SetUp="1",N.FEN=e):(delete N.SetUp,delete N.FEN))}function W(e){var t=C[E[e]];return t?{type:t.type,color:t.color}:null}function j(e,t){if(!("type"in e&&"color"in e))return!1;if(-1===u.indexOf(e.type.toLowerCase()))return!1;if(!(t in E))return!1;var i=E[t];return(e.type!=l||P[e.color]==s||P[e.color]==i)&&(C[i]={type:e.type,color:e.color},e.type===l&&(P[e.color]=i),K(Y()),!0)}function z(e,t,i,s,r){var a={color:O,from:t,to:i,flags:s,piece:e[t].type};return r&&(a.flags|=b.PROMOTION,a.promotion=r),e[i]?a.captured=e[i].type:s&b.EP_CAPTURE&&(a.captured=n),a}function Q(e){function t(e,t,i,s,l){if(e[i].type!==n||ae(s)!==S&&ae(s)!==x)t.push(z(e,i,s,l));else for(var u=[h,o,a,r],d=0,c=u.length;d<c;d++)t.push(z(e,i,s,l,u[d]))}var i=[],s=O,l=le(s),u={b:T,w:w},d=E.a8,c=E.h1,p=!1,m=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in E))return[];d=c=E[e.square],p=!0}for(var v=d;v<=c;v++)if(136&v)v+=7;else{var y=C[v];if(null!=y&&y.color===s)if(y.type===n){var A=v+f[s][0];if(null==C[A]){t(C,i,v,A,b.NORMAL);A=v+f[s][1];u[s]===ae(v)&&null==C[A]&&t(C,i,v,A,b.BIG_PAWN)}for(B=2;B<4;B++){136&(A=v+f[s][B])||(null!=C[A]&&C[A].color===l?t(C,i,v,A,b.CAPTURE):A===L&&t(C,i,v,L,b.EP_CAPTURE))}}else for(var B=0,_=g[y.type].length;B<_;B++){var k=g[y.type][B];for(A=v;!(136&(A+=k));){if(null!=C[A]){if(C[A].color===s)break;t(C,i,v,A,b.CAPTURE);break}if(t(C,i,v,A,b.NORMAL),"n"===y.type||"k"===y.type)break}}}if(!p||c===P[s]){if(I[s]&b.KSIDE_CASTLE){var N=(D=P[s])+2;null!=C[D+1]||null!=C[N]||$(l,P[s])||$(l,D+1)||$(l,N)||t(C,i,P[s],N,b.KSIDE_CASTLE)}if(I[s]&b.QSIDE_CASTLE){var D;N=(D=P[s])-2;null!=C[D-1]||null!=C[D-2]||null!=C[D-3]||$(l,P[s])||$(l,D-1)||$(l,N)||t(C,i,P[s],N,b.QSIDE_CASTLE)}}if(!m)return i;var R=[];for(v=0,_=i.length;v<_;v++)se(i[v]),V(s)||R.push(i[v]),ne();return R}function X(e,t){var i="";if(e.flags&b.KSIDE_CASTLE)i="O-O";else if(e.flags&b.QSIDE_CASTLE)i="O-O-O";else{var s=function(e,t){for(var i=Q({legal:!t}),s=e.from,n=e.to,r=e.piece,a=0,o=0,h=0,l=0,u=i.length;l<u;l++){var d=i[l].from,c=i[l].to,f=i[l].piece;r===f&&s!==d&&n===c&&(a++,ae(s)===ae(d)&&o++,oe(s)===oe(d)&&h++)}if(a>0)return o>0&&h>0?he(s):h>0?he(s).charAt(1):he(s).charAt(0);return""}(e,t);e.piece!==n&&(i+=e.piece.toUpperCase()+s),e.flags&(b.CAPTURE|b.EP_CAPTURE)&&(e.piece===n&&(i+=he(e.from)[0]),i+="x"),i+=he(e.to),e.flags&b.PROMOTION&&(i+="="+e.promotion.toUpperCase())}return se(e),Z()&&(J()?i+="#":i+="+"),ne(),i}function H(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function $(e,s){for(var r=E.a8;r<=E.h1;r++)if(136&r)r+=7;else if(null!=C[r]&&C[r].color===e){var a=C[r],o=r-s,h=o+119;if(p[h]&1<<v[a.type]){if(a.type===n){if(o>0){if(a.color===i)return!0}else if(a.color===t)return!0;continue}if("n"===a.type||"k"===a.type)return!0;for(var l=m[h],u=r+l,d=!1;u!==s;){if(null!=C[u]){d=!0;break}u+=l}if(!d)return!0}}return!1}function V(e){return $(le(e),P[e])}function Z(){return V(O)}function J(){return Z()&&0===Q().length}function ee(){return!Z()&&0===Q().length}function te(){for(var e={},t=[],i=0,s=0,n=E.a8;n<=E.h1;n++)if(s=(s+1)%2,136&n)n+=7;else{var o=C[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===a&&t.push(s),i++)}if(2===i)return!0;if(3===i&&(1===e[a]||1===e[r]))return!0;if(i===e[a]+2){var h=0,l=t.length;for(n=0;n<l;n++)h+=t[n];if(0===h||h===l)return!0}return!1}function ie(){for(var e=[],t={},i=!1;;){var s=ne();if(!s)break;e.push(s)}for(;;){var n=Y().split(" ").slice(0,4).join(" ");if(t[n]=n in t?t[n]+1:1,t[n]>=3&&(i=!0),!e.length)break;se(e.pop())}return i}function se(e){var i=O,r=le(i);if(function(e){k.push({move:e,kings:{b:P.b,w:P.w},turn:O,castling:{b:I.b,w:I.w},ep_square:L,half_moves:B,move_number:_})}(e),C[e.to]=C[e.from],C[e.from]=null,e.flags&b.EP_CAPTURE&&(O===t?C[e.to-16]=null:C[e.to+16]=null),e.flags&b.PROMOTION&&(C[e.to]={type:e.promotion,color:i}),C[e.to].type===l){if(P[C[e.to].color]=e.to,e.flags&b.KSIDE_CASTLE){var a=e.to-1,o=e.to+1;C[a]=C[o],C[o]=null}else if(e.flags&b.QSIDE_CASTLE){a=e.to+1,o=e.to-2;C[a]=C[o],C[o]=null}I[i]=""}if(I[i])for(var h=0,u=A[i].length;h<u;h++)if(e.from===A[i][h].square&&I[i]&A[i][h].flag){I[i]^=A[i][h].flag;break}if(I[r])for(h=0,u=A[r].length;h<u;h++)if(e.to===A[r][h].square&&I[r]&A[r][h].flag){I[r]^=A[r][h].flag;break}L=e.flags&b.BIG_PAWN?"b"===O?e.to-16:e.to+16:s,e.piece===n?B=0:e.flags&(b.CAPTURE|b.EP_CAPTURE)?B=0:B++,O===t&&_++,O=le(O)}function ne(){var e=k.pop();if(null==e)return null;var i=e.move;P=e.kings,O=e.turn,I=e.castling,L=e.ep_square,B=e.half_moves,_=e.move_number;var s,r,a=O,o=le(O);if(C[i.from]=C[i.to],C[i.from].type=i.piece,C[i.to]=null,i.flags&b.CAPTURE)C[i.to]={type:i.captured,color:o};else if(i.flags&b.EP_CAPTURE){var h;h=a===t?i.to-16:i.to+16,C[h]={type:n,color:o}}i.flags&(b.KSIDE_CASTLE|b.QSIDE_CASTLE)&&(i.flags&b.KSIDE_CASTLE?(s=i.to+1,r=i.to-1):i.flags&b.QSIDE_CASTLE&&(s=i.to-2,r=i.to+1),C[s]=C[r],C[r]=null);return i}function re(e,t){var i=H(e);if(t){var s=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(s)var n=s[1],r=s[2],a=s[3],o=s[4]}for(var h=Q(),l=0,u=h.length;l<u;l++){if(i===H(X(h[l]))||t&&i===H(X(h[l],!0)))return h[l];if(s&&(!n||n.toLowerCase()==h[l].piece)&&E[r]==h[l].from&&E[a]==h[l].to&&(!o||o.toLowerCase()==h[l].promotion))return h[l]}return null}function ae(e){return e>>4}function oe(e){return 15&e}function he(e){var t=oe(e),i=ae(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function le(e){return e===i?t:i}function ue(e){var t=function e(t){var i=t instanceof Array?[]:{};for(var s in t)i[s]="object"==typeof s?e(t[s]):t[s];return i}(e);t.san=X(t,!1),t.to=he(t.to),t.from=he(t.from);var i="";for(var s in b)b[s]&t.flags&&(i+=y[s]);return t.flags=i,t}function de(e){return e.replace(/^\s+|\s+$/g,"")}return q(void 0===e?d:e),{WHITE:i,BLACK:t,PAWN:n,KNIGHT:r,BISHOP:a,ROOK:o,QUEEN:h,KING:l,SQUARES:function(){for(var e=[],t=E.a8;t<=E.h1;t++)136&t?t+=7:e.push(he(t));return e}(),FLAGS:y,load:function(e){return q(e)},reset:function(){return U()},moves:function(e){for(var t=Q(e),i=[],s=0,n=t.length;s<n;s++)void 0!==e&&"verbose"in e&&e.verbose?i.push(ue(t[s])):i.push(X(t[s],!1));return i},in_check:function(){return Z()},in_checkmate:function(){return J()},in_stalemate:function(){return ee()},in_draw:function(){return B>=100||ee()||te()||ie()},insufficient_material:function(){return te()},in_threefold_repetition:function(){return ie()},game_over:function(){return B>=100||J()||ee()||te()||ie()},validate_fen:function(e){return G(e)},fen:function(){return Y()},board:function(){for(var e=[],t=[],i=E.a8;i<=E.h1;i++)null==C[i]?t.push(null):t.push({type:C[i].type,color:C[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",i="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,s=[],n=!1;for(var r in N)s.push("["+r+' "'+N[r]+'"]'+t),n=!0;n&&k.length&&s.push(t);for(var a=function(e){var t=D[Y()];void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`);return e},o=[];k.length>0;)o.push(ne());var h=[],l="";for(0===o.length&&h.push(a(""));o.length>0;){l=a(l);var u=o.pop();k.length||"b"!==u.color?"w"===u.color&&(l.length&&h.push(l),l=_+"."):l=_+". ...",l=l+" "+X(u,!1),se(u)}if(l.length&&h.push(a(l)),void 0!==N.Result&&h.push(N.Result),0===i)return s.join("")+h.join(" ");var d=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},c=function(e,n){for(var r of n.split(" "))if(r){if(e+r.length>i){for(;d();)e--;s.push(t),e=0}s.push(r),e+=r.length,s.push(" "),e++}return d()&&e--,e},f=0;for(r=0;r<h.length;r++)f+h[r].length>i&&h[r].includes("{")?f=c(f,h[r]):(f+h[r].length>i&&0!==r?(" "===s[s.length-1]&&s.pop(),s.push(t),f=0):0!==r&&(s.push(" "),f++),s.push(h[r]),f+=h[r].length);return s.join("")},load_pgn:function(e,t){var i=void 0!==t&&"sloppy"in t&&t.sloppy;function s(e){return e.replace(/\\/g,"\\")}var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",r=new RegExp("^(\\[((?:"+s(n)+")|.)*\\])(?:"+s(n)+"){2}"),a=r.test(e)?r.exec(e)[1]:"";U();var o=function(e,t){for(var i="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",n={},r=e.split(new RegExp(s(i))),a="",o="",h=0;h<r.length;h++)a=r[h].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),o=r[h].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),de(a).length>0&&(n[a]=o);return n}(a,t);for(var h in o)F([h,o[h]]);if("1"===o.SetUp&&!("FEN"in o&&q(o.FEN,!0)))return!1;for(var l=function(e){return`{${function(e){return Array.from(e).map(function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()}).join("")}((e=e.replace(new RegExp(s(n),"g")," ")).slice(1,e.length-1))}}`},u=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},d=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${s(n)}]*)`,"g"),function(e,t,i){return void 0!==t?l(t):" "+l(`{${i.slice(1)}}`)}).replace(new RegExp(s(n),"g")," "),f=/(\([^\(\)]+\))+?/g;f.test(d);)d=d.replace(f,"");var g=de(d=(d=(d=d.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));g=g.join(",").replace(/,,+/g,",").split(",");for(var p="",m=0;m<g.length-1;m++){var v=u(g[m]);if(void 0===v){if(null==(p=re(g[m],i)))return!1;se(p)}else D[Y()]=v}if(void 0!==(v=u(g[g.length-1]))&&(D[Y()]=v,g.pop()),p=g[g.length-1],c.indexOf(p)>-1)(function(e){for(var t in e)return!0;return!1})(N)&&void 0===N.Result&&F(["Result",p]);else{if(null==(p=re(p,i)))return!1;se(p)}return!0},header:function(){return F(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=E.a8;t<=E.h1;t++){if(0===oe(t)&&(e+=" "+"87654321"[ae(t)]+" |"),null==C[t])e+=" . ";else{var s=C[t].type;e+=" "+(C[t].color===i?s.toUpperCase():s.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return O},move:function(e,t){var i=void 0!==t&&"sloppy"in t&&t.sloppy,s=null;if("string"==typeof e)s=re(e,i);else if("object"==typeof e)for(var n=Q(),r=0,a=n.length;r<a;r++)if(!(e.from!==he(n[r].from)||e.to!==he(n[r].to)||"promotion"in n[r]&&e.promotion!==n[r].promotion)){s=n[r];break}if(!s)return null;var o=ue(s);return se(s),o},undo:function(){var e=ne();return e?ue(e):null},clear:function(){return R()},put:function(e,t){return j(e,t)},get:function(e){return W(e)},remove:function(e){return function(e){var t=W(e);return C[E[e]]=null,t&&t.type===l&&(P[t.color]=s),K(Y()),t}(e)},perft:function(e){return function e(t){for(var i=Q({legal:!1}),s=0,n=O,r=0,a=i.length;r<a;r++)se(i[r]),V(n)||(t-1>0?s+=e(t-1):s++),ne();return s}(e)},square_color:function(e){if(e in E){var t=E[e];return(ae(t)+oe(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],i=[],s=(void 0!==e&&"verbose"in e&&e.verbose);k.length>0;)t.push(ne());for(;t.length>0;){var n=t.pop();s?i.push(ue(n)):i.push(X(n)),se(n)}return i},get_comment:function(){return D[Y()]},set_comment:function(e){D[Y()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=D[Y()];return delete D[Y()],e},get_comments:function(){return M(),Object.keys(D).map(function(e){return{fen:e,comment:D[e]}})},delete_comments:function(){return M(),Object.keys(D).map(function(e){var t=D[e];return delete D[e],{fen:e,comment:t}})}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess});class MainGame extends Phaser.Game{constructor(e,t,i){let s=!1;window.innerWidth>=1200&&window.innerHeight>=800&&(s=!0);let n=e.offsetWidth,r=e.offsetHeight;window.devicePixelRatio>=2||window.devicePixelRatio;e.id="canvas",super({key:e.id,type:Phaser.AUTO,parent:e,width:n,height:r,backgroundColor:"#fff",roundPixels:!0,audio:{noAudio:!1},physics:{arcade:{debug:!1,fps:60}},render:{},scale:{mode:Phaser.Scale.NONE},input:{touch:{capture:!1},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene(t)]});let a=document.getElementsByTagName("html")[0].getAttribute("lang");a&&Text.setLang(a),this.registry.set("app",!1),0===window.location.href.indexOf("file:///")?(this.registry.set("debug",!0),this.registry.set("path",""),this.registry.set("app",!0)):-1!==window.location.href.indexOf("localhost:")?(this.registry.set("debug",!0),this.registry.set("path","./")):(this.registry.set("release",!0),this.registry.set("path","")),this.registry.set("gameid",i)}clear(e){window.localStorage.removeItem(this.registry.get("gameid")+e)}save(e,t){window.localStorage.setItem(this.registry.get("gameid")+e,t)}restore(e){return window.localStorage.getItem(this.registry.get("gameid")+e)}}const LEVEL="";function createGame(){var e=new URL(window.location).searchParams.get("id")||"";window.game=new MainGame(document.getElementById("canvas"),["100-01","100-02","100-03","100-04","100-05","100-06","100-07","100-08","100-09","100-10","100-11","100-12","700-01","700-02","700-03","700-04","700-05","700-06","gratz"],Text.id+e)}function setGameConfig(e,t,i){}