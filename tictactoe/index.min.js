var leadManager=leadManager||{name:"leadManager.",preloaded:!1,increaseScore:function(t,e){}},achManager=achManager||{name:"achManager.",preloaded:!1,unlockAchievement:function(t){console.log(this.name+"unlockAchievement "+t)}},constants=constants||{};constants.CLIENT_ID="921591657608-3q0q6jlnhed0alruukva957jrpiccbif.apps.googleusercontent.com",constants.LEAD_TOTAL_WINS="CgkIiOmSmekaEAIQEQ";var leadTimeUnit=6e4,playService={score:864e5,loginComplete:!1,mainStarted:!1,name:"playService.",achievements:[],leadScores:[{id:"me",rank:5,avatar:"avatar-me.png",name:"You",wins:0,inRow:0,time:0,playerId:null},{id:"1",rank:1,avatar:"avatar-0.png",name:"Astronaut",wins:100,inRow:10,time:10},{id:"2",rank:2,avatar:"avatar-1.png",name:"Rocketeer",wins:75,inRow:7,time:9},{id:"3",rank:3,avatar:"avatar-2.png",name:"Eagle",wins:50,inRow:3,time:8},{id:"4",rank:4,avatar:"avatar-3.png",name:"Birdie",wins:25,inRow:2,time:7},{id:"5",rank:5,avatar:"avatar-4.png",name:"Duckling",wins:5,inRow:1,time:6}],getAchievement:function(t){for(var e=0;e<this.achievements.length;e++)if(this.achievements[e].id===t)return this.achievements[e]},getPlayer:function(t){for(var e=0;e<this.leadScores.length;e++)if(this.leadScores[e].id===t)return this.leadScores[e];return null},getAchievements:function(t,e,i){var a,s=[];for(a=0;a<this.achievements.length&&(this.achievements[a].state===t&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id,icon:this.achievements[a].icon}),!(e>0&&s.length>=e));a++);if(i)for(a=0;a<this.achievements.length&&(this.achievements[a].claim&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id}),!(e>0&&s.length>=e));a++);return s},getScores:function(){var t=[],e=playService.getPlayer("me");return t.push(e.wins),t.push(e.inRow),t.push(e.time),t},resize:function(t,e,i){var a=document.getElementById("login-buttons");a&&(a.style.left=Math.floor(t*i)+"px",a.style.top=Math.floor(e*i)+"px"),(a=document.getElementById("login-image"))&&(a.style.width=Math.floor(64*i)+"px",a.style.height=Math.floor(64*i)+"px")},showLogin:function(){if(!this.loggedIn&&this.mainStarted&&this.loginComplete){var t=document.getElementById("login-buttons");t&&(t.style.display="block")}},downloadedScore:function(t,e){var i=playService.getPlayer("me"),a=!1;return t===constants.LEAD_TOTAL_WINS&&(e>i.wins?(i.wins=e,a=!0):i.wins>e&&leadManager.increaseScore(t,i.wins)),a},downloadedAchievements:function(t){for(var e=!1,i=0;i<t.length;i++){var a=t[i],s=this.getAchievement(a.id);if(s)if("UNLOCKED"===a.achievementState){if(s&&"UNLOCKED"!==s.state){s.state="UNLOCKED";for(var o=0;o<this.achievements.length-1;o++)this.achievements[o]===s&&this.achievements[o+1].type===s.type&&(this.achievements[o+1].state="REVEALED");e=!0}}else s&&"UNLOCKED"===s.state&&achManager.unlockAchievement(a.id)}e&&(dataStorage.saveAchievements(),mainState.updateAchievements())},loadedScores:function(t){var e=playService.getPlayer("me"),i=!1;t[0]>e.wins&&(e.wins=parseInt(t[0]),i=!0),t[1]>e.inRow&&(e.inRow=parseInt(t[1]),i=!0),t[2]>e.time&&(e.time=parseInt(t[2]),i=!0),i&&(mainState.updateScores(),leadManager.increaseScore(constants.LEAD_TOTAL_WINS,e.wins))},loadedAchievements:function(t){var e,i=!1;for(e=0;e<t.length;e++){var a=this.getAchievement(t[e]);if("UNLOCKED"!==a.state)for(i=!0,a.state="UNLOCKED",achManager.unlockAchievement(t[e]),e=0;e<this.achievements.length-1;e++)this.achievements[e]===a&&this.achievements[e+1].type===a.type&&(this.achievements[e+1].state="REVEALED")}i&&mainState.updateAchievements()},showAchievements:function(t){for(var e=[],i=0;i<this.achievements.length&&(this.achievements[i].claim&&(this.achievements[i].claim=!1,e.push({name:this.achievements[i].name,desc:this.achievements[i].desc})),!(t>0&&e.length>=t));i++);return e},setScore:function(t){var e,i;for(playerData=playService.getPlayer("me"),playerData.wins=t,e=0;e<this.achievements.length;e++)if(1===(i=this.achievements[e]).type&&"REVEALED"===i.state&&playerData.wins>=i.data){this.unlockAchievement(i.id,!0);break}leadManager.increaseScore(constants.LEAD_TOTAL_WINS,playerData.wins);return dataStorage.saveScores(),!1},unlockAchievement:function(t,e){var i=this.getAchievement(t);if("UNLOCKED"!==i.state){i.state="UNLOCKED",i.claim=!0,achManager.unlockAchievement(t),dataStorage.saveAchievements(),!0;for(var a=0;a<this.achievements.length-1;a++)this.achievements[a]===i&&this.achievements[a+1].type===i.type&&(this.achievements[a+1].state="REVEALED")}},hide:function(){var t=document.getElementById("login-buttons");t&&(t.style.display="none")},signedIn:function(t){this.loginComplete=!0,t?(this.loggedIn=!0,this.hide()):this.showLogin()},claimAchievements:function(){for(var t=0;t<this.achievements.length;t++)this.achievements[t].claim&&(achManager.unlockAchievement(this.achievements[t].id),this.achievements[t].claim=!1)},addPlayer:function(t,e,i,a){var s=playService.getPlayer("me");i&&(s.name=i),a&&!s.iconLoaded&&(s.iconLoaded=!0,s.icon=a,mainState.updatePlayerIcon(s)),this.downloadedScore(t,e)&&(dataStorage.saveScores(),mainState.updateScores())},sync:function(){console.log("sync");var t=playService.getPlayer("me");leadManager.increaseScore(constants.LEAD_TOTAL_WINS,t.wins),mainState.updateScores()}};function getProfilePic(t){}function loadUpFriends(){gapi.client.plus.people.list({collection:"visible",orderBy:"alphabetical",userId:"me",maxResults:20}).execute(function(t){if(t.hasOwnProperty("items"))for(var e=0;e<t.items.length;e++);})}leadManager.preloaded=!1,leadManager.leaderboards={},leadManager.preloadData=function(){leadManager.showLeaderboard(constants.LEAD_TOTAL_WINS)},leadManager.getScore=function(){gapi.client.games.scores.get({playerId:"me",timeSpan:"ALL_TIME",leaderboardId:"ALL"}).execute(function(t){if(!t.error){var e=[];if(t.items&&t.items.length>0)for(var i=0;i<t.items.length;i++)e.push({id:t.items[i].leaderboard_id,value:t.items[i].scoreValue});playService.downloadedScore(e)}}),leadManager.preloaded=!0},leadManager.increaseScore=function(t,e){leadManager.preloaded&&gapi.client.games.scores.submit({leaderboardId:t,score:e}).execute(function(t){if(t.hasOwnProperty("beatenScoreTimeSpans"))for(var e=0;e<t.beatenScoreTimeSpans.length;e++)"ALL_TIME"===t.beatenScoreTimeSpans[e]&&!0})},leadManager.showLeaderboard=function(t){gapi.client.games.scores.list({collection:"SOCIAL",leaderboardId:t,timeSpan:"ALL_TIME"}).execute(function(e){if(e.message,e.hasOwnProperty("items")){if(e.playerScore){var i=e.playerScore,a=i.player,s=a.displayName;(!s||s>15)&&a.name&&a.name.givenName&&(s=a.name.givenName);var o=a.avatarImageUrl;o&&(o+="?sz=74"),playService.addPlayer(t,i.scoreValue,s,o)}}else leadManager.preloaded=!0,playService.sync()})},achManager.achievements={},achManager.preloaded=!1,achManager.preloadData=function(){gapi.client.games.achievementDefinitions.list().execute(function(t){if("games#achievementDefinitionsListResponse"===t.kind&&t.hasOwnProperty("items")){for(var e=0;e<t.items.length;e++)achManager.achievements[t.items[e].id]=t.items[e],achManager.achievements[t.items[e].id].achievementState=t.items[e].initialState;achManager.loadAchievementsEarnedByPlayer()}})},achManager.loadAchievementsEarnedByPlayer=function(){gapi.client.games.achievements.list({playerId:"me"}).execute(function(t){if("games#playerAchievementListResponse"===t.kind&&t.hasOwnProperty("items")){for(var e=[],i=0;i<t.items.length;i++){var a=t.items[i];achManager.achievements[a.id].achievementState=a.achievementState,a.hasOwnProperty("formattedCurrentStepsString")&&(achManager.achievements[a.id].formattedCurrentStepsString=a.formattedCurrentStepsString),e.push(achManager.achievements[a.id])}playService.downloadedAchievements(e),achManager.preloaded=!0}else console.log("**Unexpected response **",t)})},achManager.unlockAchievement=function(t){achManager.preloaded&&gapi.client.games.achievements.unlock({achievementId:t}).execute(function(t){t.newlyUnlocked})},achManager.reset=function(t){};var login=login||{};login.loadClient=function(){gapi.client.load("games","v1",function(){leadManager.preloadData(),achManager.preloadData()})},login.handleAuthResult=function(t){t&&!t.error?(login.loadClient(),playService.signedIn(!0)):playService.signedIn(!1)},login.showLoginDialog=function(){gapi.auth.signIn()},login.logout=function(){gapi.auth.signOut()};var googleLoginCallback=function(t){login.handleAuthResult(t)};function copy(t){var e,i,a;for(a in e=Array.isArray(t)?[]:{},t)i=t[a],e[a]="object"==typeof i?copy(i):i;return e}function addText(t,e,i,a,s,o){var h=this.game.add.text(0,0,t,{fill:"#"+a,fontWeight:"normal",font:dataStorage.fontContent},this.textGroup);return h.anchor.set(.5),h.dx=.5+e,h.dy=.5+i,h.size=Math.floor(s),h.x=h.dx*this.size.width,h.y=h.dy*this.size.height,o&&h.kill(),h}function addSpriteFromFile(t,e,i){var a;return a=this.create(0,0,t),void 0===e&&(a.kill(),e=i=0),a.anchor.set(.5),a.dx=.5+e,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a}function setTexture(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e}function addSprite(t,e,i,a,s){var o;return s||(s=this),o=dataStorage.debug?s.create(0,0,t):s.create(0,0,a,t),s&&(o.noscale=!0),o.anchor.set(.5),void 0===e&&(o.kill(),e=i=0),o.dx=.5+e,o.dy=.5+i,o.x=o.dx*this.size.width,o.y=o.dy*this.size.height,o}function makeSprite(t,e,i,a){return dataStorage.debug?t.make.sprite(i,a,e):t.make.sprite(i,a,"atlas",e)}function lockInputbak(t){t||(t=500),this.inputLockTime=this.time.now+t}function handleInputWidgetbak(){if(!this.inputWidget){if(this.game.input.activePointer.targetObject){var t=this;this.inputWidgets.forEach(function(e){e.input()&&t.showInputWidget(e)})}return null!==this.inputWidget}return hideInputWidget(this),!0}function dimmOverlaybak(t){var e=window.dimmGraphics;if(e){if(e.width===window.innerWidth&&e.height===window.innerHeight)return}else e=window.dimmGraphics=t.make.graphics(0,0);return e.clear(),e.beginFill(0),e.drawRect(0,0,window.innerWidth,window.innerHeight),e.endFill(),e}function onResize(t,e){0!==e.width&&0!==e.height||(e.width=640,e.height=480);var i=e.width,a=e.height;this.width===i&&this.height,this.width=i,this.height=a;var s=i>=a,o=0,h=0;this.headerGroup&&(this.headerGroup.size=s?this.headerGroup.landSize:this.headerGroup.portSize,o+=this.headerGroup.size.width,h+=this.headerGroup.size.height),this.boardGroup&&(this.boardGroup.size=s?this.boardGroup.landSize:this.boardGroup.portSize,o+=this.boardGroup.size.width,h+=this.boardGroup.size.height),this.controlGroup&&(this.controlGroup.size=s?this.controlGroup.landSize:this.controlGroup.portSize,o+=this.controlGroup.size.width,h+=this.controlGroup.size.height),this.adGroup&&(this.adGroup.size=s?this.adGroup.landSize:this.adGroup.portSize);var r=i/o,n=a/h,d=Math.min(r,n);d>1&&(d=1);var l,p=0,c=0;if((l=this.bgGroup)&&l.resize(d,p,c,i-p,a-c),(l=this.headerGroup)&&(l.resize(d,p,c,i-p,a-c),p+=l.size.width*l.scale.x,c+=l.size.height*l.scale.y),l=this.boardGroup){var u=0,g=0;this.controlGroup&&(u=this.controlGroup.size.width*d,g=this.controlGroup.size.height*d),l.resize(d,p,c,i-p-u,a-c-g),s?p+=l.size.width*l.scale.x:c+=l.size.height*l.scale.y}return(l=this.controlGroup)&&l.resize(d,p,c,i-p,a-c),(l=this.adGroup)&&l.resize(d,0,0,i,a),(l=this.popupGroup)&&l.resize(d,0,0,i,a),(l=this.effectGroup)&&l.resize(d,0,0,i,a),(l=this.tutorialGroup)&&l.resize(d,0,0,i,a),d}var dimOverlay=null;function fadeOutEffect(t){playService.hide();var e=t.game.add.graphics(0,0);t.world.remove(e),e.beginFill(2,0,1);var i=t.game.width,a=t.game.height,s=Math.max(i,a),o={step:s};e.drawCircle(i/2,a/2,o.step);var h=t.add.tween(o).to({step:0},500,Phaser.Easing.Quadratic.InOut,!0).onUpdateCallback(function(){e.clear(),e.beginFill(2,0,1),e.drawCircle(i/2,a/2,o.step)},this);return t.world.mask=e,h}function addPointer(t,e,i){t.add.sprite(e,i,"atlas","sudokugarden-play.png").anchor.set(.5)}function formatTime(t){var e=Math.floor(t/60);return e+":"+("0"+(t-60*e)).substr(-2)}function renderBg(t){var e=this.game.width,i=this.game.height;this.cache.checkBitmapDataKey("bmd-bg")||((a=this.make.bitmapData(e,i)).smoothed=!1,this.cache.addBitmapData("bmd-bg",a));var a=this.cache.getBitmapData("bmd-bg");a.width===e&&a.height===i||a.resize(e,i),a.clear();var s=a.ctx.createLinearGradient(0,0,0,a.height);s.addColorStop(0,"#f1e5e5"),s.addColorStop(.25,"#f1e5e5"),s.addColorStop(.5,"#2244ff"),s.addColorStop(.5,"#187d31"),s.addColorStop(1,"#8ba45d"),a.ctx.fillStyle=s,a.ctx.fillRect(0,0,e,i);var o=makeSprite(this.game,"bg-top.png",0,0);o.scale.set(t),o.width=e;var h=o.height;a.draw(o,0,0),o.destroy(),(o=makeSprite(this.game,"bg-top-below.png",0,0)).scale.set(t),a.draw(o,a.width-o.width>>1,h),o.destroy(),(o=makeSprite(this.game,"bg-grass.png",0,0)).scale.set(t),o.width=e,h=i-o.height,a.draw(o,0,i-o.height),o.destroy(),(o=makeSprite(this.game,"bg-grass-above.png",0,0)).scale.set(t),a.draw(o,a.width-o.width>>1,h-o.height),o.destroy(),this.bg||(this.bg=this.game.add.image(0,0,a),this.bg.sendToBack())}var Text={name:"Tic Tac Toe",loading:"Loading",goal:"    Place three crosses in horizontal, vertical or diagonal row to win a board.\n\n    Score as many boards as possible within time.\n\n[Game sounds by NoiseForFun.com]",topScore:"TOP SCORES",begin:"YOU BEGIN",wait:"Opponent begins",quit:"Do you want to quit this game?",time:"TIME",level:"LEVEL",win:"YOU WIN!",lose:"YOU LOSE...",tie:"A DRAW",easy:"EASY",hard:"HARD",timeup:"Time is up!",congraz:"Congratulations",alldone:"You have achieved everything!",newRecord:"NEW RECORD!",yours:"TOPSCORE ",score:"SCORE ",fb1:"Well Done!",fb2:"Superb!",fb3:"Perfect!",fb4:"Excellent!",fb5:"Amazing!",fb6:"Brilliant!",fi:function(){this.name="Ristinolla",this.loading="Ladataan",this.goal="    Voita peli kolmella ristillä vakaan, pystyyn tai viistoon.\n\n    Yritä voitaa annetussa ajassa mahdollisimman monta peliä.\n\n[Pelin äänet NoiseForFun.com]",this.topScore="HUIPPUPISTEET",this.begin="SINÄ ALOITAT",this.wait="Vastustaja aloittaa",this.quit="Haluatko lopettaa tämän pelin?",this.time="AIKA",this.level="TASO",this.win="VOITIT!",this.lose="HÄVISIT...",this.tie="TASAPELI",this.easy="HELPPO",this.hard="VAIKEA",this.timeup="Time is up!",this.congraz="Onnittelut",this.alldone="Olet saavuttanut kaiken!",this.newRecord="ENNÄTYS!",this.yours="HUIPUT ",this.score="PISTEET ",this.fb1="Hienoa!",this.fb2="Huippua!",this.fb3="Täydellinstä!",this.fb4="Erinomaista!",this.fb5="Ällistyttävää!",this.fb6="Brillianttia!"}};function setLang(){(window.location.href.indexOf("-fi")>0||window.location.href.indexOf("ristinolla")>0)&&Text.fi()}setLang();var dataStorage={URL:"http://gamequack.com/",title:Text.name,name:"tic-tac-toe-",fontContent:"Source Serif Pro",fontHeader:"Source Code Pro",debug:!1,isAudio:!0,init:function(){if("undefined"!=typeof Storage)try{var t=localStorage.getItem("audio");null!==t&&"null"!==t&&(this.isAudio="on"===t),null!==(t=localStorage.getItem(this.name+"scores"))&&"null"!==t&&playService.loadedScores(t.trim().split(" "),this),null!==(t=localStorage.getItem(this.name+"achievements"))&&"null"!==t&&playService.loadedAchievements(t.trim().split(" "),this)}catch(t){alert("err")}},setAudio:function(t){if(this.isAudio=t,!t&&this.musicPlaying&&this.musicPlaying.fadeOut(),"undefined"!=typeof Storage)try{localStorage.setItem("audio",t?"on":"off")}catch(t){}},reset:function(){if(console.log("reset dataStorage"),"undefined"!=typeof Storage)try{localStorage.removeItem(this.name+"scores"),localStorage.removeItem(this.name+"achievements")}catch(t){}},saveScores:function(){if("undefined"!=typeof Storage)try{var t=playService.getScores(),e="";t.forEach(function(t){e+=t+" "}),localStorage.setItem(this.name+"scores",e)}catch(t){}},saveAchievements:function(){if("undefined"!=typeof Storage)try{var t=playService.getAchievements("UNLOCKED"),e="";t.forEach(function(t){e+=t.id+" "}),localStorage.setItem(this.name+"achievements",e)}catch(t){}}};EffectGroup=function(t,e,i){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},EffectGroup.prototype=Object.create(Phaser.Group.prototype),EffectGroup.prototype.constructor=EffectGroup,EffectGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},EffectGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},EffectGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,this.spriteAtlas)},EffectGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},EffectGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t)},EffectGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=Math.floor(t.dx*this.size.width),t.y=Math.floor(t.dy*this.size.height)},EffectGroup.prototype.moveTo=function(t,e){t.dx=e.dx,t.dy=e.dy,t.x=Math.floor(t.dx*this.size.width),t.y=Math.floor(t.dy*this.size.height)},EffectGroup.prototype.enable=function(t){"sparkle"===t&&((e=this.sparkle=this.game.add.emitter(0,0,15)).makeParticles(["atlas"],["effect-star.png"]),e.setRotation(0,0),e.gravity=0,e.minRotation=-90,e.maxRotation=90,e.setAlpha(1,0,1750,Phaser.Easing.Quadratic.InOut),this.add(e));"leaf"===t&&((e=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-leaf.png"]),this.add(e));"snowflake.png"===t&&((e=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-snowflake.png"]),this.add(e));if("snowing"===t){var e=this.snowing=this.game.add.emitter(this.game.world.centerX,-32,300);this.add(e)}},EffectGroup.prototype.start=function(t,e,i,a){if(this.snowing){var s=this.snowing;this.rain?(s.makeParticles(["atlas"],["effect-rain-drop.png"]),s.maxRotation=0,s.setYSpeed(200,300),s.setXSpeed(-5,5)):(s.makeParticles(["atlas"],["effect-snowflake-1.png","effect-snowflake-2.png","effect-snowflake-3.png"]),s.setYSpeed(40,100),s.maxRotation=40),s.maxParticleScale=1,s.minParticleScale=.5,s.gravity=0,s.width=i,s.minRotation=0,s.start(!1,2e4,500)}else if(this.leaf){(s=this.leaf).x=t/this.scale.x,s.width=i,s.height=a,s.y=e/this.scale.y,s.start(!1,5e3,1450,0)}else{(s=this.sparkle).width=i,s.height=a,s.x=t/this.scale.x,s.y=e/this.scale.y,s.flow(1750,50,1,15)}},PopupGroup=function(t,e){this.size=e,Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},PopupGroup.prototype=Object.create(Phaser.Group.prototype),PopupGroup.prototype.constructor=PopupGroup,PopupGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},PopupGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},PopupGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},PopupGroup.prototype.resize=function(t,e,i,a,s){if(this.width=a,this.height=s,this.scale.set(t),this.dim.width=a,this.dim.height=s,this.banner){this.banner.x=a/2/t,this.banner.y=s/2/t,this.bannerBg.x=this.banner.x,this.bannerBg.y=this.banner.y,this.bannerBg.width=a/t;var o=2*a/3/t,h=s/2/t-.9*this.banner.height;this.quackSad&&(this.quackSad.x=o,this.quackSad.y=h),this.quack&&(this.quack.x=o,this.quack.y=h),this.bannerText.x=a/2,this.bannerText.y=s/2,this.bannerText.fontSize=32*t,this.bannerText.wordWrapWidth=500*t}this.dialogBg&&(this.dialogBg.x=a/2/this.scale.x,this.dialogBg.y=s/2/this.scale.y,this.dialogTitle.x=a/2,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogTitle.fontSize=this.dialogTitle.baseFontSize*t,this.dialogText.x=a/2,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.fontSize=28*t,this.dialogText.wordWrapWidth=500*t,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.fontSize=20*t,this.dialogTip.wordWrapWidth=500*t)},PopupGroup.prototype.enable=function(t){if(this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.5,this.dim.kill()),"popup-kid.png"===t){(d=this.banner=this.addSprite("popup-banner.png")).scale.set(.5);var e={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};(l=this.bannerText=this.game.add.text(0,0,"",e)).kill(),l.anchor.set(.5),l.wordWrap=!0,this.textGroup.add(l)}if("popup-banner.png"===t||"popup-gauge.png"===t){d=this.bannerBg=this.addSprite("popup-banner-bg.png"),d=this.banner=this.addSprite("popup-banner.png"),(d=this.quack=this.addSpriteFromFile("quack.png")).scale.set(.375),(d=this.quackSad=this.addSprite("quack-sad.png")).scale.set(.75);e={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};if((l=this.bannerText=this.game.add.text(0,0,"",e)).kill(),l.anchor.set(.5),l.wordWrap=!0,this.textGroup.add(l),"popup-gauge.png"===t){var i=this.gaugeBg=makeSprite(this.game,"popup-gauge.png",0,16);i.anchor.set(.5),this.banner.addChild(i);var a=2*dataStorage.scoreMax,s=this.game.make.bitmapData(5*a,32);s.smoothed=!1,s.clear();var o,h=s.ctx.createLinearGradient(0,0,s.width,s.height);h.addColorStop(0,"#00ff00"),h.addColorStop(.5,"#ffff00"),h.addColorStop(1,"#ff0000"),s.ctx.fillStyle=h,s.ctx.fillRect(0,0,5*a,32),this.game.cache.removeBitmapData("bmd-gauge"),this.game.cache.addBitmapData("bmd-gauge",s),(o=this.gauge=this.game.make.sprite(0,0,this.game.cache.getBitmapData("bmd-gauge"))).anchor.set(.5),o.loadTexture(this.game.cache.getBitmapData("bmd-gauge")),this.gaugeBg.addChild(o);var r=5*-a/2;dataStorage.score<15?r+=7.5*dataStorage.score:dataStorage.score<30?(r+=112.5,r+=5*(dataStorage.score-15)):(r+=112.5,r+=75,r+=2.5*(dataStorage.score-30));var n=this.gaugePointer=this.game.make.sprite(r,0,"atlas","popup-gauge-pointer.png");n.anchor.set(.5),o.addChild(n),i.kill()}}if("popup-dialog.png"===t||"popup-dialog-quit.png"===t){var d;(d=this.dialogBg=this.addSprite("popup-dialog-bg.png")).inputEnabled=!0,d.input.useHandCursor=!1;var l;e={fill:"#83472e",align:"left",fontWeight:"bold",font:dataStorage.fontHeader};(l=this.dialogTitle=this.game.add.text(0,0,dataStorage.title,e)).baseFontSize=34,l.kill(),l.anchor.set(.6,0),l.wordWrap=!1,this.textGroup.add(l),e={fill:"#83472e",align:"left",fontWeight:"normal",font:dataStorage.fontContent},(l=this.dialogText=this.game.add.text(0,0,"",e)).kill(),l.anchor.set(.5,0),l.wordWrap=!0,this.textGroup.add(l),(l=this.dialogTip=this.game.add.text(0,0,"",e)).kill(),l.anchor.set(.5),l.wordWrap=!0,this.textGroup.add(l),this.play=makeSprite(this.game,"popup-dialog-play.png"),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0,this.play.input.priorityID=1,this.play.anchor.set(.5),d.addChild(this.play),this.claim=makeSprite(this.game,"popup-dialog-claim.png"),this.claim.inputEnabled=!0,this.claim.input.useHandCursor=!0,this.claim.input.priorityID=1,this.claim.anchor.set(.5),this.claim.kill(),this.claim.y=200,d.addChild(this.claim),"popup-dialog-quit.png"===t&&(this.quit=makeSprite(this.game,"popup-dialog-quit.png"),this.quit.inputEnabled=!0,this.quit.input.useHandCursor=!0,this.quit.anchor.set(.5),this.quit.input.priorityID=1,this.quit.y=100,d.addChild(this.quit),this.play.kill()),this.close=makeSprite(this.game,"popup-dialog-close.png"),this.close.inputEnabled=!0,this.close.input.useHandCursor=!0,this.close.input.priorityID=1,this.close.x=200,this.close.y=-250,d.addChild(this.close),this.achievementIcon=makeSprite(this.game,"popup-achievement-icon.png",115,80),this.dialogBg.addChild(this.achievementIcon),this.achievementIcon.kill()}},PopupGroup.prototype.enableGauge=function(t,e,i){this.gaugeEnabled=t},PopupGroup.prototype.gaugeX=function(){var t=dataStorage.score,e=dataStorage.scoreMax;t=45,t++;var i=5*e*2,a=Math.log(1)/Math.log(10),s=Math.log(e)/Math.log(10)-a,o=(Math.log(t)/Math.log(10)-a)/s*i;return o-=5*e,alert(o),o},PopupGroup.prototype.showBanner=function(t,e,i,a){if(this.visible||this.hideTimeout)this.hide();else{var s;this.visible=!0,this.textGroup.visible=!0,this.shade&&this.shade.revive(),this.dim.revive(),this.bannerText.revive(),this.quack.kill(),this.quackSad.kill(),(s=a?this.quackSad:this.quack).revive(),this.bannerBg.revive(),this.banner.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.hideCallback=i,this.bannerText.text=t,s.y=-this.banner.height/2-.9*this.banner.height,this.bannerBg.y=this.banner.y=-this.banner.height/2,this.gaugeBg&&(this.gaugeEnabled?this.gaugeBg.revive():this.gaugeBg.kill()),this.bannerText.y=this.banner.y*this.scale.y;var o=this.game.height,h=o/2/this.scale.y-.9*this.banner.height,r=o/2/this.scale.y,n=o/2;this.game.add.tween(s).to({y:h},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.banner).to({y:r},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerBg).to({y:r},750,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerText).to({y:n},750,Phaser.Easing.Back.Out,!0,500),e&&(this.hideTimeout=this.game.time.events.add(e,function(){this.hideBanner()},this)),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)}},PopupGroup.prototype.hideBanner=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var t,e=this.game.height;t=this.quack.visible?this.quack:this.quackSad;var i=Phaser.Easing.Quadratic.In,a=e/this.scale.y+this.banner.height,s=e/this.scale.y+this.banner.height+t.height/2;this.game.add.tween(t).to({y:a},500,i,!0),this.game.add.tween(this.banner).to({y:s},500,i,!0),this.game.add.tween(this.bannerBg).to({y:s},500,i,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.shade&&this.shade.kill(),this.dim.kill(),this.bannerText.kill(),this.banner.kill(),this.bannerBg.kill(),this.hideCallback&&(this.hideCallback.popupHidden.call(this.hideCallback,this.bannerText.text),this.hideCallback=null)},this);var o=s*this.scale.y;this.game.add.tween(this.bannerText).to({y:o},500,i,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},PopupGroup.prototype.showDialog=function(t,e,i,a,s,o,h){if(this.visible||this.hideTimeout)this.hide();else{this.visible=!0,this.textGroup.visible=!0,this.claim.kill(),o?(this.dialogTitle.text=o,this.achievementIcon.revive(),h&&(this.claim.revive(),this.play.kill())):(this.dialogTitle.text=dataStorage.title,this.achievementIcon.kill()),this.dim.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.quit&&(s?this.quit.revive():this.quit.kill()),this.dialogBg.revive(),this.dialogText.text=t,this.dialogText.revive(),this.dialogTitle.revive(),e&&(this.dialogTip.text=e,this.dialogTip.revive()),this.hideCallback=i;var r=this.game.width/this.scale.x,n=this.game.height/this.scale.y,d=-this.dialogBg.width/2;this.dialogBg.x=d,this.dialogBg.y=n/2,this.play.y="ACHIEVEMENT"!==e?200:0,this.dialogTitle.x=d*this.scale.x,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogText.x=d*this.scale.x,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.wordWrapWidth=500*this.scale.y,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.wordWrapWidth=500*this.scale.y;var l=600;a||(l=1);var p=r/2;this.game.add.tween(this.dialogBg).to({x:p},l,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTitle).to({x:p*this.scale.x},l,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogText).to({x:p*this.scale.x},l,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTip).to({x:p*this.scale.x},l,Phaser.Easing.Back.Out,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)}},PopupGroup.prototype.hideDialog=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var t=-this.dialogBg.width/2;this.game.add.tween(this.dialogTitle).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogText).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogTip).to({x:t*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogBg).to({x:t},500,Phaser.Easing.Back.In,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.dialogBg.kill(),this.dialogTitle.kill(),this.dialogText.kill(),this.dialogTip.kill(),this.achievementIcon.kill()},this),this.hideCallback&&this.hideCallback.popupHidden.call(this.hideCallback),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},PopupGroup.prototype.hide=function(){this.banner&&this.banner.visible?this.hideBanner():this.dialogBg&&this.dialogBg.visible&&this.hideDialog()},TutorialGroup=function(t,e){this.size=e,Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},TutorialGroup.prototype=Object.create(Phaser.Group.prototype),TutorialGroup.prototype.constructor=TutorialGroup,TutorialGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},TutorialGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},TutorialGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},TutorialGroup.prototype.resize=function(t,e,i,a,s){this.width=a,this.height=s,this.scale.set(t),this.dim&&(this.dim.width=a,this.dim.height=s/4),this.targetSprite&&this.handPosition()},TutorialGroup.prototype.enable=function(t){this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.75,this.dim.kill()),this.hand=this.addSprite("popup-hand.png",0,0);var e={fill:"#ffffff",align:"center",font:dataStorage.fontContent},i=this.handText=this.game.add.text(0,0,"",e);i.anchor.set(.5),i.wordWrap=!0,this.textGroup.add(i)},TutorialGroup.prototype.handPosition=function(){this.game.world.bringToTop(this),this.handText.x=this.game.width/2,this.handText.y=this.game.height/8,this.handText.fontSize=32*this.scale.x,this.handText.wordWrapWidth=400*this.scale.x;var t=this.targetSprite,e=this.targetGroup;this.hand.x=e.centerX(t)-this.hand.width/2*this.scale.x,this.hand.y=e.centerY(t),this.hand.x/=this.scale.x,this.hand.y/=this.scale.y},TutorialGroup.prototype.pointHand=function(t,e,i){this.visible=!0,this.hand.revive(),this.targetSprite=t,this.targetGroup=e,this.handPosition(),this.game.time.events.add(i,function(){this.hide()},this)},TutorialGroup.prototype.showHand=function(t,e,i){this.visible=!0,this.textGroup.visible=!0,this.step=1,this.dim.revive(),this.hand.revive(),this.targetSprite=e,this.targetGroup=i,this.handPosition(),this.handText.text=t,this.game.world.bringToTop(this.textGroup),this.handText.bringToTop(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},TutorialGroup.prototype.hideHand=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},TutorialGroup.prototype.hide=function(){this.hideHand()},TutorialGroup.prototype.nextStep=function(t,e,i){var a,s;(this.step++,this.handText.text=t,void 0!==e)&&(a=i.centerX(e)-this.hand.width/2*this.scale.x,s=i.centerY(e),a/=this.scale.x,s/=this.scale.y,this.targetSprite=e,this.targetGroup=i,this.game.add.tween(this.hand).to({x:a,y:s},750,Phaser.Easing.Back.InOut,!0).onComplete.add(function(){},this))},TutorialGroup.prototype.handTarget=function(){return this.targetSprite},AdGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.main=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},AdGroup.prototype=Object.create(Phaser.Group.prototype),AdGroup.prototype.constructor=AdGroup,AdGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},AdGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},AdGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},AdGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t),this.size===this.landSize?(this.exit.x=this.exit.width,this.exit.y=s/2/t):(this.exit.x=this.exit.width,this.exit.y=s/t-this.exit.height)},AdGroup.prototype.enable=function(t){this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0},BgGroup=function(t){Phaser.Group.call(this,t),this.textGroup=this.game.add.group(),this.spriteAtlas="atlas",this.size={width:t.width,height:t.height}},BgGroup.prototype=Object.create(Phaser.Group.prototype),BgGroup.prototype.constructor=BgGroup,BgGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},BgGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},BgGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,this.spriteAtlas)},BgGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},BgGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t),this.size.width=a,this.size.height=s;var o=a,h=s;this.children.forEach(function(e){"cache/atlas/bg-top.png"===e.frameName?(e.x=a/2/t,e.y=e.height/2,e.width=Math.floor(a/t),this.topY=e.height):"cache/atlas/bg-top-below.png"===e.frameName?(e.x=a/2/t,e.y=this.topY+e.height/2):"cache/atlas/bg-grass.png"===e.frameName?(e.x=a/2/t,e.y=h*t-e.height,e.width=Math.floor(a/t),this.bottomY=e.height):"cache/atlas/bg-bottom-above.png"===e.frameName?(e.x=a/2/t,e.y=h/t-this.bottomY-e.height/2):(1===e.dx?e.x=o*e.dx/t-e.width/2:e.x=o/2/t,1!==e.dy?e.y=h*e.dy/t:e.y=h/t-e.height/2)},this)},BoardGroup=function(t,e,i){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},BoardGroup.prototype=Object.create(Phaser.Group.prototype),BoardGroup.prototype.constructor=BoardGroup,BoardGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},BoardGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},BoardGroup.prototype.addSprite=function(t,e,i,a){var s=this;return a&&(s=this.textGroup),addSprite.call(this,t,e,i,this.spriteAtlas,s)},BoardGroup.prototype.addBitmap=function(t,e,i){var a;return a=this.create(0,0,t),void 0===e&&(a.kill(),e=i=0),a.anchor.set(.5),a.dx=.5+e,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a},BoardGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},BoardGroup.prototype.resize=function(t,e,i,a,s){this.scale.set(t);var o=this.size.width,h=this.size.height;this.textGroup.x=this.x=(a-o*t)/2+e,this.textGroup.y=this.y=(s-h*t)/2+i,this.children.forEach(function(t){t.x=t.dx*o,t.y=t.dy*h},this),this.textGroup.forEach(function(e){var i=t;e.x=e.dx*o*i,e.y=e.dy*h*i,e.fontSize=Math.floor(e.size*i)+"px"},this),this.worldX=this.x+this.size.width/2*t,this.worldY=this.y+this.size.height/2*t},BoardGroup.prototype.getCenterX=function(t){return this.x+t.dx*this.size.width*this.scale.x},BoardGroup.prototype.getCenterY=function(t){return this.y+t.dy*this.size.height*this.scale.y},BoardGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},BoardGroup.prototype.moveTo=function(t,e){e||console.log("moveTo",t,e),t.dx=e.dx,t.dy=e.dy,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},BoardGroup.prototype.xy=function(t,e){return{x:t*this.size.width,y:e*this.size.height}},ControlGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.smallScreen=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},ControlGroup.prototype=Object.create(Phaser.Group.prototype),ControlGroup.prototype.constructor=ControlGroup,ControlGroup.prototype.addText=function(t,e,i,a,s,o){return addText.call(this,t,e,i,a,s,o)},ControlGroup.prototype.addSpriteFromFile=function(t,e,i){return addSpriteFromFile.call(this,t,e,i)},ControlGroup.prototype.addSprite=function(t,e,i,a,s){var o=addSprite.call(this,t,e,i,this.spriteAtlas);return o.portx=a,o.porty=s,o},ControlGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},ControlGroup.prototype.resize=function(t,e,i,a,s){if(this.scale.set(t),this.size===this.landSize){this.exit&&this.exit.kill();var o=this.size.width,h=s;this.children.forEach(function(t){t.x=t.dx*o,t.y=t.dy*h},this)}else{this.exit&&this.exit.revive();o=a,h=this.size.height;this.children.forEach(function(t){t.x=t.portx*o,t.y=t.porty*h},this)}this.textGroup.x=this.x=(a-o*t)/2+e,this.textGroup.y=this.y=(s-h*t)/2+i,this.textGroup.forEach(function(e){e.x=e.dx*o*t,e.y=e.dy*h*t,e.fontSize=Math.floor(e.size*t)+"px"},this)},ControlGroup.prototype.move=function(t,e,i){t.dx=.5+e,t.dy=.5+i,t.x=t.dx*this.size.width,t.y=t.dy*this.size.height},ControlGroup.prototype.getCenterX=function(t){return this.x+t.x*this.scale.x},ControlGroup.prototype.getCenterY=function(t){return this.y+t.y*this.scale.y},HeaderGroup=function(t,e,i,a){Phaser.Group.call(this,t),this.landSize=e,this.portSize=i,this.state=a,this.size=t.width>t.height?this.landSize:this.portSize,this.textGroup=this.game.add.group()},HeaderGroup.prototype=Object.create(Phaser.Group.prototype),HeaderGroup.prototype.constructor=HeaderGroup,HeaderGroup.prototype.addText=function(t,e,i,a,s){return addText.call(this,t,e,i,a,s)},HeaderGroup.prototype.addSprite=function(t,e,i){return addSprite.call(this,t,e,i,"atlas")},HeaderGroup.prototype.setTexture=function(t,e){dataStorage.debug?t.loadTexture(e):t.frameName=e},HeaderGroup.prototype.resize=function(t,e,i,a,s){var o,h;t<.5&&(t=.5),this.scale.set(t);var r=10*t;if(this.option&&(o=this.option.width,h=this.option.height,this.size===this.landSize?(this.optionBg.x=this.option.x=o/2+r,this.optionBg.y=this.option.y=s/t-h/2-r,this.optionSound.x=120,this.optionSound.y=-100,this.info&&(this.info.x=50,this.info.y=-150),this.optionReset.x=170,this.optionReset.y=-0,playService.resize(r,r,t),this.info&&(this.optionFullscreen.x=this.option.x,this.optionFullscreen.y=this.option.y-h-2*r)):(this.optionBg.x=this.option.x=a/t-o/2-r,this.optionBg.y=this.option.y=h/2+r,this.optionSound.x=-120,this.optionSound.y=100,this.info.x=-155,this.info.y=25,this.optionReset.x=0,this.optionReset.y=165,playService.resize(r,r,t),this.info&&(this.optionFullscreen.x=this.option.x-o-2*r,this.optionFullscreen.y=this.option.y))),this.exit&&(this.size===this.landSize?(this.exit.revive(),o=this.exit.width,h=this.exit.height,this.exit.x=o/2+r,this.exit.y=h/2+r):(o=this.exit.width,h=this.exit.height,this.exit.x=o/2+r,this.exit.y=h/2+r)),this.score&&(o=190,h=64,this.size===this.landSize?("header-score-land.png"!==this.score.frameName&&this.setTexture(this.score,"header-score-land.png"),"header-time-land.png"!==this.scoreTime.frameName&&this.setTexture(this.scoreTime,"header-time-land.png"),this.score.x=this.score.width/2+r/2,this.score.y=s/2/t-h,this.scoreLabel.x=this.score.x*t,this.scoreLabel.y=(this.score.y+27)*t,this.scoreTime.x=this.scoreTime.width/2+r/2,this.scoreTime.y=s/2/t+h,this.scoreTimeLabel.x=this.scoreTime.x*t,this.scoreTimeLabel.y=(this.scoreTime.y+27)*t):("header-score-port.png"!==this.score.frameName&&this.setTexture(this.score,"header-score-port.png"),"header-time-port.png"!==this.scoreTime.frameName&&this.setTexture(this.scoreTime,"header-time-port.png"),this.score.x=a/2/t-o/2,this.score.y=h/2+r,this.scoreLabel.x=(this.score.x+25)*t,this.scoreLabel.y=(this.score.y+6)*t,this.scoreTime.x=a/2/t+o/2,this.scoreTime.y=h/2+r,this.scoreTimeLabel.x=(this.scoreTime.x+25)*t,this.scoreTimeLabel.y=(this.scoreTime.y+6)*t),this.scoreLabel.fontSize=Math.floor(38*t),this.scoreTimeLabel.fontSize=Math.floor(38*t)),this.health&&this.health.length)if(o=this.health[0].width,h=this.health[0].height,this.size===this.landSize)for(var n=0;n<this.health.length;n++)this.health[n].x=this.size.width/2-o/2,this.health[n].y=s/2/t-h+n*h*5/4;else for(n=0;n<this.health.length;n++)this.health[n].x=a/2/t-o+n*o*5/4,this.health[n].y=this.size.height/2-h/2},HeaderGroup.prototype.enable=function(t){if("header-option.png"===t)this.optionBg=this.addSprite("header-option-bg.png",0,0),this.optionBg.kill(),this.optionSound=this.addSprite("header-option-sound.png",0,0),this.optionSound.inputEnabled=!0,this.optionSound.input.useHandCursor=!0,this.optionBg.addChild(this.optionSound),this.optionFullscreen=this.addSprite("header-option-fullscreen.png",0,0),this.optionFullscreen.inputEnabled=!0,this.optionFullscreen.input.useHandCursor=!0,this.optionFullscreen.events.onInputDown.add(this.onFullscreen,this),this.optionReset=this.addSprite("header-option-reset.png",0,0),this.optionReset.inputEnabled=!0,this.optionReset.input.useHandCursor=!0,this.optionBg.addChild(this.optionReset),this.optionReset.kill(),this.option=this.addSprite(t,0,0),this.option.inputEnabled=!0,this.option.input.useHandCursor=!0;else if("header-health.png"===t){this.health=[];for(var e=0;e<3;e++)this.health[e]=this.addSprite("header-health.png",0,0),this.health[e].inputEnabled=!0,this.health[e].input.useHandCursor=!0}else if("header-score.png"===t||"header-time.png"===t||"header-bug.png"===t){this.scoreTime="header-bug.png"===t?"bug":"header-time.png"===t?"time":"score",this.score=this.addSprite("header-"+this.scoreTime+"-land.png",0,0),this.score.inputEnabled=!0,this.score.input.useHandCursor=!0;var i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5)}else if("header-time-score.png"===t){this.scoreTime="time-score",this.scoreTime=this.addSprite("header-time-land.png",0,0),this.scoreTime.inputEnabled=!0,this.scoreTime.input.useHandCursor=!0;i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreTimeLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5),this.score=this.addSprite("header-score-land.png",0,0),this.score.inputEnabled=!0,this.score.input.useHandCursor=!0;i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5)}else if("header-exit.png"===t)this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-quack.png"===t)this.exit=this.addSprite(t,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-ad.png"===t);else if("header-info.png"===t){var a=this.optionInfo=this.info=this.addSprite("header-info.png",0,0);this.optionBg.addChild(this.info),a.inputEnabled=!0,a.input.useHandCursor=!0}},HeaderGroup.prototype.onFullscreen=function(){if(this.game.scale.compatibility.supportsFullScreen)try{this.game.scale.isFullScreen?(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart,this.game.scale.stopFullScreen()):(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart+1,this.game.scale.startFullScreen(!1)),this.state.popupGroup.dim.kill()}catch(t){console.log(t)}else alert("Fullscreen not supported")},HeaderGroup.prototype.showOption=function(){this.game.world.bringToTop(this),this.scoreLabel&&(this.scoreLabel.bringToTop(),this.scoreTimeLabel.bringToTop()),this.game.scale.isFullScreen?this.setTexture(this.optionFullscreen,"header-option-fullscreen-active.png"):this.setTexture(this.optionFullscreen,"header-option-fullscreen.png"),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"),this.optionBg.scale.set(0),this.optionBg.revive();this.game.add.tween(this.optionBg.scale).to({x:1,y:1},500,Phaser.Easing.Back.InOut,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},HeaderGroup.prototype.hideOption=function(){this.game.add.tween(this.optionBg.scale).to({x:0,y:0},500,Phaser.Easing.Back.InOut,!0).onComplete.addOnce(function(){this.optionBg.kill()},this),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},HeaderGroup.prototype.select=function(t){return t===this.optionSound?(dataStorage.setAudio(!dataStorage.isAudio),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"),!1):t===this.optionInfo||void 0},HeaderGroup.prototype.setScore=function(t){this.scoreLabel.text=t},HeaderGroup.prototype.setTime=function(t){this.scoreTimeLabel.text=t},playLogic={row:3,col:3,init:function(t,e,i){this.grid=t,this.time=e,this.rnd=i,this.winMultipliers||(this.winMultipliers=[[[79,78,77,40,41,42,43,44,30,21,22,23,24],[69,68,67,30,31,32,33,34,20,11,12,13,14]],[[89,88,87,51,52,53,54,65,51,31,32,33,34],[79,78,77,40,41,42,43,44,30,21,22,23,24]]]),this.aiWinCount||(this.aiWinCount=[0,0,0])},start:function(t){this.gameOver=!1,this.rnd.sow([this.time.time]),playState.trainAI&&(this.wins||(this.wins=0));for(var e=0;e<3;e++)for(var i=0;i<3;i++){var a=this.grid.board[e][i];if(a.weights)for(var s=0;s<2;s++)a.weights[s][0]=a.weights[s][1]=0,a.totalWeights[s][0]=a.totalWeights[s][1]=0,a.weight=0;else a.weights=[[0,0],[0,0]],a.totalWeights=[[0,0],[0,0]],a.weight=0}},updateMultipliers:function(t){this.aiWinCount[t-1]++,console.log("Winners "+this.aiWinCount)},turn:function(t){if(!this.gameOver){var e,i;for(i=0;i<3;i++)for(e=0;e<3;e++){var a=this.grid.board[i][e];a.weight=0;for(var s=0;s<2;s++)a.weights[0][s]=a.weights[1][s]=0,a.totalWeights[0][s]=a.totalWeights[1][s]=0}return this.bestMove(t)}console.log("gam")},rand:function(t){for(var e=t.length-1;e>=0;e--){var i=this.rnd.integerInRange(0,e),a=t[e];t[e]=t[i],t[i]=a}return t},calcBoards:function(t,e){this.matchFreeCell(t,e),this.matchRow(t,e),this.match2ToRow(t,e),this.matchFreeRow(t,e)},matchFreeCell:function(t,e){var i,a,s=this.grid.board;for(a=0;a<3;a++)for(i=0;i<3;i++){var o=s[a][i];0===o.val?o.isFree=1:o.isFree=0}},matchRow:function(t,e){var i,a,s,o=this.grid.board;for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatchRow)for(i=0;i<2;i++)h.isMatchRow[i]=0;else h.isMatchRow=[0,0]}for(i=0;i<2;i++){var h,r=i+1;0===(h=(o=this.grid.board)[0][0]).val&&(o[0][1].val===r&&o[0][2].val===r&&h.isMatchRow[i]++,o[1][0].val===r&&o[2][0].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][2].val===r&&h.isMatchRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val===r&&o[0][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][1].val===r&&h.isMatchRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val===r&&o[0][1].val===r&&h.isMatchRow[i]++,o[1][2].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][1]).val&&(o[0][1].val===r&&o[2][1].val===r&&h.isMatchRow[i]++,o[1][0].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[2][0].val===r&&h.isMatchRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val===r&&o[1][1].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[2][2].val===r&&h.isMatchRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val===r&&o[1][0].val===r&&h.isMatchRow[i]++,o[2][1].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[0][2].val===r&&h.isMatchRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val===r&&o[2][2].val===r&&h.isMatchRow[i]++,o[1][1].val===r&&o[0][1].val===r&&h.isMatchRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val===r&&o[2][1].val===r&&h.isMatchRow[i]++,o[0][2].val===r&&o[1][2].val===r&&h.isMatchRow[i]++,o[0][0].val===r&&o[1][1].val===r&&h.isMatchRow[i]++)}},match2ToRow:function(t,e){var i,a,s,o=this.grid.board;for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatch2ToRow)for(i=0;i<2;i++)h.isMatch2ToRow[i]=0;else h.isMatch2ToRow=[0,0]}for(i=0;i<2;i++){var h,r=i+1;0===(h=(o=this.grid.board)[0][0]).val&&(o[0][1].val!==r&&o[0][2].val!==r||0!==o[0][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][0].val!==r&&o[2][0].val!==r||0!==o[1][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][2].val!==r||0!==o[1][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val!==r&&o[0][2].val!==r||0!==o[0][0].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][1].val!==r||0!==o[1][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val!==r&&o[0][1].val!==r||0!==o[0][0].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++,o[1][2].val!==r&&o[2][2].val!==r||0!==o[1][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[2][0].val!==r||0!==o[1][1].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val!==r&&o[1][2].val!==r||0!==o[1][1].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[2][0].val!==r||0!==o[0][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][1]).val&&(o[1][0].val!==r&&o[1][2].val!==r||0!==o[1][0].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][1].val!==r&&o[2][1].val!==r||0!==o[0][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[2][2].val!==r||0!==o[0][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[2][0].val!==r||0!==o[0][2].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val!==r&&o[1][1].val!==r||0!==o[1][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[2][2].val!==r||0!==o[0][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val!==r&&o[1][0].val!==r||0!==o[0][0].val&&0!==o[1][0].val||h.isMatch2ToRow[i]++,o[2][1].val!==r&&o[2][2].val!==r||0!==o[2][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[0][2].val!==r||0!==o[1][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val!==r&&o[2][2].val!==r||0!==o[2][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==r&&o[0][1].val!==r||0!==o[1][1].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val!==r&&o[2][1].val!==r||0!==o[2][0].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==r&&o[1][2].val!==r||0!==o[0][2].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==r&&o[1][1].val!==r||0!==o[0][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++)}},matchFreeRow:function(t,e){var i,a,s=this.grid.board;for(a=0;a<3;a++)for(i=0;i<3;i++){s[a][i].isMatchFreeRow=0}for(i=0;i<3;i++)0===s[i][0].val&&0===s[i][1].val&&0===s[i][2].val&&(s[i][0].isMatchFreeRow++,s[i][1].isMatchFreeRow++,s[i][2].isMatchFreeRow++);for(i=0;i<3;i++)0===s[0][i].val&&0===s[1][i].val&&0===s[2][i].val&&(s[0][i].isMatchFreeRow++,s[1][i].isMatchFreeRow++,s[2][i].isMatchFreeRow++);0===s[0][0].val&&0===s[1][1].val&&0===s[2][2].val&&(s[0][0].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][2].isMatchFreeRow++),0===s[0][2].val&&0===s[1][1].val&&0===s[2][0].val&&(s[0][2].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][0].isMatchFreeRow++)},fuzzyBoard:function(t,e){this.calcBoards();for(var i=this.grid.board,a=0;a<2;a++){var s,o,h=this.winMultipliers[a][e];for(o=0;o<3;o++)for(s=0;s<3;s++){var r=i[o][s];if(0===r.val){var n=0,d=0;1===r.isMatchRow[a]?(n=Math.max(h[0],n),d+=h[0]):2===r.isMatchRow[a]?(n=Math.max(h[1],n),d+=h[1]):3===r.isMatchRow[a]&&(n=Math.max(h[2],n),d+=h[2]),1===r.isMatch2ToRow[a]?(n=Math.max(h[3],n),d+=h[3]):2===r.isMatch2ToRow[a]?(n=Math.max(h[4],n),d+=h[4]):3===r.isMatch2ToRow[a]?(n=Math.max(h[5],n),d+=h[5]):4===r.isMatch2ToRow[a]?(n=Math.max(h[6],n),d+=h[6]):5===r.isMatch2ToRow[a]&&(n=Math.max(h[7],n),d+=h[7]),r.isCellToBoard&&(n=Math.max(h[8],n),d+=h[8]),1===r.isMatchFreeRow?(n=Math.max(h[9],n),d+=h[9]):2===r.isMatchFreeRow?(n=Math.max(h[10],n),d+=h[10]):3===r.isMatchFreeRow?(n=Math.max(h[11],n),d+=h[11]):4===r.isMatchFreeRow&&(n=Math.max(h[12],n),d+=h[12]),n=Math.max(1,n),r.weights[e][a]=n,r.totalWeights[e][a]=d}}}return i},boardWeight:function(t,e,i,a,s){var o,h,r=0,n=this.grid.board;if(this.grid.solvedBoards[e][t]>=1&&this.grid.solvedBoards[e][t]<=3)return n[0][0].weight;for(h=0;h<3;h++)for(o=0;o<3;o++)n[h][o].weights[s][i-1]>r&&(r=n[h][o].weights[s][i-1]),n[h][o].weights[s][a-1]>r&&(r=n[h][o].weights[s][a-1]);return r},winBoard:function(t,e,i){var a,s;for(s=0;s<3;s++)for(a=0;a<3;a++){var o=e[s][a];if(0===o.val&&o.isMatchRow[t-1]>0)return o}return null},easyMove:function(t,e){var i,a,s=this.fuzzyBoard(t,0);for(a=0;a<3;a++)for(i=0;i<3;i++)s[a][i].weights[0][t-1]>=s[a][i].weights[0][e-1]?(s[a][i].weight=s[a][i].weights[0][t-1],s[a][i].totalWeight=s[a][i].totalWeights[0][t-1]):s[a][i].weights[0][e-1]>0&&(s[a][i].weight=s[a][i].weights[0][e-1],s[a][i].totalWeight=s[a][i].totalWeights[0][e-1]);return this.randBestWeight(t,e,s)},randBestWeight:function(t,e,i){var a,s,o=0;for(s=0;s<3;s++)for(a=0;a<3;a++)0===i[s][a].val&&i[s][a].weight>o&&(o=i[s][a].weight,a,s);var h=0;if(2===t){var r=Math.floor((this.time.time-playState.startTime)/1e3);o-=this.rnd.integerInRange(0,r/2+5)}for(s=0;s<3;s++)for(a=0;a<3;a++){var n=i[s][a];0===i[s][a].val&&n.weight>=o&&h++}var d,l=this.rnd.integerInRange(0,h-1);for(s=0;s<3&&l>=0;s++)for(a=0;a<3&&l>=0;a++){n=i[s][a];0===i[s][a].val&&n.weight>=o&&(l--,a,s,d=i[s][a])}return d},bestMove:function(t){var e=t,i=1===e?2:1,a=mainState.level;return playState.trainAI&&(a=1===t?playState.trainAIPlayerSkill:playState.trainAICPUSkill),"EASY"===a?this.easyMove(e,i):"FAIR"===a?this.easyMove(e,i):"HARD"===a?this.easyMove(e,i):void alert("Level is too high for me!")}},playGrid={board:null,init:function(t){this.rnd=t,this.width=this.height=3},start:function(t){this.rnd.sow([t])},winBoard:function(t,e){var i,a,s=this.board;for(a=0;a<3;a++)if(s[a][0].val===e&&s[a][1].val===e&&s[a][2].val===e)return!0;for(i=0;i<3;i++)if(s[0][i].val===e&&s[1][i].val===e&&s[2][i].val===e)return!0;return s[0][0].val===e&&s[1][1].val===e&&s[2][2].val===e||(s[0][2].val===e&&s[1][1].val===e&&s[2][0].val===e||void 0)},possibleMoves:function(){for(var t=0,e=0;e<3;e++)for(var i=0;i<3;i++)0===this.board[e][i].val&&t++;return t}};var playState={spriteAtlas:"atlas",winsInRowTime1:0,winsInRowTime2:0,winsInRowTime3:0,winsInRowTime:0,winsInRow:0,score:0,wins:0,loses:0,ties:0,playerID:1,playerCPU:2,trainAI:!1,trainAIPlayerSkill:Text.easy,trainAICPUSkill:Text.hard,resize:function(){this.controlGroup&&(this.controlGroup.landSize.width=width,this.controlGroup.portSize.height=height);var t=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});this.helpText.fontSize=48*t,this.renderBoard(t),renderBg.call(this,t)},init:function(){this.grid=playGrid,this.grid.init(this.rnd),this.logic=playLogic,this.logic.init(this.grid,this.time,this.rnd)},preload:function(){if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){this.playerInputEnabled=!1,this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(t,e){this.soundEffects.sounds[t].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.createHeader(),this.createBoard(),this.createTutorial(),this.helpText=this.boardGroup.addText("",0,0,"333333",48),this.helpText.kill(),this.createPopup(),this.world.mask&&this.world.mask.destroy(),this.world.mask=null,this.grid.start(0),this.logic.start(0),this.start();for(var t,e,i=this.grid.board,a=0;a<3;a++)for(var s=0;s<3;s++){var o=i[a][s];o.inputEnabled=!0,o.input.useHandCursor=!0}switch(this.effectGroup=new EffectGroup(this.game,{width:720,height:720},{width:720,height:720}),this.effectGroup.enable("sparkle"),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.startTime=this.time.time,this.rnd.integerInRange(0,2)){case 0:"EASY";break;case 1:"FAIR";break;case 2:"HARD"}0===this.rnd.integerInRange(0,1)?(e=Text.wait,t=this.playerCPU):(e=Text.begin,t=this.playerID),this.player=t,this.beginner=t,this.popupGroup.showBanner(e,2500,this),this.keypadDown=!1,this.game.input.gamepad.start(),this.pad=game.input.gamepad.pad1,this.pad.addCallbacks(this,{onConnect:this.addButtons});var h=this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);h.onDown.add(this.onLeft,this),(h=this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT)).onDown.add(this.onRight,this),(h=this.game.input.keyboard.addKey(Phaser.Keyboard.DOWN)).onDown.add(this.onDown,this),(h=this.game.input.keyboard.addKey(Phaser.Keyboard.UP)).onDown.add(this.onUp,this),(h=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)).onDown.add(this.onSelect,this),(h=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER)).onDown.add(this.onSelect,this)},onUp:function(){this.keypadDown=Phaser.Keyboard.UP},onDown:function(){this.keypadDown=Phaser.Keyboard.DOWN},onLeft:function(){this.keypadDown=Phaser.Keyboard.LEFT},onRight:function(){this.keypadDown=Phaser.Keyboard.RIGHT},onSelect:function(){this.keypadDown=Phaser.Keyboard.ENTER},addButtons:function(){var t=this.pad;t.getButton(Phaser.Gamepad.XBOX360_B).onDown.add(this.onSelect,this);var e=t.getButton(Phaser.Gamepad.XBOX360_DPAD_LEFT),i=t.getButton(Phaser.Gamepad.XBOX360_DPAD_RIGHT),a=t.getButton(Phaser.Gamepad.XBOX360_DPAD_UP),s=t.getButton(Phaser.Gamepad.XBOX360_DPAD_DOWN);e.onDown.add(this.onLeft,this),i.onDown.add(this.onRight,this),a.onDown.add(this.onUp,this),s.onDown.add(this.onDown,this)},start:function(){this.score=0,this.headerGroup.setScore(this.score),this.wins=0,this.ties=0,this.loses=0,this.isGameOver=!1,this.isGameRestart=!1,this.quitGame=!1},createHeader:function(){this.headerGroup=new HeaderGroup(this.game,{width:180,height:0},{width:0,height:120},this),this.headerGroup.enable("header-option.png"),this.headerGroup.enable("header-time-score.png"),this.headerGroup.enable("header-exit.png"),this.headerGroup.enable("header-info.png")},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog-quit.png")},createTutorial:function(){this.tutorialGroup=new TutorialGroup(this.game,{width:this.game.width,height:this.game.height}),this.tutorialGroup.enable("popup-hand.png")},update:function(){if(this.playerInputEnabled)if(this.playerTurn||(this.keypadDown=!1),this.inputLockTime>=this.time.now||this.world.mask)this.keypadDown=!1;else{var t=Math.floor((this.time.time-this.startTime)/1e3);if(t>60&&(t=60),t>=60)return this.headerGroup.setTime(formatTime(0)),this.inputLockTime=this.time.now+1e4,this.isGameRestart=!1,this.isGameOver=!0,void this.time.events.add(.75*Phaser.Timer.SECOND,function(){this.popupGroup.hide(),this.time.events.add(.8*Phaser.Timer.SECOND,function(){this.quitGame=!0,this.popupGroup.showBanner(Text.timeup,2e3,this)},this)},this);if(this.headerGroup.setTime(formatTime(60-t)),!this.isGameRestart&&!this.isGameOver&&(this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame||this.keypadDown)){var e,i=this.game.input.activePointer;if(this.game.input.activePointer.isDown&&i.targetObject||this.keypadDown)if(e=this.keypadDown?null:i.targetObject.sprite,this.tutorialGroup.visible)1===this.tutorialGroup.step?(this.inputLockTime=this.time.now+750,e===this.tutorialGroup.handTarget()&&this.tutorialGroup.nextStep("HOW TO PLAY\n2 / 2\nSelect missing number.",this.controls[0],this.controlGroup)):e===this.tutorialGroup.handTarget()&&(this.tutorialGroup.nextStep("That was tutorial.\n\nNow fill the rest."),this.tutorialGroup.hand.kill(),this.time.events.add(4*Phaser.Timer.SECOND,function(){this.tutorialGroup.hide(),this.inputLockTime=this.time.now+500},this));else if(this.popupGroup.visible)e===this.popupGroup.quit?(this.inputLockTime=this.time.now+1e3,this.backToMenu(),this.updatePlayerData(-1)):e!==this.popupGroup.dialogBg&&this.popupGroup.hide();else if(this.headerGroup.optionBg.visible)this.inputLockTime=this.time.now+250,e===this.headerGroup.optionSound?(this.headerGroup.select(this.headerGroup.optionSound),dataStorage.isAudio&&this.soundEffects.play("tic")):(this.headerGroup.hideOption(),this.popupGroup.dim.kill());else if(e===this.headerGroup.option)this.inputLockTime=this.time.now+500,this.headerGroup.showOption(this),this.popupGroup.dim.revive();else if(e===this.headerGroup.score)this.inputLockTime=this.time.now+500,this.popupGroup.showBanner(Text.level+" "+mainState.level+"\n"+Text.time+" "+this.headerGroup.scoreLabel.text,2e3,this);else if(e===this.headerGroup.exit)this.inputLockTime=this.time.now+750,this.popupGroup.showDialog(Text.quit,null,this,!0,!0);else if(this.keypadDown){var a;if(this.inputLockTime=this.time.now+100,this.keypadDown===Phaser.Keyboard.LEFT)(a=this.selectPointer.target).i>0&&(this.selectPointer.target=this.grid.board[a.j][a.i-1],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target));if(this.keypadDown===Phaser.Keyboard.RIGHT)(a=this.selectPointer.target).i<2&&(this.selectPointer.target=this.grid.board[a.j][a.i+1],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target));if(this.keypadDown===Phaser.Keyboard.UP)(a=this.selectPointer.target).j>0&&(this.selectPointer.target=this.grid.board[a.j-1][a.i],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target));if(this.keypadDown===Phaser.Keyboard.DOWN)(a=this.selectPointer.target).j<2&&(this.selectPointer.target=this.grid.board[a.j+1][a.i],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target));if(this.keypadDown===Phaser.Keyboard.ENTER||this.keypadDown===Phaser.Keyboard.SPACEBAR){if(!this.selectPointer.target.inputEnabled)return;e=this.selectPointer.target;for(var s=0;s<this.grid.height;s++)for(var o=0;o<this.grid.width;o++){if(e===(h=this.grid.board[s][o]))return this.inputLockTime=this.time.now+500,this.time.events.add(.25*Phaser.Timer.SECOND,function(){this.selectCell(this.playerID,h),this.turn(2)},this),void(this.keypadDown=!1)}}this.keypadDown=!1}else for(s=0;s<this.grid.height;s++)for(o=0;o<this.grid.width;o++){var h;if(e===(h=this.grid.board[s][o]))return this.inputLockTime=this.time.now+500,this.boardGroup.moveTo(this.selectPointer,h),this.selectPointer.target=h,void this.time.events.add(.25*Phaser.Timer.SECOND,function(){this.selectCell(this.playerID,h),this.turn(2)},this)}else this.headerGroup.optionBg.visible?(this.headerGroup.hideOption(),this.popupGroup.dim.kill()):this.popupGroup.visible&&this.popupGroup.hide()}}},selectCell:function(t,e){this.playerTurn=!1;var i=e;if(i.alpha=1,0===i.val){if(i.val=t,i.tint=16777215,this.boardGroup.setTexture(i,"play-token-"+i.val+"-big.png"),i.input&&(i.inputEnabled=!1),i.scale.set(0),this.add.tween(i.scale).to({x:1,y:1},500,Phaser.Easing.Back.InOut,!0),this.selectPointer.alpha=.33,this.grid.winBoard(i,t)){var a,s=i,o=this.grid.board[s.h][s.w],h=this.boardGroup.getCenterX(o),r=this.boardGroup.getCenterY(o);240,240,this.effectGroup.start(h,r,240,240),this.time.events.add(.5*Phaser.Timer.SECOND,function(){var e;if(t===this.playerID){this.winsInRow;this.updatePlayerData(t),e=Text.win+"\n"+Text.time+" +30 sec.",this.startTime+=3e4}else t===this.playerCPU&&(this.updatePlayerData(t),e=Text.lose,a="quack-sad.png");this.popupGroup.showBanner(e,1500,this,a)},this),this.isGameRestart=!0,dataStorage.isAudio&&(t===this.playerID?this.soundEffects.play("boardWin"):this.soundEffects.play("boardLose"))}else if(dataStorage.isAudio&&this.soundEffects.play(t===this.playerID?"tic":"toc"),0===this.grid.possibleMoves()){var n=this.time.time-this.startTime;this.winsInRowTime1+=n,this.updatePlayerData(3),this.popupGroup.showBanner(Text.tie+".\n"+Text.time+" +10 sec.",1500,this),this.startTime+=1e4,this.isGameRestart=!0}this.isGameRestart||(this.selectBoard(t===this.playerID?this.playerCPU:this.playerID),this.playerID),this.trainAI&&this.time.events.add(0*Phaser.Timer.SECOND,function(){this.turn(t===this.playerID?this.playerCPU:this.playerID)},this)}else this.backToMenu()},updatePlayerData:function(t){if(1===t){this.winsInRowTime3=this.winsInRowTime2,this.winsInRowTime2=this.winsInRowTime1;var e=this.time.time-this.startTime;this.winsInRowTime1=e,this.winsInRow++,this.score+=3,this.wins++,this.winsInRowTime=this.winsInRowTime1+this.winsInRowTime2+this.winsInRowTime3}else 2===t&&this.loses++,3===t&&(this.score++,this.ties++),this.winsInRow=0,this.winsInRowTime=this.winsInRowTime3=this.winsInRowTime2=this.winsInRowTime1=0;return-1===t&&(this.score=0),this.headerGroup.setScore(this.score),!1},turn:function(t){if(!this.isGameRestart&&!this.isGameOver){var e=.5;this.trainAI&&(e=.5),this.time.events.add(Phaser.Timer.SECOND*e,function(){var e=this.logic.turn(t);if(!e)for(var i=this.grid.board,a=0;a<3;a++){for(var s=0;s<3;s++)if(0===i[a][s].val){e=i[a][s];break}if(e)break}this.boardGroup.moveTo(this.selectPointer,e),this.selectPointer.target=e,this.selectPointer.revive(),this.time.events.add(.25*Phaser.Timer.SECOND,function(){this.selectCell(t,e)},this)},this)}},showText:function(t,e,i){this.helpText.text=t,this.helpText.x=e,this.helpText.y=i,this.helpText.alpha=1,this.helpText.revive(),this.add.tween(this.helpText).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.helpText.kill()},this)},backToMenu:function(){for(var t in this.texture=this.textureSprite=this.textureBg=this.textureBgSprite=null,this.boardTexture=null,PIXI.BaseTextureCache)delete PIXI.BaseTextureCache[t];for(var t in PIXI.TextureCache)delete PIXI.TextureCache[t];this.time.events.add(.1*Phaser.Timer.SECOND,function(){fadeOutEffect(this).onComplete.addOnce(function(){this.state.start("mainState")},this)},this)},popupHidden:function(t){t!==Text.begin&&t!==Text.wait||(this.selectBoard(this.player),t===Text.begin?this.playerTurn=!0:(this.playerTurn=!1,this.turn(this.playerCPU))),this.quitGame?this.backToMenu():this.isGameRestart&&this.restartGame()},restartGame:function(){this.time.events.add(250,function(){for(var t=0;t<3;t++)for(var e=0;e<3;e++){(o=this.grid.board[t][e]).val=0,this.boardGroup.setTexture(o,"play-token-"+o.val+"-big.png")}for(var i=this.grid.board,a=0;a<3;a++)for(var s=0;s<3;s++){var o;(o=i[a][s]).inputEnabled=!0,o.input.useHandCursor=!0}this.selectPointer.target=this.grid.board[1][1],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target),this.beginner=this.beginner===this.playerID?this.playerCPU:this.playerID,this.isGameRestart=this.isGameOver=!1,this.selectBoard(this.beginner),this.beginner===this.playerCPU?(this.playerTurn=!1,this.turn(this.playerCPU)):(this.playerTurn=!0,this.trainAI&&this.turn(this.playerID))},this)},renderBoard:function(t){var e=Math.floor(this.boardGroup.size.width*t),i=Math.floor(this.boardGroup.size.height*t),a=e/3,s=this.boardGroup.x+this.boardGroup.size.width/2*t,o=this.boardGroup.y+this.boardGroup.size.height/2*t,h=40*t;this.cache.checkBitmapDataKey("bmd-board-bg")||(r=this.make.bitmapData(e+2*h,i+2*h),this.cache.addBitmapData("bmd-board-bg",r));var r=this.cache.getBitmapData("bmd-board-bg");r.width===e&&r.height===i||r.resize(e+3+2*h,i+3+2*h),r.clear();var n=makeSprite(this.game,"play-bg.png",0,0);n.scale.set(t),r.draw(n,0,0),n.destroy();var d=s,l=o,p=r.ctx;p.lineWidth=1,p.strokeStyle="#83472e";var c=Math.floor(3*a),u=h;p.beginPath();for(s=1;s<3;s++)p.moveTo(u,u+s*a),p.lineTo(u+1*c,u+s*a),p.moveTo(u+s*a,u),p.lineTo(u+s*a,u+1*c);p.stroke(),this.boardBg?(this.boardBg.x=d,this.boardBg.y=l):(this.boardBg=this.game.add.image(d,l,r),this.boardBg.anchor.set(.5),this.boardBg.sendToBack())},createBoard:function(){this.boardGroup=new BoardGroup(this.game,{width:720,height:720},{width:720,height:720}),this.grid.board=[];for(var t=0;t<this.grid.height;t++){this.grid.board[t]=[];for(var e=0;e<this.grid.width;e++){var i=this.boardGroup.addSprite("play-token-0-big.png",(e-1)/3,(t-1)/3);this.grid.board[t][e]=i,i.val=0,i.alpha=0,i.h=t,i.w=e}}this.selectPointer=this.boardGroup.addSprite("play-selected.png"),this.selectPointer.anchor.set(.5),this.selectPointer.alpha=.33,this.selectPointer.target=this.grid.board[1][1],this.boardGroup.moveTo(this.selectPointer,this.selectPointer.target),this.selectPointer.revive();for(var a=0;a<3;a++)for(var s=0;s<3;s++)this.grid.board[a][s].j=a,this.grid.board[a][s].i=s},shutdown:function(){this.bg=this.boardBg=null},selectBoard:function(t){this.playerInputEnabled=1===t;for(var e=this.grid.board,i=0;i<3;i++)for(var a=0;a<3;a++){var s=e[i][a];0===s.val&&(s.alpha=1,s.tint=2===t?16751001:11184895)}this.playerTurn=1===t}},mainState={name:"mainState",spriteAtlas:"atlas",goal:Text.goal,resize:function(){var t=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});renderBg.call(this,t)},init:function(){Phaser.Canvas.setTouchAction(game.canvas,"auto"),this.game.input.touch.preventDefault=!1,this.level="EASY",this.dataLoaded||(this.dataLoaded=!0,dataStorage.init())},preload:function(){if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(t,e){this.soundEffects.sounds[t].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.controlGroup=new ControlGroup(this.game,{width:260,height:0},{width:0,height:280}),this.boardGroup=new BoardGroup(this.game,{width:720,height:720},{width:720,height:720});var t=this.boardGroup.addSprite("main-board-bg.png",0,.05);t=this.controlGroup.addSprite("main-play-cloud.png",-.15,0,.7,.5);this.playBg=makeSprite(this.game,"main-play-bg.png",74,0),this.playBg.anchor.set(.5),t.addChild(this.playBg),this.add.tween(this.playBg.scale).to({x:.95,y:.9},500,Phaser.Easing.Sinusoidal.In,!0).repeat(Number.MAX_VALUE).yoyo(!0),this.add.tween(this.playBg).to({angle:360},1e4,Phaser.Easing.Linear.None,!0).repeat(Number.MAX_VALUE),this.play=makeSprite(this.game,"main-play.png",74,0),this.play.anchor.set(.5),t.addChild(this.play),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0,this.leadAvatar=[],this.leadName=[],this.leadScore=[];this.leadTitle=this.boardGroup.addText("",0,.03-.35,"000000",42);this.rankIcons=[];for(var e=0;e<5&&e<playService.leadScores.length;e++)this.addLeaderScore(e);this.selectButton(null),this.createHeader(),this.createPopup(),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.keypadDown=!1,this.game.input.gamepad.start(),this.pad=game.input.gamepad.pad1,this.pad.addCallbacks(this,{onConnect:this.addButtons});var i=this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);i.onDown.add(this.onLeft,this),(i=this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT)).onDown.add(this.onRight,this),(i=this.game.input.keyboard.addKey(Phaser.Keyboard.DOWN)).onDown.add(this.onDown,this),(i=this.game.input.keyboard.addKey(Phaser.Keyboard.UP)).onDown.add(this.onUp,this),(i=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)).onDown.add(this.onSelect,this),(i=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER)).onDown.add(this.onSelect,this),this.start()},onUp:function(){this.keypadDown=Phaser.Keyboard.UP},onDown:function(){this.keypadDown=Phaser.Keyboard.DOWN},onLeft:function(){this.keypadDown=Phaser.Keyboard.LEFT},onRight:function(){this.keypadDown=Phaser.Keyboard.RIGHT},onSelect:function(){this.keypadDown=Phaser.Keyboard.ENTER},addButtons:function(){var t=this.pad;t.getButton(Phaser.Gamepad.XBOX360_B).onDown.add(this.onSelect,this);var e=t.getButton(Phaser.Gamepad.XBOX360_DPAD_LEFT),i=t.getButton(Phaser.Gamepad.XBOX360_DPAD_RIGHT),a=t.getButton(Phaser.Gamepad.XBOX360_DPAD_UP),s=t.getButton(Phaser.Gamepad.XBOX360_DPAD_DOWN);e.onDown.add(this.onLeft,this),i.onDown.add(this.onRight,this),a.onDown.add(this.onUp,this),s.onDown.add(this.onDown,this)},addLeaderScore:function(t){var e=playService.leadScores[t].rank,i=playService.leadScores[t].name,a=playService.leadScores[t].wins,s=-.175,o=2.5*.165+-.15*(4-t),h=this.boardGroup.addSprite("medal.png",s-.05,o);switch(e){case 0:h.tint=16711935;break;case 1:h.tint=16738047;break;case 2:h.tint=16755455;break;case 3:h.tint=16777062;break;case 4:h.tint=16777215}this.rankIcons[t]=h,(h=this.leadAvatar[t]=this.boardGroup.addSprite("avatar-"+t+".png",-.155,o)).anchor.x=0;var r=this.leadName[t]=this.boardGroup.addText(i,s+.2,o-.03,"000000",28);r.anchor.x=0,(h=this.boardGroup.addSprite("main-board-score-bg.png",s+.2,o+.02)).anchor.x=0,r=this.leadScore[t]=this.boardGroup.addText(a,s+.33,o+.025,"ffffff",28)},updateLeaderScore:function(t){if(this.currentButton=t,this.leadAvatar)if(t===this.achievement){for(var e=playService.getAchievements("REVEALED",5,!0),i=0;i<5;i++)this.leadAvatar[i].kill(),this.leadName[i].text="",this.leadScore[i].text="";for(i=0;i<e.length;i++)this.leadAvatar[i].revive(),e[i].icon?setTexture(this.leadAvatar[i],e[i].icon):setTexture(this.leadAvatar[i],"achievement.png"),this.leadName[i].text=e[i].name,"UNLOCKED"===e[i].state?this.leadScore[i].text="ACHIEVED":this.leadScore[i].text="OPEN"}else{for(i=0;i<5;i++)this.leadAvatar[i].kill(),this.leadName[i].text="",this.leadScore[i].text="";var a=0;for(i=0;a<5&&i<playService.leadScores.length;i++){var s;playService.leadScores.sort(function(t,e){return t.wins>e.wins?-1:t.wins<e.wins?1:0}),s=playService.leadScores[i].wins,this.leadAvatar[a].revive(),playService.leadScores[i].avatar?setTexture(this.leadAvatar[a],playService.leadScores[i].avatar):setTexture(this.leadAvatar[a],"avatar-"+i+".png"),this.leadName[a].text=playService.leadScores[i].name,this.leadScore[a].text=s,a++}}},createHeader:function(){this.headerGroup=new HeaderGroup(this.game,{width:260,height:0,maxHeight:1200},{width:0,height:90,maxWidth:1200},this),this.headerGroup.enable("header-option.png"),this.headerGroup.enable("header-ad.png"),this.headerGroup.enable("header-info.png")},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog.png")},updateProgress:function(){},selectButton:function(t){this.updateLeaderScore(t),this.leadTitle.text=Text.topScore},update:function(){if(!(this.inputLockTime>=this.time.now||this.world.mask)){if(this.keypadDown)return this.inputLockTime=this.time.now+1e3,this.keypadDown=!1,void fadeOutEffect(this).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this);if(this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame){var t=this.game.input.activePointer;if(t.targetObject){var e=t.targetObject.sprite;if(this.popupGroup.visible)e===this.popupGroup.close||e===this.popupGroup.claim?(this.inputLockTime=this.time.now+1e3,this.popupGroup.hide()):e===this.popupGroup.play&&(this.inputLockTime=this.time.now+1e3,this.popupHidden(),fadeOutEffect(this).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this));else if(this.headerGroup.optionBg.visible)if(this.inputLockTime=this.time.now+250,e===this.headerGroup.optionSound)this.headerGroup.select(this.headerGroup.optionSound),dataStorage.isAudio&&this.soundEffects.play("tic");else{if(e===this.headerGroup.optionInfo)return this.inputLockTime=this.time.now+500,void this.popupGroup.showDialog(this.goal,null,this,!0);e===this.headerGroup.optionReset?(dataStorage.reset(),this.headerGroup.hideOption(),this.popupGroup.dim.kill()):(this.headerGroup.hideOption(),this.popupGroup.dim.kill())}else{if(e===this.headerGroup.option)return this.inputLockTime=this.time.now+500,this.headerGroup.showOption(this),void this.popupGroup.dim.revive();if(e===this.headerGroup.info)return this.inputLockTime=this.time.now+500,void this.popupGroup.showDialog(this.goal,null,this,!0);e===this.play&&fadeOutEffect(this).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this)}}else this.headerGroup.optionBg.visible?(this.headerGroup.hideOption(),this.popupGroup.dim.kill()):this.popupGroup.visible&&(this.inputLockTime=this.time.now+1e3,this.popupGroup.hide())}}},showAchievement:function(t){var e;if(t){if((e=playService.showAchievements(5)).length<=0)return}else(e=playService.getAchievements("REVEALED",3)).length<=0&&e.push({title:Text.congraz,text:Text.alldone});var i="";e.forEach(function(t){i+=t.name+": "+t.desc+"\n"}),this.selectButton(this.achievement),this.popupGroup.showDialog(i,null,this,!0,!1,"Achievements",t)},start:function(){this.world.mask&&this.world.mask.destroy(),this.world.mask=null,playService.mainStarted=!0,playService.showLogin(),this.updateProgress(),this.started=!0,this.time.events.add(100,function(){if(playState.score>0){var t,e=[Text.fb1,Text.fb2,Text.fb3,Text.fb4,Text.fb5,Text.fb6],i=Math.floor(playState.score/5);i>=e.length&&(i=e.length-1);var a=playService.getPlayer("me");playState.score>a.wins?(t=Text.newRecord,playService.setScore(playState.score)):t=playState.score===a.wins?Text.newRecord:Text.yours+a.wins+".",this.popupGroup.showDialog(Text.score+playState.score+".\n    Win "+playState.wins+"\n    Lose "+playState.loses+"\n    Tie "+playState.ties+"\n"+t,null,this,!0,!1,e[i],!1)}else this.popupGroup.showDialog(this.goal,null,this,!0)},this)},popupHidden:function(){},shutdown:function(){this.bg=null},updatePlayerIcon:function(t){t&&t.icon&&(this.load.crossOrigin="Anonymous",this.load.image(t.icon),this.load.onFileComplete.add(this.iconComplete,this),console.log("updatePlayerIcon: "+t.icon),this.load.start())},updateScores:function(){this.updateLeaderScore(this.currentButton)},updateAchievements:function(){this.currentButton&&this.updateLeaderScore(this.currentButton)},loadComplete:function(){console.log("loadComplete")},iconComplete:function(t,e,i,a,s){console.log("Loading "+t+" %"),console.log(i+" "+e),i&&e&&this.boardGroup.addSpriteFromFile(e,.1,.1)},printCache:function(t){var e=this.cache.getKeys(t),i="";for(var a in e)i+=a+" ";e.length>0&&console.log(t+":"+i),this.cacheItems+=e.length},showPhaserCache:function(){this.printCache(Phaser.Cache.CANVAS),this.printCache(Phaser.Cache.IMAGE),this.printCache(Phaser.Cache.TEXTURE),this.printCache(Phaser.Cache.SOUND),this.printCache(Phaser.Cache.TEXT),this.printCache(Phaser.Cache.PHYSICS),this.printCache(Phaser.Cache.TILEMAP),this.printCache(Phaser.Cache.BINARY),this.printCache(Phaser.Cache.BITMAPDATA),this.printCache(Phaser.Cache.BITMAPFONT),this.printCache(Phaser.Cache.JSON),this.printCache(Phaser.Cache.XML)},showPixiCache:function(){var t="";for(var e in PIXI.BaseTextureCache)t+=e+" ",this.cacheItems++;for(var e in PIXI.TextureCache)t+=e+" ",this.cacheItems++;console.log("PIXI Base/TextureCache: "+t)},showCache:function(t){this.cacheItems=0,console.log(t),this.showPhaserCache(),this.showPixiCache(),console.log("world length: "+this.world.children.length),console.log("cache length: "+this.cacheItems)}},bootState={config:{},name:"bootState",spriteAtlas:"atlas",resize:function(){onResize.call(this,this.scale,{width:this.game.width,height:this.game.height})},init:function(){Phaser.Plugin.Debug},preload:function(){this.game.forceSingleUpdate=!0,this.game.renderer.renderSession.roundPixels=!0,this.stage.smoothed=!0,this.game.renderer.clearBeforeRender=!0,this.stage.backgroundColor="#f7fbfd",this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.scale.fullScreenScaleMode=Phaser.ScaleManager.RESIZE,this.scale.setShowAll(),this.scale.refresh()},loadComplete:function(){if(dataStorage.debug&&this.spriteAtlas)for(var t=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),e=0;e<t.length;e++){var i=t[e].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}this.state.add("mainState",mainState,!0)},create:function(){-1===window.location.href.indexOf("localhost:8383")&&(this.load.path="/tictactoe/"),this.input.maxPointers=1,this.boardGroup=new BoardGroup(this.game,{width:640,height:720},{width:640,height:720}),this.boardGroup.addText(dataStorage.title,0,.2,"c98dd0",60),this.boardGroup.addText("logic",0,.3,"98a1c1",48),this.loadText=this.boardGroup.addText(Text.loading+" ...",0,.4,"666666",32),this.load.image("quack.png","cache/quack.png",400,400);this.load.audiosprite("sound-effects",["cache/sound-effects.ogg","cache/sound-effects.mp3"],null,{spritemap:{tic:{start:0,end:.04,loop:!1},boardWin:{start:.05,end:.79,loop:!1},boardLose:{start:.8,end:2.15,loop:!1},toc:{start:2.2,end:2.24,loop:!1}}}),this.time.events.add(10,function(){this.load.atlasXML("atlas","cache/atlas/sprites.png","cache/atlas/sprites.xml"),this.load.onFileComplete.add(this.fileComplete,this),this.load.onLoadComplete.addOnce(this.loadComplete,this),this.load.start()},this),this.game.scale.setResizeCallback(this.onResize,this),this.resize()},fileComplete:function(t,e,i,a,s){this.loadText.setText(Text.loading+" "+t+" %"),i&&"quack.png"===e&&this.boardGroup.addSpriteFromFile(e,0,-.2)},shutdown:function(){}};function createGame(){var t=window;if(!t||t.innerWidth<=0||t.innerHeight<=0)setTimeout(function(){createGame()},100);else{var e={width:t.innerWidth,height:t.innerHeight},i={type:Phaser.AUTO,parent:"canvas",width:e.width,height:e.height,antialias:!bootState.config.cleanBoard};window.game=new Phaser.Game(i),window.game.state.add("bootState",bootState,!0)}}