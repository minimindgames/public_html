/*! Copyright minigame 09-04-2021 */

let UnitActionControl=t=>(class extends t{controlInit(t){this.control=t,this.control.started=!1,this.targetPosition=null,this.targetPositionImage=this.scene.add.image(0,0,"ControlTarget"),this.targetPositionImage.visible=!1,this.control.target={unit:null,focus:null,focusImage:this.scene.add.image(this.x,this.y,UnitBot.name+"Target"),img:this.scene.add.image(this.x,this.y,UnitBot.name+"Target")},this.control.target.img.visible=!1,this.control.target.focusImage.visible=!1,this.control.target.focusImage.tint=10066329,this.control.speed=1,this.body.maxSpeed=Unit.defaultSpeed*this.scene.game.resolution,this.currentAction=null,this.control.action=null,this.body.moves=!0,this.body.immovable=!1}controlDeinit(){const t=this.control;t.started&&this.controlStop(),t.action&&t.action.menuDeinit(),t.target.img.destroy(),t.target.focusImage.destroy(),this.control=null}controlStart(){this.control.started=!0,this.setDrag(1.5*this.body.maxSpeed),this.body.setAllowDrag(!0)}controlStop(){this.control.started=!1}controlDo(t,e,i,s,n){const a=this.control;if(null===a.action){if(t||e||i||s){n&&(a.target.unit=null,a.target.img.visible=!1,a.target.focus=null,a.target.focusImage.visible=!1,this.controlResume(null));let h=this,o=this.x,r=this.y;t?r-=a.speed:e&&(r+=a.speed),i?o-=a.speed:s&&(o+=a.speed);let l=Phaser.Math.Angle.Between(h.x,h.y,o,r);h.rotation=Phaser.Math.Angle.RotateTo(h.rotation,l,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}else if(n)this.controlPause();else if(this.targetPosition){let t=Phaser.Math.Angle.Between(this.x,this.y,this.targetPosition[0],this.targetPosition[1]);this.rotation=Phaser.Math.Angle.RotateTo(this.rotation,t,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}if(null!==this.targetPosition){Phaser.Math.Distance.Squared(this.x,this.y,this.targetPosition[0],this.targetPosition[1])<this.targetPositionProximity&&this.controlPause()}}else n&&(t||e||i||s)&&a.action.actionSelect(t,e,i,s)}controlPause(){this.setFrame(0),this.body.setAcceleration(0),null!==this.targetPosition&&(this.targetPositionImage.visible=!1,this.targetPosition=null)}controlResume(t){if(this.targetPosition=t,this.setFrame(1),t){this.targetPositionImage.setPosition(t[0],t[1]);let e=Phaser.Math.Distance.Squared(this.x,this.y,t[0],t[1]);this.targetPositionProximity=e/5,this.targetPositionProximity>this.width*this.width*2&&(this.targetPositionProximity=this.width*this.width*2)}this.targetPositionImage.visible=null!==t}controlPoint(t){if(null!==this.control.action)return this.controlPause(),!1;if(t){if(this.getBounds().contains(t[0],t[1]))return this.control.pad.select(),!0;this.controlResume(t)}else this.controlPause();return!0}controlAction(t){const e=this.control;return this.currentAction?(this.currentAction.stop.call(this),void(this.currentAction=null)):e.action?(e.action.actionActivate(),void(e.action=null)):(e.target.unit?this.currentAction||(e.action=e.target.unit,e.action.menuStart(this),e.target.unit=null,e.target.img.visible=!1,e.target.focus=null,e.target.focusImage.visible=!1):(e.action=this,this.menuStart(this)),void this.controlPause())}});class Unit extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,n,a,h,o){super(t,e,i,s),h.incubate&&(this.incubate={scale:0,speed:h.incubate},t.addIdle(this)),this.player=a,this.action=null,null!==a&&o===t.mapUnitGroup&&(o=t.teamBuildings[a.team.id]),this.id=h.id||Unit.id++,this.destroyed?this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed):this.on(Phaser.GameObjects.Events.DESTROY,this.deinitUnit),this.unitConfig=h,this.unitConfig.incubate?(this.incubate=0,this.sceneGroup=o,this.scene.idleUnits.add(this,!0),this.body.moves=!1,this.body.immovable=!0):(o.add(this,!0),this.initUnit())}unitInit(t){this.unit=t,this.unit.listeners=[],this.unit.tweens=[],this.unit.time=0,this.unit.tint=0,this.unit.freeze=0,this.unit.level=t.level||1,this.unit.defenceFactor=t.defenceFactor||1,this.body.mass=t.mass||this.width,this.body.allowDrag=!1,this.body.allowGravity=!1,this.unit.sizeSquared=this.width*this.width/2,this.unit.parent&&this.unit.parent.addListener(this),this.unitProcess&&this.scene.addUnitProcess(this)}unitDeinit(){this.unit.parent&&this.unit.parent.removeListener(this),this.live.damageImage&&this.live.damageImage.destroy(),this.live.damageImage2&&this.live.damageImage2.destroy(),this.unitEventNotify("stop"),this.unit.listeners=[],this.scene.clearEvents(this)}unitStart(){}unitStop(){}deinitUnit(){if(this.unitProcess&&this.scene.removeUnitProcess(this),this.menu&&this.menuDeinit(),this.route&&this.routeDeinit(),this.watch&&this.watchDeinit(),this.produce&&this.produceDeinit(),this.move&&this.moveDeinit(),this.live&&this.liveDeinit(),this.follow&&this.followDeinit(),this.unit){for(let t=this.unit.tweens.length-1;t>=0;t--)this.unit.tweens[t].remove();this.unitDeinit()}}unitTween(t){let e=this.scene.tweens.add(t);return this.unit.tweens.push(e),e}addWatch2(t){-1===this.unit.watchListeners.indexOf(t)&&this.unit.watchListeners.push(t)}removeWatch2(t){let e=this.unit.watchListeners.indexOf(t);-1!==e&&this.unit.watchListeners.splice(e,1)}watchNotify2(t){for(let e=this.unit.watchListeners.length-1;e>=0;e--)this.unit.watchListeners[e].watchDo(this,t)}addListener(t){-1===this.unit.listeners.indexOf(t)&&this.unit.listeners.push(t)}removeListener(t){let e=this.unit.listeners.indexOf(t);-1!==e&&this.unit.listeners.splice(e,1)}unitEventNotify(t){for(let e=this.unit.listeners.length-1;e>=0&&!this.unit.listeners[e].unitEvent(this,t);e--);}unitEvent(t,e){this.move&&this.moveEvent(t,e),this.watch&&this.watchEvent(t,e),this.follow&&this.followEvent(t,e)}scaleResolution(t){return this.scene.game.resolution*t}setPlayer(t){0===t.id&&this.sound("claim"),0===this.player.id&&this.sound("lose"),this.unitEventNotify("stop");let e=[this.live.damageImage];this.scene.tweens.add({targets:e,duration:150,scaleX:0,callbackScope:this,rotation:Math.PI,onComplete:function(t){this.scene.tweens.add({targets:e,duration:150,scaleX:1,callbackScope:this,rotation:0,onComplete:function(t){this.live.damageImage.setTint(this.player.color)}},this)}},this),this.player=t,this.unit.level=1,this.updateDamage(),this.live.damageImage2&&(this.live.damageImage2.alpha=.25,this.live.damageImage2.setTint(16777215))}unitDamage(t){this.live.damage;return this.live.damage+=t*this.unit.defenceFactor,this.live.damage>this.live.health?(this.live.damage=this.live.health,!0):(this.updateDamage(),!1)}overlapEnemy(t){let e=t.live.health-t.live.damage;return t.unitDamage(this.live.health-this.live.damage)&&t.destroy(),!!this.unitDamage(e)&&(this.live.damage=this.live.health-(this.live.damage-this.live.health),!0)}overlapFriend(t){if(this.live.damage>0){let e=t.live.health-t.live.damage;this.unit.level>1&&(e/=this.unit.level),e/=2,this.live.damage-=e,this.live.damage<0&&(this.live.damage=0),t.destroy(),this.updateDamage()}}overlap(t){t.unit.activeDelay>0||(this.player.team.id===t.player.team.id?this.overlapFriend(t):this.damageEnemy(t))}explodeEffect(){let t=this.scene.add.particles("Unit-explode");t.createEmitter({frame:[2],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(112.5),end:this.scene.scaleResolution(-112.5)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),t.createEmitter({frame:[0],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(75),end:this.scene.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:750,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),this.scene.time.delayedCall(1e3,function(){t.destroy()},this)}sound(t){this.scene.cardScene.audio.play(t)}toString(){return this.id}static preload(t,e){e.push({name:"Unit-damage-10",size:10});for(let t=40;t<=40;t+=10)e.push({name:"Unit-damage-"+t,size:t})}}Unit.id=1e3,Unit.defaultHealth=64,Unit.defaultMass=100,Unit.defaultSpeed=150;class EventDispatcher extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return null===EventDispatcher.instance&&(EventDispatcher.instance=new EventDispatcher),EventDispatcher.instance}}EventDispatcher.instance=null;class GameScene extends Phaser.Scene{constructor(t){super({key:t}),this.teleports=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]],this.random=Date.now()}init(){this.firstGameToday=!1,parseInt(0|this.game.restore("lastPlayTime"))+43200<(Date.now()/1e3|0)&&(this.firstGameToday=!0)}preload(){this.load.path=this.registry.get("path");this.scene.get("LoaderScene")}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel(),this.level.end||this.startGame()}startGame(){let t=this.registry.get("level");this.level=t,t.players&&this.startUIScene()}startLevel(){let t=this.registry.get("level");this.level=t,t.end}startUIScene(){let t=this.scene.get("UIScene");t=this.scene.add("UIScene",new UIScene("UIScene"));this.scene.run(t,{sceneCreated:this.uiSceneCreated.bind(this),layout:{y:0,x:0,h:this.cameras.main.height-0,w:this.cameras.main.width-0}}),this.uiScene=t}startScene(t,e){let i=this.scene.get(t);i?(this.scene.run(i,e),this.unitScene=i):this.time.delayedCall(100,function(){this.startScene(t,e)},[],this)}getUnitScene(t,e){return new UnitScene(t,this.uiScene)}uiSceneCreated(){this.level.teleport=this.teleport;let t=this.level,e="UnitScene-"+t.id,i=this.scene.get(e);i?(i.scene.wake(),this.uiScene.setUnitSceneLevel(i,this.level),this.uiScene.setPlayer(t.data.players[0]),this.unitScene=i):(i=this.scene.add(e,this.getUnitScene(e,t.name)),t.sceneCreated=this.sceneCreated.bind(this),this.startScene(e,t))}sceneCreated(t){this.level.teleport=this.teleport,this.uiScene.setUnitSceneLevel(t,this.level),this.unitScene.levelFactory||(this.unitScene.levelFactory=new LevelFactory(this.uiScene,this.unitScene,this.level,this.teleports))}gameStatus(t){t.shutdown&&(this.scene.wake(),this.cameras.main.fadeOut(150,255,255,255,function(t,e){1===e&&this.cameras.main.fadeIn(1e3,255,255,255,function(t,e){})},this),this.scene.manager.scenes.forEach(function(t){t instanceof LoaderScene||t instanceof GameScene||t.gameOver()}),this.time.delayedCall(3e3,function(){this.scene.manager.scenes.forEach(function(t){t instanceof LoaderScene||t instanceof GameScene||t.destroyed()}),this.time.delayedCall(100,function(){EventDispatcher.getInstance().emit("GameStatus",{gameover:!0})},[],this)},[],this)),t.start&&this.scene.setVisible(!1),t.teleportComplete&&(this.startLevel(),this.uiSceneCreated(),this.uiScene.player.bot.travelStop()),t.teleport&&(this.teleport=t.from.teleport),t.gameover}handleLoseFocus(){console.log("handleLoseFocus")}}class LevelFactory{constructor(t,e,i,s){this.uiScene=t,this.unitScene=e,this.units=[],this.events=[],i.data={players:[],playerTeams:[]};let n=-1;for(let s=0;s<i.players.length;s++)i.data.players[s]=new Player(s,e),i.data.players[s].id=s,i.players[s].team>=0?n=i.players[s].team:n++,i.data.playerTeams[n]||(i.data.playerTeams[n]=new PlayerTeam(n,t,e)),i.data.playerTeams[n].addPlayer(i.data.players[s]);this.level=i,this.tilesize=64*e.game.resolution;let a=i.data.players[0];i.players[0].bot[0].id=1;let h=UnitBot;"tictactoe"===i.name&&(h=UnitBot);let o=this.createUnits(e,i.players[0].bot,h,a)[0];a.bot=o;if("tictactoe"!==i.name){this.createTeleports(e,i,s,a);for(let t=0;t<i.players.length;t++){let s=i.players[t],n=i.data.players[t];this.createUnits(e,s.guard,UnitGuard,n),this.createUnits(e,s.emitter,UnitEmitter,n),this.createUnits(e,s.teleport,UnitTeleport,n)}}if(i.event)for(let t=0;t<i.event.length;t++){let e=i.event[t],s=this.getUnitById(e.unit);e.disable&&(e.disableUnit=this.getUnitById(e.disable)),this.events.push(new LevelEvent(s,e))}t.setPlayer(a);for(let t=0;t<this.units.length;t++)this.units[t].unit&&this.units[t].unitEventNotify("start")}createUnit(t,e,i,s,n,a){if(a.unit){a.parents=[];for(let t=0;t<a.unit.length;t++)a.parents.push(this.getUnitById(a.unit[t]))}let h=new e(t,i,s,n,a);return a.id&&(h.id=a.id),h}randomXY(){let t=this.level,e=this.tilesize,i=this.position;i||(this.position={},(i=this.position).areas=[1,2,3,4],Phaser.Utils.Array.Shuffle(i.areas));let s=i.areas.splice(0,1),n=t.grid.w/2-1.5,a=t.grid.h/2-1.5;return i.x=Phaser.Math.FloatBetween(1.5,n),i.y=Phaser.Math.FloatBetween(1.5,a),2===s[0]&&(i.x+=t.grid.w/2),3===s[0]&&(i.y+=t.grid.h/2),4===s[0]&&(i.x+=t.grid.w/2,i.y+=t.grid.h/2),i.x*=e,i.y*=e,i}createTeleports(t,e,i,s){let n=[],a=2;for(let h=0;h<i.length;h++){let o=i[h];if(o[0]===e.id||o[1]===e.id){let i=this.randomXY(),h=i.x,r=i.y,l=o[0]===e.id?o[1]:o[0],c={id:a++,from:e.id,to:l},d=new UnitTeleport(t,h,r,s,c);n.push(d),this.units.push(d)}}return n}createEmitters2(t,e,i,s){for(let i=0;i<1;i++){let i=this.randomXY();new UnitEmitter(t,i.x,i.y,s,e)}}createEnergy(t,e,i,s){let n=[];for(let i=0;i<e.grid.w+e.grid.h;i+=10){let i=64*t.game.resolution,a=Phaser.Math.Between(2,e.grid.w-2)*i,h=Phaser.Math.Between(2,e.grid.h-2)*i,o=new UnitEnergy(t,a,h,s,e);n.push(o)}return n}relocateUnit(t,e,i,s,n){let a,h,o=64*t.game.resolution;do{a=i.x;let t=Phaser.Math.Between(s,n)*o;0===Phaser.Math.Between(0,1)&&(t=-t),a+=t}while(a<1*o||a>e.grid.w*o-o);do{h=i.y;let t=Phaser.Math.Between(s,n)*o;0===Phaser.Math.Between(0,1)&&(t=-t),h+=t}while(h<1*o||h>e.grid.h*o-o);return{x:a,y:h}}destroy(){for(let t=0;t<this.events.length;t++)this.events[t].destroy();this.events=null}createUnits(t,e,i,s){let n=[];if(e)for(let a=0;a<e.length;a++){let h=e[a],o=0,r=0;if(h.position<0){let t=this.randomXY();o=t.x,r=t.y}else{h.parents=[];for(let t=0;h.unit&&t<h.unit.length;t++)h.parents.push(this.getUnitById(h.unit[t]));h.x||(h.x=10,h.y=10),this.dx=100,this.dx2=0,this.dy=100,this.dy2=0,o=h.x*this.dx-this.dx2,r=h.y*this.dy-this.dy2,o||(o=0),r||(r=0)}let l=this.createUnit(t,i,o,r,s,h);n.push(l),this.units.push(l)}return n}getUnitById(t){for(let e=0;e<this.units.length;e++)if(this.units[e].id===t)return this.units[e];return null}createRandomUnit(){const t=this.unitScene;let e=this.level.units,i=Phaser.Math.Between(1,100),s=null;for(let t=0;t<e.length;t++){let n=e[t];if((i-=n.freq)<0){s=n;break}}if(s){let e=t.getBounds(),i=1024*t.game.resolutionSquared;for(let n=0;n<10;n++){let n,a=Phaser.Math.Between(e.x,e.w),h=Phaser.Math.Between(e.y,e.h);if(t.isFreeSpace(t.mapUnitGroup,a,h,i)&&(t.isFreeSpace(t.fields,a,h,i)&&t.isFreeSpace(t.idleUnits,a,h,i))){for(n=0;n<t.teamBuildings.length&&t.isFreeSpace(t.teamBuildings[n],a,h,i)&&t.isFreeSpace(t.teamTroops[n],a,h,i)&&t.isFreeSpace(t.teamBullets[n],a,h,i);n++);if(n===t.teamBuildings.length){let e;"Virus"===s.type&&(e=Unit.Type.Virus),"Energy"===s.type&&(e=Unit.Type.Energy),"Guard"===s.type&&(e=Unit.Type.Guard),this.createUnit(t,e,a,h,this.level.data.players[s.player],s);break}}}}let n=t.idleUnits.getChildren();for(let e=n.length-1;e>=0;e--){let i=n[e];i.unitConfig.incubate;i.incubate+=i.unitConfig.incubate,i.incubate<1?i.updateDamage():(i.incubate=null,t.idleUnits.remove(i),i.sceneGroup.add(i),i.initUnit())}let a=t.teamBuildings[0].getChildren().length;a>50&&(a=50);let h=1e3-20*a;t.addEvent(this.createRandomUnit,h,this)}static preload(t,e){}}class LoaderScene extends Phaser.Scene{constructor(t){super({key:"LoaderScene",visible:!1}),this.loadProgress=0,this.levelList=t}init(){}preload(){this.load.path=this.registry.get("path"),this.game.getImage=this.getImage,this.game.config.width>=2560&&this.game.config.height>=1440?(this.res="",this.game.resolution=4):this.game.config.width>=1920&&this.game.config.height>=1080?(this.res="-L",this.game.resolution=3):this.game.config.width>=1280&&this.game.config.height>=720?(this.res="-M",this.game.resolution=2):(this.res="-S",this.game.resolution=1),this.game.resolutionSquared=this.game.resolution*this.game.resolution,this.game.res=this.res,this.levelNo=parseInt(this.game.restore("levelNo")||0);for(let t=0;t<this.levelList.length;t++)if(this.levelList[t]===LEVEL){this.levelNo=t,console.log("Level "+LEVEL);break}this.load.json("json/"+this.levelList[this.levelNo])}gameStatus(t){t.gameover&&this.restartLevel(1e3,!0),t.teleport&&(this.levelNo=t.from.teleport.to,this.restartLevel(t.teleport.time,!1))}checkOriention(t,e){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffff00"}).setOrigin(.5);let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.loading,{font:16*this.game.resolution+"px Arial",fill:"#000000"}).setOrigin(.5);this.load.on("loadProgress",function(e){t.text=Text.loading+" "+parseInt(100*e)+" %"},this),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel()}loadLevel(){this.levelList&&this.levelNo>=this.levelList.length||(this.registry.set("level",null),this.load.json("json/"+this.levelList[this.levelNo]),this.load.start())}restartLevel(t,e){if(e){let t=EventDispatcher.getInstance();t.shutdown(),t.on("GameStatus",this.gameStatus.bind(this))}this.scene.setVisible(!0),this.scene.bringToTop(),this.cameras.main.alpha=1,this.cameras.main.once("camerafadeoutcomplete",()=>{e&&this.scene.manager.scenes.forEach(function(t){t!==this&&this.scene.remove(t)},this),this.time.delayedCall(100,function(){this.startLevel()},[],this)}),this.cameras.main.fadeOut(t,255,255,255)}startLevel(){let t=this.cache.json.get("json/"+this.levelList[this.levelNo]);if(!t)return this.load.once("complete",function(){this.startLevel()},this),this.load.json("json/"+this.levelList[this.levelNo]),void this.load.start();this.registry.set("level",t),this.scene.setVisible(!1),this.scene.get("GameScene")?EventDispatcher.getInstance().emit("GameStatus",{teleportComplete:!0}):this.scene.add("GameScene",new GameScene("GameScene"),!0)}getImage(t,e,i,s){return this.cache.json.get("sprites").frames[s+".png"]?new Phaser.GameObjects.Image(t,e,i,"sprites-doodd",s):new Phaser.GameObjects.Image(t,e,i,s)}loadBitmap2(t,e){this.bitmaps={frames:[]},e.forEach(function(e){t===this||this.sprites.frames[e+".png"]||t.load.bitmapFont(e,"img/"+e+this.res+".png","img/"+e+this.res+".xml")},this)}loadImages(t,e,i="png"){this.sprites={frames:[]},e.forEach(function(e){if(t!==this&&!this.sprites.frames[e+"."+i]){let s="";this.registry.get("debug")&&(s="?t="+Date.now()),t.load.image(e,"img/"+e+this.res+"."+i+s)}},this)}loadSpritesheets(t,e){e.forEach(function(e){let i=e.width?e.width:e.size,s=e.height?e.height:e.size,n="";this.registry.get("debug")&&(n="?t="+Date.now()),t.load.spritesheet(e.name,"img/"+e.name+this.res+".png"+n,{frameWidth:i*this.game.resolution,frameHeight:s*this.game.resolution})},this)}}const TEAM_COLOR=[13421721,9638133,6710886,6684774],TEAM_COLOR_BG=[1907968,51,3342336,1900573],ROUTE_COLOR=[10066227,3355443,16777215,3355443];class Player{constructor(t,e){this.id=t,this.color=TEAM_COLOR[this.id],this.routeColor=ROUTE_COLOR[this.id],this.bgColor=TEAM_COLOR_BG[this.id],this.unitScene=e}addHQ(t){this.HQ=t}setTeam(t){this.team=t,this.unitScene.addTeamGroups(this.team.id)}}class PlayerTeam{constructor(t,e,i){this.id=t,this.cardScene=e,this.unitScene=i,this.players=[]}addPlayer(t){this.players.push(t),t.setTeam(this)}}class PriorityQueue{constructor(){this.collection=[]}enqueue(t){if(this.isEmpty())this.collection.push(t);else{let e=!1;for(let i=1;i<=this.collection.length;i++)if(t[1]<this.collection[i-1][1]){this.collection.splice(i-1,0,t),e=!0;break}e||this.collection.push(t)}}dequeue(){return 0===this.collection.length?null:this.collection.shift()}dequeueExpired(t){return 0===this.collection.length?null:t>=this.collection[0][1]?this.collection.shift():null}isEmpty(){return 0===this.collection.length}clear(t){for(let e=this.collection.length-1;e>=0;e--)t===this.collection[e][2]&&this.collection.splice(e,1)}destroy(){this.collection=[]}}var Text={id:"",gameName:"",loading:"Loading",next:"NEXT",play:"PLAY",quit:"QUIT",pause:"PAUSE",resume:"RESUME",restart:"TRY\nAGAIN",gameOverCongratulations:"All levels passed.\n\nCongratulations!",win:"YOU WIN",wait:"Wait for computer,\nmay take a minute.",setLang(t){"fi"===t&&(this.gameName="NANOBOT LIFE",this.loading="Ladataan",this.next="JATKA",this.play="PELAA",this.quit="POISTU",this.pause="PAUSE",this.resume="RESUME",this.restart="ALOITA\nALUSTA",this.gameOverCongratulations="Kaikki tasot selvitetty.\n\nOnnittelut!",this.draw="TASAN",this.win="VOITIT",this.wait="Odota tietokonetta,\nvoi kestää minuutin.")}};class UIControl{constructor(t){this.scene=t;let e=t.add.image(0,t.cameras.main.height,"ControlPadBg").setOrigin(.5,.5);e.x=.3*e.width,e.y-=.3*e.height,e.tint=8421504,this.padMoveBg=e,e.alpha=.5,this.padMove=t.add.image(e.x,e.y,"ControlPadButton"),this.padMove.tint=10079385,this.padMove.step=this.padMove.width/4;let i=t.add.image(t.cameras.main.width-e.x,e.y,"ControlPadBg").setOrigin(.5,.5);i.tint=8421504,i.alpha=.5,this.padButtonBg=i,this.padButton=t.add.image(i.x,i.y,"ControlPadButton"),this.padButton.tint=16751001,this.reset()}resetMove(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1}resetButton(){this.button=!1}reset(){this.resetMove(),this.resetButton()}setUnit(t){this.unit=t,this.unit.control.pad=this}isPointerOver(t){return this.padMoveBg.getBounds().contains(t.x,t.y)?this.padMoveBg:this.padButtonBg.getBounds().contains(t.x,t.y)?this.padButtonBg:null}onPointermove(t,e,i){if(!this.unit)return;let s=null;if(this.padButtonBg.pointerId===t.id){s=this.padButtonBg,this.isPointerOver(t)||(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padButton.x=this.padButtonBg.x,this.padButton.y=this.padButtonBg.y)}else if(this.padMoveBg.pointerId===t.id){s=this.padMoveBg,this.isPointerOver(t)?this.updatePadmove(t):(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padMove.x=this.padMoveBg.x,this.padMove.y=this.padMoveBg.y)}else this.isPointerOver(t)||(this.padMove.tint=10551200,this.unit.controlPoint([t.x+e,t.y+i]))}onPointerdown(t){if(!this.unit)return;this.update(!1,!1,!1,!1),this.unit.controlPoint(null);let e=this.isPointerOver(t);return e===this.padMoveBg?(this.move=!0,e.pointerId=t.id):e===this.padButtonBg&&(e.pointerId=t.id,this.button=!0),this.move|this.button}updatePadmove(t){let e=!1,i=!1;t.y<this.padMoveBg.y-this.padMove.step?e=!0:t.y>this.padMoveBg.y+this.padMove.step&&(i=!0);let s=!1,n=!1;t.x<this.padMoveBg.x-this.padMove.step?s=!0:t.x>this.padMoveBg.x+this.padMove.step&&(n=!0),this.update(e,i,s,n)}onPointerup(t,e,i){if(!this.unit)return;this.update(!1,!1,!1,!1);this.move,this.button;this.padMoveBg.pointerId===t.id&&(this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1,this.padMoveBg.pointerId=-1),this.padButtonBg.pointerId===t.id&&(this.button=!1,this.padButtonBg.pointerId=-1);let s=this.isPointerOver(t);if(s)s===this.padButtonBg&&this.select();else if(this.unit.controlPoint([t.x+e,t.y+i])){this.unit.control.target.unit=null,this.unit.control.target.focus=null;let s=this.unit.width,n=this.unit.scene.getUnits(t.x+e,t.y+i,s*s,this.unit.player);if(n)for(let t=0;t<n.length;t++){let e=n[t];if(e.action){this.unit.control.target.focus=e;break}}this.unit.control.target.focus?(this.unit.control.target.focusImage.setPosition(this.unit.control.target.focus.x,this.unit.control.target.focus.y),this.unit.control.target.focusImage.visible=!0):this.unit.control.target.focusImage.visible=!1}else this.unit.menuSelect(t.x,t.y),this.scene.moveTime=this.scene.time.now+250}padActive2(t){t||this.move?this.padMove.tint=10551200:this.padMove.tint=10079385}update(t,e,i,s){if(t!==this.up||e!==this.down||i!==this.left||s!==this.right){this.up=t,this.down=e,this.left=i,this.right=s,this.unit.controlPoint(null),this.padMove.y=this.padMoveBg.y,this.up?this.padMove.y-=this.padMove.step:this.down&&(this.padMove.y+=this.padMove.step),this.padMove.x=this.padMoveBg.x,this.left?this.padMove.x-=this.padMove.step:this.right&&(this.padMove.x+=this.padMove.step),this.unit.controlDo(t,e,i,s,!0);let n=t||e||i||s;this.padMove.tint=n?10551200:10079385}}refresh(){}select(){this.scene.select()}static preload(t,e){Array.prototype.push.apply(t,["ControlTarget","ControlPadBg","ControlPadButton"])}}class MainGame extends Phaser.Game{constructor(t,e,i){let s=window.innerWidth,n=window.innerHeight;if(s<n){let t=s;s=n,n=t}window.devicePixelRatio>=2||window.devicePixelRatio;super({key:t.id,type:Phaser.AUTO,parent:t,width:s,height:n,backgroundColor:"#202f53",audio:{noAudio:!0},physics:{default:"arcade",arcade:{debug:!1,fps:60}},render:{},scale:{zoom:1,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{touch:{capture:!0},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene(e)]});let a=document.getElementsByTagName("html")[0].getAttribute("lang");a&&Text.setLang(a),this.registry.set("debug",!0),-1!==window.location.href.indexOf("localhost:8383")?(this.registry.set("debug",!0),this.registry.set("path","./")):-1!==window.location.href.indexOf("test/")?(this.registry.set("release",!0),this.registry.set("path","/test-"+Text.id+"/")):(this.registry.set("release",!0),this.registry.set("path","/"+Text.id+"/")),this.registry.set("gameid",i)}clear(t){window.localStorage.removeItem(this.registry.get("gameid")+t)}save(t,e){window.localStorage.setItem(this.registry.get("gameid")+t,e)}restore(t){return window.localStorage.getItem(this.registry.get("gameid")+t)}}const LEVEL="";function createGame(){var t=new URL(window.location).searchParams.get("id")||"";window.game=new MainGame(document.getElementById("canvas"),["tictactoe-0"],t)}function setGameConfig(t,e,i){}function log(t){console.log(t)}