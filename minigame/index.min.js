/*! Copyright minigame 21-09-2021 */

let UnitActionControl=t=>(class extends t{controlInit(t){this.control=t,this.control.started=!1,this.targetPosition=null,this.targetPositionImage=this.scene.add.image(0,0,"ControlTarget"),this.targetPositionImage.visible=!1,this.control.target={unit:null,focus:null,focusImage:this.scene.add.image(this.x,this.y,UnitBot.name+"Target"),img:this.scene.add.image(this.x,this.y,UnitBot.name+"Target")},this.control.target.img.visible=!1,this.control.target.focusImage.visible=!1,this.control.target.focusImage.tint=10066329,this.control.speed=1,this.body.maxSpeed=Unit.defaultSpeed*this.scene.game.resolution,this.currentAction=null,this.control.action=null,this.body.moves=!0,this.body.immovable=!1}controlDeinit(){const t=this.control;t.started&&this.controlStop(),t.action&&t.action.menuDeinit(),t.target.img.destroy(),t.target.focusImage.destroy(),this.control=null}controlStart(){this.control.started=!0,this.setDrag(1.5*this.body.maxSpeed),this.body.setAllowDrag(!0)}controlStop(){this.control.started=!1}controlDo(t,e,i,s,n){const a=this.control;if(null===a.action){if(t||e||i||s){n&&(a.target.unit=null,a.target.img.visible=!1,a.target.focus=null,a.target.focusImage.visible=!1,this.controlResume(null));let h=this,r=this.x,l=this.y;t?l-=a.speed:e&&(l+=a.speed),i?r-=a.speed:s&&(r+=a.speed);let o=Phaser.Math.Angle.Between(h.x,h.y,r,l);h.rotation=Phaser.Math.Angle.RotateTo(h.rotation,o,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}else if(n)this.controlPause();else if(this.targetPosition){let t=Phaser.Math.Angle.Between(this.x,this.y,this.targetPosition[0],this.targetPosition[1]);this.rotation=Phaser.Math.Angle.RotateTo(this.rotation,t,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}if(null!==this.targetPosition){Phaser.Math.Distance.Squared(this.x,this.y,this.targetPosition[0],this.targetPosition[1])<this.targetPositionProximity&&this.controlPause()}}else n&&(t||e||i||s)&&a.action.actionSelect(t,e,i,s)}controlPause(){this.setFrame(0),this.body.setAcceleration(0),null!==this.targetPosition&&(this.targetPositionImage.visible=!1,this.targetPosition=null)}controlResume(t){if(this.targetPosition=t,this.setFrame(1),t){this.targetPositionImage.setPosition(t[0],t[1]);let e=Phaser.Math.Distance.Squared(this.x,this.y,t[0],t[1]);this.targetPositionProximity=e/5,this.targetPositionProximity>this.width*this.width*2&&(this.targetPositionProximity=this.width*this.width*2)}this.targetPositionImage.visible=null!==t}controlPoint(t){if(null!==this.control.action)return this.controlPause(),!1;if(t){if(this.getBounds().contains(t[0],t[1]))return this.control.pad.select(),!0;this.controlResume(t)}else this.controlPause();return!0}controlAction(t){const e=this.control;return this.currentAction?(this.currentAction.stop.call(this),void(this.currentAction=null)):e.action?(e.action.actionActivate(),void(e.action=null)):(e.target.unit?this.currentAction||(e.action=e.target.unit,e.action.menuStart(this),e.target.unit=null,e.target.img.visible=!1,e.target.focus=null,e.target.focusImage.visible=!1):(e.action=this,this.menuStart(this)),void this.controlPause())}});class Unit extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,n,a,h,r){super(t,e,i,s),h.incubate&&(this.incubate={scale:0,speed:h.incubate},t.addIdle(this)),this.player=a,this.action=null,null!==a&&r===t.mapUnitGroup&&(r=t.teamBuildings[a.team.id]),this.id=h.id||Unit.id++,this.destroyed?this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed):this.on(Phaser.GameObjects.Events.DESTROY,this.deinitUnit),this.unitConfig=h,this.unitConfig.incubate?(this.incubate=0,this.sceneGroup=r,this.scene.idleUnits.add(this,!0),this.body.moves=!1,this.body.immovable=!0):(r.add(this,!0),this.initUnit())}unitInit(t){this.unit=t,this.unit.listeners=[],this.unit.tweens=[],this.unit.time=0,this.unit.tint=0,this.unit.freeze=0,this.unit.level=t.level||1,this.unit.defenceFactor=t.defenceFactor||1,this.body.mass=t.mass||this.width,this.body.allowDrag=!1,this.body.allowGravity=!1,this.unit.sizeSquared=this.width*this.width/2,this.unit.parent&&this.unit.parent.addListener(this),this.unitProcess&&this.scene.addUnitProcess(this)}unitDeinit(){this.unit.parent&&this.unit.parent.removeListener(this),this.live.damageImage&&this.live.damageImage.destroy(),this.live.damageImage2&&this.live.damageImage2.destroy(),this.unitEventNotify("stop"),this.unit.listeners=[],this.scene.clearEvents(this)}unitStart(){}unitStop(){}deinitUnit(){if(this.unitProcess&&this.scene.removeUnitProcess(this),this.menu&&this.menuDeinit(),this.route&&this.routeDeinit(),this.watch&&this.watchDeinit(),this.produce&&this.produceDeinit(),this.move&&this.moveDeinit(),this.live&&this.liveDeinit(),this.follow&&this.followDeinit(),this.unit){for(let t=this.unit.tweens.length-1;t>=0;t--)this.unit.tweens[t].remove();this.unitDeinit()}}unitTween(t){let e=this.scene.tweens.add(t);return this.unit.tweens.push(e),e}addWatch2(t){-1===this.unit.watchListeners.indexOf(t)&&this.unit.watchListeners.push(t)}removeWatch2(t){let e=this.unit.watchListeners.indexOf(t);-1!==e&&this.unit.watchListeners.splice(e,1)}watchNotify2(t){for(let e=this.unit.watchListeners.length-1;e>=0;e--)this.unit.watchListeners[e].watchDo(this,t)}addListener(t){-1===this.unit.listeners.indexOf(t)&&this.unit.listeners.push(t)}removeListener(t){let e=this.unit.listeners.indexOf(t);-1!==e&&this.unit.listeners.splice(e,1)}unitEventNotify(t){for(let e=this.unit.listeners.length-1;e>=0&&!this.unit.listeners[e].unitEvent(this,t);e--);}unitEvent(t,e){this.move&&this.moveEvent(t,e),this.watch&&this.watchEvent(t,e),this.follow&&this.followEvent(t,e)}scaleResolution(t){return this.scene.game.resolution*t}setPlayer(t){0===t.id&&this.sound("claim"),0===this.player.id&&this.sound("lose"),this.unitEventNotify("stop");let e=[this.live.damageImage];this.scene.tweens.add({targets:e,duration:150,scaleX:0,callbackScope:this,rotation:Math.PI,onComplete:function(t){this.scene.tweens.add({targets:e,duration:150,scaleX:1,callbackScope:this,rotation:0,onComplete:function(t){this.live.damageImage.setTint(this.player.color)}},this)}},this),this.player=t,this.unit.level=1,this.updateDamage(),this.live.damageImage2&&(this.live.damageImage2.alpha=.25,this.live.damageImage2.setTint(16777215))}unitDamage(t){this.live.damage;return this.live.damage+=t*this.unit.defenceFactor,this.live.damage>this.live.health?(this.live.damage=this.live.health,!0):(this.updateDamage(),!1)}overlapEnemy(t){let e=t.live.health-t.live.damage;return t.unitDamage(this.live.health-this.live.damage)&&t.destroy(),!!this.unitDamage(e)&&(this.live.damage=this.live.health-(this.live.damage-this.live.health),!0)}overlapFriend(t){if(this.live.damage>0){let e=t.live.health-t.live.damage;this.unit.level>1&&(e/=this.unit.level),e/=2,this.live.damage-=e,this.live.damage<0&&(this.live.damage=0),t.destroy(),this.updateDamage()}}overlap(t){t.unit.activeDelay>0||(this.player.team.id===t.player.team.id?this.overlapFriend(t):this.damageEnemy(t))}explodeEffect(){let t=this.scene.add.particles("Unit-explode");t.createEmitter({frame:[2],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(112.5),end:this.scene.scaleResolution(-112.5)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),t.createEmitter({frame:[0],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(75),end:this.scene.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:750,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),this.scene.time.delayedCall(1e3,function(){t.destroy()},this)}sound(t){this.scene.cardScene.audio.play(t)}toString(){return this.id}static preload(t,e){e.push({name:"Unit-damage-10",size:10});for(let t=40;t<=40;t+=10)e.push({name:"Unit-damage-"+t,size:t})}}Unit.id=1e3,Unit.defaultHealth=64,Unit.defaultMass=100,Unit.defaultSpeed=150;class EventDispatcher extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return null===EventDispatcher.instance&&(EventDispatcher.instance=new EventDispatcher),EventDispatcher.instance}}EventDispatcher.instance=null;class GameScene extends Phaser.Scene{constructor(t){super({key:t}),this.teleports=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]],this.random=Date.now()}init(){this.firstGameToday=!1,parseInt(0|this.game.restore("lastPlayTime"))+43200<(Date.now()/1e3|0)&&(this.firstGameToday=!0)}preload(){this.load.path=this.registry.get("path");this.scene.get("LoaderScene")}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel(),this.level.end||this.startGame()}startGame(){let t=this.registry.get("level");this.level=t,t.players&&this.startUIScene()}startLevel(){let t=this.registry.get("level");this.level=t,t.end}startUIScene(){let t=this.scene.get("UIScene");t=this.scene.add("UIScene",new UIScene("UIScene"));this.scene.run(t,{sceneCreated:this.uiSceneCreated.bind(this),layout:{y:0,x:0,h:this.cameras.main.height-0,w:this.cameras.main.width-0}}),this.uiScene=t}startScene(t,e){let i=this.scene.get(t);i?(this.scene.run(i,e),this.unitScene=i):this.time.delayedCall(100,function(){this.startScene(t,e)},[],this)}getUnitScene(t,e){return"tictactoe"===e?new TictactoeUnitScene(t,this.uiScene):"sudokukid"===e?new SudokukidUnitScene(t,this.uiScene):new UnitScene(t,this.uiScene)}uiSceneCreated(){this.level.teleport=this.teleport;let t=this.level,e="UnitScene-"+t.id,i=this.scene.get(e);i?(i.scene.wake(),this.uiScene.setUnitSceneLevel(i,this.level),this.uiScene.setPlayer(t.data.players[0]),this.unitScene=i):(i=this.scene.add(e,this.getUnitScene(e,t.name)),t.sceneCreated=this.sceneCreated.bind(this),this.startScene(e,t))}sceneCreated(t){this.level.teleport=this.teleport,this.uiScene.setUnitSceneLevel(t,this.level),this.unitScene.levelFactory||(this.unitScene.levelFactory=new LevelFactory(this.uiScene,this.unitScene,this.level,this.teleports))}gameStatus(t){t.shutdown&&(this.scene.wake(),this.cameras.main.fadeOut(150,255,255,255,function(t,e){1===e&&this.cameras.main.fadeIn(1e3,255,255,255,function(t,e){})},this),this.scene.manager.scenes.forEach(function(t){t instanceof LoaderScene||t instanceof GameScene||t.gameOver()}),this.time.delayedCall(3e3,function(){this.scene.manager.scenes.forEach(function(t){t instanceof LoaderScene||t instanceof GameScene||t.destroyed()}),this.time.delayedCall(100,function(){EventDispatcher.getInstance().emit("GameStatus",{gameover:!0})},[],this)},[],this)),t.start&&this.scene.setVisible(!1),t.minigameComplete&&(this.startLevel(),this.uiSceneCreated(),this.uiScene.player.bot.minigameStop()),t.teleportComplete&&(this.startLevel(),this.uiSceneCreated(),this.uiScene.player.bot.travelStop()),t.minigame&&(this.teleport=null),t.teleport&&(this.teleport=t.from.teleport),t.gameover}handleLoseFocus(){console.log("handleLoseFocus")}}class LevelFactory{constructor(t,e,i,s){this.uiScene=t,this.unitScene=e,this.units=[],this.events=[],i.data={players:[],playerTeams:[]};let n=-1;for(let s=0;s<i.players.length;s++)i.data.players[s]=new Player(s,e),i.data.players[s].id=s,i.players[s].team>=0?n=i.players[s].team:n++,i.data.playerTeams[n]||(i.data.playerTeams[n]=new PlayerTeam(n,t,e)),i.data.playerTeams[n].addPlayer(i.data.players[s]);this.level=i,this.tilesize=64*e.game.resolution;let a,h=i.data.players[0];i.players[0].bot[0].id=1,a="tictactoe"===i.name?TictactoeUnitBot:"sudokukid"===i.name?SudokukidUnitBot:UnitBot;let r=this.createUnits(e,i.players[0].bot,a,h)[0];h.bot=r;if("tictactoe"!==i.name&&"sudokukid"!==i.name){this.createTeleports(e,i,s,h);for(let t=0;t<i.players.length;t++){let s=i.players[t],n=i.data.players[t];this.createUnits(e,s.guard,UnitGuard,n),this.createUnits(e,s.emitter,UnitEmitter,n),this.createUnits(e,s.teleport,UnitTeleport,n)}}if(i.event)for(let t=0;t<i.event.length;t++){let e=i.event[t],s=this.getUnitById(e.unit);e.disable&&(e.disableUnit=this.getUnitById(e.disable)),this.events.push(new LevelEvent(s,e))}t.setPlayer(h);for(let t=0;t<this.units.length;t++)this.units[t].unit&&this.units[t].unitEventNotify("start")}createUnit(t,e,i,s,n,a){if(a.unit){a.parents=[];for(let t=0;t<a.unit.length;t++)a.parents.push(this.getUnitById(a.unit[t]))}let h=new e(t,i,s,n,a);return a.id&&(h.id=a.id),h}randomXY(){let t=this.level,e=this.tilesize,i=this.position;i||(this.position={},(i=this.position).areas=[1,2,3,4],Phaser.Utils.Array.Shuffle(i.areas));let s=i.areas.splice(0,1),n=t.grid.w/2-1.5,a=t.grid.h/2-1.5;return i.x=Phaser.Math.FloatBetween(1.5,n),i.y=Phaser.Math.FloatBetween(1.5,a),2===s[0]&&(i.x+=t.grid.w/2),3===s[0]&&(i.y+=t.grid.h/2),4===s[0]&&(i.x+=t.grid.w/2,i.y+=t.grid.h/2),i.x*=e,i.y*=e,i}createTeleports(t,e,i,s){let n=[],a=2;for(let h=0;h<i.length;h++){let r=i[h];if(r[0]===e.id||r[1]===e.id){let i=this.randomXY(),h=i.x,l=i.y,o=r[0]===e.id?r[1]:r[0],c={id:a++,from:e.id,to:o},u=new UnitTeleport(t,h,l,s,c);n.push(u),this.units.push(u)}}return n}createEmitters2(t,e,i,s){for(let i=0;i<1;i++){let i=this.randomXY();new UnitEmitter(t,i.x,i.y,s,e)}}createEnergy(t,e,i,s){let n=[];for(let i=0;i<e.grid.w+e.grid.h;i+=10){let i=64*t.game.resolution,a=Phaser.Math.Between(2,e.grid.w-2)*i,h=Phaser.Math.Between(2,e.grid.h-2)*i,r=new UnitEnergy(t,a,h,s,e);n.push(r)}return n}relocateUnit(t,e,i,s,n){let a,h,r=64*t.game.resolution;do{a=i.x;let t=Phaser.Math.Between(s,n)*r;0===Phaser.Math.Between(0,1)&&(t=-t),a+=t}while(a<1*r||a>e.grid.w*r-r);do{h=i.y;let t=Phaser.Math.Between(s,n)*r;0===Phaser.Math.Between(0,1)&&(t=-t),h+=t}while(h<1*r||h>e.grid.h*r-r);return{x:a,y:h}}destroy(){for(let t=0;t<this.events.length;t++)this.events[t].destroy();this.events=null}createUnits(t,e,i,s){let n=[];if(e)for(let a=0;a<e.length;a++){let h=e[a],r=0,l=0;if(h.position<0){let t=this.randomXY();r=t.x,l=t.y}else{h.parents=[];for(let t=0;h.unit&&t<h.unit.length;t++)h.parents.push(this.getUnitById(h.unit[t]));h.x||(h.x=10,h.y=10),this.dx=100,this.dx2=0,this.dy=100,this.dy2=0,r=h.x*this.dx-this.dx2,l=h.y*this.dy-this.dy2,r||(r=0),l||(l=0)}let o=this.createUnit(t,i,r,l,s,h);n.push(o),this.units.push(o)}return n}getUnitById(t){for(let e=0;e<this.units.length;e++)if(this.units[e].id===t)return this.units[e];return null}createRandomUnit(){const t=this.unitScene;let e=this.level.units,i=Phaser.Math.Between(1,100),s=null;for(let t=0;t<e.length;t++){let n=e[t];if((i-=n.freq)<0){s=n;break}}if(s){let e=t.getBounds(),i=1024*t.game.resolutionSquared;for(let n=0;n<10;n++){let n,a=Phaser.Math.Between(e.x,e.w),h=Phaser.Math.Between(e.y,e.h);if(t.isFreeSpace(t.mapUnitGroup,a,h,i)&&(t.isFreeSpace(t.fields,a,h,i)&&t.isFreeSpace(t.idleUnits,a,h,i))){for(n=0;n<t.teamBuildings.length&&t.isFreeSpace(t.teamBuildings[n],a,h,i)&&t.isFreeSpace(t.teamTroops[n],a,h,i)&&t.isFreeSpace(t.teamBullets[n],a,h,i);n++);if(n===t.teamBuildings.length){let e;"Virus"===s.type&&(e=Unit.Type.Virus),"Energy"===s.type&&(e=Unit.Type.Energy),"Guard"===s.type&&(e=Unit.Type.Guard),this.createUnit(t,e,a,h,this.level.data.players[s.player],s);break}}}}let n=t.idleUnits.getChildren();for(let e=n.length-1;e>=0;e--){let i=n[e];i.unitConfig.incubate;i.incubate+=i.unitConfig.incubate,i.incubate<1?i.updateDamage():(i.incubate=null,t.idleUnits.remove(i),i.sceneGroup.add(i),i.initUnit())}let a=t.teamBuildings[0].getChildren().length;a>50&&(a=50);let h=1e3-20*a;t.addEvent(this.createRandomUnit,h,this)}static preload(t,e){}}class LoaderScene extends Phaser.Scene{constructor(t){super({key:"LoaderScene",visible:!1}),this.loadProgress=0,this.levelList=t,this.minigame=!1,this.minigameLevelNo=-1}init(){}preload(){this.load.path=this.registry.get("path"),this.game.getImage=this.getImage,this.game.config.width>=2560&&this.game.config.height>=1440?(this.res="",this.game.resolution=4):this.game.config.width>=1920&&this.game.config.height>=1080?(this.res="-L",this.game.resolution=3):this.game.config.width>=1280&&this.game.config.height>=720?(this.res="-M",this.game.resolution=2):(this.res="-S",this.game.resolution=1),this.game.resolutionSquared=this.game.resolution*this.game.resolution,this.game.res=this.res,this.levelNo=parseInt(this.game.restore("levelNo")||0),this.getLevelNo(LEVEL),this.load.json("json/"+this.levelList[this.levelNo])}getLevelNo(t){for(let e=0;e<this.levelList.length;e++)if(this.levelList[e]===t){this.levelNo=e;break}}gameStatus(t){t.gameover&&this.restartLevel(1e3,!0),t.teleport&&(this.levelNo=t.from.teleport.to,this.restartLevel(t.teleport.time,!1)),t.minigame&&(this.minigame=!0,t.level?(this.minigameLevelNo=this.levelNo,this.getLevelNo(t.level),this.restartLevel(t.minigame.time,!1)):(this.levelNo=this.minigameLevelNo,this.minigameLevelNo=-1,this.restartLevel(t.minigame.time,!1)))}checkOriention(t,e){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffff00"}).setOrigin(.5);let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.loading,{font:16*this.game.resolution+"px Arial",fill:"#000000"}).setOrigin(.5);this.load.on("loadProgress",function(e){t.text=Text.loading+" "+parseInt(100*e)+" %"},this),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel()}loadLevel(){this.levelList&&this.levelNo>=this.levelList.length||(this.registry.set("level",null),this.load.json("json/"+this.levelList[this.levelNo]),this.load.start())}restartLevel(t,e){if(e){let t=EventDispatcher.getInstance();t.shutdown(),t.on("GameStatus",this.gameStatus.bind(this))}this.scene.setVisible(!0),this.scene.bringToTop(),this.cameras.main.alpha=1,this.cameras.main.once("camerafadeoutcomplete",()=>{e&&this.scene.manager.scenes.forEach(function(t){t!==this&&this.scene.remove(t)},this),this.time.delayedCall(100,function(){this.startLevel()},[],this)}),this.cameras.main.fadeOut(t,255,255,255)}startLevel(){let t=this.cache.json.get("json/"+this.levelList[this.levelNo]);if(!t)return this.load.once("complete",function(){this.startLevel()},this),this.load.json("json/"+this.levelList[this.levelNo]),void this.load.start();this.registry.set("level",t),this.scene.setVisible(!1),this.scene.get("GameScene")?this.minigame?(this.minigame=!1,EventDispatcher.getInstance().emit("GameStatus",{minigameComplete:!0})):EventDispatcher.getInstance().emit("GameStatus",{teleportComplete:!0}):this.scene.add("GameScene",new GameScene("GameScene"),!0)}getImage(t,e,i,s){return this.cache.json.get("sprites").frames[s+".png"]?new Phaser.GameObjects.Image(t,e,i,"sprites-doodd",s):new Phaser.GameObjects.Image(t,e,i,s)}loadBitmap2(t,e){this.bitmaps={frames:[]},e.forEach(function(e){t===this||this.sprites.frames[e+".png"]||t.load.bitmapFont(e,"img/"+e+this.res+".png","img/"+e+this.res+".xml")},this)}loadImages(t,e,i="png"){this.sprites={frames:[]},e.forEach(function(e){if(t!==this&&!this.sprites.frames[e+"."+i]){let s="";this.registry.get("debug")&&(s="?t="+Date.now()),t.load.image(e,"img/"+e+this.res+"."+i+s)}},this)}loadSpritesheets(t,e){e.forEach(function(e){let i=e.width?e.width:e.size,s=e.height?e.height:e.size,n="";this.registry.get("debug")&&(n="?t="+Date.now());let a=e.sub?e.sub:"";t.load.spritesheet(e.name,"img/"+e.name+this.res+a+".png"+n,{frameWidth:i*this.game.resolution,frameHeight:s*this.game.resolution})},this)}}const TEAM_COLOR=[13421721,9638133,6710886,6684774],TEAM_COLOR_BG=[1907968,51,3342336,1900573],ROUTE_COLOR=[10066227,3355443,16777215,3355443];class Player{constructor(t,e){this.id=t,this.color=TEAM_COLOR[this.id],this.routeColor=ROUTE_COLOR[this.id],this.bgColor=TEAM_COLOR_BG[this.id],this.unitScene=e}addHQ(t){this.HQ=t}setTeam(t){this.team=t,this.unitScene.addTeamGroups(this.team.id)}}class PlayerTeam{constructor(t,e,i){this.id=t,this.cardScene=e,this.unitScene=i,this.players=[]}addPlayer(t){this.players.push(t),t.setTeam(this)}}class PriorityQueue{constructor(){this.collection=[]}enqueue(t){if(this.isEmpty())this.collection.push(t);else{let e=!1;for(let i=1;i<=this.collection.length;i++)if(t[1]<this.collection[i-1][1]){this.collection.splice(i-1,0,t),e=!0;break}e||this.collection.push(t)}}dequeue(){return 0===this.collection.length?null:this.collection.shift()}dequeueExpired(t){return 0===this.collection.length?null:t>=this.collection[0][1]?this.collection.shift():null}isEmpty(){return 0===this.collection.length}clear(t){for(let e=this.collection.length-1;e>=0;e--)t===this.collection[e][2]&&this.collection.splice(e,1)}destroy(){this.collection=[]}}var Text={id:"minigame",gameName:"",loading:"Loading",next:"NEXT",play:"PLAY",quit:"QUIT",pause:"PAUSE",resume:"RESUME",restart:"TRY\nAGAIN",gameOverCongratulations:"All levels passed.\n\nCongratulations!",win:"YOU WIN",wait:"Wait for computer,\nmay take a minute.",setLang(t){"fi"===t&&(this.gameName="NANOBOT LIFE",this.loading="Ladataan",this.next="JATKA",this.play="PELAA",this.quit="POISTU",this.pause="PAUSE",this.resume="RESUME",this.restart="ALOITA\nALUSTA",this.gameOverCongratulations="Kaikki tasot selvitetty.\n\nOnnittelut!",this.draw="TASAN",this.win="VOITIT",this.wait="Odota tietokonetta,\nvoi kestää minuutin.")}};class UIControl{constructor(t){this.scene=t;let e=t.add.image(0,t.cameras.main.height,"ControlPadBg").setOrigin(.5,.5);e.x=.3*e.width,e.y-=.3*e.height,e.tint=8421504,this.padMoveBg=e,e.alpha=.5,this.padMove=t.add.image(e.x,e.y,"ControlPadButton"),this.padMove.tint=10079385,this.padMove.step=this.padMove.width/4;let i=t.add.image(t.cameras.main.width-e.x,e.y,"ControlPadBg").setOrigin(.5,.5);i.tint=8421504,i.alpha=.5,this.padButtonBg=i,this.padButton=t.add.image(i.x,i.y,"ControlPadButton"),this.padButton.tint=16751001,this.reset()}resetMove(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1}resetButton(){this.button=!1}reset(){this.resetMove(),this.resetButton()}setUnit(t){this.unit=t,t&&(this.unit.control.pad=this)}isPointerOver(t){return this.padMoveBg.getBounds().contains(t.x,t.y)?this.padMoveBg:this.padButtonBg.getBounds().contains(t.x,t.y)?this.padButtonBg:null}onPointermove(t,e,i){if(!this.unit)return;let s=null;if(this.padButtonBg.pointerId===t.id){s=this.padButtonBg,this.isPointerOver(t)||(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padButton.x=this.padButtonBg.x,this.padButton.y=this.padButtonBg.y)}else if(this.padMoveBg.pointerId===t.id){s=this.padMoveBg,this.isPointerOver(t)?this.updatePadmove(t):(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padMove.x=this.padMoveBg.x,this.padMove.y=this.padMoveBg.y)}else this.isPointerOver(t)||(this.padMove.tint=10551200,this.unit.controlPoint([t.x+e,t.y+i]))}onPointerdown(t){if(!this.unit)return;this.update(!1,!1,!1,!1),this.unit.controlPoint(null);let e=this.isPointerOver(t);return e===this.padMoveBg?(this.move=!0,e.pointerId=t.id):e===this.padButtonBg&&(e.pointerId=t.id,this.button=!0),this.move|this.button}updatePadmove(t){let e=!1,i=!1;t.y<this.padMoveBg.y-this.padMove.step?e=!0:t.y>this.padMoveBg.y+this.padMove.step&&(i=!0);let s=!1,n=!1;t.x<this.padMoveBg.x-this.padMove.step?s=!0:t.x>this.padMoveBg.x+this.padMove.step&&(n=!0),this.update(e,i,s,n)}onPointerup(t,e,i){if(!this.unit)return;this.update(!1,!1,!1,!1);this.move,this.button;this.padMoveBg.pointerId===t.id&&(this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1,this.padMoveBg.pointerId=-1),this.padButtonBg.pointerId===t.id&&(this.button=!1,this.padButtonBg.pointerId=-1);let s=this.isPointerOver(t);if(s)s===this.padButtonBg&&this.select();else if(this.unit.controlPoint([t.x+e,t.y+i])){this.unit.control.target.unit=null,this.unit.control.target.focus=null;let s=this.unit.width,n=this.unit.scene.getUnits(t.x+e,t.y+i,s*s,this.unit.player);if(n)for(let t=0;t<n.length;t++){let e=n[t];if(e.action){this.unit.control.target.focus=e;break}}this.unit.control.target.focus?(this.unit.control.target.focusImage.setPosition(this.unit.control.target.focus.x,this.unit.control.target.focus.y),this.unit.control.target.focusImage.visible=!0):this.unit.control.target.focusImage.visible=!1}else this.unit.menuSelect(t.x,t.y),this.scene.moveTime=this.scene.time.now+250}padActive2(t){t||this.move?this.padMove.tint=10551200:this.padMove.tint=10079385}update(t,e,i,s){if(t!==this.up||e!==this.down||i!==this.left||s!==this.right){this.up=t,this.down=e,this.left=i,this.right=s,this.unit.controlPoint(null),this.padMove.y=this.padMoveBg.y,this.up?this.padMove.y-=this.padMove.step:this.down&&(this.padMove.y+=this.padMove.step),this.padMove.x=this.padMoveBg.x,this.left?this.padMove.x-=this.padMove.step:this.right&&(this.padMove.x+=this.padMove.step),this.unit.controlDo(t,e,i,s,!0);let n=t||e||i||s;this.padMove.tint=n?10551200:10079385}}refresh(){this.unit.controlDo(this.up,this.down,this.left,this.right,!1)}select(){this.selected||(this.selected=!0,this.scene.select())}deselect(){this.selected&&(this.selected=!1)}static preload(t,e,i){Array.prototype.push.apply(e,["ControlPadBg","ControlPadButton"])}}class UIScene extends Phaser.Scene{constructor(t){super({key:t}),this.selectTime=0,this.moveTime=0,this.updateControlTargetTime=0,this.isGameOver=!1}init(){this.levelNo=parseInt(this.game.restore("levelNo")||1),this.level=this.registry.get("level"),this.events.on(Phaser.Scenes.Events.SHUTDOWN,()=>{}),this.events.on(Phaser.Scenes.Events.DESTROY,()=>{})}preload(){this.load.path=this.registry.get("path");let t,e,i=this.scene.get("LoaderScene");this.registry.get("minimind")?(t=["ActionBg","ActionIconBg","ActionProgress","ActionCancel","ActionSpawn","ActionMinigame","ActionConnect","ActionTeleport","ActionBuild","StatusBg","StatusEnergy","StatusBody","StatusBot","BrainBot","BrainTeleport","StatusBigBg","StatusBigValue","StatusBigBrain"],e=[{name:"StatusValue",size:50}]):(t=[],e=[]),UIControl.preload(this,t,e),i.loadImages(this,t),i.loadSpritesheets(this,e)}create(t){if(this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.height,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5),this.debugInfo.y-=this.debugInfo.height,this.input.setTopOnly(!0),this.input.addPointer(1),this.registry.get("minimind")){this.brain=new UIBrain(this);let t=4*this.game.resolution,e=t,i=t;this.statusBody=new UIStatus(this,e,i,"Status","Body",10066329,64,0,64),i+=this.statusBody.bg.height+t,this.statusEnergy=new UIStatus(this,e,i,"Status","Energy",10066176,8,0,8),i+=this.statusEnergy.bg.height+t,this.statusBot=new UIStatus(this,e,i,"Status","Bot",10027161,8,0,8)}this.controlPad=new UIControl(this),this.input.dragDistanceThreshold=16,this.input.dragTimeThreshold=500,this.upPrev=!1,this.downPrev=!1,this.leftPrev=!1,this.rightPrev=!1,EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this));var e=this.input.keyboard.addKeys("W,S,A,D,CTRL,SPACE");this.keys=e;let i=this.input.keyboard.createCursorKeys();this.cursors=i,this.gamepad=null,this.input.gamepad.once("connected",function(t){this.gamepad=t,this.gamepad.on(Phaser.Input.Gamepad.Events.BUTTON_DOWN,function(t){this.gamepad.left||this.gamepad.right||this.controlPad.select()},this)},this),this.input.mouse&&this.input.mouse.disableContextMenu(),this.game.input.touch.capture=!1,this.input.on("pointerup",this.onPointerup,this),this.input.on("pointerdown",this.onPointerdown,this),this.input.on("pointermove",this.onPointermove,this),t.sceneCreated&&t.sceneCreated(this),this.enableInput(!1)}onPointermove(t){if(!this.input.enabled)return;if(!t.isDown)return;let e=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollX:0,i=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollY:0;this.controlPad.onPointermove(t,e,i)}onPointerdown(t){this.input.enabled&&(this.time.now<this.moveTime||this.controlPad.onPointerdown(t))}onPointerup(t){if(!this.input.enabled)return;if(this.time.now<this.moveTime)return;this.moveTime=this.time.now+150;let e=t.upTime-t.downTime,i=t.upX-t.downX,s=t.upY-t.downY;if(e<200){let t=64*this.game.resolution,e=Math.abs(i),n=Math.abs(s);if(e>t||n>t){let a=!1,h=!1,r=!1,l=!1;return e>t&&(i>0?a=!0:h=!0),n>t&&(s>0?l=!0:r=!0),void this.controlPad.update(r,l,h,a)}}let n=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollX:0,a=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollY:0;this.controlPad.onPointerup(t,n,a)}update(t,e){if(this.input.enabled&&this.input.enabled){this.bot.unitFollowCamera&&this.brain&&(this.brain.update(this.bot),this.debugInfo.text="FPS "+parseInt(this.game.loop.actualFps)),this.bot.update(t,e);let i=!1,s=!1,n=!1,a=!1;if(this.keys){let t=this.keys;t.W.isDown&&(i=!0),t.S.isDown&&(s=!0),t.A.isDown&&(n=!0),t.D.isDown&&(a=!0),(t.CTRL.isDown||t.SPACE.isDown)&&this.controlPad.select(),t.CTRL.isUp&&t.SPACE.isUp&&this.controlPad.deselect()}if(this.cursors){let t=this.cursors;t.up.isDown&&(i=!0),t.down.isDown&&(s=!0),t.left.isDown&&(n=!0),t.right.isDown&&(a=!0)}this.gamepad&&((this.gamepad.up||this.gamepad.leftStick.y<=-.5||this.gamepad.rightStick.y<=-.5)&&(i=!0),(this.gamepad.down||this.gamepad.leftStick.y>=.5||this.gamepad.rightStick.y>=.5)&&(s=!0),(this.gamepad.left||this.gamepad.leftStick.x<=-.5||this.gamepad.rightStick.x<=-.5)&&(n=!0),(this.gamepad.right||this.gamepad.leftStick.x>=.5||this.gamepad.rightStick.x>=.5)&&(a=!0)),this.upPrev===i&&this.downPrev===s&&this.leftPrev===n&&this.rightPrev===a||(this.upPrev=i,this.downPrev=s,this.leftPrev=n,this.rightPrev=a,this.controlPad.update(i,s,n,a)),this.controlPad.refresh()}}setUnitSceneLevel(t,e){this.up=this.upPrev=!1,this.down=this.downPrev=!1,this.left=this.leftPrev=!1,this.right=this.rightPrev=!1,this.input.keyboard.resetKeys(),this.controlPad&&this.controlPad.reset(),this.level=e,this.unitScene&&this.unitScene.scene.sleep(),this.unitScene=t}setPlayer(t){if(!this.isGameOver&&(this.player=t,this.bot&&(this.bot.setActive(!1),t.bot&&(t.bot.rotation=this.bot.rotation)),this.bot=t.bot,this.bot)){if(this.level.teleport){let t=this.unitScene.getHqUnits(this.player);for(let e=t.length-1;e>=0;e--){let i=t[e];if(i instanceof UnitTeleport&&this.level.teleport.from===i.teleport.to){this.bot.setPosition(i.x,i.y);break}}}this.bot.setActive(!0),this.bot.travelEffect(!0,this.bot),this.unitScene.children.bringToTop(this.bot),this.controlPad.setUnit(this.bot),this.bot.unitFollowCamera&&this.unitScene.cameras.main.startFollow(this.bot),this.unitScene.children.bringToTop(this.bot),this.bot?(this.brain&&this.brain.reset(this.level.grid),this.enableInput(!0)):this.enableInput(!1)}}enableInput(t){this.input.keyboard.resetKeys(),this.input.keyboard.enabled=t,this.input.enabled=t}disableUnitScene(){this.enableInput(!1),this.bot=null,this.unitScene=null,this.controlPad.setUnit(null)}select(){this.input.enabled&&(this.time.now<this.selectTime||(this.selectTime=this.time.now+150,this.tweens.addCounter({from:204,to:153,duration:125,callbackScope:this,onUpdate:function(t){const e=Math.floor(t.getValue());this.controlPad.padButton.setTint(Phaser.Display.Color.GetColor(255,e,e))}},this),this.bot&&this.bot.uiAction(this)))}gameStatus(t){if(t.start){this.scene.get("UnitScene");this.time.delayedCall(500,function(){},[],this)}t.gameover,t.teleport&&this.enableInput(!1),t.teleportComplete&&this.time.delayedCall(200,function(){this.enableInput(!0)},[],this)}closeUI(){}destroyed(){let t=this.children.getChildren();for(let e=t.length-1;e>=0;e--)t[e].destroy(!0,!0)}gameOver(t){this.isGameOver=!0,this.enableInput(!1),this.tweens.killAll()}}class TictactoeLogic{constructor(t){this.level=0,this.reset(),this.evaluateValue="win"===t?this.evaluateWinThreeInLine:this.evaluateLoseThreeInLine,this.evaluateTerminal=this.gameOver,this.players=[],this.players[0]={id:1},this.players[1]={id:2},this.players[1].ai=new TictactoeNegamax(this.evaluate.bind(this),this.evaluateTerminal.bind(this)),this.setSkill(0)}getSkill(){return this.players[1].ai.skill}setSkill(t){this.players[1].ai.skill=t}reset(){this.board=[[0,0,0],[0,0,0],[0,0,0]]}selectTile(t,e){this.selectTileX=t,this.selectTileY=e}setTile(t){this.board[this.selectTileY][this.selectTileX]=t.id+1}isValid(){return 0===this.board[this.selectTileY][this.selectTileX]}getBoard(){return this.board}hasPlayerInput(){return!this.players[this.currentPlayer].ai}getMove(){let t=this.players[this.currentPlayer].ai.getMoves(this.board,this.players,this.player,this.opponent);return(t=Phaser.Math.RND.shuffle(t)).sort(function(t,e){return t.value>e.value?-1:t.value<e.value?1:0}),t[0]}validMove(t,e){return 0===this.board[e][t]}gameOver(t=this.board,e=this.player,i=!0){return this.gameoverMoves=[],this.winner=this.evaluateValue(t,e,0,i),0!==this.winner?this.gameoverMoves:this.availableMoves()?null:[]}availableMoves(){let t=0;for(let e=0;e<3;e++)for(let i=0;i<3;i++)0===this.board[e][i]&&t++;return t}evaluate(t,e,i,s=!1){this.moveCount++;let n=this.evaluateValue(t,e,i,s);return 0===n?0:n===this.player?10-i:i-10}evaluateWinThreeInLine(t,e,i,s=!0){for(let e=0;e<3;e++)if(0!==t[e][0]&&t[e][0]===t[e][1]&&t[e][1]===t[e][2])return s&&(this.gameoverMoves.push({col:0,row:e}),this.gameoverMoves.push({col:1,row:e}),this.gameoverMoves.push({col:2,row:e})),t[e][0];for(let e=0;e<3;e++)if(0!==t[0][e]&&t[0][e]===t[1][e]&&t[1][e]===t[2][e])return s&&(this.gameoverMoves.push({col:e,row:0}),this.gameoverMoves.push({col:e,row:1}),this.gameoverMoves.push({col:e,row:2})),t[0][e];return 0!==t[0][0]&&t[0][0]===t[1][1]&&t[1][1]===t[2][2]?(s&&(this.gameoverMoves.push({col:0,row:0}),this.gameoverMoves.push({col:1,row:1}),this.gameoverMoves.push({col:2,row:2})),t[0][0]):0!==t[0][2]&&t[0][2]===t[1][1]&&t[1][1]===t[2][0]?(s&&(this.gameoverMoves.push({col:0,row:2}),this.gameoverMoves.push({col:1,row:1}),this.gameoverMoves.push({col:2,row:0})),t[0][2]):0}evaluateLoseThreeInLine(t,e,i,s=!1){let n=this.evaluateWinThreeInLine(t,e,s);return 1===n?2:2===n?1:n}drawThreeInLine(t,e,i,s){let n=this.evaluateWinThreeInLine(t,e,s);return 10===Math.abs(n)?-10:this.availableMoves()?0:10}winOrLoseThreeInLine(t,e,i,s){let n=this.evaluateWinThreeInLine(t,e,s);return 10===Math.abs(n)?10:this.availableMoves()?0:-10}win15InLine(t,e,i,s){for(let n=0;n<3;n++)if(t[n][0]+t[n][1]+t[n][2]===15){if(s&&(this.gameoverMoves.push({col:0,row:n}),this.gameoverMoves.push({col:1,row:n}),this.gameoverMoves.push({col:2,row:n})),t[n][0]===e)return this.winning;if(t[n][0]===i)return-this.winning}for(let n=0;n<3;n++)if(t[0][n]+t[1][n]+t[2][n]===15){if(s&&(this.gameoverMoves.push({col:n,row:0}),this.gameoverMoves.push({col:n,row:1}),this.gameoverMoves.push({col:n,row:2})),t[0][n]===e)return this.winning;if(t[0][n]===i)return-this.winning}if(t[0][0]+t[1][1]+t[2][2]===15){if(s&&(this.gameoverMoves.push({col:0,row:0}),this.gameoverMoves.push({col:1,row:1}),this.gameoverMoves.push({col:2,row:2})),t[0][0]===e)return this.winning;if(t[0][0]===i)return-this.winning}if(t[0][2]+t[1][1]+t[2][0]===15){if(s&&(this.gameoverMoves.push({col:0,row:2}),this.gameoverMoves.push({col:1,row:1}),this.gameoverMoves.push({col:2,row:0})),t[0][2]===e)return this.winning;if(t[0][2]===i)return-this.winning}return 0}get player(){return this.players[this.currentPlayer].id}get opponent(){return 1===this.player?2:1}nextPlayer(){this.currentPlayer=(this.currentPlayer+1)%this.players.length}test(){if(0===this.humanPlayer){this.latestPlayer=0;for(let t=6;t<=6;t++){let e={depth:t,games:0,p1:0,p2:0,skill:0};this.players[0].ai.skill=0,this.players[0].ai.skill=t-1,this.players[0].ai.skill<0&&(this.players[0].ai.skill=0),this.players[1].ai.skill=t,this.moveCount=0;let i=1;for(let t=0;t<100;t++){Phaser.Math.RND.init([i]),i++;let t=null;this.board=[[0,0,0],[0,0,0],[0,0,0]],this.boardMoves=[[0,0,0],[0,0,0],[0,0,0]];let s=1;for(this.currentPlayer=this.latestPlayer,this.latestPlayer=0===this.latestPlayer?1:0;null===t;){let e=this.getMove();this.board[e.row][e.col]=this.player,this.boardMoves[e.row][e.col]=s,s++,null===(t=this.gameOver())&&this.nextPlayer()}if(e.games++,0===t.length||(0===this.currentPlayer?e.p1++:e.p2++),e.p2>0||3===i){console.log(this.board),console.log(this.boardMoves),console.log(i);break}}e.skill=(e.p2-e.p1)/e.p2*100,e.moves=this.moveCount/e.games,console.log(e)}this.board=[[0,0,0],[0,0,0],[0,0,0]]}}}class TictactoeNegamax{constructor(t,e){this.evaluateValue=t,this.evaluateTerminal=e,this.depthMax=-1}negamax(t,e,i,s,n,a,h,r){if(i>this.depthMax)return 0;if(i===this.depthMax||this.evaluateTerminal(e,s,!1))return r*this.evaluateValue(e,s,i);let l=Number.NEGATIVE_INFINITY;for(let o=0;o<e.length;o++)for(let c=0;c<e[0].length;c++)if(0===e[o][c]&&(e[o][c]=s,l=Math.max(l,-this.negamax(t,e,i+1,n,s,-h,-a,-r)),a=Math.max(a,l),e[o][c]=0,a>=h))return a;return l}minimax(t,e,i,s,n,a,h,r){if(i===this.depthMax||null!==this.evaluateTerminal(e,s,!1)){return this.evaluateValue(e,s,i)}let l;l=1===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;for(let o=0;o<e.length;o++)for(let c=0;c<e[0].length;c++)if(0===e[o][c]&&(e[o][c]=s,l=1===r?Math.max(l,this.minimax(t,e,i+1,n,s,-h,-a,-r)):Math.min(l,this.minimax(t,e,i+1,n,s,-h,-a,-r)),a=Math.max(a,l),e[o][c]=0,a>=h))return a;return l}getMoves(t,e,i,s){let n=[];this.players=e,this.depthMax=this.players[i-1].ai.skill;for(let e=0;e<3;e++)for(let a=0;a<3;a++)if(0===t[e][a]){let h={col:a,row:e,value:0};this.depthMax>0?(t[e][a]=i,h.value=-this.negamax(h,t,1,s,i,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,-1),t[e][a]=0):this.evaluateValue(t,i,0),n.push(h)}return n}}class TictactoeUnitBot extends Unit{constructor(t,e,i,s,n){super(t,e,i,"TictactoeTokens",0,s,n,t.teamBuildings[s.team.id]),this.setFrame(3),this.control={};let a=0;t.registry.get("minigame")?(a=parseInt(0|this.scene.game.restore("minigame-tictactoe")),this.maxLevel=a%2==0?a+2:a+1,this.maxLevel>6&&(this.maxLevel=6),this.maxLevel=a+1):this.maxLevel=6,this.scene.tictactoe.setSkill(a);let h="Score 0",r="LEVEL "+a+" / "+this.maxLevel;t.registry.get("minigame")&&(h="VIRUS to get THREE-IN-ROW",r="SEQUENCING "+a+" / "+this.maxLevel),this.gameLabel=this.scene.cardScene.add.text(this.scene.cardScene.cameras.main.centerX,0,h,{fontStyle:"",fontSize:16*this.scene.game.resolution,color:"#99f",align:"center"}).setOrigin(.5,-1),this.skillLabel=this.scene.cardScene.add.text(this.scene.cardScene.cameras.main.centerX,this.gameLabel.height,r,{fontStyle:"bold",fontSize:16*this.scene.game.resolution,color:"#99f",align:"center"}).setOrigin(.5,-1.5),this.infoLabel=this.scene.cardScene.add.text(this.scene.cardScene.cameras.main.centerX,this.scene.cardScene.cameras.main.height,"YOUR TURN",{fontStyle:"bold",fontSize:16*this.scene.game.resolution,color:"#99f",align:"center"}).setOrigin(.5,3),this.startingPlayer=this.player.id,t.registry.get("minigame")?(this.target=this.scene.add.image(this.x,this.y,"TictactoeTokens",3),this.targetImage=this.target,this.setFrame(4)):this.target=this,this.target.setTint(65280),this.currentTile=this.scene.board.getTileAt(1,1),this.scene.tictactoe.selectTile(1,1),this.scene.tictactoe.currentPlayer=this.startingPlayer+1,this.x=this.currentTile.getCenterX(),this.y=this.currentTile.getCenterY(),this.score=0,this.moveTime=0,this.setDepth(10),this.moving=!1,this.winBg=null}controlPoint(t){if(!this.isGameOver()&&!this.moving&&t){const e=this.scene.board;let i=e.worldToTileXY(t[0],t[1]),s=e.getTileAt(i.x,i.y);if(s){let t=null;this.scene.tictactoe.validMove(s.x,s.y)&&(t=this.player),this.updateBoard(s,t)}}}isGameOver(){if(null!==this.winBg){{this.scene.level.id,this.scene;let t=this;this.scene.time.delayedCall(3e3,function(){t.destroy()},this)}return!0}return!1}controlDo(t,e,i,s,n){if(this.moving)return;if(this.moveTime>this.scene.time.now)return;if(n&&this.isGameOver())return;const a=this.scene.board;let h=a.worldToTileXY(this.x,this.y),r=a.getTileAt(h.x,h.y),l=r;s&&r.x<a.layer.width-1&&(r=a.getTileAt(h.x+1,h.y),this.moveTime=this.scene.time.now+300),i&&r.x>0&&(r=a.getTileAt(h.x-1,h.y),this.moveTime=this.scene.time.now+300),t&&r.y>0&&(r=a.getTileAt(h.x,h.y-1),this.moveTime=this.scene.time.now+300),e&&r.y<a.layer.height-1&&(r=a.getTileAt(h.x,h.y+1),this.moveTime=this.scene.time.now+300),l!==r&&this.updateBoard(r)}updateBoard(t,e){let i=this.scene.board.tileToWorldXY(t.x,t.y),s=i.x+t.width/2,n=i.y+t.height/2;this.moving=!0;let a=0;this.scene.registry.get("minigame")&&(a=Phaser.Math.Angle.Between(this.x,this.y,s,n)+Math.PI/2),t===this.currentTile?a=this.rotation:this.currentTile=t,this.scene.tweens.add({targets:this,duration:100,rotation:a,callbackScope:this,onComplete:function(t){this.scene.tweens.add({targets:this,duration:200,x:s,y:n,callbackScope:this,onComplete:function(t){this.moving=!1;let i=this.scene.tictactoe;i.selectTile(this.currentTile.x,this.currentTile.y),i.isValid()?this.target.setTint(65280):this.target.setTint(16776960),e&&this.placeTile(e)}},this)}},this)}placeTile(t){let e=this.scene.tictactoe;e.setTile(t),new TictactoeUnitToken(this.scene,this.x,this.y,t,{tile:this.currentTile});let i=e.gameOver();if(i)i.length>0?e.winner===this.player.id+1?this.gameover("win",i):this.gameover("lose",i):this.gameover("draw");else{let e=this.scene.cardScene;t===this.player?(this.nextMove(e),e.enableInput(!1),this.infoLabel.text="WAIT...",this.target.setTint(16711680)):(e.enableInput(!0),this.infoLabel.text="YOUR TURN")}}initUnit(){}startUnit(){this.controlStart()}destroyed(){this.scene.cardScene.disableUnitScene(),this.gameLabel.destroy(),this.skillLabel.destroy(),this.infoLabel.destroy(),this.actionIcon&&this.actionIcon.destroy(),this.actionLabel&&this.actionLabel.destroy(),this.winBg&&this.winBg.destroy(),this.targetImage&&this.targetImage.destroy();let t="UnitScene-"+this.scene.level.id;this.scene.scene.remove(t)}unitProcess(t){return 1/0}updateDamage(){this.scene.cardScene.statusBody.update(-this.live.damage)}shootUnit(t){this.shoot.target.unit.d2amage<this.shoot.target.live.health?this.shoot.target.unitDamage(this.shoot.d2amage):(this.shoot.target.destroy(),this.laser.visible=!1)}collideGround(){}preUpdate(){this.target!==this&&this.target.setPosition(this.x,this.y)}menuSelect(t,e){this.isGameOver()||this.getBounds().contains(t,e)&&this.uiAction(this.scene.cardScene)}showScore(){this.visible&&(this.target.visible=!1,this.visible=!1,this.skillLabel.text="SEQUENCING COMPLETE",this.winBg=this.scene.add.image(this.scene.cardScene.cameras.main.centerX,this.scene.cardScene.cameras.main.centerY,"MinigameTechnology"),this.actionIcon=this.scene.add.image(this.winBg.x-this.winBg.width/4,this.winBg.y+this.winBg.height/4,"ActionLaser"),this.actionLabel=this.scene.cardScene.add.text(this.actionIcon.x+this.actionIcon.width,this.actionIcon.y,"Antibiotic\nLaser",{fontStyle:"bold",fontSize:16*this.scene.game.resolution,color:"#000",align:"left"}).setOrigin(0,.5),this.infoLabel.text="HIT ANY TO CONTINUE")}restartGame(t){this.visible=!0;let e=this.scene.tictactoe;if(this.scene.registry.get("minigame")&&"win"===t&&e.getSkill()===this.maxLevel)return this.showScore(),void this.scene.cardScene.enableInput(!0);e.reset();for(let t=0;t<=1;t++){let e=this.scene.teamTroops[t];for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}}const i=this.scene.board;this.updateBoard(i.getTileAt(1,1)),this.startingPlayer=0===this.startingPlayer?1:0,this.startingPlayer===this.player.id?(this.infoLabel.text="YOUR TURN",this.scene.cardScene.enableInput(!0)):this.nextMove(this.scene.cardScene)}nextMove(t){let e=this.scene.tictactoe,i=this.scene.levelFactory.level.data.players[1],s=e.getMove();e.selectTile(s.col,s.row);const n=this.scene.board;this.updateBoard(n.getTileAt(s.col,s.row),i)}setToken(){}explode(t,e){let i=this.scene.add.image(t,e,"EffectExplode-0").setScale(0);this.scene.tweens.add({targets:i,duration:500,scale:1,alpha:0,callbackScope:this,onComplete:function(t){i.destroy()}}),i=this.scene.add.image(t,e,"EffectExplode-1").setScale(0),this.scene.tweens.add({targets:i,duration:200,scale:1,alpha:0,callbackScope:this,onComplete:function(t){i.destroy()}})}uiAction(t){this.isGameOver()||this.moving||this.scene.tictactoe.isValid()&&(this.target.setTint(16776960),this.placeTile(this.player))}gameover(t,e=null){if(this.alpha=0,this.scene.tweens.add({targets:this,duration:1200,rotation:8*Math.PI,alpha:1},this),e){let i=[];for(let t=0;t<=1;t++){let s=this.scene.teamTroops[t];for(let t=s.getChildren().length-1;t>=0;t--){let n=s.getChildren()[t];for(let t=0;t<e.length;t++){let s=e[t];n.tile.x===s.col&&n.tile.y===s.row&&i.push(n)}}}if("win"!==t&&this.scene.registry.get("minigame")){this.alpha=0;for(let t=i.length-1;t>=0;t--){let e=i[t];this.explode(e.x,e.y),e.destroy()}}else this.scene.tweens.add({targets:i,duration:375,repeat:2,scaleX:-1},this)}let i=this.scene.tictactoe;"win"===t?(this.infoLabel.text="YOU WIN",this.score+=i.getSkill()):"lose"===t?(this.score=0,this.infoLabel.text="YOU LOSE"):(this.infoLabel.text="DRAW",this.score+=i.getSkill()),this.scene.registry.get("minigame")||(this.scene.registry.get("minigame")?this.gameLabel.text="SEQUENCING "+this.score:this.gameLabel.text="Score "+this.score),this.scene.time.delayedCall(1600,function(){let e=i.getSkill();if("win"===t&&e<6&&e++,"lose"===t&&e>0&&e--,this.scene.registry.get("minigame")){e>(0|this.scene.game.restore("minigame-tictactoe"))&&this.scene.game.save("minigame-tictactoe",e)}i.setSkill(e),this.scene.registry.get("minigame")?this.skillLabel.text="SEQUENCING "+i.getSkill()+" / "+this.maxLevel:this.skillLabel.text="LEVEL "+i.getSkill()+" / "+this.maxLevel,this.restartGame(t)},[],this)}update(t){}activateAction(t,e){this.currentAction=t,t.start.call(this,e)}travelEffect(){}static preload(t,e,i){let s="";t.registry.get("minigame")&&(s="-minimind",e.push("EffectExplode-0"),e.push("EffectExplode-1"),e.push("MinigameTechnology"),e.push("ActionLaser")),i.push({name:"TictactoeTokens",size:64,sub:s})}}TictactoeUnitBot.name="TictactoeUnitBot";class TictactoeUnitScene extends Phaser.Scene{constructor(t,e){super({key:t}),this.debug=!0,this.cardScene=e,this.teamBuildings=[],this.teamTroops=[],this.teamBullets=[],this.eventQueue=new PriorityQueue,this.unitListeners=[]}init(){this.events.on(Phaser.Scenes.Events.DESTROY,()=>{})}preload(){this.load.path=this.registry.get("path");let t=[],e=[];TictactoeUnitBot.preload(this,t,e);let i=this.scene.get("LoaderScene");i.loadImages(this,t),i.loadSpritesheets(this,e)}create(t){this.level=t,this.scene.sendToBack(),this.tictactoe=new TictactoeLogic(this.registry.get("minigame")?"lose":"win");let e=this.textures.get("TictactoeTokens").getSourceImage(),i=this.make.tilemap({data:this.tictactoe.getBoard(),tileWidth:e.height,tileHeight:e.height});var s=i.addTilesetImage("TictactoeTokens");this.board=i.createLayer(0,s,0,0),this.board.x=this.cameras.main.centerX-this.board.width/2,this.board.y=this.cameras.main.centerY-this.board.height/2,this.mapUnitGroup=this.physics.add.staticGroup(),this.cameras.main.setBackgroundColor("#0b032d"),t.sceneCreated&&t.sceneCreated(this)}getBounds(t=null){let e,i,s,n,a=64*this.game.resolution;return t||(e=0*a,i=0*a,s=this.level.grid.w*a,n=this.level.grid.h*a),{x:e,y:i,w:s,h:n}}createBackground(){let t=64*this.game.resolution;var e=[];let i=this.textures.get("BgTileCell").getSourceImage().width/this.textures.get("BgTileCell").getSourceImage().height,s=this.level.grid.w,n=this.level.grid.h;for(let t=0;t<n;t++){e[t]=[];for(let n=0;n<s;n++){let s=Phaser.Math.Between(0,i-2);e[t][n]=s}}let a=this.make.tilemap({data:e,tileWidth:t,tileHeight:t});var h=a.addTilesetImage("BgTileCell","BgTileCell",t,t);let r=a.createLayer(0,h);this.groundLayer=r,r.depth=-1,r.setCollisionBetween(3,i-1)}isFreeSpace(t,e,i,s){let n=t.getChildren();for(let t=n.length-1;t>=0;t--){let a=n[t];if(Phaser.Math.Distance.Squared(e,i,a.x,a.y)<s)return!1}return!0}countEnergy(){let t=this.fields.getChildren(),e=0;for(let i=t.length-1;i>=0;i--)t[i]instanceof UnitEnergy&&e++;return e}createEnergy2(t,e){new UnitEnergy(this,t,e,this.cardScene.player,this.level)}addIdle(t){this.idleUnits.add(t,!0)}zoomTo(t,e,i){}addTeamGroups(t){if(this.teamTroops[t])return;let e=this.physics.add.group();e.runChildUpdate=!1;let i=this.physics.add.group();i.runChildUpdate=!1;let s=this.physics.add.group();s.runChildUpdate=!1,this.teamBuildings[t]=e,this.teamTroops[t]=i,this.teamBullets[t]=s}addUnitProcess(t){if(-1===this.unitListeners.indexOf(t)){for(let e=this.unitListeners.length-1;e>=0;e--){this.unitListeners[e].unitEvent(t,"start")}this.unitListeners.push(t)}}removeUnitProcess(t){const e=this.unitListeners;let i=e.indexOf(t);if(-1!==i){e.splice(i,1);for(let e=this.unitListeners.length-1;e>=0;e--){this.unitListeners[e].unitEvent(t,"stop")}}}executeUnitProcess(t){const e=this.unitListeners;for(let i=e.length-1;i>=0;i--){let s=e[i];t>s.unit.time&&(s.unit.time=s.unitProcess(t))}}overlapUnit(t,e){this.physics.world.isPaused||t.overlap(e)}scaleResolution(t){return t*this.game.resolution}explode(t){let e=this.add.particles("EffectExplode");e.createEmitter({frame:[2],x:t.x,y:t.y,speed:{start:this.scaleResolution(112.5),end:this.scaleResolution(-112.5)},quantity:5,ease:"Power2",lifespan:1500,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(75),end:this.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(56.25),end:this.scaleResolution(-56.25)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}});e.createGravityWell({x:t.x,y:t.y,power:2,epsilon:100,gravity:t.scene.scaleResolution(8)});this.time.delayedCall(2e3,function(){e.destroy()},this)}showGameOver(t,e,i,s,n,a,h){this.input.enabled=!1;let r=this.add.group();this.cardScene.input.once("pointerdown",function(){r.destroy(!0),r=null,this.input.enabled=!0},this);let l=this.add.graphics();if(r.add(l),l.fillStyle(0,.5),l.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),this.level.tutorial.img)return void this.add.image(this.cameras.main.centerX,this.cameras.main.centerY/3,"tutorial-drag-to-select");let o=-1===e?this.cameras.main.centerX:e*a,c=-1===i?this.cameras.main.centerY:i*h,u=r.create(o,c,"sprites","alice.png");if(u.setDepth(10),u.alpha=0,n){let t=r.create(n[0]*a,n[1]*h,"sprites","hand.png");t.x<this.cameras.main.width/2&&(t.scaleX=-1),this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:n.length>2?2:4,yoyo:!0,callbackScope:this,onComplete:function(){r&&(n.length>2?(t.scaleX=1,t.x=n[2]*a,t.y=n[3]*h,this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:1,yoyo:!0,callbackScope:this,onComplete:function(){}},this)):t.destroy())}},this)}this.tweens.add({targets:u,duration:400,alpha:1,delay:s/4,repeat:1,callbackScope:this,onComplete:function(){if(!r)return;let e=r.create(u.x,u.y+u.height/2,"sprites","dialog.png");e.setDepth(10);let i=e.width/12,s=this.add.text(e.x,e.y-e.width/26/2,t,{fontFamily:"Source Code Pro",fontSize:i,color:"#000",align:"center"}).setOrigin(.5);s.setDepth(10),r.add(s)}},this)}destroyed(){for(let t=0;t<this.teamTroops.length;t++){let e=this.teamBuildings[t];e.runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}(e=this.teamTroops[t]).runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}(e=this.teamBullets[t]).runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}}this.mapUnitGroup.runChildUpdate=!1;for(let t=this.mapUnitGroup.getChildren().length-1;t>=0;t--){this.mapUnitGroup.getChildren()[t].destroy(!0,!0)}this.eventQueue.destroy()}gameOver(){this.eventQueue.destroy(),this.time.removeAllEvents(),this.physics.world.colliders.destroy(),this.physics.pause(),this.tweens.killAll()}getHqUnits(t){return this.mapUnitGroup.getChildren().concat(this.teamBuildings[t.id].getChildren())}getAllUnits(){return this.teamTroops[0].getChildren()}getUnits(t,e,i,s){return[]}getEnemyTroops(t){let e=[];for(let i=0;i<this.teamTroops.length;i++)t.team.id!==i&&e.push(this.teamTroops[i].getChildren());return e}getEnemyUnits(t,e,i,s){let n=[];for(let a=0;a<this.teamTroops.length;a++){if(s.id===a)continue;let h=this.teamTroops[a].getChildren();for(let s=h.length-1;s>=0;s--){let a=h[s];i?Phaser.Math.Distance.Squared(t,e,a.x,a.y)<i&&n.push(a):a.getBounds().contains(t,e)&&n.push(a)}}return n}addEvent(t,e,i){this.eventQueue.enqueue([t,this.time.now+e,i])}clearEvents(t){this.eventQueue.clear(t)}update(t,e){this.executeUnitProcess(t);let i=this.eventQueue.dequeueExpired(t);for(;null!==i;)i[0].call(i[2]),i=this.eventQueue.dequeueExpired(t)}}class TictactoeUnitToken extends Unit{constructor(t,e,i,s,n){super(t,e,i,"TictactoeTokens",n.frame,s,n,t.teamTroops[s.team.id]),this.tile=n.tile}initUnit(){this.setFrame(this.player.id+1)}startUnit(){}unitProcess(t){let e=1/0;const i=this.move;t>i.time&&(i.time=t+this.moveDo(),i.time<e&&(e=i.time));const s=this.watch;if(t>s.time){let i=s.unit;s.time=t+this.watchDo(t),s.time<e&&(e=s.time),i!==s.unit&&(null!==i&&(this.moveStop(),this.moveStart()),null!==s.unit&&this.moveStart(s.unit))}return e}static preload(t,e){}}TictactoeUnitToken.name="TictactoeUnitToken";class SudokukidBacktrace{constructor(t,e){this.evaluateValue=t,this.evaluateTerminal=e,this.depthMax=-1}negamax(t,e,i,s,n,a,h,r){if(i>this.depthMax)return 0;if(i===this.depthMax||this.evaluateTerminal(e,s,!1))return r*this.evaluateValue(e,s,i);let l=Number.NEGATIVE_INFINITY;for(let o=0;o<e.length;o++)for(let c=0;c<e[0].length;c++)if(0===e[o][c]&&(e[o][c]=s,l=Math.max(l,-this.negamax(t,e,i+1,n,s,-h,-a,-r)),a=Math.max(a,l),e[o][c]=0,a>=h))return a;return l}minimax(t,e,i,s,n,a,h,r){if(i===this.depthMax||null!==this.evaluateTerminal(e,s,!1)){return this.evaluateValue(e,s,i)}let l;l=1===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;for(let o=0;o<e.length;o++)for(let c=0;c<e[0].length;c++)if(0===e[o][c]&&(e[o][c]=s,l=1===r?Math.max(l,this.minimax(t,e,i+1,n,s,-h,-a,-r)):Math.min(l,this.minimax(t,e,i+1,n,s,-h,-a,-r)),a=Math.max(a,l),e[o][c]=0,a>=h))return a;return l}getMoves(t,e,i,s){let n=[];this.players=e,this.depthMax=this.players[i-1].ai.skill;for(let e=0;e<3;e++)for(let a=0;a<3;a++)if(0===t[e][a]){let h={col:a,row:e,value:0};this.depthMax>0?(t[e][a]=i,h.value=-this.negamax(h,t,1,s,i,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,-1),t[e][a]=0):this.evaluateValue(t,i,0),n.push(h)}return n}}class SudokukidLogic{constructor(t){this.level=0,this.reset(13),this.evaluateValue="d"===t?this.evaluateWinThreeInLine:this.evaluateLoseThreeInLine,this.evaluateTerminal=this.gameOver,this.players=[],this.players[0]={id:1},this.players[1]={id:2},this.players[1].ai=new SudokukidBacktrace(this.evaluate.bind(this),this.evaluateTerminal.bind(this)),this.setSkill(0)}getSkill(){return this.players[1].ai.skill}setSkill(t){this.players[1].ai.skill=t}reset(t){this.board=this.createPuzzle(t),this.fixed=JSON.parse(JSON.stringify(this.board))}selectTile(t,e){this.selectTileX=t,this.selectTileY=e}getTile(){return this.fixed[this.selectTileY][this.selectTileX]}setTile(t){this.board[this.selectTileY][this.selectTileX]=t}isValid(){return 0===this.board[this.selectTileY][this.selectTileX]}validSudoku(t,e,i,s){for(let n=0;n<4;n++){const a=2*Math.floor(e/2)+Math.floor(n/2),h=2*Math.floor(i/2)+n%2;if(t[e][n]===s||t[n][i]===s||t[a][h]===s)return!1}return!0}isSudokuDone(){let t=this.board,e=!0;this.boardBacktrace=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(let i=0;i<4;i++)for(let s=0;s<4;s++)0===t[i][s]&&(e=!1),this.boardBacktrace[i][s]=t[i][s];return e}copy(t){var e,i,s;for(s in e=Array.isArray(t)?[]:{},t)i=t[s],e[s]="object"==typeof i?this.copy(i):i;return e}createRandomPuzzle(t){var e,i,s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],n=0,a=0;for(a=0;a<4;a++){var h=[1,2,3,4];for(t.shuffle(h),n=0;n<4;n++){for(i=0,e=0;e<4;e++)if(0!==(i=h[e])&&this.legalNumber(s,n,a,i)){s[a][n]=i,h[e]=0;break}if(e>=4)return null}}return s}getFreeCell2(t){var e,i;for(e=0;e<4;e++)for(i=0;i<4;i++)if(0===t[e][i])return{x:i,y:e};return null}getAvailable2(t,e,i){var s,n,a;for(n=e.y,a=e.x,s=0;s<4;s++)t[n][s]>0&&(i[t[n][s]-1]=t[n][s]);for(s=0;s<4;s++)t[s][a]>0&&(i[t[s][a]-1]=t[s][a]);var h=Math.floor(a/2),r=Math.floor(n/2);for(let e=0;e<2;e++)for(let s=0;s<2;s++){var l=2*h+s,o=2*r+e;0!==t[o][l]&&(i[t[o][l]-1]=t[o][l])}}isFull(){let t=this.boardBacktrace,e=!0;for(let i=0;i<4;i++)for(let s=0;s<4;s++)0===t[i][s]&&(e=!1);return e}clueCount(t){let e=0;for(let i=0;i<4;i++)for(let s=0;s<4;s++)0!==t[i][s]&&e++;return e}isSudokuSolvable(t){let e=this.boardBacktrace;if(this.isFull())return this.count++;for(let i=0;i<4;i++)for(let s=0;s<4;s++)if(0===e[i][s]){for(let n=1;n<=4;n++)this.validSudoku(e,i,s,n)&&(e[i][s]=n,this.isSudokuSolvable(t)||(e[i][s]=0));return t}return t}removeRandomCells(t,e){for(var i,s,n,a,h,r=0;r<50;r++)if(s=t.integerInRange(0,3),n=3-(i=t.integerInRange(0,3)),a=3-s,0!==e[s][i]){h=e[s][i],e[a][n],e[s][i]=0,this.count=0,this.boardBacktrace=this.copy(e);this.isSudokuSolvable(0);return 1===this.count?(r=0,!0):(e[s][i]=h,!0)}return!1}createPuzzle(t){var e=new Phaser.Math.RandomDataGenerator([(Date.now()*Math.random()).toString()]);let i=null;for(var s=0;s<50;s++){for(;!i;)i=this.createRandomPuzzle(e),this.solvedPuzzle=this.copy(i);if(this.removeRandomCells(e,i,2,!0),this.clueCount(i)<=t)break}return i}legalNumber(t,e,i,s){var n,a,h,r;for(r=0;r<4;r++)if(t[r][e]===s)return!1;for(n=0,r=2*Math.floor(i/2);n<2;n++)for(a=0,h=2*Math.floor(e/2);a<2;a++)if(t[r+n][h+a]===s)return!1;return!0}isSolved(){let t=this.board,e=this.boardSolved;for(var i=0;i<4;i++)for(var s=0;s<4;s++)if(t[i][s]!==e[i][s])return!1;return!0}getBoard(){return this.board}hasPlayerInput(){return!this.players[this.currentPlayer].ai}getMove(){let t=this.players[this.currentPlayer].ai.getMoves(this.board,this.players,this.player,this.opponent);return(t=Phaser.Math.RND.shuffle(t)).sort(function(t,e){return t.value>e.value?-1:t.value<e.value?1:0}),t[0]}validMove(t,e){return 0===this.board[e][t]}gameOver(t=this.board,e=this.player,i=!0){let s=!1;this.isSudokuDone()&&(s=!0);for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0!==this.board[t][e]&&this.board[t][e]!==this.solvedPuzzle[t][e])return[1];return this.count=0,this.isSudokuSolvable(0),1!==this.count?[1]:s?[]:null}availableMoves(){let t=0;for(let e=0;e<3;e++)for(let i=0;i<3;i++)0===this.board[e][i]&&t++;return t}evaluate(t,e,i,s=!1){this.moveCount++;let n=this.evaluateValue(t,e,i,s);return 0===n?0:n===this.player?10-i:i-10}}class SudokukidUnitBot extends Unit{constructor(t,e,i,s,n){super(t,e,i,"SudokukidTokens",0,s,n,t.teamBuildings[s.team.id]),this.setFrame(5),this.control={};let a=0;t.registry.get("minigame")?(a=parseInt(0|this.scene.game.restore("minigame-sudokukid")),this.maxLevel=a%2==0?a+2:a+1,this.maxLevel>6&&(this.maxLevel=6),this.maxLevel=a+1):this.maxLevel=6,this.scene.sudokukid.setSkill(a),this.clueLevel=13,this.selectCell=!0;let h="Put each picture once to each row, column and box.",r="LEVEL "+(a+1)+" / "+this.maxLevel;t.registry.get("minigame")&&(h="VIRUS to get THREE-IN-ROW",r="SEQUENCING "+a+" / "+this.maxLevel),this.clueLevelLabel=this.scene.cardScene.add.text(this.scene.board.x,this.scene.buttons.y,"",{fontStyle:"bold",fontSize:32*this.scene.game.resolution,color:"#99c",align:"center"}).setOrigin(1.25,-.75),this.clueLevelUpLabel=this.scene.cardScene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY,"LEVEL UP",{fontStyle:"bold",fontSize:64*this.scene.game.resolution,color:"#c9c",align:"center"}).setOrigin(.5,.5),this.clueLevelUpLabel.visible=!1,this.updateClueLevel(0,null),this.gameLabel=this.scene.cardScene.add.text(this.scene.board.x+this.scene.board.width/2,0,h,{fontStyle:"",fontSize:16*this.scene.game.resolution,color:"#c9c",align:"center"}).setOrigin(.5,-1),this.gameLabel.visible=!1,this.skillLabel=this.scene.cardScene.add.text(this.scene.cardScene.cameras.main.centerX,this.gameLabel.height,r,{fontStyle:"",fontSize:16*this.scene.game.resolution,color:"#99c",align:"center"}).setOrigin(.5,-1.5),this.skillLabel.setVisible(!1),this.infoLabel=this.scene.cardScene.add.text(this.scene.cardScene.cameras.main.centerX,this.scene.cardScene.cameras.main.height,"Select a cell then picture",{fontStyle:"bold",fontSize:16*this.scene.game.resolution,color:"#6c6",align:"center"}).setOrigin(.5,3),this.infoLabel.setVisible(!1),this.startingPlayer=this.player.id,t.registry.get("minigame")?(this.target=this.scene.add.image(this.x,this.y,"SudokukidTokens",3),this.targetImage=this.target,this.setFrame(4)):this.target=this,this.target.setTint(16776960),this.currentTile=this.scene.board.getTileAt(0,0),this.scene.sudokukid.selectTile(0,0),this.scene.sudokukid.currentPlayer=this.startingPlayer+1,this.x=this.currentTile.getCenterX(),this.y=this.currentTile.getCenterY(),this.buttonFocus=this.scene.add.image(this.x,this.y,"SudokukidTokens",5),this.buttonFocus.setTint(65280),this.buttonSelect=this.scene.buttons.getTileAt(0,0),this.buttonFocus.x=this.buttonSelect.getCenterX(),this.buttonFocus.y=this.buttonSelect.getCenterY(),this.buttonTile=this.buttonSelect,0!==this.scene.sudokukid.getTile()&&this.buttonFocus.setVisible(!1),this.score=0,this.moveTime=0,this.setDepth(10),this.moving=!1,this.winBg=null,this.tileIcon=null}updateClueLevel(t,e){this.clueLevel+=t,this.clueLevelLabel.text="LEVEL\n"+(14-this.clueLevel)+" / 10",this.clueLevelUpLabel.text=e,this.clueLevelUpLabel.visible=!0,this.clueLevelUpLabel.alpha=1,this.scene.tweens.add({targets:this.clueLevelUpLabel,duration:1500,alpha:0,callbackScope:this,onComplete:function(t){this.clueLevelUpLabel.visible=!1}})}controlPoint(t){if(!this.isGameOver()&&!this.moving&&t){let e,i;e=this.scene.board,i=this;let s=e.worldToTileXY(t[0],t[1]);this.selectCell=!0,this.buttonFocus.visible&&(!s||s.x<0||s.y<0||s.x>=4||s.y>=4)&&(e=this.scene.buttons,i=this.buttonFocus,!(s=e.worldToTileXY(t[0],t[1]))||s.x<0||s.y<0||s.x>=2||s.y>=2||(this.selectCell=!1));let n=e.getTileAt(s.x,s.y);if(n){let t=null;this.scene.sudokukid.validMove(n.x,n.y)&&(t=this.player),this.updateBoard(n,this.player)}}}isGameOver(){if(null!==this.winBg){{this.scene.level.id,this.scene;let t=this;this.scene.time.delayedCall(3e3,function(){t.destroy()},this)}return!0}return!1}controlDo(t,e,i,s,n){if(this.moving)return;if(this.moveTime>this.scene.time.now)return;if(n&&this.isGameOver())return;let a,h;this.selectCell,this.buttonFocus.visible?(a=this.scene.buttons,h=this.buttonFocus):(a=this.scene.board,h=this);let r=a.worldToTileXY(h.x,h.y),l=a.getTileAt(r.x,r.y),o=l;s&&l.x<a.layer.width-1&&(l=a.getTileAt(r.x+1,r.y),this.moveTime=this.scene.time.now+10),i&&l.x>0&&(l=a.getTileAt(r.x-1,r.y),this.moveTime=this.scene.time.now+10),t&&l.y>0&&(l=a.getTileAt(r.x,r.y-1),this.moveTime=this.scene.time.now+10),e&&l.y<a.layer.height-1&&(l=a.getTileAt(r.x,r.y+1),this.moveTime=this.scene.time.now+10),o!==l&&this.updateBoard(l,null)}updateBoard(t,e){let i,s;this.tileIcon&&(this.tileIcon.anims.pause(),this.tileIcon=null),t.icon&&(t.icon.anims.resume(),this.tileIcon=t.icon),this.selectCell?(i=this.scene.board,s=this):(i=this.scene.buttons,s=this.buttonFocus,this.buttonTile=t);let n=i.tileToWorldXY(t.x,t.y),a=n.x+t.width/2,h=n.y+t.height/2;this.moving=!0;let r=0;this.scene.registry.get("minigame")&&(r=Phaser.Math.Angle.Between(this.x,this.y,a,h)+Math.PI/2),t===this.currentTile?r=this.rotation:this.selectCell&&(this.currentTile=t),this.scene.tweens.add({targets:this,duration:100,rotation:r,callbackScope:this,onComplete:function(t){this.scene.tweens.add({targets:s,duration:50,x:a,y:h,callbackScope:this,onComplete:function(t){this.moving=!1;let i=this.scene.sudokukid;this.selectCell&&(i.selectTile(this.currentTile.x,this.currentTile.y),i.isValid(),s.setTint(16776960),e&&this.buttonFocus.setVisible(0===this.scene.sudokukid.getTile())),e&&(this.selectCell?this.selectTile(e):(this.placeTile(e),this.buttonFocus.setVisible(!1)))}},this)}},this)}selectTile(){0===this.scene.sudokukid.getTile()&&(this.selectCell=!1,this.buttonFocus.setVisible(!0))}placeTile(t){this.selectCell=!0;let e=this.scene.sudokukid,i=this.buttonTile.x+2*this.buttonTile.y+1;e.setTile(i),this.currentTile.unit&&this.currentTile.unit.destroy(),this.currentTile.unit=new SudokukidUnitToken(this.scene,this.x,this.y,t,{tileId:i,tile:this.currentTile},i),this.teleportEffect(this.currentTile.unit,!0,{x:this.currentTile.unit.x,y:this.currentTile.unit.y},750);let s=!this.checkGameover(),n=this.buttonTile;this.scene.tweens.addCounter({from:153,to:255,duration:300,callbackScope:this,onUpdate:function(t){const e=Math.floor(t.getValue());for(let t=0;t<2;t++)for(let i=0;i<2;i++){let a=this.scene.buttons.getTileAt(t,i);a!==n?a.tint=Phaser.Display.Color.GetColor(e,e,e):s&&"win"!==this.gameResult?a.tint=Phaser.Display.Color.GetColor(255,e,e):a.tint=Phaser.Display.Color.GetColor(0,255,0)}},onComplete:function(){n.tint=16777215}},this)}teleportEffect(t,e,i,s=500){this.travel;this.scene.time.addEvent({callback:()=>{let t=this.scene.add.image(i.x,i.y,"EffectTeleport");t.scale=0,this.scene.tweens.add({targets:t,scale:3,ease:"Linear",duration:s/2,alpha:0,rotation:2*Math.PI,onComplete:function(){t.destroy()}})},callbackScope:this,repeat:1});e&&(t.setScale(0),t.alpha=0);this.scene.tweens.add({targets:t,delay:200,ease:"Quad.easeOut",duration:100,scale:e?1:0,alpha:e?1:0,callback:()=>{},callbackScope:this})}checkGameover(){let t=this.scene.sudokukid.gameOver();return t?(t.length>0?(this.infoLabel.text="LOSE",this.gameover("lose",t)):(this.infoLabel.text="WIN",this.gameover("win")),!1):(this.scene.cardScene&&this.scene.cardScene.enableInput(!0),!0)}initUnit(){}startUnit(){this.controlStart()}destroyed(){this.scene.cardScene.disableUnitScene(),this.gameLabel.destroy(),this.skillLabel.destroy(),this.infoLabel.destroy(),this.actionIcon&&this.actionIcon.destroy(),this.actionLabel&&this.actionLabel.destroy(),this.winBg&&this.winBg.destroy(),this.targetImage&&this.targetImage.destroy();let t="UnitScene-"+this.scene.level.id;this.scene.scene.remove(t)}unitProcess(t){return 1/0}updateDamage(){this.scene.cardScene.statusBody.update(-this.live.damage)}shootUnit(t){this.shoot.target.unit.d2amage<this.shoot.target.live.health?this.shoot.target.unitDamage(this.shoot.d2amage):(this.shoot.target.destroy(),this.laser.visible=!1)}collideGround(){}preUpdate(){this.target!==this&&this.target.setPosition(this.x,this.y)}menuSelect(t,e){this.isGameOver()||this.getBounds().contains(t,e)&&this.uiAction(this.scene.cardScene)}showScore(){this.visible&&(this.target.visible=!1,this.visible=!1,this.skillLabel.text="SEQUENCING COMPLETE",this.winBg=this.scene.add.image(this.scene.cardScene.cameras.main.centerX,this.scene.cardScene.cameras.main.centerY,"MinigameTechnology"),this.actionIcon=this.scene.add.image(this.winBg.x-this.winBg.width/4,this.winBg.y+this.winBg.height/4,"ActionLaser"),this.actionLabel=this.scene.cardScene.add.text(this.actionIcon.x+this.actionIcon.width,this.actionIcon.y,"Antibiotic\nLaser",{fontStyle:"bold",fontSize:16*this.scene.game.resolution,color:"#000",align:"left"}).setOrigin(0,.5),this.infoLabel.text="HIT ANY TO CONTINUE")}restartGame(t){this.visible=!0;let e=this.scene.sudokukid;if(this.scene.registry.get("minigame")&&"win"===t&&e.getSkill()===this.maxLevel)return this.showScore(),void this.scene.cardScene.enableInput(!0);e.reset(this.clueLevel);let i=this.scene.map,s=e.getBoard();i.fill(0,0,0,4,4);for(let t=0;t<4;t++)for(let e=0;e<4;e++)i.getTileAt(e,t).unit&&(i.getTileAt(e,t).unit.destroy(),i.getTileAt(e,t).unit=null),i.putTileAt(s[t][e],e,t);for(let t=0;t<=1;t++){let e=this.scene.teamTroops[t];for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}}this.scene.board;this.currentTile=this.scene.board.getTileAt(0,0),this.scene.sudokukid.selectTile(0,0),this.buttonSelect=this.scene.buttons.getTileAt(0,0),this.buttonFocus.x=this.buttonSelect.getCenterX(),this.buttonFocus.y=this.buttonSelect.getCenterY(),this.buttonTile=this.buttonSelect,this.startingPlayer===this.player.id&&(this.infoLabel.text="Select a cell then picture",this.scene.cardScene.enableInput(!0))}nextMove(t){let e=this.scene.sudokukid,i=this.scene.levelFactory.level.data.players[1],s=e.getMove();e.selectTile(s.col,s.row);const n=this.scene.board;this.updateBoard(n.getTileAt(s.col,s.row),i)}setToken(){}explode(t,e){let i=this.scene.add.image(t,e,"EffectExplode-0").setScale(0);this.scene.tweens.add({targets:i,duration:500,scale:1,alpha:0,callbackScope:this,onComplete:function(t){i.destroy()}}),i=this.scene.add.image(t,e,"EffectExplode-1").setScale(0),this.scene.tweens.add({targets:i,duration:200,scale:1,alpha:0,callbackScope:this,onComplete:function(t){i.destroy()}})}uiAction(t){this.isGameOver()||this.moving||(this.selectCell?this.selectTile(this.player):(this.placeTile(this.player),this.buttonFocus.setVisible(!1)))}gameover(t,e=null){this.gameResult=t;if("win"!==this.gameResult&&(this.alpha=0,this.scene.tweens.add({targets:this,duration:1200,rotation:8*Math.PI,alpha:1},this)),e){let i=[];for(let t=0;t<=1;t++){let s=this.scene.teamTroops[t];for(let t=s.getChildren().length-1;t>=0;t--){let n=s.getChildren()[t];for(let t=0;t<e.length;t++){let s=e[t];n.tile.x===s.col&&n.tile.y===s.row&&i.push(n)}}}if("win"!==t&&this.scene.registry.get("minigame")){this.alpha=0;for(let t=i.length-1;t>=0;t--){let e=i[t];this.explode(e.x,e.y),e.destroy()}}else this.scene.tweens.add({targets:i,duration:375,repeat:2,scaleX:-1},this)}let i=this.scene.sudokukid;"win"===t?(this.infoLabel.text="SUDOKU SOLVED",this.score+=i.getSkill()):"lose"===t?(this.score=0,this.infoLabel.text="NO GOOD MOVE"):(this.infoLabel.text="DRAW",this.score+=i.getSkill()),this.scene.registry.get("minigame")||(this.scene.registry.get("minigame")?this.gameLabel.text="SEQUENCING "+this.score:this.gameLabel.text="Score "+this.score),this.scene.time.delayedCall(1600,function(){let e=i.getSkill();if("win"===t&&e<6&&e++,"lose"===t&&e>0&&e--,this.scene.registry.get("minigame")){e>(0|this.scene.game.restore("minigame-sudokukid"))&&this.scene.game.save("minigame-sudokukid",e)}i.setSkill(e),this.scene.registry.get("minigame")?this.skillLabel.text="SEQUENCING "+i.getSkill()+" / "+this.maxLevel:this.skillLabel.text="LEVEL "+i.getSkill()+" / "+this.maxLevel,this.restartGame(t)},[],this),"win"===t?this.clueLevel>4?this.updateClueLevel(-1,"LEVEL UP"):this.updateClueLevel(0,"PERFECT"):this.clueLevel<13?this.updateClueLevel(1,"LEVEL DOWN"):this.updateClueLevel(0,"TRY AGAIN")}update(t){}activateAction(t,e){this.currentAction=t,t.start.call(this,e)}travelEffect(){}static preload(t,e,i){let s="";t.registry.get("minigame")?(s="-minimind",e.push("EffectExplode-0"),e.push("EffectExplode-1"),e.push("MinigameTechnology"),e.push("ActionLaser")):e.push("EffectTeleport"),i.push({name:"SudokukidTokens",size:64,sub:s})}}SudokukidUnitBot.name="SudokukidUnitBot";class SudokukidUnitScene extends Phaser.Scene{constructor(t,e){super({key:t}),this.debug=!0,this.cardScene=e,this.teamBuildings=[],this.teamTroops=[],this.teamBullets=[],this.eventQueue=new PriorityQueue,this.unitListeners=[]}init(){this.events.on(Phaser.Scenes.Events.DESTROY,()=>{})}preload(){this.load.path=this.registry.get("path");let t=["SudokukidBorder"],e=[];SudokukidUnitBot.preload(this,t,e),SudokukidUnitToken.preload(this,t,e);let i=this.scene.get("LoaderScene");i.loadImages(this,t),i.loadSpritesheets(this,e)}create(t){this.level=t,this.scene.sendToBack(),this.sudokukid=new SudokukidLogic(this.registry.get("minigame")?"mini":"mind");let e=this.textures.get("SudokukidTokens").getSourceImage(),i=this.make.tilemap({data:this.sudokukid.getBoard(),tileWidth:e.height,tileHeight:e.height});this.map=i;var s=i.addTilesetImage("SudokukidTokens",null,e.height,e.height);this.board=i.createLayer(0,s,0,0),this.board.x=this.cameras.main.centerX-this.board.width/2,this.board.y=this.cameras.main.centerY-this.board.height/2;let n=this.make.tilemap({data:[[0,0],[0,0]],tileWidth:e.height,tileHeight:e.height});this.buttons=n.createLayer(0,s,0,0),this.buttons.x=this.board.x+this.board.width+e.height/2,this.buttons.y=this.board.y,this.add.image(this.board.x+this.board.width/2,this.board.y+this.board.height/2,"SudokukidBorder").setDepth(-1),this.mapUnitGroup=this.physics.add.staticGroup(),this.registry.get("minigame"),this.cameras.main.setBackgroundColor("#0b032d");for(let t=0;t<2;t++)for(let e=0;e<2;e++){let i=this.buttons.getTileAt(t,e),s=2*e+t+1,n=this.buttons.tileToWorldXY(i.x,i.y);i.icon=new SudokukidUnitToken(this,n.x+i.width/2,n.y+i.height/2,null,{tileId:s,tile:this.currentTile,anim:!0},s)}t.sceneCreated&&t.sceneCreated(this)}getBounds(t=null){let e,i,s,n,a=64*this.game.resolution;return t||(e=0*a,i=0*a,s=this.level.grid.w*a,n=this.level.grid.h*a),{x:e,y:i,w:s,h:n}}addTeamGroups(t){if(this.teamTroops[t])return;let e=this.physics.add.group();e.runChildUpdate=!1;let i=this.physics.add.group();i.runChildUpdate=!1;let s=this.physics.add.group();s.runChildUpdate=!1,this.teamBuildings[t]=e,this.teamTroops[t]=i,this.teamBullets[t]=s}addUnitProcess(t){if(-1===this.unitListeners.indexOf(t)){for(let e=this.unitListeners.length-1;e>=0;e--){this.unitListeners[e].unitEvent(t,"start")}this.unitListeners.push(t)}}removeUnitProcess(t){const e=this.unitListeners;let i=e.indexOf(t);if(-1!==i){e.splice(i,1);for(let e=this.unitListeners.length-1;e>=0;e--){this.unitListeners[e].unitEvent(t,"stop")}}}executeUnitProcess(t){const e=this.unitListeners;for(let i=e.length-1;i>=0;i--){let s=e[i];t>s.unit.time&&(s.unit.time=s.unitProcess(t))}}overlapUnit(t,e){this.physics.world.isPaused||t.overlap(e)}scaleResolution(t){return t*this.game.resolution}destroyed(){for(let t=0;t<this.teamTroops.length;t++){let e=this.teamBuildings[t];e.runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}(e=this.teamTroops[t]).runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}(e=this.teamBullets[t]).runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0,!0)}}this.mapUnitGroup.runChildUpdate=!1;for(let t=this.mapUnitGroup.getChildren().length-1;t>=0;t--){this.mapUnitGroup.getChildren()[t].destroy(!0,!0)}this.eventQueue.destroy()}gameOver(){this.eventQueue.destroy(),this.time.removeAllEvents(),this.physics.world.colliders.destroy(),this.physics.pause(),this.tweens.killAll()}getHqUnits(t){return this.mapUnitGroup.getChildren().concat(this.teamBuildings[t.id].getChildren())}getUnits(t,e,i,s){return[]}addEvent(t,e,i){this.eventQueue.enqueue([t,this.time.now+e,i])}clearEvents(t){this.eventQueue.clear(t)}update(t,e){this.executeUnitProcess(t);let i=this.eventQueue.dequeueExpired(t);for(;null!==i;)i[0].call(i[2]),i=this.eventQueue.dequeueExpired(t)}}class SudokukidUnitToken extends Unit{constructor(t,e,i,s,n){super(t,e,i,"SudokukidTokens",n.frame,s,n,t.mapUnitGroup),this.tile=n.tile}initUnit(){if(this.setFrame(this.unitConfig.tileId),this.unitConfig.anim){let t=[8,2,30,0],e="SudokukidToken"+["Moon","Bot","Teleport","Fighter"][this.unitConfig.tileId-1];this.setTexture(e),t[this.unitConfig.tileId-1]&&(this.anims.create({key:e,frames:this.anims.generateFrameNumbers(e),frameRate:t[this.unitConfig.tileId-1],repeat:-1,yoyo:!1}),this.anims.play(e),this.anims.pause())}}startUnit(){}unitProcess(t){let e=1/0;const i=this.move;t>i.time&&(i.time=t+this.moveDo(),i.time<e&&(e=i.time));const s=this.watch;if(t>s.time){let i=s.unit;s.time=t+this.watchDo(t),s.time<e&&(e=s.time),i!==s.unit&&(null!==i&&(this.moveStop(),this.moveStart()),null!==s.unit&&this.moveStart(s.unit))}return e}static preload(t,e,i){i.push({name:"SudokukidTokenMoon",size:36}),i.push({name:"SudokukidTokenBot",size:36}),i.push({name:"SudokukidTokenTeleport",size:36}),i.push({name:"SudokukidTokenFighter",size:36})}}SudokukidUnitToken.name="SudokukidUnitToken";class MainGame extends Phaser.Game{constructor(t,e,i){let s=window.innerWidth,n=window.innerHeight;if(s<n){let t=s;s=n,n=t}window.devicePixelRatio>=2||window.devicePixelRatio;super({key:t.id,type:Phaser.AUTO,parent:t,width:s,height:n,backgroundColor:"#202f53",audio:{noAudio:!0},physics:{default:"arcade",arcade:{debug:!1,fps:60}},render:{},scale:{zoom:1,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{touch:{capture:!0},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene(e)]});let a=document.getElementsByTagName("html")[0].getAttribute("lang");a&&Text.setLang(a),this.registry.set("debug",!0),-1!==window.location.href.indexOf("localhost:8383")?(this.registry.set("debug",!0),this.registry.set("path","./")):-1!==window.location.href.indexOf("test/")?(this.registry.set("release",!0),this.registry.set("path","/test-"+Text.id+"/")):(this.registry.set("release",!0),this.registry.set("path","/"+Text.id+"/")),this.registry.set("gameid",i),this.registry.set("minimind",!1)}clear(t){window.localStorage.removeItem(this.registry.get("gameid")+t)}save(t,e){window.localStorage.setItem(this.registry.get("gameid")+t,e)}restore(t){return window.localStorage.getItem(this.registry.get("gameid")+t)}}var LEVEL="";function createGame(){var t,e=new URL(window.location);e.hash.length>0?(t=e.hash.substr(1),LEVEL=t+"-0"):t=Text.id,window.game=new MainGame(document.getElementById("canvas"),["sudokukid-0","tictactoe-0"],t)}function setGameConfig(t,e,i){}function log(t){console.log(t)}