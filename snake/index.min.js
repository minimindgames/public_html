var leadManager=leadManager||{name:"leadManager.",preloaded:!1,increaseScore:function(e,t){console.log(this.name+"increaseScore "+e+" "+t)}},achManager=achManager||{name:"achManager.",preloaded:!1,unlockAchievement:function(e){console.log(this.name+"unlockAchievement "+e)}},constants=constants||{};constants.CLIENT_ID="206761680427-8g4a8o6t230b4f4rqqqdgomnnb1i1n6j.apps.googleusercontent.com",constants.LEAD_TOTAL_WINS="CgkIq7zTn4IGEAIQBQ";var leadTimeUnit=6e4,playService={score:864e5,loginComplete:!1,mainStarted:!1,name:"playService.",achievements:[],leadScores:[{id:"me",rank:5,avatar:"avatar-me.png",name:"You",wins:0,inRow:0,time:0,playerId:null}],getAchievement:function(e){for(var t=0;t<this.achievements.length;t++)if(this.achievements[t].id===e)return this.achievements[t]},getPlayer:function(e){for(var t=0;t<this.leadScores.length;t++)if(this.leadScores[t].id===e)return this.leadScores[t];return null},getAchievements:function(e,t,i){var a,s=[];for(a=0;a<this.achievements.length&&(this.achievements[a].state===e&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id,icon:this.achievements[a].icon}),!(t>0&&s.length>=t));a++);if(i)for(a=0;a<this.achievements.length&&(this.achievements[a].claim&&s.push({name:this.achievements[a].name,desc:this.achievements[a].desc,id:this.achievements[a].id}),!(t>0&&s.length>=t));a++);return s},getScores:function(){var e=[],t=playService.getPlayer("me");return e.push(t.wins),e},resize:function(e,t,i){var a=document.getElementById("login-buttons");a&&(a.style.left=Math.floor(e*i)+"px",a.style.top=Math.floor(t*i)+"px"),(a=document.getElementById("login-image"))&&(a.style.width=Math.floor(64*i)+"px",a.style.height=Math.floor(64*i)+"px")},showLogin:function(){if(!this.loggedIn&&this.mainStarted&&this.loginComplete){var e=document.getElementById("login-buttons");e&&(e.style.display="block")}},downloadedScore:function(e,t){var i=playService.getPlayer("me"),a=!1;return e===constants.LEAD_TOTAL_WINS&&(t>i.wins?(i.wins=t,a=!0):i.wins>t&&leadManager.increaseScore(e,i.wins)),a},downloadedAchievements:function(e){for(var t=!1,i=0;i<e.length;i++){var a=e[i],s=this.getAchievement(a.id);if(s)if("UNLOCKED"===a.achievementState){if(s&&"UNLOCKED"!==s.state){s.state="UNLOCKED";for(var o=0;o<this.achievements.length-1;o++)this.achievements[o]===s&&this.achievements[o+1].type===s.type&&(this.achievements[o+1].state="REVEALED");t=!0}}else s&&"UNLOCKED"===s.state&&achManager.unlockAchievement(a.id)}t&&(dataStorage.saveAchievements(),mainState.updateAchievements())},loadedScores:function(e){var t=playService.getPlayer("me"),i=!1;e[0]>t.wins&&(t.wins=parseInt(e[0]),i=!0),i&&(mainState.updateScores(),leadManager.increaseScore(constants.LEAD_TOTAL_WINS,t.wins))},loadedAchievements:function(e){var t,i=!1;for(t=0;t<e.length;t++){var a=this.getAchievement(e[t]);if("UNLOCKED"!==a.state)for(i=!0,a.state="UNLOCKED",achManager.unlockAchievement(e[t]),t=0;t<this.achievements.length-1;t++)this.achievements[t]===a&&this.achievements[t+1].type===a.type&&(this.achievements[t+1].state="REVEALED")}i&&mainState.updateAchievements()},showAchievements:function(e){for(var t=[],i=0;i<this.achievements.length&&(this.achievements[i].claim&&(this.achievements[i].claim=!1,t.push({name:this.achievements[i].name,desc:this.achievements[i].desc})),!(e>0&&t.length>=e));i++);return t},setScore:function(e){var t,i;for(playerData=playService.getPlayer("me"),playerData.wins=e,t=0;t<this.achievements.length;t++)if(1===(i=this.achievements[t]).type&&"REVEALED"===i.state&&playerData.wins>=i.data){this.unlockAchievement(i.id,!0);break}leadManager.increaseScore(constants.LEAD_TOTAL_WINS,playerData.wins);return dataStorage.saveScores(),!1},unlockAchievement:function(e,t){var i=this.getAchievement(e);if("UNLOCKED"!==i.state){i.state="UNLOCKED",i.claim=!0,achManager.unlockAchievement(e),dataStorage.saveAchievements(),!0;for(var a=0;a<this.achievements.length-1;a++)this.achievements[a]===i&&this.achievements[a+1].type===i.type&&(this.achievements[a+1].state="REVEALED")}},hide:function(){var e=document.getElementById("login-buttons");e&&(e.style.display="none")},signedIn:function(e){this.loginComplete=!0,e?(this.loggedIn=!0,this.hide()):this.showLogin()},claimAchievements:function(){for(var e=0;e<this.achievements.length;e++)this.achievements[e].claim&&(achManager.unlockAchievement(this.achievements[e].id),this.achievements[e].claim=!1)},addPlayer:function(e,t,i,a){var s=playService.getPlayer("me");i&&(s.name=i),a&&!s.iconLoaded&&(s.iconLoaded=!0,s.icon=a,mainState.updatePlayerIcon(s)),this.downloadedScore(e,t)&&(dataStorage.saveScores(),mainState.updateScores())},sync:function(){console.log("sync");var e=playService.getPlayer("me");leadManager.increaseScore(constants.LEAD_TOTAL_WINS,e.wins),mainState.updateScores()}};function getProfilePic(e){}function loadUpFriends(){gapi.client.plus.people.list({collection:"visible",orderBy:"alphabetical",userId:"me",maxResults:20}).execute(function(e){if(e.hasOwnProperty("items"))for(var t=0;t<e.items.length;t++);})}leadManager.preloaded=!1,leadManager.leaderboards={},leadManager.preloadData=function(){leadManager.showLeaderboard(constants.LEAD_TOTAL_WINS)},leadManager.getScore=function(){gapi.client.games.scores.get({playerId:"me",timeSpan:"ALL_TIME",leaderboardId:"ALL"}).execute(function(e){if(!e.error){var t=[];if(e.items&&e.items.length>0)for(var i=0;i<e.items.length;i++)t.push({id:e.items[i].leaderboard_id,value:e.items[i].scoreValue});playService.downloadedScore(t)}}),leadManager.preloaded=!0},leadManager.increaseScore=function(e,t){leadManager.preloaded&&gapi.client.games.scores.submit({leaderboardId:e,score:t}).execute(function(e){if(e.hasOwnProperty("beatenScoreTimeSpans"))for(var t=0;t<e.beatenScoreTimeSpans.length;t++)"ALL_TIME"===e.beatenScoreTimeSpans[t]&&!0})},leadManager.showLeaderboard=function(e){gapi.client.games.scores.list({collection:"SOCIAL",leaderboardId:e,timeSpan:"ALL_TIME"}).execute(function(t){if(t.message,t.hasOwnProperty("items")){if(t.playerScore){var i=t.playerScore,a=i.player,s=a.displayName;(!s||s>15)&&a.name&&a.name.givenName&&(s=a.name.givenName);var o=a.avatarImageUrl;o&&(o+="?sz=74"),playService.addPlayer(e,i.scoreValue,s,o)}}else leadManager.preloaded=!0,playService.sync()})},achManager.achievements={},achManager.preloaded=!1,achManager.preloadData=function(){gapi.client.games.achievementDefinitions.list().execute(function(e){if("games#achievementDefinitionsListResponse"===e.kind&&e.hasOwnProperty("items")){for(var t=0;t<e.items.length;t++)achManager.achievements[e.items[t].id]=e.items[t],achManager.achievements[e.items[t].id].achievementState=e.items[t].initialState;achManager.loadAchievementsEarnedByPlayer()}})},achManager.loadAchievementsEarnedByPlayer=function(){gapi.client.games.achievements.list({playerId:"me"}).execute(function(e){if("games#playerAchievementListResponse"===e.kind&&e.hasOwnProperty("items")){for(var t=[],i=0;i<e.items.length;i++){var a=e.items[i];achManager.achievements[a.id].achievementState=a.achievementState,a.hasOwnProperty("formattedCurrentStepsString")&&(achManager.achievements[a.id].formattedCurrentStepsString=a.formattedCurrentStepsString),t.push(achManager.achievements[a.id])}playService.downloadedAchievements(t),achManager.preloaded=!0}else console.log("**Unexpected response **",e)})},achManager.unlockAchievement=function(e){achManager.preloaded&&gapi.client.games.achievements.unlock({achievementId:e}).execute(function(e){e.newlyUnlocked})},achManager.reset=function(e){};var login=login||{};login.loadClient=function(){gapi.client.load("games","v1",function(){leadManager.preloadData(),achManager.preloadData()})},login.handleAuthResult=function(e){e&&!e.error?(login.loadClient(),playService.signedIn(!0)):playService.signedIn(!1)},login.showLoginDialog=function(){gapi.auth.signIn()},login.logout=function(){gapi.auth.signOut()};var googleLoginCallback=function(e){login.handleAuthResult(e)};function copy(e){var t,i,a;for(a in t=Array.isArray(e)?[]:{},e)i=e[a],t[a]="object"==typeof i?copy(i):i;return t}function addText(e,t,i,a,s,o){var h=this.game.add.text(0,0,e,{fill:"#"+a,fontWeight:"normal",font:dataStorage.fontContent},this.textGroup);return h.anchor.set(.5),h.dx=.5+t,h.dy=.5+i,h.size=Math.floor(s),h.x=h.dx*this.size.width,h.y=h.dy*this.size.height,o&&h.kill(),h}function addSpriteFromFile(e,t,i){var a;return a=this.create(0,0,e),void 0===t&&(a.kill(),t=i=0),a.anchor.set(.5),a.dx=.5+t,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a}function setTexture(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t}function addSprite(e,t,i,a,s){var o;return s||(s=this),o=dataStorage.debug?s.create(0,0,e):s.create(0,0,a,e),s&&(o.noscale=!0),o.anchor.set(.5),void 0===t&&(o.kill(),t=i=0),o.dx=.5+t,o.dy=.5+i,o.x=Math.floor(o.dx*this.size.width),o.y=Math.floor(o.dy*this.size.height),o}function makeSprite(e,t,i,a){return dataStorage.debug?e.make.sprite(i,a,t):e.make.sprite(i,a,"atlas",t)}function lockInputbak(e){e||(e=500),this.inputLockTime=this.time.now+e}function handleInputWidgetbak(){if(!this.inputWidget){if(this.game.input.activePointer.targetObject){var e=this;this.inputWidgets.forEach(function(t){t.input()&&e.showInputWidget(t)})}return null!==this.inputWidget}return hideInputWidget(this),!0}function dimmOverlaybak(e){var t=window.dimmGraphics;if(t){if(t.width===window.innerWidth&&t.height===window.innerHeight)return}else t=window.dimmGraphics=e.make.graphics(0,0);return t.clear(),t.beginFill(0),t.drawRect(0,0,window.innerWidth,window.innerHeight),t.endFill(),t}function onResize(e,t){var i=t.width,a=t.height;this.width===i&&this.height,this.width=i,this.height=a;var s=i>=a,o=0,h=0;this.headerGroup&&(this.headerGroup.size=s?this.headerGroup.landSize:this.headerGroup.portSize,o+=this.headerGroup.size.width,h+=this.headerGroup.size.height),this.boardGroup&&(this.boardGroup.size=s?this.boardGroup.landSize:this.boardGroup.portSize,o+=this.boardGroup.size.width,h+=this.boardGroup.size.height),this.controlGroup&&(this.controlGroup.size=s?this.controlGroup.landSize:this.controlGroup.portSize,o+=this.controlGroup.size.width,h+=this.controlGroup.size.height),this.adGroup&&(this.adGroup.size=s?this.adGroup.landSize:this.adGroup.portSize);var n=i/o,r=a/h,l=Math.min(n,r);l>1&&(l=1);var p,d=0,c=0;if((p=this.bgGroup)&&p.resize(l,d,c,i-d,a-c),(p=this.headerGroup)&&(p.resize(l,d,c,i-d,a-c),d+=p.size.width*p.scale.x,c+=p.size.height*p.scale.y),p=this.boardGroup){var u=0,g=0;this.controlGroup&&(u=this.controlGroup.size.width*l,g=this.controlGroup.size.height*l),p.resize(l,d,c,i-d-u,a-c-g),s?d+=p.size.width*p.scale.x:c+=p.size.height*p.scale.y}return(p=this.controlGroup)&&p.resize(l,d,c,i-d,a-c),(p=this.adGroup)&&p.resize(l,0,0,i,a),(p=this.popupGroup)&&p.resize(l,0,0,i,a),(p=this.effectGroup)&&p.resize(l,0,0,i,a),(p=this.tutorialGroup)&&p.resize(l,0,0,i,a),l}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var dimOverlay=null;function fadeOutEffect(e,t,i){playService.hide();var a=!i,s=e.game.add.graphics(0,0);e.world.remove(s),s.beginFill(2,0,1),tweenColor(e.game,e.game.stage,e.game.stage.backgroundColor,t,750);var o=e.game.width,h=e.game.height,n=Math.max(o,h),r={step:a?n:0};s.drawCircle(o/2,h/2,r.step);var l=e.add.tween(r).to({step:a?0:n},750,Phaser.Easing.Quadratic.InOut,!0).onUpdateCallback(function(){s.clear(),s.beginFill(2,0,1),s.drawCircle(o/2,h/2,r.step)},this);return e.world.mask=s,l}function tweenColor(e,t,i,a,s){var o={step:0},h=e.add.tween(o).to({step:100},s,Phaser.Easing.Linear.None,!1);h.onUpdateCallback(function(){t.backgroundColor=Phaser.Color.interpolateColor(i,a,100,o.step)}),t.backgroundColor=i,h.start()}function addPointer(e,t,i){e.add.sprite(t,i,"atlas","sudokugarden-play.png").anchor.set(.5)}function formatTime(e){var t=Math.floor(e/60);return t+":"+("0"+(e-60*t)).substr(-2)}function renderBg(e){var t=this.game.width,i=this.game.height;this.cache.checkBitmapDataKey("bmd-bg")||((a=this.make.bitmapData(t,i)).smoothed=!1,this.cache.addBitmapData("bmd-bg",a));var a=this.cache.getBitmapData("bmd-bg");a.width===t&&a.height===i||a.resize(t,i),a.clear();var s=a.ctx.createLinearGradient(0,0,0,a.height);s.addColorStop(0,"#f1e5e5"),s.addColorStop(.25,"#f1e5e5"),s.addColorStop(.5,"#2244ff"),s.addColorStop(.5,"#187d31"),s.addColorStop(1,"#8ba45d"),a.ctx.fillStyle=s,a.ctx.fillRect(0,0,t,i);var o=makeSprite(this.game,"bg-top.png",0,0);o.scale.set(e),o.width=t;var h=o.height;a.draw(o,0,0),o.destroy(),(o=makeSprite(this.game,"bg-top-below.png",0,0)).scale.set(e),a.draw(o,a.width-o.width>>1,h),o.destroy(),(o=makeSprite(this.game,"bg-grass.png",0,0)).scale.set(e),o.width=t,h=i-o.height,a.draw(o,0,i-o.height),o.destroy(),(o=makeSprite(this.game,"bg-grass-above.png",0,0)).scale.set(e),a.draw(o,a.width-o.width>>1,h-o.height),o.destroy(),this.bg||(this.bg=this.game.add.image(0,0,a),this.bg.sendToBack())}var snakeHead,dataStorage={URL:"https://tactic.itch.io/",title:"1 Button Snake Game",name:"1-button-snake-game-",fontContent:"Source Serif Pro",fontHeader:"Source Code Pro",debug:!1,isAudio:!0,upgrades:[0,0,0],init:function(){if("undefined"!=typeof Storage)try{var e=localStorage.getItem("audio");null!==e&&"null"!==e&&(this.isAudio="on"===e),null!==(e=localStorage.getItem(this.name+"upgrades"))&&"null"!==e&&(upgrades=e.trim().split(" "),upgradeSpeed=upgrades[0],upgradeLives=upgrades[1],upgradeAgility=upgrades[2],upgradeTurning=upgrades[3]),null!==(e=localStorage.getItem(this.name+"scores"))&&"null"!==e&&playService.loadedScores(e.trim().split(" "),this),null!==(e=localStorage.getItem(this.name+"achievements"))&&"null"!==e&&playService.loadedAchievements(e.trim().split(" "),this)}catch(e){alert("datastorage err")}},setAudio:function(e){if(this.isAudio=e,!e&&this.musicPlaying&&this.musicPlaying.fadeOut(),"undefined"!=typeof Storage)try{localStorage.setItem("audio",e?"on":"off")}catch(e){}},reset:function(){if(console.log("reset dataStorage"),"undefined"!=typeof Storage)try{localStorage.removeItem(this.name+"scores"),localStorage.removeItem(this.name+"upgrades"),localStorage.removeItem(this.name+"achievements")}catch(e){}},saveUpgrades:function(e){if("undefined"!=typeof Storage)try{var t="";e.forEach(function(e){t+=e+" "}),localStorage.setItem(this.name+"upgrades",t),console.log("saveUpgrades "+t)}catch(e){}},saveScores:function(){if("undefined"!=typeof Storage)try{var e=playService.getScores(),t="";e.forEach(function(e){t+=e+" "}),localStorage.setItem(this.name+"scores",t),console.log("saveScores "+t)}catch(e){}},saveAchievements:function(){if("undefined"!=typeof Storage)try{var e=playService.getAchievements("UNLOCKED"),t="";e.forEach(function(e){t+=e.id+" "}),localStorage.setItem(this.name+"achievements",t),console.log("saveAchievements "+t)}catch(e){}}};EffectGroup=function(e,t,i){Phaser.Group.call(this,e),this.landSize=t,this.portSize=i,this.size=e.width>e.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},EffectGroup.prototype=Object.create(Phaser.Group.prototype),EffectGroup.prototype.constructor=EffectGroup,EffectGroup.prototype.addText=function(e,t,i,a,s,o){return addText.call(this,e,t,i,a,s,o)},EffectGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},EffectGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,this.spriteAtlas)},EffectGroup.prototype.setTexture=function(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t},EffectGroup.prototype.resize=function(e,t,i,a,s){if(this.scale.set(e),this.explode1){var o=200*(e*=2);this.explode1.minParticleScale=.1*e,this.explode1.maxParticleScale=.5*e,this.explode1.minParticleSpeed.setTo(-o,-o),this.explode1.maxParticleSpeed.setTo(o,o),o/=2,this.explode2.minParticleScale=.1*e,this.explode2.maxParticleScale=.5*e,this.explode2.minParticleSpeed.setTo(-o,-o),this.explode2.maxParticleSpeed.setTo(o,o),this.spriteScale=e}},EffectGroup.prototype.move=function(e,t,i){e.dx=.5+t,e.dy=.5+i,e.x=Math.floor(e.dx*this.size.width),e.y=Math.floor(e.dy*this.size.height)},EffectGroup.prototype.moveTo=function(e,t){e.dx=t.dx,e.dy=t.dy,e.x=Math.floor(e.dx*this.size.width),e.y=Math.floor(e.dy*this.size.height)},EffectGroup.prototype.enable=function(e){"sparkle"===e&&((t=this.sparkle=this.game.add.emitter(0,0,15)).makeParticles(["atlas"],["effect-star.png"]),t.setRotation(0,0),t.gravity=0,t.minRotation=-90,t.maxRotation=90,t.setAlpha(1,0,1750,Phaser.Easing.Quadratic.InOut),this.add(t));"leaf"===e&&((t=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-leaf.png"]),this.add(t));"snowflake.png"===e&&((t=this.leaf=this.game.add.emitter(this.game.world.centerX,this.game.world.centerY,10)).makeParticles(["atlas"],["effect-snowflake.png"]),this.add(t));"snowing"===e&&((t=this.snowing=this.game.add.emitter(this.game.world.centerX,-32,150)).makeParticles(["atlas"],["effect-snowflake-1.png","effect-snowflake-2.png","effect-snowflake-3.png"]),this.add(t));if("explosion"===e){var t;(t=this.explode1=this.game.add.emitter(0,0,50)).makeParticles(["atlas"],["explode3.png"]),t.width=0,t.height=0,t.gravity=0,t.minRotation=0,t.maxRotation=0,t.setAlpha(1,0,950,Phaser.Easing.Quadratic.InOut),this.add(t),(t=this.explode2=this.game.add.emitter(0,0,25)).makeParticles(["atlas"],["explode4.png"]),t.width=0,t.height=0,t.gravity=0,t.minRotation=0,t.maxRotation=0,t.setAlpha(1,0,950,Phaser.Easing.Quadratic.InOut),this.add(t);var i=this.explodeSprite=this.addSprite("explode1.png",0,0);i.visible=!1,i.anchor.set(.5),i.scale.set(0),i.angle=360*Math.random()}},EffectGroup.prototype.start=function(e,t,i,a){if(this.snowing){var s=150,o=this.scale.x;i<720&&(s=150*(o=(720-i)/720)),this.snowing.maxParticleScale=1*o,this.snowing.minParticleScale=.5*o,this.snowing.setYSpeed(50*o,100*o),this.snowing.setXSpeed(-50*o,50*o),this.snowing.gravity=0,this.snowing.width=i,this.snowing.height=a,this.snowing.minRotation=-70,this.snowing.maxRotation=70,this.snowing.start(!0,2e4,0,s)}else if(this.leaf){(h=this.leaf).x=e/this.scale.x,h.width=i,h.height=a,h.y=t/this.scale.y,h.start(!1,5e3,1450,0)}else if(this.explode1){o=this.scale.x;this.explode1.x=e/o,this.explode1.y=t/o,this.explode2.x=e/o,this.explode2.y=t/o,this.explodeSprite.visible=!0,this.explodeSprite.x=e/o,this.explodeSprite.y=t/o,this.explode1.start(!0,900,50,20),this.explode2.start(!0,900,50,10),this.spriteScale=1,this.explodeSprite.revive(),this.explodeSprite.scale.set(.25),this.game.add.tween(this.explodeSprite.scale).to({x:this.spriteScale,y:this.spriteScale},75,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this.game.add.tween(this.explodeSprite.scale).to({x:.25,y:.25},25,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this.explodeSprite.kill()},this)},this)}else{var h;(h=this.sparkle).width=i,h.height=a,h.x=e/this.scale.x,h.y=t/this.scale.y,h.flow(1750,40,1,10)}},PopupGroup=function(e,t){this.size=t,Phaser.Group.call(this,e),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},PopupGroup.prototype=Object.create(Phaser.Group.prototype),PopupGroup.prototype.constructor=PopupGroup,PopupGroup.prototype.addText=function(e,t,i,a,s){return addText.call(this,e,t,i,a,s)},PopupGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},PopupGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,"atlas")},PopupGroup.prototype.resize=function(e,t,i,a,s){if(this.width=a,this.height=s,this.scale.set(e),this.dim.width=a,this.dim.height=s,this.banner){this.banner.x=a/2/e,this.banner.y=s/2/e,this.bannerBg.x=this.banner.x,this.bannerBg.y=this.banner.y,this.bannerBg.width=a/e;var o=2*a/3/e,h=s/2/e-.9*this.banner.height;this.quackSad&&(this.quackSad.x=o,this.quackSad.y=h),this.quack&&(this.quack.x=o,this.quack.y=h),this.bannerText.x=a/2,this.bannerText.y=s/2,this.bannerText.fontSize=32*e,this.bannerText.wordWrapWidth=500*e}this.dialogBg&&(this.dialogBg.x=a/2/this.scale.x,this.dialogBg.y=s/2/this.scale.y,this.dialogTitle.x=a/2,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogTitle.fontSize=this.dialogTitle.baseFontSize*e,this.dialogText.x=a/2,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.fontSize=32*e,this.dialogText.wordWrapWidth=500*e,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.fontSize=28*e,this.dialogTip.wordWrapWidth=500*e),this.info&&(this.info.wordWrapWidth=500*e,this.info.x=a/2,this.info.y=s/2,this.info.fontSize=48*e,this.info.wordWrapWidth=500*e),this.infoAction&&(this.dimRight.width=this.dimLeft.width=this.game.width,this.dimRight.height=this.dimLeft.height=this.game.height,this.infoSprite&&(this.infoSprite.x=this.game.width/2/e,this.infoSprite.y=this.game.height/2/e),this.infoTitle2.x=this.infoTitle.x=this.game.width/2,this.infoTitle2.y=this.infoTitle.y=this.game.height/2-192*e,this.infoTitle.fontSize=this.infoTitle.baseFontSize*e,this.infoTitle.wordWrapWidth=720*e,this.infoTitle2.fontSize=this.infoTitle2.baseFontSize*e,this.infoTitle2.wordWrapWidth=720*e,this.infoText2.x=this.infoText.x=this.game.width/2,this.infoText2.y=this.infoText.y=this.infoTitle.y+288*e,this.infoText.fontSize=this.infoText.baseFontSize*e,this.infoText.wordWrapWidth=600*e,this.infoText2.fontSize=this.infoText2.baseFontSize*e,this.infoText2.wordWrapWidth=600*e,this.infoAction.x=this.game.width/2,this.infoAction.y=this.infoText2.y+this.infoText2.height+this.infoAction.height,this.infoAction.fontSize=this.infoAction.baseFontSize*e,this.infoAction.wordWrapWidth=720*e)},PopupGroup.prototype.enable=function(e){if(this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.5,this.dim.kill()),this.dimLeft||(this.dimLeft=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dimLeft),this.dimLeft.alpha=1,this.dimLeft.kill()),this.dimRight||(this.dimRight=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dimRight),this.dimRight.alpha=1,this.dimRight.kill()),"popup-kid.png"===e){(l=this.banner=this.addSprite("popup-banner.png")).scale.set(.5);var t={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};(p=this.bannerText=this.game.add.text(0,0,"",t)).kill(),p.anchor.set(.5),p.wordWrap=!0,this.textGroup.add(p)}if("popup-banner.png"===e||"popup-gauge.png"===e){l=this.bannerBg=this.addSprite("popup-banner-bg.png"),l=this.banner=this.addSprite("popup-banner.png"),(l=this.quack=this.addSpriteFromFile("quack.png")).scale.set(.375),(l=this.quackSad=this.addSprite("quack-sad.png")).scale.set(.75);t={fill:"#000000",align:"center",fontWeight:"normal",font:dataStorage.fontContent};if((p=this.bannerText=this.game.add.text(0,0,"",t)).kill(),p.anchor.set(.5),p.wordWrap=!0,this.textGroup.add(p),"popup-gauge.png"===e){var i=this.gaugeBg=makeSprite(this.game,"popup-gauge.png",0,16);i.anchor.set(.5),this.banner.addChild(i);var a=2*dataStorage.scoreMax,s=this.game.make.bitmapData(5*a,32);s.smoothed=!1,s.clear();var o,h=s.ctx.createLinearGradient(0,0,s.width,s.height);h.addColorStop(0,"#00ff00"),h.addColorStop(.5,"#ffff00"),h.addColorStop(1,"#ff0000"),s.ctx.fillStyle=h,s.ctx.fillRect(0,0,5*a,32),this.game.cache.removeBitmapData("bmd-gauge"),this.game.cache.addBitmapData("bmd-gauge",s),(o=this.gauge=this.game.make.sprite(0,0,this.game.cache.getBitmapData("bmd-gauge"))).anchor.set(.5),o.loadTexture(this.game.cache.getBitmapData("bmd-gauge")),this.gaugeBg.addChild(o);var n=5*-a/2;dataStorage.score<15?n+=7.5*dataStorage.score:dataStorage.score<30?(n+=112.5,n+=5*(dataStorage.score-15)):(n+=112.5,n+=75,n+=2.5*(dataStorage.score-30));var r=this.gaugePointer=this.game.make.sprite(n,0,"atlas","popup-gauge-pointer.png");r.anchor.set(.5),o.addChild(r),i.kill()}}if("popup-dialog.png"===e||"popup-dialog-quit.png"===e||"popup-dialog-upgrade.png"===e){var l;(l=this.dialogBg=this.addSprite("popup-dialog-bg.png")).inputEnabled=!0,l.input.useHandCursor=!1;t={fill:"#333",align:"left",fontWeight:"bold",font:dataStorage.fontHeader};(p=this.dialogTitle=this.game.add.text(0,0,dataStorage.title,t)).baseFontSize=34,p.kill(),p.anchor.set(.6,0),p.wordWrap=!1,this.textGroup.add(p),t={fill:"#666",align:"left",fontWeight:"normal",font:dataStorage.fontContent},(p=this.dialogText=this.game.add.text(0,0,"",t)).kill(),p.anchor.set(.5,.1),p.wordWrap=!0,this.textGroup.add(p),(p=this.dialogTip=this.game.add.text(0,0,"",t)).kill(),p.anchor.set(.5),p.wordWrap=!0,this.textGroup.add(p),this.play=makeSprite(this.game,"popup-dialog-play.png"),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0,this.play.input.priorityID=1,this.play.anchor.set(.5),l.addChild(this.play),"popup-dialog-upgrade.png"!==e&&(this.claim=makeSprite(this.game,"popup-dialog-claim.png"),this.claim.inputEnabled=!0,this.claim.input.useHandCursor=!0,this.claim.input.priorityID=1,this.claim.anchor.set(.5),this.claim.kill(),this.claim.y=200,l.addChild(this.claim)),"popup-dialog-quit.png"===e&&(this.quit=makeSprite(this.game,"popup-dialog-quit.png"),this.quit.inputEnabled=!0,this.quit.input.useHandCursor=!0,this.quit.anchor.set(.5),this.quit.input.priorityID=1,this.quit.y=200,l.addChild(this.quit),this.play.kill()),this.close=makeSprite(this.game,"popup-dialog-close.png"),this.close.inputEnabled=!0,this.close.input.useHandCursor=!0,this.close.input.priorityID=1,this.close.x=200,this.close.y=-250,"popup-dialog-upgrade.png"===e&&this.close.kill(),l.addChild(this.close),"popup-dialog-upgrade.png"!==e&&(this.achievementIcon=makeSprite(this.game,"popup-achievement-icon.png",115,80),this.dialogBg.addChild(this.achievementIcon),this.achievementIcon.kill()),"popup-dialog-upgrade.png"===e&&(this.upgradesSteps=[],this.upgradesSteps[0]=[],this.upgradeTurning=this.addUpgrade(0,upgradeTurning,l,"Agility"),this.upgradesSteps[1]=[],this.upgradeSpeed=this.addUpgrade(1,upgradeSpeed,l,"Speed"),this.upgradesSteps[2]=[],this.upgradeAgility=this.addUpgrade(2,upgradeAgility,l,"Wiggle"),this.upgradesSteps[3]=[],this.upgradeLives=this.addUpgrade(3,upgradeLives,l,"Bite"))}if("info"===e){var p;t={fill:"#ffffff",align:"center",fontWeight:"bold",font:dataStorage.fontHeader};(p=this.infoTitle=this.game.add.text(0,0,"",t)).kill(),p.fontSize=p.baseFontSize=64,p.anchor.set(.5,0),p.wordWrap=!1,this.textGroup.add(p),(p=this.infoTitle2=this.game.add.text(0,0,"",t)).kill(),p.fontSize=p.baseFontSize=64,p.anchor.set(.5,0),p.wordWrap=!1,this.textGroup.add(p),t={fill:"#ffffff",align:"center",fontWeight:"normal",font:dataStorage.fontHeader},(p=this.infoText=this.game.add.text(0,0,"",t)).kill(),p.fontSize=p.baseFontSize=40,p.anchor.set(.5,0),p.wordWrap=!0,this.textGroup.add(p),(p=this.infoText2=this.game.add.text(0,0,"",t)).kill(),p.fontSize=p.baseFontSize=40,p.anchor.set(.5,0),p.wordWrap=!0,this.textGroup.add(p),t={fill:"#ffffff",align:"center",fontWeight:"normal",font:dataStorage.fontHeader},(p=this.infoAction=this.game.add.text(0,0,"",t)).kill(),p.fontSize=p.baseFontSize=24,p.anchor.set(.5,0),p.wordWrap=!1,this.textGroup.add(p),this.infoSprite=makeSprite(this.game,"snakebite.png"),this.infoSprite.anchor.set(.5),this.add(this.infoSprite)}},PopupGroup.prototype.addUpgrade=function(e,t,i,a){var s,o={fill:"#666",align:"left",fontWeight:"normal",font:dataStorage.fontContent},h=this.game.make.text(0,123*e-173,a,o);for(h.anchor.set(.5,.5),h.wordWrap=!1,h.fontSize=32,i.addChild(h),s=0;s<7;s++){var n=makeSprite(this.game,"main-upgrade-step.png");n.anchor.set(.5),n.x=(s-3.5)*n.width,n.y=123*e-125,s<t&&(n.tint=s<=1?16776960:s<=3?16744448:16711680),this.upgradesSteps[e][s]=n,i.addChild(n)}this.upgradesSteps[e][s]=h;var r=makeSprite(this.game,"main-upgrade-plus.png");return r.anchor.set(.5),t<7?(r.inputEnabled=!0,r.input.useHandCursor=!0,r.input.priorityID=1):r.alpha=.5,r.x=(s-3)*n.width,r.y=123*e-125,i.addChild(r),this.upgradesSteps[e][s+1]=r,r},PopupGroup.prototype.enableGauge=function(e,t,i){this.gaugeEnabled=e},PopupGroup.prototype.gaugeX=function(){var e=dataStorage.score,t=dataStorage.scoreMax;e=45,e++;var i=5*t*2,a=Math.log(1)/Math.log(10),s=Math.log(t)/Math.log(10)-a,o=(Math.log(e)/Math.log(10)-a)/s*i;return o-=5*t,alert(o),o},PopupGroup.prototype.showBanner=function(e,t,i,a){if(this.hideTimeout)this.hide();else{var s;this.visible=!0,this.textGroup.visible=!0,this.shade&&this.shade.revive(),this.dim.revive(),this.bannerText.revive(),this.quack.kill(),this.quackSad.kill(),s=a?this.quackSad:this.quack,this.bannerBg.revive(),this.banner.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.hideCallback=i,this.bannerText.text=e,s.y=-this.banner.height/2-.9*this.banner.height,this.bannerBg.y=this.banner.y=-this.banner.height/2,this.gaugeBg&&(this.gaugeEnabled?this.gaugeBg.revive():this.gaugeBg.kill()),this.bannerText.y=this.banner.y*this.scale.y;var o=this.game.height,h=o/2/this.scale.y-.9*this.banner.height,n=o/2/this.scale.y,r=o/2;this.game.add.tween(s).to({y:h},500,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.banner).to({y:n},500,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerBg).to({y:n},500,Phaser.Easing.Back.Out,!0,500),this.game.add.tween(this.bannerText).to({y:r},500,Phaser.Easing.Back.Out,!0,500),t&&(this.hideTimeout=this.game.time.events.add(t,function(){this.hideBanner()},this)),this.game.physics&&this.game.physics.arcade}},PopupGroup.prototype.hideBanner=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var e,t=this.game.height;e=this.quack.visible?this.quack:this.quackSad;var i=Phaser.Easing.Quadratic.In,a=t/this.scale.y+this.banner.height,s=t/this.scale.y+this.banner.height+e.height/2;this.game.add.tween(e).to({y:a},250,i,!0),this.game.add.tween(this.banner).to({y:s},250,i,!0),this.game.add.tween(this.bannerBg).to({y:s},250,i,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.shade&&this.shade.kill(),this.dim.kill(),this.bannerText.kill(),this.banner.kill(),this.bannerBg.kill(),this.hideCallback&&this.hideCallback.popupHidden.call(this.hideCallback)},this);var o=s*this.scale.y;this.game.add.tween(this.bannerText).to({y:o},250,i,!0),this.game.physics&&this.game.physics.arcade},PopupGroup.prototype.showDialog=function(e,t,i,a,s,o,h){if(this.visible||this.hideTimeout)this.hide();else{if(this.visible=!0,this.textGroup.visible=!0,this.claim&&this.claim.kill(),o?(this.dialogTitle.text=o,this.achievementIcon&&this.achievementIcon.revive(),h&&(this.claim&&this.claim.revive(),this.play.kill())):(this.dialogTitle.text=dataStorage.title,this.achievementIcon&&this.achievementIcon.kill()),this.upgradesSteps)for(var n=0;n<this.upgradesSteps.length;n++)for(var r=0;r<this.upgradesSteps[n].length;r++)o?this.upgradesSteps[n][r].revive():this.upgradesSteps[n][r].kill();this.dim.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.quit&&(s?this.quit.revive():this.quit.kill()),this.dialogBg.revive(),this.dialogText.text=e,this.dialogText.revive(),this.dialogTitle.revive(),t&&(this.dialogTip.text=t,this.dialogTip.revive()),this.hideCallback=i;var l=this.game.width/this.scale.x,p=this.game.height/this.scale.y,d=-this.dialogBg.width/2;this.dialogBg.x=d,this.dialogBg.y=p/2,this.play.y="ACHIEVEMENT"!==t?200:0,this.dialogTitle.x=d*this.scale.x,this.dialogTitle.y=this.game.height/2-250*this.scale.y,this.dialogText.x=d*this.scale.x,this.dialogText.y=this.game.height/2-150*this.scale.y,this.dialogText.wordWrapWidth=500*this.scale.y,this.dialogTip.x=this.dialogText.x,this.dialogTip.y=this.dialogText.y+370*this.scale.y,this.dialogTip.wordWrapWidth=500*this.scale.y;var c=600;a||(c=1);var u=l/2;this.game.add.tween(this.dialogBg).to({x:u},c,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTitle).to({x:u*this.scale.x},c,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogText).to({x:u*this.scale.x},c,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.dialogTip).to({x:u*this.scale.x},c,Phaser.Easing.Back.Out,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0,this.pausedTime=this.game.time.time)}},PopupGroup.prototype.hideDialog=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null;var e=-this.dialogBg.width/2;this.game.add.tween(this.dialogTitle).to({x:e*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogText).to({x:e*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogTip).to({x:e*this.scale.x},500,Phaser.Easing.Back.In,!0),this.game.add.tween(this.dialogBg).to({x:e},500,Phaser.Easing.Back.In,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.dialogBg.kill(),this.dialogTitle.kill(),this.dialogText.kill(),this.dialogTip.kill(),this.achievementIcon&&this.achievementIcon.kill()},this),this.hideCallback&&this.hideCallback.popupHidden.call(this.hideCallback),this.game.physics&&this.game.physics.arcade},PopupGroup.prototype.hide=function(){this.banner&&this.banner.visible?this.hideBanner():this.dialogBg&&this.dialogBg.visible&&this.hideDialog(),this.infoTitle&&this.infoTitle.visible&&this.hideInfo()},PopupGroup.prototype.showInfo=function(e,t,i,a,s,o,h,n){if(this.visible||this.hideTimeout)this.hide();else{this.visible=!0,this.textGroup.visible=!0,this.hideState=s,this.hideCallback=o,this.infoTitle.text=e,this.infoTitle2.text=e,this.infoText.text=t,this.infoText2.text=t,this.infoAction.text=i,this.dimLeft.width=this.game.width,this.dimLeft.height=this.game.height,this.dimLeft.x=0,this.dimLeft.y=0,this.dimLeft.revive(),this.dimRight.width=this.game.width,this.dimRight.height=this.game.height,this.dimRight.x=0,this.dimRight.y=0,this.dimRight.revive(),this.game.world.bringToTop(this),this.game.world.bringToTop(this.textGroup),this.infoEnter=h;var r=this.scale.x;n||(n="snakebite.png"),setTexture(this.infoSprite,n),"snakebite.png"===n&&(this.infoSprite.angle=90),this.infoSprite.x=this.game.width/2/r,this.infoSprite.y=this.game.height/2/r,this.infoSprite.kill(),this.game.time.events.add(250,function(){this.infoSprite.revive()},this),h?(this.infoTitle2.alpha=this.infoTitle.alpha=.5,this.infoText.alpha=this.infoText2.alpha=.5,this.dimLeft.x=-this.dimLeft.width,this.dimRight.x=this.game.width,this.infoTitle2.x=3*this.game.width/2,this.infoTitle.x=-this.game.width/2,this.infoTitle2.y=this.infoTitle.y=this.game.height/2-192*r,this.infoTitle2.y=this.infoTitle.y=this.game.height/2-2*this.infoTitle.height,this.infoText2.x=3*this.game.width/2,this.infoText.x=-this.game.width/2,this.infoText2.y=this.infoText.y=this.infoTitle.y+288*r,this.infoAction.x=this.game.width/2,this.infoAction.y=this.infoText2.y+this.infoText2.height+this.infoAction.height,this.infoTitle.revive(),this.infoTitle2.revive(),this.infoText.revive(),this.infoText2.revive(),this.game.add.tween(this.dimLeft).to({x:0},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.dimRight).to({x:0},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoTitle).to({x:this.game.width/2},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoTitle2).to({x:this.game.width/2},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoText).to({x:this.game.width/2},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoText2).to({x:this.game.width/2},300,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){this.infoTitle.alpha=1,this.infoTitle2.alpha=1,this.infoText.alpha=1,this.infoText2.alpha=1},this)):(this.infoTitle2.x=this.infoTitle.x=this.game.width/2,this.infoTitle2.y=this.infoTitle.y=this.game.height/2-192*r,this.infoText2.x=this.infoText.x=this.game.width/2,this.infoText2.y=this.infoText.y=this.infoTitle.y+288*r,this.infoAction.x=this.game.width/2,this.infoAction.y=this.infoText2.y+this.infoText2.height+this.infoAction.height,this.infoTitle.alpha=0,this.infoTitle.revive(),this.game.add.tween(this.infoTitle).to({alpha:1},300,Phaser.Easing.Linear.None,!0),this.infoText.alpha=0,this.infoText.revive(),this.game.add.tween(this.infoText).to({alpha:1},300,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){this.infoTitle2.revive(),this.infoText2.revive()},this)),this.infoAction.alpha=0,this.infoAction.revive(),this.game.add.tween(this.infoAction).to({alpha:1},300,Phaser.Easing.Linear.None,!0,750),a&&(this.hideTimeout=this.game.time.events.add(a,function(){this.hideInfo()},this)),this.game.physics&&this.game.physics.arcade}},PopupGroup.prototype.hideInfo=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.hideTimeout=null,this.infoTitle2.alpha=this.infoTitle.alpha=.5,this.infoText.alpha=this.infoText2.alpha=.5,this.infoAction.alpha=.5;this.infoEnter?this.hideCallback.call(this.hideState):(this.game.add.tween(this.dimLeft).to({x:-this.dimLeft.width},750,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.dimRight).to({x:this.game.width},750,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoTitle).to({x:-this.game.width/2},750,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoTitle2).to({x:3*this.game.width/2},750,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoText).to({x:-this.game.width/2},750,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.infoText2).to({x:3*this.game.width/2},750,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){this.visible=!1,this.textGroup.visible=!1,this.dimLeft.kill(),this.dimRight.kill(),this.infoTitle.kill(),this.infoTitle2.kill(),this.infoText.kill(),this.infoText2.kill()},this),this.infoAction.kill(),this.infoSprite.kill(),this.hideCallback&&this.hideCallback.call(this.hideState),this.game.physics&&this.game.physics.arcade)},PopupGroup.prototype.getCenterX=function(e){return this.x+e.dx*this.size.width*this.scale.x},PopupGroup.prototype.getCenterY=function(e){return this.y+e.dy*this.size.height*this.scale.y},TutorialGroup=function(e,t){this.size=t,Phaser.Group.call(this,e),this.textGroup=this.game.add.group(),this.visible=!1,this.textGroup.visible=!1},TutorialGroup.prototype=Object.create(Phaser.Group.prototype),TutorialGroup.prototype.constructor=TutorialGroup,TutorialGroup.prototype.addText=function(e,t,i,a,s){return addText.call(this,e,t,i,a,s)},TutorialGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},TutorialGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,"atlas")},TutorialGroup.prototype.resize=function(e,t,i,a,s){this.width=a,this.height=s,this.scale.set(e),this.dim&&(this.dim.width=a,this.dim.height=s/4),this.targetSprite&&this.handPosition(),this.handText&&(this.handText.fontSize=28*this.scale.x,this.handText.wordWrapWidth=720*this.scale.x)},TutorialGroup.prototype.enable=function(e){this.dim||(this.dim=makeSprite(this.game,"popup-dim.png"),this.game.world.add(this.dim),this.dim.alpha=.75,this.dim.kill()),this.hand=this.addSprite("popup-hand.png",0,0);var t={fill:"#ffffff",align:"center",font:dataStorage.fontContent},i=this.handText=this.game.add.text(0,0,"",t);i.anchor.set(.5),i.y=this.handText.height/2,i.wordWrap=!0,this.textGroup.add(i)},TutorialGroup.prototype.handPosition=function(){this.game.world.bringToTop(this),this.handText.x=this.game.width/2,this.handText.y=this.handText.height/2,this.handText.fontSize=28*this.scale.x,this.handText.wordWrapWidth=720*this.scale.x;var e=this.targetSprite,t=this.targetGroup;this.hand.x=t.getCenterX(e)-this.hand.width/2*this.scale.x,this.hand.y=t.getCenterY(e),this.hand.x/=this.scale.x,this.hand.y/=this.scale.y},TutorialGroup.prototype.pointHand=function(e,t,i){this.visible=!0,this.hand.revive(),this.targetSprite=e,this.targetGroup=t,this.handPosition(),this.game.time.events.add(i,function(){this.hide()},this)},TutorialGroup.prototype.showHand=function(e,t,i){this.visible=!0,this.textGroup.visible=!0,this.step=1,this.dim.revive(),this.hand.revive(),this.targetSprite=t,this.targetGroup=i,this.handPosition(),this.handText.text=e,this.handText.wordWrapWidth=720*this.scale.x,this.handText.y=this.handText.height/2,this.game.world.bringToTop(this.textGroup),this.handText.bringToTop(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},TutorialGroup.prototype.hideHand=function(){this.hideTimeout&&this.game.time.events.remove(this.hideTimeout),this.visible=!1,this.textGroup.visible=!1,this.dim.kill(),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},TutorialGroup.prototype.hide=function(){this.hideHand()},TutorialGroup.prototype.nextStep=function(e,t,i){var a,s;(this.step++,this.handText.text=e,void 0!==t)&&(a=i.getCenterX(t)-this.hand.width/2*this.scale.x,s=i.getCenterY(t),a/=this.scale.x,s/=this.scale.y,this.targetSprite=t,this.targetGroup=i,this.game.add.tween(this.hand).to({x:a,y:s},750,Phaser.Easing.Back.InOut,!0).onComplete.add(function(){},this))},TutorialGroup.prototype.handTarget=function(){return this.targetSprite},AdGroup=function(e,t,i,a){Phaser.Group.call(this,e),this.landSize=t,this.portSize=i,this.main=a,this.size=e.width>e.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},AdGroup.prototype=Object.create(Phaser.Group.prototype),AdGroup.prototype.constructor=AdGroup,AdGroup.prototype.addText=function(e,t,i,a,s){return addText.call(this,e,t,i,a,s)},AdGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},AdGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,"atlas")},AdGroup.prototype.resize=function(e,t,i,a,s){e<.5&&(e=.5),this.scale.set(e),this.size===this.landSize?(this.exit.x=a/e-(this.exit.width+25)*e,this.exit.y=s/2/e):(this.exit.x=a/2/e,this.exit.y=s/e-this.exit.height)},AdGroup.prototype.enable=function(e){this.exit=this.addSprite(e,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0},BgGroup=function(e){Phaser.Group.call(this,e),this.textGroup=this.game.add.group(),this.spriteAtlas="atlas",this.size={width:e.width,height:e.height}},BgGroup.prototype=Object.create(Phaser.Group.prototype),BgGroup.prototype.constructor=BgGroup,BgGroup.prototype.addText=function(e,t,i,a,s,o){return addText.call(this,e,t,i,a,s,o)},BgGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},BgGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,this.spriteAtlas)},BgGroup.prototype.setTexture=function(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t},BgGroup.prototype.resize=function(e,t,i,a,s){this.scale.set(e),this.size.width=a,this.size.height=s;var o=a,h=s;this.children.forEach(function(t){"cache/atlas/bg-top.png"===t.frameName?(t.x=a/2/e,t.y=t.height/2,t.width=Math.floor(a/e),this.topY=t.height):"cache/atlas/bg-top-below.png"===t.frameName?(t.x=a/2/e,t.y=this.topY+t.height/2):"cache/atlas/bg-grass.png"===t.frameName?(t.x=a/2/e,t.y=h*e-t.height,t.width=Math.floor(a/e),this.bottomY=t.height):"cache/atlas/bg-bottom-above.png"===t.frameName?(t.x=a/2/e,t.y=h/e-this.bottomY-t.height/2):(1===t.dx?t.x=o*t.dx/e-t.width/2:t.x=o/2/e,1!==t.dy?t.y=h*t.dy/e:t.y=h/e-t.height/2)},this)},BoardGroup=function(e,t,i){Phaser.Group.call(this,e),this.landSize=t,this.portSize=i,this.size=e.width>e.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas",this.foeGroup=this.game.add.group()},BoardGroup.prototype=Object.create(Phaser.Group.prototype),BoardGroup.prototype.constructor=BoardGroup,BoardGroup.prototype.addText=function(e,t,i,a,s,o){return addText.call(this,e,t,i,a,s,o)},BoardGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},BoardGroup.prototype.addSprite=function(e,t,i,a){var s=this;return a&&(s=this.textGroup),addSprite.call(this,e,t,i,this.spriteAtlas,s)},BoardGroup.prototype.addFoe=function(e,t,i){return addSprite.call(this,e,t,i,this.spriteAtlas,this.foeGroup)},BoardGroup.prototype.addBitmap=function(e,t,i){var a;return a=this.create(0,0,e),void 0===t&&(a.kill(),t=i=0),a.anchor.set(.5),a.dx=.5+t,a.dy=.5+i,a.x=a.dx*this.size.width,a.y=a.dy*this.size.height,a},BoardGroup.prototype.setTexture=function(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t},BoardGroup.prototype.resize=function(e,t,i,a,s){this.scale.set(e),this.foeGroup.scale.set(e),this.offsetX=t,this.offsetY=i;var o=this.size.width,h=this.size.height;this.textGroup.x=this.x=this.foeGroup.x=(a-o*e)/2+t,this.textGroup.y=this.y=this.foeGroup.y=(s-h*e)/2+i,this.children.forEach(function(e){e.x=e.dx*o,e.y=e.dy*h},this),this.foeGroup.children.forEach(function(e){e.x=e.dx*o,e.y=e.dy*h},this),this.textGroup.forEach(function(t){var i=e;t.x=t.dx*o*i,t.y=t.dy*h*i,t.fontSize=Math.floor(t.size*i)+"px"},this),this.worldX=this.x+this.size.width/2*e,this.worldY=this.y+this.size.height/2*e},BoardGroup.prototype.getCenterX=function(e){return this.x+e.x*this.scale.x},BoardGroup.prototype.getCenterY=function(e){return this.y+e.y*this.scale.y},BoardGroup.prototype.move=function(e,t,i){e.dx=.5+t,e.dy=.5+i,e.x=e.dx*this.size.width,e.y=e.dy*this.size.height},BoardGroup.prototype.moveTo=function(e,t){e.dx=t.dx,e.dy=t.dy,e.x=e.dx*this.size.width,e.y=e.dy*this.size.height},BoardGroup.prototype.xy=function(e,t){return{x:e*this.size.width,y:t*this.size.height}},ControlGroup=function(e,t,i,a){Phaser.Group.call(this,e),this.landSize=t,this.portSize=i,this.smallScreen=a,this.size=e.width>e.height?this.landSize:this.portSize,this.textGroup=this.game.add.group(),this.spriteAtlas="atlas"},ControlGroup.prototype=Object.create(Phaser.Group.prototype),ControlGroup.prototype.constructor=ControlGroup,ControlGroup.prototype.addText=function(e,t,i,a,s,o){return addText.call(this,e,t,i,a,s,o)},ControlGroup.prototype.addSpriteFromFile=function(e,t,i){return addSpriteFromFile.call(this,e,t,i)},ControlGroup.prototype.addSprite=function(e,t,i,a,s){var o=addSprite.call(this,e,t,i,this.spriteAtlas);return o.portx=a,o.porty=s,o},ControlGroup.prototype.setTexture=function(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t},ControlGroup.prototype.resize=function(e,t,i,a,s){if(this.scale.set(e),this.size===this.landSize){this.exit&&this.exit.kill();var o=this.size.width,h=s;this.children.forEach(function(e){e.x=e.dx*o,e.y=e.dy*h},this)}else{this.exit&&this.exit.revive();o=a,h=this.size.height;this.children.forEach(function(e){e.x=e.portx*o,e.y=e.porty*h},this)}this.textGroup.x=this.x=(a-o*e)/2+t,this.textGroup.y=this.y=(s-h*e)/2+i,this.textGroup.forEach(function(t){t.x=t.dx*o*e,t.y=t.dy*h*e,t.fontSize=Math.floor(t.size*e)+"px"},this)},ControlGroup.prototype.move=function(e,t,i){e.dx=.5+t,e.dy=.5+i,e.x=e.dx*this.size.width,e.y=e.dy*this.size.height},ControlGroup.prototype.getCenterX=function(e){return this.x+e.x*this.scale.x},ControlGroup.prototype.getCenterY=function(e){return this.y+e.y*this.scale.y},HeaderGroup=function(e,t,i,a){Phaser.Group.call(this,e),this.landSize=t,this.portSize=i,this.state=a,this.size=e.width>e.height?this.landSize:this.portSize,this.textGroup=this.game.add.group()},HeaderGroup.prototype=Object.create(Phaser.Group.prototype),HeaderGroup.prototype.constructor=HeaderGroup,HeaderGroup.prototype.addText=function(e,t,i,a,s){return addText.call(this,e,t,i,a,s)},HeaderGroup.prototype.addSprite=function(e,t,i){return addSprite.call(this,e,t,i,"atlas")},HeaderGroup.prototype.setTexture=function(e,t){dataStorage.debug?e.loadTexture(t):e.frameName=t},HeaderGroup.prototype.resize=function(e,t,i,a,s){var o,h;e<.5&&(e=.5),this.scale.set(e);var n=10*e;if(this.option&&(o=this.option.width,h=this.option.height,this.size===this.landSize?(this.optionBg.x=this.option.x=o/2+n,this.optionBg.y=this.option.y=s/e-h/2-n,this.optionSound.x=120,this.optionSound.y=-100,this.optionFullscreen.x=50,this.optionFullscreen.y=-150,this.optionReset.x=170,this.optionReset.y=-0,playService.resize(n,n,e),this.info&&(this.info.x=this.option.x,this.info.y=this.option.y-h-2*n)):(this.optionBg.x=this.option.x=a/e-o/2-n,this.optionBg.y=this.option.y=h/2+n,this.optionSound.x=-120,this.optionSound.y=100,this.optionFullscreen.x=-155,this.optionFullscreen.y=25,this.optionReset.x=0,this.optionReset.y=165,playService.resize(n,n,e),this.info&&(this.info.x=this.option.x-o-2*n,this.info.y=this.option.y))),this.exit&&(this.size===this.landSize?(this.exit.revive(),o=this.exit.width,h=this.exit.height,this.exit.x=o/2+n,this.exit.y=h/2+n):(o=this.exit.width,h=this.exit.height,this.exit.x=o/2+n,this.exit.y=h/2+n)),this.score&&(o=190,h=64,this.size===this.landSize?("header-score-land.png"!==this.score.frameName&&this.setTexture(this.score,"header-score-land.png"),this.score.x=this.score.width/2+15*e,this.score.y=s/2/e-2*h*e,this.scoreLabel.x=this.score.x*e,this.scoreLabel.y=(this.score.y+27)*e,this.scoreTime&&(this.scoreTime.frameName!=="header-"+this.scoreType+"-land.png"&&this.setTexture(this.scoreTime,"header-"+this.scoreType+"-land.png"),this.scoreTime.x=this.score.width/2+15*e,this.scoreTime.y=s/2/e+2*h*e,this.scoreTimeLabel.x=this.scoreTime.x*e,this.scoreTimeLabel.y=(this.scoreTime.y+27)*e)):("header-score-port.png"!==this.score.frameName&&this.setTexture(this.score,"header-score-port.png"),this.score.x=a/2/e-o*e,this.score.y=h/2+n,this.scoreLabel.x=(this.score.x+25)*e,this.scoreLabel.y=(this.score.y+6)*e,this.scoreTime&&(this.scoreTime.frameName!=="header-"+this.scoreType+"-port.png"&&this.setTexture(this.scoreTime,"header-"+this.scoreType+"-port.png"),this.scoreTime.x=a/2/e+o*e,this.scoreTime.y=h/2+n,this.scoreTimeLabel.x=(this.scoreTime.x+25)*e,this.scoreTimeLabel.y=(this.scoreTime.y+6)*e)),this.scoreLabel.fontSize=Math.floor(38*e),this.scoreTimeLabel&&(this.scoreTimeLabel.fontSize=Math.floor(38*e))),this.health&&this.health.length)if(o=this.health[0].width,h=this.health[0].height,this.size===this.landSize)for(var r=0;r<this.health.length;r++)this.health[r].x=this.size.width/2-o/2,this.health[r].y=s/2/e-h+r*h*5/4;else for(r=0;r<this.health.length;r++)this.health[r].x=a/2/e-o+r*o*5/4,this.health[r].y=this.size.height/2-h/2},HeaderGroup.prototype.enable=function(e){if("header-option.png"===e)this.optionBg=this.addSprite("header-option-bg.png",0,0),this.optionBg.kill(),this.optionSound=this.addSprite("header-option-sound.png",0,0),this.optionSound.inputEnabled=!0,this.optionSound.input.useHandCursor=!0,this.optionBg.addChild(this.optionSound),this.optionFullscreen=this.addSprite("header-option-fullscreen.png",0,0),this.optionFullscreen.inputEnabled=!0,this.optionFullscreen.input.useHandCursor=!0,this.optionFullscreen.events.onInputDown.add(this.onFullscreen,this),this.optionBg.addChild(this.optionFullscreen),this.optionReset=this.addSprite("header-option-reset.png",0,0),this.optionReset.inputEnabled=!0,this.optionReset.input.useHandCursor=!0,this.optionBg.addChild(this.optionReset),this.optionReset.kill(),this.option=this.addSprite(e,0,0),this.option.inputEnabled=!0,this.option.input.useHandCursor=!0;else if("header-health.png"===e){this.health=[];for(var t=0;t<3;t++)this.health[t]=this.addSprite("header-health.png",0,0),this.health[t].inputEnabled=!0,this.health[t].input.useHandCursor=!0}else if("header-score.png"===e||"header-time.png"===e||"header-bug.png"===e){this.scoreType="header-bug.png"===e?"bug":"header-time.png"===e?"time":"score",this.score=this.addSprite("header-"+this.scoreType+"-land.png",0,0),this.score.inputEnabled=!0,this.score.input.useHandCursor=!0;var i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5)}else if("header-time-score.png"===e||"header-health-score.png"===e){this.scoreType="header-time-score.png"===e?"time":"health",this.scoreTime=this.addSprite("header-"+this.scoreType+"-land.png",0,0),this.scoreTime.inputEnabled=!0,this.scoreTime.input.useHandCursor=!0;i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreTimeLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5),this.score=this.addSprite("header-score-land.png",0,0),this.score.inputEnabled=!0,this.score.input.useHandCursor=!0;i={fill:"#ffffff",font:dataStorage.fontHeader};(this.scoreLabel=this.game.add.text(0,0,"",i)).anchor.set(.5,.5)}else if("header-exit.png"===e)this.exit=this.addSprite(e,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-quack.png"===e)this.exit=this.addSprite(e,0,0),this.exit.inputEnabled=!0,this.exit.input.useHandCursor=!0;else if("header-ad.png"===e);else if("header-info.png"===e){var a=this.info=this.addSprite("header-info.png",0,0);a.inputEnabled=!0,a.input.useHandCursor=!0}},HeaderGroup.prototype.onFullscreen=function(){this.game.scale.isFullScreen?(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart,this.game.scale.stopFullScreen()):(this.optionFullscreen.frame=this.optionFullscreen.spritesheetStart+1,this.game.scale.startFullScreen(!1)),this.state.popupGroup.dim.kill()},HeaderGroup.prototype.showOption=function(){this.game.world.bringToTop(this),this.scoreLabel&&this.scoreLabel.bringToTop(),this.game.scale.isFullScreen?this.setTexture(this.optionFullscreen,"header-option-fullscreen-active.png"):this.setTexture(this.optionFullscreen,"header-option-fullscreen.png"),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"),this.optionBg.scale.set(0),this.optionBg.revive();this.game.add.tween(this.optionBg.scale).to({x:1,y:1},500,Phaser.Easing.Back.InOut,!0),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!0)},HeaderGroup.prototype.hideOption=function(){this.game.add.tween(this.optionBg.scale).to({x:0,y:0},500,Phaser.Easing.Back.InOut,!0).onComplete.addOnce(function(){this.optionBg.kill()},this),this.game.physics&&this.game.physics.arcade&&(this.game.physics.arcade.isPaused=!1)},HeaderGroup.prototype.select=function(e){e===this.optionSound&&(dataStorage.setAudio(!dataStorage.isAudio),dataStorage.isAudio?this.setTexture(this.optionSound,"header-option-sound-active.png"):this.setTexture(this.optionSound,"header-option-sound.png"))},HeaderGroup.prototype.setScore=function(e){this.scoreLabel&&(this.scoreLabel.text=e)},HeaderGroup.prototype.setTime=function(e){this.scoreTimeLabel&&(this.scoreTimeLabel.text=e)},playLogic={row:3,col:3,init:function(e,t,i){this.grid=e,this.time=t,this.rnd=i,this.winMultipliers||(this.winMultipliers=[[[79,78,77,40,41,42,43,44,30,21,22,23,24],[69,68,67,30,31,32,33,34,20,11,12,13,14]],[[89,88,87,51,52,53,54,65,51,31,32,33,34],[79,78,77,40,41,42,43,44,30,21,22,23,24]]]),this.aiWinCount||(this.aiWinCount=[0,0,0])},start:function(e){this.gameOver=!1,this.rnd.sow([this.time.time]),playState.trainAI&&(this.wins||(this.wins=0));for(var t=0;t<3;t++)for(var i=0;i<3;i++){var a=this.grid.cells[t][i];if(a.weights)for(var s=0;s<2;s++)a.weights[s][0]=a.weights[s][1]=0,a.totalWeights[s][0]=a.totalWeights[s][1]=0,a.weight=0;else a.weights=[[0,0],[0,0]],a.totalWeights=[[0,0],[0,0]],a.weight=0}},updateMultipliers:function(e){this.aiWinCount[e-1]++,console.log("Winners "+this.aiWinCount)},turn:function(e){if(!this.gameOver){var t,i;for(i=0;i<3;i++)for(t=0;t<3;t++){var a=this.grid.cells[i][t];a.weight=0;for(var s=0;s<2;s++)a.weights[0][s]=a.weights[1][s]=0,a.totalWeights[0][s]=a.totalWeights[1][s]=0}return this.bestMove(e)}},rand:function(e){for(var t=e.length-1;t>=0;t--){var i=this.rnd.integerInRange(0,t),a=e[t];e[t]=e[i],e[i]=a}return e},calcBoards:function(e,t){this.matchFreeCell(e,t),this.matchRow(e,t),this.match2ToRow(e,t),this.matchFreeRow(e,t)},matchFreeCell:function(e,t){var i,a,s=this.grid.cells;for(a=0;a<3;a++)for(i=0;i<3;i++){var o=s[a][i];0===o.val?o.isFree=1:o.isFree=0}},matchRow:function(e,t){var i,a,s,o=this.grid.cells;for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatchRow)for(i=0;i<2;i++)h.isMatchRow[i]=0;else h.isMatchRow=[0,0]}for(i=0;i<2;i++){var h,n=i+1;0===(h=(o=this.grid.cells)[0][0]).val&&(o[0][1].val===n&&o[0][2].val===n&&h.isMatchRow[i]++,o[1][0].val===n&&o[2][0].val===n&&h.isMatchRow[i]++,o[1][1].val===n&&o[2][2].val===n&&h.isMatchRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val===n&&o[0][2].val===n&&h.isMatchRow[i]++,o[1][1].val===n&&o[2][1].val===n&&h.isMatchRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val===n&&o[0][1].val===n&&h.isMatchRow[i]++,o[1][2].val===n&&o[2][2].val===n&&h.isMatchRow[i]++,o[1][1].val===n&&o[2][0].val===n&&h.isMatchRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val===n&&o[1][2].val===n&&h.isMatchRow[i]++,o[0][0].val===n&&o[2][0].val===n&&h.isMatchRow[i]++),0===(h=o[1][1]).val&&(o[0][1].val===n&&o[2][1].val===n&&h.isMatchRow[i]++,o[1][0].val===n&&o[1][2].val===n&&h.isMatchRow[i]++,o[0][0].val===n&&o[2][2].val===n&&h.isMatchRow[i]++,o[0][2].val===n&&o[2][0].val===n&&h.isMatchRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val===n&&o[1][1].val===n&&h.isMatchRow[i]++,o[0][2].val===n&&o[2][2].val===n&&h.isMatchRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val===n&&o[1][0].val===n&&h.isMatchRow[i]++,o[2][1].val===n&&o[2][2].val===n&&h.isMatchRow[i]++,o[1][1].val===n&&o[0][2].val===n&&h.isMatchRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val===n&&o[2][2].val===n&&h.isMatchRow[i]++,o[1][1].val===n&&o[0][1].val===n&&h.isMatchRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val===n&&o[2][1].val===n&&h.isMatchRow[i]++,o[0][2].val===n&&o[1][2].val===n&&h.isMatchRow[i]++,o[0][0].val===n&&o[1][1].val===n&&h.isMatchRow[i]++)}},match2ToRow:function(e,t){var i,a,s,o=this.grid.cells;for(s=0;s<3;s++)for(a=0;a<3;a++){if((h=o[s][a]).isMatch2ToRow)for(i=0;i<2;i++)h.isMatch2ToRow[i]=0;else h.isMatch2ToRow=[0,0]}for(i=0;i<2;i++){var h,n=i+1;0===(h=(o=this.grid.cells)[0][0]).val&&(o[0][1].val!==n&&o[0][2].val!==n||0!==o[0][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][0].val!==n&&o[2][0].val!==n||0!==o[1][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++,o[1][1].val!==n&&o[2][2].val!==n||0!==o[1][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[0][1]).val&&(o[0][0].val!==n&&o[0][2].val!==n||0!==o[0][0].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==n&&o[2][1].val!==n||0!==o[1][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++),0===(h=o[0][2]).val&&(o[0][0].val!==n&&o[0][1].val!==n||0!==o[0][0].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++,o[1][2].val!==n&&o[2][2].val!==n||0!==o[1][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==n&&o[2][0].val!==n||0!==o[1][1].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][0]).val&&(o[1][1].val!==n&&o[1][2].val!==n||0!==o[1][1].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==n&&o[2][0].val!==n||0!==o[0][0].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][1]).val&&(o[1][0].val!==n&&o[1][2].val!==n||0!==o[1][0].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][1].val!==n&&o[2][1].val!==n||0!==o[0][1].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][0].val!==n&&o[2][2].val!==n||0!==o[0][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[0][2].val!==n&&o[2][0].val!==n||0!==o[0][2].val&&0!==o[2][0].val||h.isMatch2ToRow[i]++),0===(h=o[1][2]).val&&(o[1][0].val!==n&&o[1][1].val!==n||0!==o[1][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==n&&o[2][2].val!==n||0!==o[0][2].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][0]).val&&(o[0][0].val!==n&&o[1][0].val!==n||0!==o[0][0].val&&0!==o[1][0].val||h.isMatch2ToRow[i]++,o[2][1].val!==n&&o[2][2].val!==n||0!==o[2][1].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==n&&o[0][2].val!==n||0!==o[1][1].val&&0!==o[0][2].val||h.isMatch2ToRow[i]++),0===(h=o[2][1]).val&&(o[2][0].val!==n&&o[2][2].val!==n||0!==o[2][0].val&&0!==o[2][2].val||h.isMatch2ToRow[i]++,o[1][1].val!==n&&o[0][1].val!==n||0!==o[1][1].val&&0!==o[0][1].val||h.isMatch2ToRow[i]++),0===(h=o[2][2]).val&&(o[2][0].val!==n&&o[2][1].val!==n||0!==o[2][0].val&&0!==o[2][1].val||h.isMatch2ToRow[i]++,o[0][2].val!==n&&o[1][2].val!==n||0!==o[0][2].val&&0!==o[1][2].val||h.isMatch2ToRow[i]++,o[0][0].val!==n&&o[1][1].val!==n||0!==o[0][0].val&&0!==o[1][1].val||h.isMatch2ToRow[i]++)}},matchFreeRow:function(e,t){var i,a,s=this.grid.cells;for(a=0;a<3;a++)for(i=0;i<3;i++){s[a][i].isMatchFreeRow=0}for(i=0;i<3;i++)0===s[i][0].val&&0===s[i][1].val&&0===s[i][2].val&&(s[i][0].isMatchFreeRow++,s[i][1].isMatchFreeRow++,s[i][2].isMatchFreeRow++);for(i=0;i<3;i++)0===s[0][i].val&&0===s[1][i].val&&0===s[2][i].val&&(s[0][i].isMatchFreeRow++,s[1][i].isMatchFreeRow++,s[2][i].isMatchFreeRow++);0===s[0][0].val&&0===s[1][1].val&&0===s[2][2].val&&(s[0][0].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][2].isMatchFreeRow++),0===s[0][2].val&&0===s[1][1].val&&0===s[2][0].val&&(s[0][2].isMatchFreeRow++,s[1][1].isMatchFreeRow++,s[2][0].isMatchFreeRow++)},fuzzyBoard:function(e,t){this.calcBoards();for(var i=this.grid.cells,a=0;a<2;a++){var s,o,h=this.winMultipliers[a][t];for(o=0;o<3;o++)for(s=0;s<3;s++){var n=i[o][s];if(0===n.val){var r=0,l=0;1===n.isMatchRow[a]?(r=Math.max(h[0],r),l+=h[0]):2===n.isMatchRow[a]?(r=Math.max(h[1],r),l+=h[1]):3===n.isMatchRow[a]&&(r=Math.max(h[2],r),l+=h[2]),1===n.isMatch2ToRow[a]?(r=Math.max(h[3],r),l+=h[3]):2===n.isMatch2ToRow[a]?(r=Math.max(h[4],r),l+=h[4]):3===n.isMatch2ToRow[a]?(r=Math.max(h[5],r),l+=h[5]):4===n.isMatch2ToRow[a]?(r=Math.max(h[6],r),l+=h[6]):5===n.isMatch2ToRow[a]&&(r=Math.max(h[7],r),l+=h[7]),n.isCellToBoard&&(r=Math.max(h[8],r),l+=h[8]),1===n.isMatchFreeRow?(r=Math.max(h[9],r),l+=h[9]):2===n.isMatchFreeRow?(r=Math.max(h[10],r),l+=h[10]):3===n.isMatchFreeRow?(r=Math.max(h[11],r),l+=h[11]):4===n.isMatchFreeRow&&(r=Math.max(h[12],r),l+=h[12]),r=Math.max(1,r),n.weights[t][a]=r,n.totalWeights[t][a]=l}}}return i},boardWeight:function(e,t,i,a,s){var o,h,n=0,r=this.grid.cells;if(this.grid.solvedBoards[t][e]>=1&&this.grid.solvedBoards[t][e]<=3)return r[0][0].weight;for(h=0;h<3;h++)for(o=0;o<3;o++)r[h][o].weights[s][i-1]>n&&(n=r[h][o].weights[s][i-1]),r[h][o].weights[s][a-1]>n&&(n=r[h][o].weights[s][a-1]);return n},winBoard:function(e,t,i){var a,s;for(s=0;s<3;s++)for(a=0;a<3;a++){var o=t[s][a];if(0===o.val&&o.isMatchRow[e-1]>0)return o}return null},easyMove:function(e,t){var i,a,s=this.fuzzyBoard(e,0);for(a=0;a<3;a++)for(i=0;i<3;i++)s[a][i].weights[0][e-1]>=s[a][i].weights[0][t-1]?(s[a][i].weight=s[a][i].weights[0][e-1],s[a][i].totalWeight=s[a][i].totalWeights[0][e-1]):s[a][i].weights[0][t-1]>0&&(s[a][i].weight=s[a][i].weights[0][t-1],s[a][i].totalWeight=s[a][i].totalWeights[0][t-1]);return this.randBestWeight(e,t,s)},randBestWeight:function(e,t,i){var a,s,o=0;for(s=0;s<3;s++)for(a=0;a<3;a++)0===i[s][a].val&&i[s][a].weight>o&&(o=i[s][a].weight,a,s);var h=0;if(2===e){var n=Math.floor((this.time.time-playState.startTime)/1e3);o-=this.rnd.integerInRange(0,n/2+5)}for(s=0;s<3;s++)for(a=0;a<3;a++){var r=i[s][a];0===i[s][a].val&&r.weight>=o&&h++}var l,p=this.rnd.integerInRange(0,h-1);for(s=0;s<3&&p>=0;s++)for(a=0;a<3&&p>=0;a++){r=i[s][a];0===i[s][a].val&&r.weight>=o&&(p--,a,s,l=i[s][a])}return l},bestMove:function(e){var t=e,i=1===t?2:1,a=mainState.level;return playState.trainAI&&(a=1===e?playState.trainAIPlayerSkill:playState.trainAICPUSkill),"EASY"===a?this.easyMove(t,i):"FAIR"===a?this.easyMove(t,i):"HARD"===a?this.easyMove(t,i):void alert("Level is too high for me!")}},playGrid={board:null,levels:[{title:"Snake 2",effect:"none",health:0,image:"snakebite.png",desc:"Eat germs, grow bigger and don't run into yourself.",time:0,virus:0,bacteria:0,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 2",effect:"none",health:0,image:"virus0.png",desc:"Flu season begins. Eat 6 germs.",time:0,virus:6,bacteria:0,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 3",effect:"none",health:0,image:"play-block.png",desc:"Some cells are impassable.",time:0,virus:6,bacteria:0,fungus:0,pepper:0,blocks:[{x:0,y:-.2},{x:0,y:.2},{x:0,y:-.35},{x:0,y:.35}],holes:[]},{title:"Day 4",effect:"none",health:0,image:"bacteria0.png",desc:"Bacteria on the move.",time:0,virus:0,bacteria:6,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 5",effect:"none",health:0,image:"header-time-land.png",desc:"Eat all before the day is over.",time:24,virus:3,bacteria:3,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 6",effect:"none",health:0,image:"fungus0.png",desc:"Grind fungus in pieces.",time:0,virus:0,bacteria:0,fungus:4,pepper:0,blocks:[],holes:[]},{title:"Day 7",effect:"none",health:0,image:"pepper0.png",desc:"Avoid peppers! They are explosive.",time:0,virus:6,bacteria:2,fungus:0,pepper:1,blocks:[],holes:[]},{title:"Day 8",effect:"none",health:50,image:"centre.png",desc:"Eat germs fast to stay healthy.",time:0,virus:4,bacteria:4,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 9",effect:"none",health:0,image:"hole.png",desc:"Avoid holes in the ground.",time:0,virus:4,bacteria:3,fungus:0,pepper:0,blocks:[],holes:[{x:0,y:-.2},{x:0,y:.2}]},{title:"Day 10",effect:"none",health:0,image:"snakebite.png",desc:"Don't bite your tail.\nIt's a HARD day.",time:0,virus:16,bacteria:4,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 11",effect:"none",health:0,image:"fungus0.png",desc:"A mob of fungus. 3rd week in flu season.",time:0,virus:0,bacteria:0,fungus:4,pepper:2,blocks:[],holes:[]},{title:"Day 12",effect:"none",health:0,image:"hole.png",desc:"Peril on the borders.",time:0,virus:3,bacteria:3,fungus:1,pepper:0,blocks:[],holes:[{x:-.43,y:-.4},{x:.43,y:-.4},{x:-.43,y:.4},{x:.43,y:.4}]},{title:"Day 13",effect:"none",health:0,image:"header-time-land.png",desc:"Prevail a day.",time:24,virus:4,bacteria:4,fungus:2,pepper:0,blocks:[],holes:[]},{title:"Day 14",effect:"none",health:0,image:"bacteria0.png",desc:"Don't drive germs to holes.",time:0,virus:3,bacteria:3,fungus:2,pepper:0,blocks:[],holes:[{x:-.43,y:-.4},{x:-.35,y:-.3},{x:-.43,y:-.3},{x:-.35,y:-.4},{x:.43,y:.4},{x:.35,y:.3},{x:.43,y:.3},{x:.35,y:.4}]},{title:"Day 15",effect:"none",health:70,image:"centre.png",desc:"Take care of health.\nIt's a HARD day.",time:0,virus:4,bacteria:4,fungus:1,pepper:0,blocks:[{x:-.25,y:-.25},{x:.25,y:-.25},{x:-.25,y:.25},{x:.25,y:.25}],holes:[]},{title:"Day 16",effect:"none",health:0,image:"play-block.png",desc:"Divided by the blocks.",time:0,virus:3,bacteria:3,fungus:1,pepper:0,blocks:[{x:0,y:-.2},{x:0,y:.2},{x:0,y:-.3},{x:0,y:.3},{x:0,y:-.4},{x:0,y:.4}],holes:[]},{title:"Day 17",effect:"none",health:0,image:"pepper0.png",desc:"Dangerous peppers.",time:0,virus:3,bacteria:3,fungus:0,pepper:3,blocks:[],holes:[]},{title:"Day 18",effect:"none",health:75,image:"centre.png",desc:"Blocks on your health.",time:0,virus:4,bacteria:4,fungus:2,pepper:0,blocks:[{x:0,y:-.3},{x:0,y:.3},{x:.3,y:-.3},{x:-.3,y:.3}],holes:[]},{title:"Day 19",effect:"none",health:0,image:"header-time-land.png",desc:"Hurry up. Flu season almost over.",time:24,virus:12,bacteria:0,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 20",effect:"none",health:0,image:"hole.png",desc:"Battle on the edge.\nIt's a HARD day.",time:0,virus:3,bacteria:3,fungus:3,pepper:0,blocks:[],holes:[{x:0,y:-.2},{x:0,y:.2},{x:0,y:-.3},{x:0,y:.3},{x:0,y:-.4},{x:0,y:.4}]},{title:"Day 21",effect:"none",health:0,image:"snakebite.png",desc:"Last week in flu season.",time:0,virus:4,bacteria:4,fungus:1,pepper:1,blocks:[],holes:[]},{title:"Day 22",effect:"none",health:55,image:"centre.png",desc:"A very crowded room. Just 3 days to fight.",time:0,virus:12,bacteria:3,fungus:0,pepper:0,blocks:[],holes:[]},{title:"Day 23",effect:"none",health:0,image:"snakebite.png",desc:"Last common cold day.",time:0,virus:5,bacteria:5,fungus:2,pepper:0,blocks:[{x:0,y:-.3},{x:0,y:.3}],holes:[]},{title:"Day 24",effect:"none",health:0,image:"snakebite.png",desc:"Flu season is about to end.",time:0,virus:5,bacteria:5,fungus:2,pepper:1,blocks:[],holes:[]},{title:"Day 25",effect:"none",health:0,image:"header-time-land.png",desc:"One more day to healthy Xmas.",time:24,virus:4,bacteria:4,fungus:2,pepper:1,blocks:[],holes:[{x:0,y:-.3},{x:0,y:.3}]}],init:function(e){this.rnd=e,this.width=this.height=3},start:function(e){this.rnd.sow([e])},setBoard:function(e){this.board=this.cells},shuffle:function(e){var t;switch(e.level){case 0:e.cols=2,e.rows=2,t=[[[1,2],[3,0]],[[3,0],[1,2]],[[1,3],[0,2]],[[2,0],[3,1]]];break;case 1:e.cols=3,e.rows=2,t=[[[4,2,1],[5,3,0]],[[1,4,0],[3,5,2]],[[5,3,1],[2,0,4]],[[1,5,4],[0,2,3]],[[5,0,3],[4,2,1]]];break;case 2:e.cols=4,e.rows=2,t=[[[4,2,1,6],[7,3,0,5]],[[3,4,7,6],[1,5,2,0]],[[7,0,6,1],[2,3,4,5]],[[7,4,6,1],[0,5,3,2]],[[5,7,3,0],[4,2,1,6]]];break;case 3:e.cols=3,e.rows=3,t=[[[2,0,1],[4,5,3],[8,6,7]],[[7,3,6],[1,8,4],[2,0,5]],[[8,7,1],[5,2,4],[0,3,6]],[[5,7,3],[2,0,6],[4,8,1]],[[7,5,6],[8,2,0],[4,3,1]]];break;case 4:e.cols=4,e.rows=3,t=[[[2,0,1,9],[4,5,3,11],[6,8,7,10]],[[9,3,6,7],[1,10,4,8],[2,11,5,0]],[[8,7,1,2],[5,11,4,0],[10,3,6,9]],[[5,7,3,0],[11,9,10,6],[4,8,1,2]],[[7,5,11,4],[10,2,0,8],[9,3,1,6]]];break;case 5:e.cols=5,e.rows=3,t=[[[12,0,1,9,2],[14,5,13,11,3],[6,8,7,10,4]],[[9,3,6,12,7],[1,10,4,8,14],[2,11,5,0,13]],[[8,7,1,2,12],[14,11,4,13,0],[10,3,6,9,5]],[[13,7,3,0,9],[11,12,10,6,5],[14,8,1,2,4]],[[7,5,11,4,8],[10,14,0,12,3],[9,13,1,6,2]]];break;case 6:e.cols=4,e.rows=4,t=[[[6,13,5,15],[14,9,12,3],[4,11,2,7],[0,10,8,1]],[[6,13,5,15],[14,9,12,3],[4,11,2,7],[0,10,8,1]],[[8,11,15,6],[2,7,13,1],[9,12,3,0],[14,4,10,5]],[[7,8,5,14],[13,15,9,6],[3,12,2,4],[10,1,0,11]],[[5,3,6,13],[15,11,4,0],[12,14,1,10],[8,7,2,9]]];break;case 7:e.cols=5,e.rows=4,t=[[[6,18,5,16,15],[17,14,12,9,3],[11,4,2,7,13],[19,10,8,1,0]],[[16,13,19,15,6],[14,9,12,3,7],[4,11,2,17,8],[0,10,18,1,5]],[[8,11,15,6,16],[19,7,13,18,0],[9,12,3,17,1],[14,4,10,5,2]],[[7,17,5,14,18],[13,15,9,6,19],[3,12,16,4,11],[10,1,0,2,8]],[[18,3,19,13,1],[15,11,4,0,14],[12,17,16,10,5],[8,7,2,9,6]]];break;case 8:e.cols=6,e.rows=4,t=[[[20,18,21,16,15,6],[17,14,12,3,9,5],[22,11,23,7,13,4],[19,10,8,1,0,2]],[[16,13,19,15,6,20],[14,9,12,3,7,21],[4,11,23,17,8,0],[22,10,18,1,5,2]],[[23,11,15,20,16,6],[19,7,13,18,22,9],[21,12,3,17,1,0],[14,4,10,5,2,8]],[[7,17,20,21,18,2],[13,15,9,23,19,14],[22,12,16,4,11,3],[10,1,0,5,8,6]],[[18,23,19,13,12,22],[15,11,20,0,14,1],[21,17,16,10,5,4],[8,7,2,9,6,3]]];break;case 9:e.cols=5,e.rows=5,t=[[[6,18,5,16,24],[17,14,22,9,3],[21,4,2,23,13],[19,10,8,20,0],[1,11,12,7,15]],[[16,13,19,15,23],[14,22,12,3,20],[4,11,21,17,8],[0,24,18,1,5],[7,2,9,6,10]],[[8,11,15,6,16],[19,21,13,18,23],[22,12,3,17,20],[14,4,10,5,2],[1,7,24,0,9]],[[7,17,24,14,18],[13,20,9,6,19],[23,12,16,21,11],[10,1,0,2,22],[15,4,8,3,5]],[[18,23,19,13,1],[15,11,24,20,14],[22,17,16,10,5],[8,21,2,9,6],[0,7,12,4,3]]]}return t}};var snakebite,turntime,snakespeed,snakeagility,mines,snakeSection=[],snakePath=[],numSnakeSections=100,snakeSpacer=7,dayTimer=500,createMine=0,createMineTimer=25,healthTimer=150,upgradeSpeed=0,upgradeLives=0,upgradeAgility=0,upgradeTurning=0,isDown=!1,moveDir=1,turn=-turntime,hitBoundsTimer=0,blink=0,playState={spriteAtlas:"atlas",level:0,feedbackNo:0,feedback:["Superb!","Perfect!","Excellent!","Brilliant!","Amazing!","Wonderful!","Fantastic!","Outstanding!"],upgrade:!1,resize:function(){this.orientation;var e=this.game.width>this.game.height?1:2;this.orientation!==e&&(this.backToMenu(),this.orientation=3);var t=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});this.helpText&&(this.helpText.fontSize=128*t),this.resizeSprites(t);var i=this.boardGroup.x+snakeHead.width*t/2,a=this.boardGroup.y+snakeHead.height*t/2,s=1080*t-snakeHead.width*t,o=720*t-snakeHead.height*t;1===e?this.game.physics.arcade.setBounds(i,a,s,o):this.game.physics.arcade.setBounds(i,a,o,s)},resizeSprites:function(e){var t=snakeHead.width*e*.66,i=snakeHead.height*e*.66,a=(snakeHead.width-t)/2,s=(snakeHead.height-i)/2;snakeHead.body.setSize(t,i,a,s),this.boardGroup.children.forEach(function(t){if(t.body&&t!==snakeHead){var i=t.width*e*.66,a=t.height*e*.66,s=(t.width-i)/2,o=(t.height-a)/2;t.body.setSize(i,a,s,o)}},this),this.boardGroup.foeGroup.children.forEach(function(e){if(e.body){var t=(e.width+snakebite)*playState.boardGroup.scale.x*.66,i=(e.height+snakebite)*playState.boardGroup.scale.y*.66,a=(e.width-t)/2,s=(e.height-i)/2;e.body.setSize(t,i,a,s)}},this)},init:function(){this.game.input.touch.preventDefault=!0,this.bulpSound=1,this.collidePlaying=0,this.tutorial=mainState.score>0?0:1,this.orientation=this.game.width>this.game.height?1:2,snakebite=2*upgradeLives,turntime=27-upgradeAgility,snakespeed=325+5*upgradeSpeed,snakeagility=85+5*upgradeTurning,this.bacteriaSpawn=0,this.virusSpawn=0,this.fungusSpawn=0,this.pepperSpawn=0,this.germEaten=0,this.mine=null},preload:function(){if(dataStorage.debug&&this.spriteAtlas)for(var e=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),t=0;t<e.length;t++){var i=e[t].name;this.cache.checkImageKey(i)||this.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){this.game.canvas.oncontextmenu=function(e){e.preventDefault()},this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(e,t){this.soundEffects.sounds[e].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.createBoard(),this.createSnake(),this.game.physics.arcade.isPaused=!0,this.createHeader(),this.createTutorial(),this.createPopup(),this.world.mask&&this.world.mask.destroy(),this.world.mask=null;if(this.helpText=this.add.text(0,0,"",{font:"128px",fill:"#000000",wordWrap:!1,fontWeight:"bold",align:"center",backgroundColor:"#ffff00"}),this.helpText.anchor.set(.5),this.helpText.kill(),this.countSprite=this.boardGroup.addSprite("number-3.png",0,.2).kill(),this.startedCoundDown=!1,this.start(),this.effectGroup=new EffectGroup(this.game,{width:720,height:720},{width:720,height:720}),this.effectGroup.enable("explosion"),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.tutorial)this.showTutorial();else{var e=playGrid.levels[mainState.score].desc;this.popupGroup.showInfo(playGrid.levels[mainState.score].title,e,"HIT TO START",0,this,this.startCountdown,!1,playGrid.levels[mainState.score].image)}this.inputLockTime=this.time.time+500},start:function(){this.spaceKey=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]),hitBoundsTimer=10,this.isGameOver=!1,this.passed=!1,this.stage.backgroundColor="#000000",this.countdown=0,this.hasEatenBug=!1,this.game.onPause.add(this.onPaused,this),this.game.onResume.add(this.onResumed,this)},onPaused:function(){this.orientation=4,this.backToMenu()},onResumed:function(){},stopCountdown:function(){if(this.hasEatenBug&&(this.startTime+=750,this.hasEatenBug=!1,this.countdown++),this.countdown){if(this.countdown--,1===this.countdown)return;switch(this.countSprite.alpha=1,this.countdown){case 4:this.countSprite.revive(),this.boardGroup.setTexture(this.countSprite,"number-3.png");break;case 3:this.boardGroup.setTexture(this.countSprite,"number-2.png");break;case 2:this.boardGroup.setTexture(this.countSprite,"number-1.png")}this.add.tween(this.countSprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0)}else this.countdown=5,dataStorage.isAudio&&this.soundEffects.play("countdown");this.countdown>1&&this.time.events.add(750,function(){this.stopCountdown()},this)},startCountdown:function(){if(this.countdown){if(this.countdown--,1===this.countdown)return this.game.physics.arcade.isPaused=!1,void(this.startTime=this.time.time);switch(this.countSprite.alpha=1,this.countdown){case 4:this.countSprite.revive(),this.boardGroup.setTexture(this.countSprite,"number-3.png");break;case 3:this.boardGroup.setTexture(this.countSprite,"number-2.png");break;case 2:this.boardGroup.setTexture(this.countSprite,"number-1.png"),dataStorage.isAudio&&this.time.events.add(500,function(){this.music=this.game.add.audio("play-music"),this.music.loopFull(.25)},this)}this.add.tween(this.countSprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0)}else this.countdown=5;this.countdown>1&&this.time.events.add(750,function(){this.startCountdown()},this)},resume:function(){this.popupGroup.pausedTime&&(this.pausedTime=this.time.time-this.popupGroup.pausedTime,this.startTime+=this.pausedTime),this.game.physics.arcade.isPaused=!1},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("info"),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog-quit.png")},createTutorial:function(){this.tutorialGroup=new TutorialGroup(this.game,{width:this.game.width,height:this.game.height}),this.tutorialGroup.enable("popup-hand.png")},update:function(){if(blink++,this.boardGroup.foeGroup.forEach(function(e){1===this.rnd.integerInRange(1,100)&&(3===e.type&&(e.animations.play("virus-blink",10,!1),e.animations.currentAnim.onComplete.add(function(){e.animations.play("virus",15,!0)},this)),2===e.type&&(e.animations.play("bacteria-blink",10,!1),e.animations.currentAnim.onComplete.add(function(){e.animations.play("bacteria",15,!0)},this)))},this),200===blink?this.boardGroup.setTexture(snakeHead,"snakehead2.png"):210===blink&&(this.boardGroup.setTexture(snakeHead,"snakehead.png"),blink=0),this.game.debug.renderPhysicsBody&&this.game.debug.renderPhysicsBody(snakeHead.body),this.popupGroup.visible||this.game.physics.arcade.isPaused?snakeHead.body.enable&&(snakeHead.body.enable=!1):(this.updateSnake(),snakeHead.body.enable||(snakeHead.body.enable=!0)),!(this.inputLockTime>=this.time.time||this.world.mask)&&this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame){var e=this.game.input.activePointer;if(e.targetObject){var t=e.targetObject.sprite;if(this.tutorialGroup.visible)return void(1===this.tutorialGroup.step?(this.inputLockTime=this.time.time+750,t===this.tutorialGroup.handTarget()&&this.tutorialGroup.nextStep("HOW TO PLAY\n2 / 2\nSelect missing number.",this.controls[0],this.controlGroup)):t===this.tutorialGroup.handTarget()&&(this.tutorialGroup.nextStep("That was tutorial.\n\nNow fill the rest."),this.tutorialGroup.hand.kill(),this.time.events.add(4*Phaser.Timer.SECOND,function(){this.tutorialGroup.hide(),this.inputLockTime=this.time.time+500},this)));this.popupGroup.visible?t===this.popupGroup.quit?(this.inputLockTime=this.time.time+1e3,this.backToMenu()):t!==this.popupGroup.dialogBg&&(this.inputLockTime=this.time.time+1e3,this.popupGroup.hide()):t===this.headerGroup.exit?(this.inputLockTime=this.time.time+750,this.popupGroup.showDialog("Are you sure to quit this game?",null,this,!0,!0)):t===this.headerGroup.score?(this.inputLockTime=this.time.time+750,this.popupGroup.showBanner("How many germs to eat.")):t===this.headerGroup.scoreTime&&(this.inputLockTime=this.time.time+750,this.popupGroup.showBanner("Time to complete this level."))}else this.tutorialGroup.visible&&this.showTutorial(),this.popupGroup.visible&&(this.inputLockTime=this.time.time+750,"explode"===playGrid.levels[mainState.score].effect&&playState.effectGroup.start(playState.popupGroup.getCenterX(this.popupGroup.infoSprite),playState.popupGroup.getCenterY(this.popupGroup.infoSprite),0,0),this.popupGroup.hide())}},backToMenu:function(){for(var e in this.texture=this.textureSprite=this.textureBg=this.textureBgSprite=null,this.boardTexture=null,PIXI.BaseTextureCache)delete PIXI.BaseTextureCache[e];for(var e in PIXI.TextureCache)delete PIXI.TextureCache[e];this.time.events.add(.1*Phaser.Timer.SECOND,function(){mainState.stage.backgroundColor="#000000",this.state.start("mainState")},this)},popupHidden:function(){this.isGameOver?this.time.events.add(750,function(){this.backToMenu()},this):(this.popupGroup.pausedTime&&(this.pausedTime=this.time.time-this.popupGroup.pausedTime,this.startTime+=this.pausedTime),this.game.physics.arcade.isPaused=!1)},createHeader:function(){this.headerGroup=new HeaderGroup(this.game,{width:175,height:0},{width:0,height:75},this),this.headerGroup.enable("header-exit.png"),playGrid.levels[mainState.score].time>0?(this.headerGroup.enable("header-time-score.png"),this.headerGroup.setTime("24:00"),this.headerGroup.setScore(playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus-this.germEaten)):playGrid.levels[mainState.score].health>0?(this.headerGroup.enable("header-health-score.png"),this.headerGroup.setTime("100"),this.headerGroup.setScore(playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus-this.germEaten)):(playGrid.levels[mainState.score].virus||playGrid.levels[mainState.score].bacteria>0||2*playGrid.levels[mainState.score].fungus>0)&&(this.headerGroup.enable("header-score.png"),this.headerGroup.setScore(playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus-this.germEaten))},createBoard:function(){this.boardGroup=new BoardGroup(this.game,{width:1080,height:720},{width:720,height:1080}),this.bg=this.boardGroup.addSprite("play-bg.png",0,0),this.game.width<this.game.height&&(this.bg.angle=90),playGrid.levels[mainState.score].blocks.forEach(function(e){var t,i;this.game.width>=this.game.height?(t=e.x,i=e.y):(t=e.y,i=e.x);var a=this.boardGroup.addSprite("play-block.png",t,i);this.game.physics.enable(a,Phaser.Physics.ARCADE),a.body.immovable=!0,a.isBlock=!0},this),playGrid.levels[mainState.score].holes.forEach(function(e){var t,i;this.game.width>=this.game.height?(t=e.x,i=e.y):(t=e.y,i=e.x);var a=this.boardGroup.addSprite("hole.png",t,i);this.game.physics.enable(a,Phaser.Physics.ARCADE),a.body.immovable=!0,a.isBlock=!0,a.isHole=!0},this),playGrid.levels[mainState.score].health>0&&(this.healthValue=0,healthTimer=0,this.centre=this.boardGroup.addSprite("centre.png",0,0),this.centre.alpha=1-this.healthValue/100||1),this.createPuzzle()},shutdown:function(){this.bg=this.boardBg=null,this.music&&this.music.stop()},gameOver:function(e){if(this.upgrade=!0,e){++this.feedbackNo>=this.feedback.length-1&&(this.feedbackNo=0),feedback=this.feedback[this.feedbackNo];var t=playService.getPlayer("me");playService.setScore(t.wins+1)}else feedback="Too many moves "+this.incorrectMove+".",icon="quack-sad.png",dataStorage.isAudio&&this.time.events.add(25,function(){},this);var i=feedback;0===mainState.score&&(i=playGrid.levels[mainState.score].desc),this.endGame(i),this.inputLockTime=this.time.time+1500},createPuzzle:function(e){},renderBoard:function(e){},renderBg:function(e){},addAnim:function(e){},createSnake:function(){var e,t=this.game;for(t.input.onDown.add(function(){isDown=!0}),t.input.onUp.add(function(){isDown=!1}),t.physics.startSystem(Phaser.Physics.ARCADE),snakeHead=this.boardGroup.addSprite("snakehead.png",0,0),this.bite=makeSprite(this.game,"snakebite.png"),this.bite.anchor.setTo(.5,.5),this.bite.alpha=0,snakeHead.addChild(this.bite),t.physics.enable(snakeHead,Phaser.Physics.ARCADE),t.width<t.height&&(snakeHead.angle=90),snakeHead.checkWorldBounds=!0,snakeHead.body.collideWorldBounds=!0,snakeHead.body.onWorldBounds=new Phaser.Signal,snakeHead.body.onWorldBounds.add(this.hitWorldBounds,this),e=1;e<=numSnakeSections-1;e++)snakeSection[e]=this.boardGroup.addSprite("snakebody.png",0,0),snakeSection[e].dontremovealpha=!0,snakeSection[e].x=snakeHead.x,snakeSection[e].y=snakeHead.y,e>2&&(snakeSection[e].alpha=0);for(snakeHead.bringToTop(),e=0;e<=numSnakeSections*snakeSpacer;e++)snakePath[e]=new Phaser.Point(t.world.centerX,t.world.centerY);mines=this.boardGroup.foeGroup,this.healthTimeValue=0;var i=this.healthTime=t.add.text(t.world.centerX/2,18,"");i.font="Georgia",i.fontSize=32,i.align="center",i.fill="#10df4a",i.stroke="#382F32",i.strokeThickness=1,i.anchor.set(.5),(i=this.health=t.add.text(3*t.world.centerX/2,18,"")).font="Georgia",i.fontSize=32,i.align="center",i.fill="#df104a",i.stroke="#382F32",i.strokeThickness=1,i.anchor.set(.5),t.input.keyboard.onDownCallback=function(e){isDown=!0},t.input.keyboard.onUpCallback=function(e){isDown=!1}},hitWorldBounds:function(e){dataStorage.isAudio&&this.collidePlaying<this.time.time-100&&(this.collidePlaying=this.time.time,this.soundEffects.play("collide")),hitBoundsTimer=10,snakeHead.alpha=.5;for(var t=1;t<=numSnakeSections-1&&0!==snakeSection[t].alpha;t++)snakeSection[t].alpha=.5},updateSnake:function(){snakeHead&&(this.game.physics.arcade.overlap(snakeHead,mines,ballHitBrick),ballHitBrick2()),this.boardGroup.children.forEach(function(e){e.isBlock&&playState.game.physics.arcade.collide(snakeHead,e,collideBlock,null,this)},this),this.boardGroup.foeGroup.children.forEach(function(e){e.isBlock&&playState.game.physics.arcade.collide(snakeHead,e,collideFungus,null,this)},this);var e=this.game;if(!this.isGameOver){for(var t=e.world.children.length-1;t>0;t--)tmp=e.world.children[t],tmp.alpha<=0&&!tmp.dontremovealpha&&tmp.destroy();var i=1;if(this.health){if(playGrid.levels[mainState.score].health>0&&(this.centre.alpha=1-this.healthValue/100||1,this.healthValue>=100))return void this.endGame("Eat germs faster to stay healthy.");++healthTimer>=playGrid.levels[mainState.score].health&&(healthTimer=0,this.healthValue+=mines.children.length,this.healthValue>100&&(this.healthValue=100)),this.healthTimeValue++;var a=Math.floor((playState.time.time-playState.startTime)/1e3);0===mainState.score?a=0:a*=60,playGrid.levels[mainState.score].time>0?(a>=1200&&(playState.startedCoundDown||(playState.hasEatenBug=!1,playState.startedCoundDown=!0,null!==mines.getFirstAlive()&&playState.showText.call(playState,null,"Hurry up!")),a>=1440&&(playState.passed=!0,a=1440)),i=0,a>960?this.virusSpawn<playGrid.levels[mainState.score].virus||this.bacteriaSpawn<playGrid.levels[mainState.score].bacteria||this.fungusSpawn<playGrid.levels[mainState.score].fungus||this.pepperSpawn<playGrid.levels[mainState.score].pepper?(i=1,createMine=0):i=0:(this.virusSpawn<playGrid.levels[mainState.score].virus||this.bacteriaSpawn<playGrid.levels[mainState.score].bacteria||this.fungusSpawn<playGrid.levels[mainState.score].fungus||this.pepperSpawn<playGrid.levels[mainState.score].pepper)&&(i=1),playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus===this.germEaten&&this.gameOver(!0)):playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+playGrid.levels[mainState.score].fungus>0&&(this.germEaten>=playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus&&this.gameOver(!0),this.virusSpawn>=playGrid.levels[mainState.score].virus&&this.bacteriaSpawn>=playGrid.levels[mainState.score].bacteria&&this.fungusSpawn>=playGrid.levels[mainState.score].fungus&&this.pepperSpawn>=playGrid.levels[mainState.score].pepper&&(i=0)),a=1440-a,playGrid.levels[mainState.score].health>0?this.headerGroup.setTime(Math.floor(100*this.centre.alpha)):this.headerGroup.setTime(formatTime(a))}if(this.filter,snakeHead){if(0===hitBoundsTimer);else if(0===--hitBoundsTimer){snakeHead.alpha=1;for(var s=1;s<=numSnakeSections-1&&0!==snakeSection[s].alpha;s++)snakeSection[s].alpha=1}snakeHead.body.velocity.copyFrom(e.physics.arcade.velocityFromAngle(snakeHead.angle,snakespeed));var o=snakePath.pop();o.setTo(snakeHead.x,snakeHead.y),snakePath.unshift(o);for(s=1;s<=numSnakeSections-1;s++)snakeSection[s].x=snakePath[s*snakeSpacer].x,snakeSection[s].y=snakePath[s*snakeSpacer].y;isDown?1===moveDir?(snakeHead.body.angularVelocity=3*-snakeagility,turn=-turntime):(snakeHead.body.angularVelocity=3*snakeagility,turn=0):(turn>0?(moveDir=1,snakeHead.body.angularVelocity=-snakeagility,turn>=turntime&&(turn=-turntime)):(moveDir=2,snakeHead.body.angularVelocity=snakeagility),turn++)}if(createMine--,!playState.passed&&mines&&(createMine<=0||null===mines.getFirstAlive())&&(i>0||null!==this.mine)){if(mainState.score>0){var h,n;if(null===this.mine){var r=playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+playGrid.levels[mainState.score].pepper+playGrid.levels[mainState.score].fungus-this.virusSpawn-this.bacteriaSpawn-this.pepperSpawn-this.fungusSpawn,l=e.rnd.integerInRange(1,r);playGrid.levels[mainState.score].bacteria-this.bacteriaSpawn>0&&l<=playGrid.levels[mainState.score].bacteria-this.bacteriaSpawn?(h=2,this.bacteriaSpawn++):playGrid.levels[mainState.score].pepper-this.pepperSpawn>0&&l<=playGrid.levels[mainState.score].bacteria+playGrid.levels[mainState.score].pepper-this.bacteriaSpawn-this.pepperSpawn?(h=1,this.pepperSpawn++):playGrid.levels[mainState.score].fungus-this.fungusSpawn>0&&l<=playGrid.levels[mainState.score].bacteria+playGrid.levels[mainState.score].pepper+playGrid.levels[mainState.score].bacteria+playGrid.levels[mainState.score].fungus-this.bacteriaSpawn-this.pepperSpawn-this.fungusSpawn?(h=4,this.fungusSpawn++):(h=3,this.virusSpawn++)}else h=this.mine.type;for(var p=0;p<5&&null===(n=this.teleport(h));p++);if(null===n)return void(createMine=0);if(dataStorage.isAudio&&(this.bulpSound++,this.bulpSound>3&&(this.bulpSound=1),this.soundEffects.play("bulp"+this.bulpSound)),2===h&&playGrid.levels[mainState.score].health<=0){var d=this.boardGroup.scale.x,c=e.rnd.realInRange(.1,.8),u=e.rnd.realInRange(.1,.8),g=this.boardGroup.offsetX/d+this.boardGroup.size.width*c,m=this.boardGroup.offsetY/d+this.boardGroup.size.height*u;playGrid.levels[mainState.score].health,this.game.add.tween(n).to({x:g,y:m},5e3,Phaser.Easing.Back.InOut,!0,0,1e3,!0)}if(2===h&&playGrid.levels[mainState.score].health>0){g=this.centre.x,m=this.centre.y;this.game.add.tween(n).to({x:g,y:m},5e3,Phaser.Easing.Sinusoidal.InOut,!0,0,1e3,!0).onRepeat.add(function(){this.healthValue++,this.centre.tint=16711680,this.time.events.add(1500,function(){this.centre.tint=16777215},this)},this)}}createMine=e.rnd.integerInRange(createMineTimer,1.5*createMineTimer)}else playState.passed&&(null===mines.getFirstAlive()?this.gameOver(!0):this.endGame("Eat germs before the day is over."),this.inputLockTime=this.time.time+1500)}},endGame:function(e){this.music&&(this.music.stop(),this.music=null),dataStorage.isAudio&&this.soundEffects.play("end"),this.isGameOver=!0,this.inputLockTime=this.time.time+1500,this.popupGroup.showInfo(playGrid.levels[mainState.score].title,e,"HIT TO CONTINUE",0,playState,playState.backToMenu,!0,playGrid.levels[mainState.score].image)},teleport:function(e){var t,i=this.game;t=4===e?.3:.375;var a,s=i.rnd.realInRange(-t,t),o=i.rnd.realInRange(-t,t);if(this.mine)a=this.mine,s=i.rnd.realInRange(-t,t),o=i.rnd.realInRange(-t,t),this.boardGroup.move(a,s,o);else{var h="bug"+e;1===e&&(h="pepper"),2===e&&(h="bacteria"),3===e&&(h="virus"),4===e&&(h="fungus"),a=this.boardGroup.addFoe(h+".png",s,o),this.game.physics.enable(a,Phaser.Physics.ARCADE);var n=a,r=(n.width+snakebite)*playState.boardGroup.scale.x*.66,l=(n.height+snakebite)*playState.boardGroup.scale.y*.66;1===e&&(a.animations.add("pepper",["pepper0.png","pepper1.png","pepper2.png","pepper3.png"]),a.animations.play("pepper",30,!0)),2===e&&(a.animations.add("bacteria",["bacteria0.png","bacteria1.png","bacteria2.png","bacteria3.png"]),a.animations.add("bacteria-blink",["bacteria4.png","bacteria5.png"]),a.animations.play("bacteria",30,!0)),3===e&&(a.animations.add("virus",["virus0.png","virus1.png","virus2.png","virus3.png"]),a.animations.add("virus-blink",["virus4.png","virus5.png"]),a.animations.play("virus",30,!0)),4===e&&(a.animations.add("fungus",["fungus0.png","fungus1.png","fungus2.png","fungus3.png"]),a.animations.add("fungus-blink",["fungus4.png","fungus5.png"]),a.animations.play("fungus",30,!0),a.isBlock=!0,a.fungusSize=1,a.body.collideWorldBounds=!0,a.body.bounce.set(1),a.body.moves=!1);var p=(n.width-r)/2,d=(n.height-l)/2;n.body.setSize(r,l,p,d),a.type=e}var c=9999,u=!0;if(i.physics.arcade.distanceBetween(a,snakeHead)<250?u=!1:(this.boardGroup.foeGroup.children.forEach(function(e){if(a!==e&&e.alive&&e.type>0){var t=i.physics.arcade.distanceBetween(a,e);if(t<c)return void(c=t)}},this),this.boardGroup.children.forEach(function(e){if(a!==e&&e.alive){var t=i.physics.arcade.distanceBetween(a,e);if(t<c)return void(c=t)}},this)),1===a.type&&c<150&&(u=!1),2===a.type&&c<150&&(u=!1),3===a.type&&c<150&&(u=!1),4===a.type&&c<150&&(u=!1),!u)return this.mine=a,a.kill(),null;null!==this.mine&&(this.mine=null,a.revive()),mines=this.boardGroup.foeGroup;var g;return a.alpha=0,g=this.boardGroup.addSprite("teleport3.png",s,o),1===e&&(g.tint=16711680),g.anchor.set(.5),g.scale.x=g.scale.y=0,i.add.tween(g.scale).to({x:1,y:1},1e3,Phaser.Easing.Linear.None,!0,0,0,!1),i.add.tween(g).to({alpha:0},1e3,Phaser.Easing.Quadratic.InOut,!0,0,0,!1).onComplete.add(function(e){e.destroy()}),g.scale.x=g.scale.y=0,i.add.tween(a).to({alpha:1},500,Phaser.Easing.Quadratic.InOut,!0,500,0,!1),i.physics.enable(a,Phaser.Physics.ARCADE),a},showText:function(e,t){this.helpText.text=t,this.helpText.x=this.game.width/2,this.helpText.y=this.game.height/2,this.helpText.alpha=1,this.helpText.bringToTop(),this.helpText.revive(),this.add.tween(this.helpText).to({alpha:0},500,Phaser.Easing.Quadratic.InOut,!0,0).onComplete.add(function(){this.helpText.kill(),this.stopCountdown()},this),this.countdown=0},showTutorial:function(){var e=this.tutorial++;switch(this.inputLockTime=this.time.time+1e3,e){case 1:this.tutorialGroup.showHand("\nThis is YOU!\n\n[ hit to continue ]",snakeHead,this.boardGroup);break;case 2:this.tutorialGroup.hand.kill(),this.tutorialGroup.handText.text="\nPRESS anywhere to turn.\n\n[ hit to continue ]";break;case 3:this.startup(),this.tutorialGroup.hide(),this.time.events.add(3e3,function(){this.inputLockTime=this.time.time+1e3,this.tutorialGroup.showHand("\nPress long to TURN more.\n\n[ hit to continue ]",snakeHead,this.boardGroup)},this);break;case 4:this.tutorialGroup.hide(),this.time.events.add(3e3,function(){this.inputLockTime=this.time.time+1e3,this.tutorialGroup.showHand("\nFollow wiggle to turn left/right.\n\n[ hit to continue ]",snakeHead,this.boardGroup)},this);break;case 5:this.tutorialGroup.hide(),this.time.events.add(4500,function(){do{this.tutorialGerm=this.teleport(3)}while(null===this.tutorialGerm);this.tutorialGroup.showHand("\nEat your first BUG!",this.tutorialGerm,this.boardGroup)},this);break;case 6:this.time.events.add(2e3,function(){this.tutorial=0,this.tutorialGroup.hide()},this)}},startup:function(){this.startTime=this.time.time,this.resume()},explode:function(e){playState.effectGroup.start(playState.boardGroup.getCenterX(e),playState.boardGroup.getCenterY(e),0,0),this.endGame("Don't eat peppers! They are explosive.")},inHole:function(){this.endGame("Avoid holes in the ground.")}};function ballHitBrick2(){for(var e=3;e<=numSnakeSections-1&&0!==snakeSection[e].alpha;e++)if(playState.game.physics.arcade.distanceBetween(snakeHead,snakeSection[e])<25){playState.bite.scale.x=playState.bite.scale.y=.5,playState.bite.alpha=1;playState.add.tween(playState.bite.scale).to({x:1,y:1},75,Phaser.Easing.Quadratic.InOut,!0,0,0,!0);return void playState.endGame("Don't bite your tail!")}}function ballHitBrick(e,t){var i=playState.game;if(4===t.type){if(t.fungusSize>0)return;if(playState.time.time<t.fungusSpeed)return}if(1===t.type)return playState.explode(t),playState.boardGroup.foeGroup.remove(t),void t.destroy();dataStorage.isAudio&&playState.soundEffects.play("crunch"),playState.hasEatenBug=!0,playState.germEaten++,playState.headerGroup.setScore(playGrid.levels[mainState.score].virus+playGrid.levels[mainState.score].bacteria+2*playGrid.levels[mainState.score].fungus-playState.germEaten),playState.bite.scale.x=playState.bite.scale.y=.5,playState.bite.alpha=1,i.add.tween(playState.bite.scale).to({x:1,y:1},75,Phaser.Easing.Quadratic.InOut,!0,0,0,!0).onComplete.add(function(){playState.bite.alpha=0}),playState.boardGroup.foeGroup.remove(t),t.destroy();for(var a=1;a<=numSnakeSections-1;a++){var s=snakeSection[a];if(0===s.alpha){i.add.tween(s).to({alpha:1},350,Phaser.Easing.Linear.None,!0);break}}0===mainState.score&&playState.gameOver(!0)}function collideBlock(e,t){t.isHole?playState.inHole():playState.hitWorldBounds()}function collideFungus(e,t){if(t.body.moves=!0,t.fungusSpeed,1===t.fungusSize){t.fungusSize=0,t.fungusSpeed=playState.time.time+500,this.boardGroup.setTexture(t,"fungus-split0.png");var i=this.boardGroup.addFoe("fungus-split0.png",0,0);t.animations.add("fungus-split",["fungus-split0.png","fungus-split1.png","fungus-split2.png","fungus-split3.png"]),t.animations.play("fungus-split",30,!0),i.animations.add("fungus-split",["fungus-split0.png","fungus-split1.png","fungus-split2.png","fungus-split3.png"]),i.animations.play("fungus-split",30,!0),i.fungusSpeed=playState.time.time+500,this.game.physics.enable(i,Phaser.Physics.ARCADE),i.body.collideWorldBounds=!0,i.body.bounce.set(1),i.type=t.type,i.x=t.x,i.y=t.y,i.fungusSize=0,i.isBlock=!0,i.body.drag.set(50),t.body.drag.set(50);var a=i,s=(a.width+snakebite)*playState.boardGroup.scale.x*.66,o=(a.height+snakebite)*playState.boardGroup.scale.y*.66;a.width,a.height}}var mainState={name:"mainState",spriteAtlas:"atlas",goal:"Music by PlayOnLoop.com\n\nSounds by InspectorJ of Freesound.org\n\n",chapters:[{name:"Christmas",levels:25}],score:0,scoreMax:25,resize:function(){var e=onResize.call(this,this.scale,{width:this.game.width,height:this.game.height});this.effectGroup&&this.effectGroup.snowing&&(this.effectGroup.snowing.x=this.game.width/2,this.effectGroup.snowing.y=-this.game.height,this.effectGroup.snowing.width=this.game.width,this.effectGroup.snowing.height=2*this.game.height),this.helpText&&(this.helpText.fontSize=64*e)},init:function(){this.game.input.touch.preventDefault=!1;var e=playService.getPlayer("me");this.score=e.wins,0===this.score&&this.state.add("playState",playState,!0)},preload:function(){if(dataStorage.debug&&this.spriteAtlas)for(var e=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),t=0;t<e.length;t++){var i=e[t].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}},create:function(){this.cache.checkSoundKey("sound-effects")?(this.soundEffects=this.add.audioSprite("sound-effects"),Object.keys&&Object.keys(this.soundEffects.sounds).forEach(function(e,t){this.soundEffects.sounds[e].allowMultiple=!0},this)):dataStorage.isAudio=!1,this.controlGroup=new ControlGroup(this.game,{width:260,height:0},{width:0,height:280}),this.createBoard(),this.createHeader(),this.createPopup();this.helpText=this.add.text(0,0,"",{font:"128px",fill:"#000000",wordWrap:!1,fontWeight:"bold",align:"center",backgroundColor:"#ffff00"}),this.helpText.anchor.set(.5),this.helpText.kill(),this.game.scale.setResizeCallback(this.onResize,this),this.resize(),this.start(),dataStorage.isAudio&&this.time.events.add(100,function(){this.load.audio("main-music",["cache/POL-living-lucky-short.ogg","cache/POL-brave-worm-short.mp3"]),this.load.audio("play-music",["cache/POL-brave-worm-short.ogg","cache/POL-brave-worm-short.mp3"]),this.load.start(),this.load.onLoadComplete.addOnce(this.loadComplete,this)},this)},createHeader:function(){this.headerGroup=new HeaderGroup(this.game,{width:260,height:0,maxHeight:1200},{width:0,height:90,maxWidth:1200},this),this.headerGroup.enable("header-option.png"),this.headerGroup.enable("header-ad.png"),this.headerGroup.enable("header-info.png")},createPopup:function(){this.popupGroup=new PopupGroup(this.game,{width:this.game.width,height:this.game.height}),this.popupGroup.enable("popup-banner.png"),this.popupGroup.enable("popup-dialog-upgrade.png")},createBoard:function(){var e,t,i=[{x:-.35,y:-.053},{x:-.175,y:-.053},{x:0,y:-.053},{x:3*.175-.35,y:-.053},{x:.35,y:-.053},{x:-.35,y:.055},{x:-.175,y:.055},{x:0,y:.055},{x:3*.175-.35,y:.055},{x:.35,y:.055},{x:-.35,y:.163},{x:-.175,y:.163},{x:0,y:.163},{x:3*.175-.35,y:.163},{x:.35,y:.163},{x:-.35,y:.27},{x:-.175,y:.27},{x:0,y:.27},{x:3*.175-.35,y:.27},{x:.35,y:.27},{x:-.35,y:.378},{x:-.175,y:.378},{x:0,y:.378},{x:3*.175-.35,y:.378},{x:.35,y:.378}];if(this.boardGroup=new BoardGroup(this.game,{width:720,height:720},{width:720,height:720}),e=this.boardGroup.addSprite("main-board-bg.png",0,0),this.score<this.scoreMax){for(var a=i[this.score],s=0,o=0;s<this.chapters.length;s++)if(o+=this.chapters[s].levels,this.score<o){this.chapterNo=s,this.chapterLevel=this.score-o-this.chapters[s].levels;break}this.chapter=this.chapters[this.chapterNo],t=this.chapter.name,e=this.playBg=this.boardGroup.addSprite("main-play-bg.png",a.x,a.y),this.add.tween(e.scale).to({x:.95,y:.9},500,Phaser.Easing.Sinusoidal.In,!0).repeat(Number.MAX_VALUE).yoyo(!0),this.add.tween(e).to({angle:360},1e4,Phaser.Easing.Linear.None,!0).repeat(Number.MAX_VALUE),this.play=this.boardGroup.addSprite("main-play.png",e.dx-.5,e.dy-.5),this.play.inputEnabled=!0,this.play.input.useHandCursor=!0}else t="Congratulations!";this.chapterLabel=this.boardGroup.addText(t,0,-.25,"ffffff",48);for(s=0;s<this.score;s++)e=this.boardGroup.addSprite("main-check.png",i[s].x+.065,i[s].y-.035)},update:function(){var e;if(!(this.inputLockTime>=this.time.now||this.world.mask))if(playState.upgrade){if(this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame&&(e=this.game.input.activePointer).targetObject){var t=null;if((a=e.targetObject.sprite)===this.popupGroup.upgradeSpeed?(t="Speed",upgradeSpeed++):a===this.popupGroup.upgradeLives?(t="Bite",upgradeLives++):a===this.popupGroup.upgradeAgility?(t="Wiggle",upgradeAgility++):a===this.popupGroup.upgradeTurning?(t="Agility",upgradeTurning++):t=!1,t){this.showText(null,"Snake\n"+t+"\nUpgraded!"),this.inputLockTime=this.time.now+500,playState.upgrade=!1;var i=[upgradeSpeed,upgradeLives,upgradeAgility,upgradeTurning];dataStorage.saveUpgrades(i),this.popupGroup.hide()}}}else if(this.game.input.activePointer.isDown&&this.game.input.activePointer.withinGame)if((e=this.game.input.activePointer).targetObject){var a=e.targetObject.sprite;if(this.popupGroup.visible)a===this.popupGroup.close||a===this.popupGroup.claim||3===playState.orientation||4===playState.orientation?(playState.orientation=0,this.inputLockTime=this.time.now+1e3,this.popupGroup.hide()):a===this.popupGroup.play&&(this.inputLockTime=this.time.now+1e3,this.popupHidden(),fadeOutEffect(this,0).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this));else if(this.headerGroup.optionBg.visible)this.inputLockTime=this.time.now+250,a===this.headerGroup.optionSound?(this.headerGroup.select(this.headerGroup.optionSound),dataStorage.isAudio?this.soundEffects.play("collide"):this.music&&this.music.stop()):a===this.headerGroup.optionReset?(dataStorage.reset(),this.headerGroup.hideOption(),this.popupGroup.dim.kill()):(this.headerGroup.hideOption(),this.popupGroup.dim.kill());else{if(a===this.headerGroup.option)return this.inputLockTime=this.time.now+500,this.headerGroup.showOption(this),void this.popupGroup.dim.revive();if(a===this.headerGroup.info)return this.inputLockTime=this.time.now+500,void this.popupGroup.showDialog(this.goal,null,this,!0);a===this.play&&fadeOutEffect(this,0).onComplete.addOnce(function(){this.state.add("playState",playState,!0)},this)}}else this.headerGroup.optionBg.visible?(this.headerGroup.hideOption(),this.popupGroup.dim.kill()):this.popupGroup.visible&&(this.inputLockTime=this.time.now+1e3,this.popupGroup.hide())},start:function(){(this.game.physics&&(this.game.physics.arcade.isPaused=!1),this.world.mask&&this.world.mask.destroy(),this.effectGroup=new EffectGroup(this.game,{width:720,height:720},{width:720,height:720}),this.effectGroup.enable("snowing"),this.time.events.add(0,function(){this.effectGroup.start(this.game.width/2,-this.game.height,this.game.width,2*this.game.height)},this),this.world.mask=null,16251901===this.stage.backgroundColor)?(playService.mainStarted=!0,playService.showLogin(),this.started=!0):fadeOutEffect(this,16251901,!0).onComplete.addOnce(function(){playService.mainStarted=!0,playService.showLogin(),this.started=!0,this.world.mask.destroy(),this.world.mask=null},this);if(this.score>=this.scoreMax)return playState.upgrade=!1,this.popupGroup.showBanner("Congratulations!\nMerry & Healthy Xmas"),void this.popupGroup.play.kill();3===playState.orientation?this.popupGroup.showBanner("Game orientation changed."):4===playState.orientation?playState.upgrade?this.showAchievement(!0):this.popupGroup.showBanner("Game resumed."):playState.upgrade&&this.showAchievement(!0)},popupHidden:function(){this.game.physics.arcade.isPaused=!1},shutdown:function(){this.bg=null,this.effectGroup=null,this.music&&this.music.stop()},loadImage:function(e){this.load.crossOrigin="Anonymous",this.load.image(e),this.load.onFileComplete.add(this.onLoadImage,this),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.load.start()},loadComplete:function(){dataStorage.isAudio&&(this.music=this.game.add.audio("main-music"),this.music.loopFull(.25))},updateScores:function(){},updateAchievements:function(){this.currentButton&&this.updateLeaderScore(this.currentButton)},iconComplete:function(e,t,i,a,s){console.log("Loading "+e+" %"),console.log(i+" "+t),i&&t&&this.boardGroup.addSpriteFromFile(t,.1,.1)},printCache:function(e){var t=this.cache.getKeys(e),i="";for(var a in t)i+=a+" ";t.length>0&&console.log(e+":"+i),this.cacheItems+=t.length},showPhaserCache:function(){this.printCache(Phaser.Cache.CANVAS),this.printCache(Phaser.Cache.IMAGE),this.printCache(Phaser.Cache.TEXTURE),this.printCache(Phaser.Cache.SOUND),this.printCache(Phaser.Cache.TEXT),this.printCache(Phaser.Cache.PHYSICS),this.printCache(Phaser.Cache.TILEMAP),this.printCache(Phaser.Cache.BINARY),this.printCache(Phaser.Cache.BITMAPDATA),this.printCache(Phaser.Cache.BITMAPFONT),this.printCache(Phaser.Cache.JSON),this.printCache(Phaser.Cache.XML)},showPixiCache:function(){var e="";for(var t in PIXI.BaseTextureCache)e+=t+" ",this.cacheItems++;for(var t in PIXI.TextureCache)e+=t+" ",this.cacheItems++;console.log("PIXI Base/TextureCache: "+e)},showCache:function(e){this.cacheItems=0,console.log(e),this.showPhaserCache(),this.showPixiCache(),console.log("world length: "+this.world.children.length),console.log("cache length: "+this.cacheItems)},showAchievement:function(e){this.popupGroup.showDialog("",null,this,!0,!1,"Upgrade Snake",e)},showText:function(e,t){this.helpText.text=t,this.helpText.x=this.game.width/2,this.helpText.y=this.game.height/2,this.helpText.alpha=1,this.helpText.bringToTop(),this.helpText.revive(),this.add.tween(this.helpText).to({alpha:0},1500,Phaser.Easing.Quadratic.InOut,!0,0).onComplete.add(function(){this.helpText.kill()},this)}},bootState={config:{},name:"bootState",spriteAtlas:"atlas",resize:function(){onResize.call(this,this.scale,{width:this.game.width,height:this.game.height})},init:function(){Phaser.Canvas.setTouchAction(game.canvas,"auto"),this.game.input.touch.preventDefault=!1,-1===window.location.href.indexOf("localhost:8383")&&(this.load.path="/snake/"),this.dataLoaded||(this.dataLoaded=!0,dataStorage.init()),Phaser.Plugin.Debug},preload:function(){this.game.forceSingleUpdate=!0,this.game.renderer.renderSession.roundPixels=!0,this.stage.smoothed=!0,this.game.renderer.clearBeforeRender=!0,this.stage.backgroundColor="#f7fbfd",this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.scale.fullScreenScaleMode=Phaser.ScaleManager.RESIZE,this.scale.setShowAll(),this.scale.refresh()},loadComplete:function(){if(dataStorage.debug&&this.spriteAtlas)for(var e=this.game.cache.getFrameData(this.spriteAtlas).getFrames(),t=0;t<e.length;t++){var i=e[t].name;this.cache.checkImageKey(i)||this.game.load.image(i,"cache/"+this.spriteAtlas+"/"+i)}this.state.add("mainState",mainState,!0)},create:function(){this.input.maxPointers=1,this.boardGroup=new BoardGroup(this.game,{width:640,height:720},{width:640,height:720}),this.boardGroup.addText(dataStorage.title,0,.2,"c98dd0",60),this.boardGroup.addText("GameQuack.com",0,.3,"98a1c1",48),this.loadText=this.boardGroup.addText("Loading ...",0,.4,"666666",32),this.load.image("quack.png","cache/quack.png",400,400);this.load.audiosprite("sound-effects",["cache/sound-effects.ogg","cache/sound-effects.mp3"],null,{spritemap:{countdown:{start:0,end:2.3,loop:!1},crunch:{start:3,end:3.2,loop:!1},collide:{start:4,end:4.1,loop:!1},end:{start:5,end:5.9,loop:!1},bulp1:{start:6,end:6.1,loop:!1},bulp2:{start:6.2,end:6.3,loop:!1},bulp3:{start:6.4,end:6.5,loop:!1}}}),this.time.events.add(10,function(){this.load.atlasXML("atlas","cache/atlas/sprites.png","cache/atlas/sprites.xml"),this.load.onFileComplete.add(this.fileComplete,this),this.load.onLoadComplete.addOnce(this.loadComplete,this),this.load.start()},this),this.game.scale.setResizeCallback(this.onResize,this),this.resize()},fileComplete:function(e,t,i,a,s){this.loadText.setText("Loading "+e+" %"),i&&"quack.png"===t&&this.boardGroup.addSpriteFromFile(t,0,-.2)},shutdown:function(){}};function createGame(){var e=window,t={width:e.innerWidth,height:e.innerHeight},i=new Phaser.Game(t.width,t.height,Phaser.CANVAS,"canvas");window.game=i,i.state.add("bootState",bootState,!0)}