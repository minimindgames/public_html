/*! Copyright minimind 14-02-2021 */

let unitControl=t=>(class extends t{initControl(t){this.control=t,this.targetPosition=null,this.targetPositionImage=this.scene.add.image(0,0,"ControlTarget"),this.targetPositionImage.visible=!1,this.control.target={unit:null,focus:null,focusImage:this.scene.add.image(this.x,this.y,UnitBot.name+"Target"),img:this.scene.add.image(this.x,this.y,UnitBot.name+"Target")},this.control.target.img.visible=!1,this.control.target.focusImage.visible=!1,this.control.target.focusImage.tint=10066329}startControl(){this.setDrag(1.5*this.body.maxSpeed),this.body.setAllowDrag(!0)}stopControl(){}doControl(t,e,i,s,a){this.control.target.unit?(this.control.target.img.setPosition(this.control.target.unit.x,this.control.target.unit.y),this.control.target.img.visible=!0):this.control.target.img.visible=!1;const n=this.control;if(t||e||i||s){a&&this.resumeControl(null);let h=this,o=this.x,r=this.y;t?r-=n.speed:e&&(r+=n.speed),i?o-=n.speed:s&&(o+=n.speed);let l=Phaser.Math.Angle.Between(h.x,h.y,o,r);h.rotation=Phaser.Math.Angle.RotateTo(h.rotation,l,n.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}else if(a)this.pauseControl();else if(this.targetPosition){let t=Phaser.Math.Angle.Between(this.x,this.y,this.targetPosition[0],this.targetPosition[1]);this.rotation=Phaser.Math.Angle.RotateTo(this.rotation,t,n.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}if(null!==this.targetPosition){Phaser.Math.Distance.Squared(this.x,this.y,this.targetPosition[0],this.targetPosition[1])<this.targetPositionProximity&&this.pauseControl()}}pauseControl(){this.setFrame(0),this.body.setAcceleration(0),null!==this.targetPosition&&(this.targetPositionImage.visible=!1,this.targetPosition=null),this.control.pad.padActive(!1)}resumeControl(t){if(this.targetPosition=t,this.setFrame(1),t){this.targetPositionImage.setPosition(t[0],t[1]);let e=Phaser.Math.Distance.Squared(this.x,this.y,t[0],t[1]);this.targetPositionProximity=e/5,this.targetPositionProximity>this.width*this.width*2&&(this.targetPositionProximity=this.width*this.width*2)}this.targetPositionImage.visible=null!==t,this.control.pad.padActive(!0)}setTargetPosition(t){if(t){if(this.getBounds().contains(t[0],t[1]))return;this.resumeControl(t)}else this.pauseControl()}}),unitTeleport=t=>(class extends t{initTeleport(t={}){this.teleport=t,this.teleport.from=null,this.teleport.to=null}startTeleport(){}stopTeleport(){}doTeleportEffect(t,e){this.scene.time.addEvent({delay:200,callback:()=>{let t=this.scene.add.image(e.x,e.y,"EffectTeleport");this.scene.tweens.add({targets:t,scale:10,ease:"Linear",duration:1250,alpha:0,onComplete:function(){t.destroy()}})},callbackScope:this,repeat:1});t&&this.setScale(0),this.scene.tweens.add({targets:this,ease:"Quad.easeOut",duration:1250,scale:t?1:0,alpha:t?1:0})}doTeleport(t,e){if(t.unit.damage>0)return t.tint=10066329,void this.scene.time.addEvent({delay:500,callback:()=>{t.clearTint()},callbackScope:this});this.setTargetPosition(null),this.teleport.from=t,this.doTeleportEffect(!1,this.teleport.from),EventDispatcher.getInstance().emit("GameStatus",{teleport:!0,from:t}),this.x=this.teleport.from.x,this.y=this.teleport.from.y,this.body.setVelocity(0),this.body.setAcceleration(0),this.stop()}}),unitWatch=t=>(class extends t{initWatch(t={}){this.watch=t}startWatch(){}stopWatch(){}});class Unit extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,a,n){"UnitElement"===s||"UnitTeleport"===s||"UnitBot"===s||"UnitFungus"===s||"UnitEnergy"===s?super(t,e,i,s):super(t,e,i,"sprites",s+".png"),this.player=n,this.scene.anims.exists(s)&&this.anims.play(s),this.id=Unit.id++}toString(){return this.id}startUnit(t){this.unit=t,this.unit.listeners=[],this.unit.watchListeners=[],this.unit.tint=0,this.unit.freeze=0,this.unit.level=t.level||1,this.unit.damage=t.damage||0,this.unit.defenceFactor=t.defenceFactor||1,this.body.mass=t.mass||this.width,this.body.maxSpeed=this.scene.scaleResolution(t.maxSpeed||Unit.speedMax),this.body.allowDrag=!1,this.body.allowGravity=!1,this.unit.sizeSquared=this.width*this.width/2,t.damageSize&&(this.unit.levelMax>=2&&(this.unit.damageImage2=this.scene.add.image(this.x,this.y,"damage-"+(t.damageSize+10)),this.unit.damageImage2.setDepth(-1),this.unit.level<this.unit.levelMax?(this.unit.damageImage2.alpha=.25,this.unit.damageImage2.setFrame(this.unit.damageImage2.texture.frameTotal-2)):this.unit.damageImage2.setTint(this.player.color)),this.unit.damageImage=this.scene.add.image(this.x,this.y,"Unit-damage-"+t.damageSize,0),this.unit.damageImage.setDepth(-1),this.unit.damageImage.setTint(this.player.color),this.updateDamageImage())}stopUnit(){this.unit.damageImage&&this.unit.damageImage.destroy(),this.unit.damageImage2&&this.unit.damageImage2.destroy(),this.notify("stop"),this.unit.listeners=[],this.unit.watchListeners=[],this.scene.clearEvents(this)}addWatch(t){-1===this.unit.watchListeners.indexOf(t)&&this.unit.watchListeners.push(t)}removeWatch(t){let e=this.unit.watchListeners.indexOf(t);-1!==e&&this.unit.watchListeners.splice(e,1)}watchNotify(){for(let t=this.unit.watchListeners.length-1;t>=0;t--)this.unit.watchListeners[t].doWatch(this)}addListener(t){-1===this.unit.listeners.indexOf(t)&&this.unit.listeners.push(t)}removeListener(t){let e=this.unit.listeners.indexOf(t);-1!==e&&this.unit.listeners.splice(e,1)}notify(t){for(let e=this.unit.listeners.length-1;e>=0;e--)this.unit.listeners[e].event(this,t)}event(t,e){}updateDamageImage(){if(1===this.unit.level){let t=this.unit.damageImage.texture.frameTotal-2,e=Math.trunc(t*(this.unit.health-this.unit.damage)/this.unit.health);this.unit.damageImage.setFrame(e)}else{let t=this.unit.health/2;if(this.unit.damage<t){let e=this.unit.damageImage.texture.frameTotal-2;this.unit.damageImage.setFrame(e);let i=Math.trunc(e*(t-this.unit.damage)/t);this.unit.damageImage2.setFrame(i),this.unit.damageImage2.alpha=1}else{let e=this.unit.damageImage.texture.frameTotal-2;this.unit.damageImage2.setFrame(e-1),this.unit.damageImage2.alpha=.5;let i=Math.trunc(e*(this.unit.health-this.unit.damage)/t);this.unit.damageImage.setFrame(i)}}}setPlayer(t){0===t.id&&this.sound("claim"),0===this.player.id&&this.sound("lose"),this.notify("stop");let e=[this.unit.damageImage];this.scene.tweens.add({targets:e,duration:150,scaleX:0,callbackScope:this,rotation:Math.PI,onComplete:function(t){this.scene.tweens.add({targets:e,duration:150,scaleX:1,callbackScope:this,rotation:0,onComplete:function(t){this.unit.damageImage.setTint(this.player.color)}},this)}},this),this.player=t,this.unit.level=1,this.updateDamage(),this.updateRoutes(),this.unit.damageImage2&&(this.unit.damageImage2.alpha=.25,this.unit.damageImage2.setTint(16777215))}unitDamage(t){this.unit.damage;return this.unit.damage+=t*this.unit.defenceFactor,this.unit.damage>this.unit.health?(this.unit.damage=this.unit.health,!0):(this.updateDamage(),!1)}damageEnemy(t){if(this.player.team.id!==t.player.team.id){let e=t.unit.health-t.unit.damage;t.unitDamage(this.unit.health-this.unit.damage)&&t.destroy(),this.unitDamage(e)&&this.destroy()}}overlapEnemy(t){let e=t.unit.health-t.unit.damage;return t.unitDamage(this.unit.health-this.unit.damage)&&t.destroy(),!!this.unitDamage(e)&&(this.unit.damage=this.unit.health-(this.unit.damage-this.unit.health),!0)}overlapFriend(t){if(t instanceof UnitElement&&this.unit.damage>0){let e=t.unit.health-t.unit.damage;this.unit.level>1&&(e/=this.unit.level),e/=2,this.unit.damage-=e,this.unit.damage<0&&(this.unit.damage=0),t.destroy(),this.updateDamage()}}overlap(t){this.player.team.id===t.player.team.id?this.overlapFriend(t):this.damageEnemy(t)}unitMapUpdated(){}explodeEffect(){let t=this.scene.add.particles("Unit-explode");t.createEmitter({frame:[2],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(112.5),end:this.scene.scaleResolution(-112.5)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),t.createEmitter({frame:[0],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(75),end:this.scene.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:750,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),this.scene.time.delayedCall(1e3,function(){t.destroy()},this)}sound(t){this.scene.cardScene.audio.play(t)}static preload(t,e){for(let t=40;t<=40;t+=10)e.push({name:"Unit-damage-"+t,size:t})}}Unit.id=1,Unit.speedMax=40,Unit.defaultHealth=100,Unit.defaultMass=100,Unit.defaultSpeed=150;class UnitBot extends(unitTeleport(unitControl(Unit))){constructor(t,e,i,s,a){super(t,e,i,UnitBot.name,0,s),t.unitSprites[this.player.team.id].add(this,!0),this.startUnit({health:Unit.defaultHealth,mass:Unit.defaultMass,maxSpeed:Unit.defaultSpeed}),this.initControl({speed:1,turnSpeed:.25}),this.startControl(),this.initTeleport({}),this.startTeleport(),this.body.setSize(this.width/2,this.height/2),this.scene.physics.add.collider(this,this.scene.groundLayer,this.collideGround.bind(this)),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.scene.cardScene.bot=null,this.stopTeleport(),this.stopControl(),this.stopUnit()}event(t,e){"stop"===e&&t===this.shoot.target&&this.setShootTarget(null)}updateDamage(){let t=this.damage.texture.frameTotal-1,e=t-Math.trunc(t*(this.unit.health-this.unit.damage-1)/this.unit.health);this.damage.setFrame(e-1)}shootUnit(t){this.shoot.target.unit.damage<this.shoot.target.unit.health?this.shoot.target.unitDamage(this.shoot.damage):(this.shoot.target.destroy(),this.laser.visible=!1)}collideGround(){}preUpdate(){this.watchNotify()}action(){this.control.target.unit?(this.control.target.unit.route&&this.doTeleport(this.control.target.unit,this.control.target.unit),this.control.target.unit=null,this.control.target.img.visible=!1,this.control.target.focus=null,this.control.target.focusImage.visible=!1):this.pauseControl()}static preload(t,e){t.push("EffectTeleport"),t.push(UnitBot.name+"Target"),e.push({name:UnitBot.name,size:32})}}UnitBot.name="UnitBot";class UnitEnergy extends Unit{constructor(t,e,i,s,a){super(t,e,i,UnitEnergy.name,a.frame,s),t.fields.add(this,!0),this.body.move=!1,this.body.immovable=!0,this.startUnit({mass:0}),this.energy=!0,this.body.setSize(6*this.width)}overlap(t){if(t===this.scene.cardScene.bot){let e=this.scene.add.image(this.x,this.y,"UnitEnergy"),i=this.scene.cardScene.energy;i.update(.1)&&(i.bg.tint=0,this.scene.tweens.add({targets:e,ease:"Power1",duration:150,x:t.x,y:t.y,scale:0,angle:360,onComplete:function(){i.bg.clearTint(),e.destroy()}}),this.destroy())}}unitDamage(){}static preload(t,e){e.push({name:UnitEnergy.name,size:16})}}UnitEnergy.name="UnitEnergy";class UnitTeleport extends(unitWatch(Unit)){constructor(t,e,i,s,a){super(t,e,i,UnitTeleport.name,0,s),t.hqSprites.add(this,!0),this.teleport=a,this.body.move=!1,this.body.immovable=!0,this.startUnit({health:100,damage:0,damageSize:40}),this.initWatch(a),this.startWatch(),this.route=!0,this.unit.damage>0&&this.anims.pause(),this.visible=!1,this.watchRangeSquared=this.scene.cameras.main.centerX*this.scene.cameras.main.centerX,this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.stopWatch(),this.stopUnit()}disabledBy(t){this.unit.disabled=t,this.unit.disabled.addListener(this),this.anims.pause()}event(t,e){t===this.unit.disabled&&"stop"===e&&(this.unit.disabled=!1,this.anims.resume())}doWatch(t){if(!this.visible){Phaser.Math.Distance.Squared(this.x,this.y,t.x,t.y)<=this.watchRangeSquared&&(this.visible=!0,t.removeWatch(this),this.scene.cardScene.brain.addTeleport(this))}}overlap(t){}static preload(t,e){e.push({name:UnitTeleport.name,size:32})}}UnitTeleport.name="UnitTeleport",UnitTeleport.animFrameRate=30;class EventDispatcher extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return null===EventDispatcher.instance&&(EventDispatcher.instance=new EventDispatcher),EventDispatcher.instance}}EventDispatcher.instance=null;class GameScene extends Phaser.Scene{constructor(t){super({key:t}),this.teleports=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]]}init(){this.firstGameToday=!1,parseInt(0|this.game.restore("lastPlayTime"))+43200<(Date.now()/1e3|0)&&(this.firstGameToday=!0)}preload(){this.load.path=this.registry.get("path");let t=this.scene.get("LoaderScene");this.load.image("Hello","img/Hello"+t.res+".jpg"),t.loadImages(this,[])}create(){this.cameras.main.setBackgroundColor("#fff"),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.helloImage=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"Hello"),this.input.once(Phaser.Input.Events.POINTER_UP,()=>{this.startGame()}),this.input.keyboard.once("keyup",()=>{this.startGame()}),this.input.gamepad.once("connected",function(t){this.startGame()}),this.startLevel(),this.startGame()}startGame(){this.helloImage&&(this.scene.sleep(),EventDispatcher.getInstance().emit("GameStatus",{start:!0}))}startLevel(){let t=this.registry.get("level");if(this.level=t,t.end){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.gameName+"\n\n"+Text.gameOverCongratulations,{align:"center"}).setShadow(2,2,"rgba(255,255,255,1)",3).setOrigin(.5).setColor("blue")}else t.players&&this.startUIScene()}startUIScene(){let t=this.scene.get("UIScene");if(t)t.scene.wake(),this.sceneCreated(t);else{t=this.scene.add("UIScene",new UIScene("UIScene"));let e=0;this.scene.run(t,{sceneCreated:this.sceneCreated.bind(this),layout:{y:e,x:e,h:this.cameras.main.height-e,w:this.cameras.main.width-e}})}this.uiScene=t}sceneCreated(t){if(this.level.teleport=this.teleport,t===this.uiScene){let e=this.level,i="UnitScene-"+e.id,s=this.scene.get(i);s?(s.scene.wake(),this.uiScene.setUnitSceneLevel(s,this.level),this.uiScene.setPlayer(e.data.players[0])):(s=this.scene.add(i,new UnitScene(i,t)),e.sceneCreated=this.sceneCreated.bind(this),this.scene.run(s,e)),this.unitScene=s}else t===this.unitScene&&(this.uiScene.setUnitSceneLevel(t,this.level),this.unitScene.levelFactory||(this.unitScene.levelFactory=new LevelFactory(this.uiScene,this.unitScene,this.level,this.teleports)));this.scene.bringToTop()}gameStatus(t){if(t.start&&this.scene.setVisible(!1),t.restart&&this.startLevel(),t.teleport){this.registry.get("level");this.teleport=t.from.teleport;let e="UIScene";this.scene.get(e)}t.gameover}handleLoseFocus(){console.log("handleLoseFocus")}}class LevelFactory{constructor(t,e,i,s){this.units=[],this.events=[],i.data={players:[],playerTeams:[]};let a=-1;for(let s=0;s<i.players.length;s++)i.data.players[s]=new Player(s,e),i.data.players[s].id=s,i.players[s].team>=0?a=i.players[s].team:a++,i.data.playerTeams[a]||(i.data.playerTeams[a]=new PlayerTeam(a,t,e)),i.data.playerTeams[a].addPlayer(i.data.players[s]);let n=null;for(let t=0;t<i.players.length;t++){let s=i.players[t],a=i.data.players[t];n=this.createUnits(e,s.bot,UnitBot,a)[0]}if(i.event)for(let t=0;t<i.event.length;t++){let e=i.event[t],s=this.getUnitById(e.unit);e.disable&&(e.disableUnit=this.getUnitById(e.disable)),this.events.push(new LevelEvent(s,e))}for(let t=0;t<this.units.length;t++)this.units[t].notify("start");this.units=null;let h=i.data.players[0],o=[],r=this.createTeleports(e,i,s,h);Array.prototype.push.apply(o,r),this.createEnergy(e,i,[],h);let l=64*e.game.resolution,d=i.grid.w;i.grid.h;n.x=Phaser.Math.Between(2,d-2),n.x*=l,n.y=Phaser.Math.Between(2,d-2),n.y*=l,h.bot=n,t.setPlayer(h);for(let t=0;t<o.length;t++){let e=o[t];n.addWatch(e)}}createTeleports(t,e,i,s){let a=[];for(let n=0;n<i.length;n++){let h=i[n];if(h[0]===e.id||h[1]===e.id){let i=64*t.game.resolution,n=Phaser.Math.Between(2,e.grid.w-2)*i,o=Phaser.Math.Between(2,e.grid.h-2)*i,r=h[0]===e.id?h[1]:h[0],l=new UnitTeleport(t,n,o,s,{from:e.id,to:r});a.push(l)}}return a}createEnergy(t,e,i,s){for(let i=0;i<e.grid.w+e.grid.h;i+=10){let i=64*t.game.resolution,a=Phaser.Math.Between(2,e.grid.w-2)*i,n=Phaser.Math.Between(2,e.grid.h-2)*i;new UnitEnergy(t,a,n,s,e)}}destroy(){for(let t=0;t<this.events.length;t++)this.events[t].destroy();this.events=null}createUnits(t,e,i,s){let a=[];if(e)for(let n=0;n<e.length;n++){let h=e[n];this.dx=100,this.dx2=0,this.dy=100,this.dy2=0;let o=new i(t,h.x*this.dx-this.dx2,h.y*this.dy-this.dy2,s,h);a.push(o),this.units.push(o),h.id&&(o.id=h.id)}return a}getUnitById(t){for(let e=0;e<this.units.length;e++)if(this.units[e].id===t)return this.units[e];return null}createUnits2(t,e,i,s,a){let n=[];if(e)for(let h=0;h<e.length;h++){let o=new i(t,s,a,e[h]);n.push(o.sprite)}return n}static preload(t,e){}}class LoaderScene extends Phaser.Scene{constructor(t){super({key:"LoaderScene",visible:!1}),this.loadProgress=0,this.levelList=t}init(){}preload(){this.load.path=this.registry.get("path"),this.game.getImage=this.getImage,this.game.config.width>=2560&&this.game.config.height>=1440?(this.res="",this.game.resolution=4):this.game.config.width>=1920&&this.game.config.height>=1080?(this.res="-L",this.game.resolution=3):this.game.config.width>=1280&&this.game.config.height>=720?(this.res="-M",this.game.resolution=2):(this.res="-S",this.game.resolution=1),this.game.res=this.res,this.levelNo=parseInt(this.game.restore("levelNo")||0);for(let t=0;t<this.levelList.length;t++)if(this.levelList[t]===LEVEL){this.levelNo=t,console.log("Level "+LEVEL);break}this.load.json("json/"+this.levelList[this.levelNo])}gameStatus(t){t.gameover&&this.restartLevel(5e3,!0),t.teleport&&(this.levelNo=t.from.teleport.to,this.restartLevel(1500,!1))}create(){let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.loading,{font:"16px Arial",fill:"#000000"}).setOrigin(.5);this.load.on("loadProgress",function(e){t.text=Text.loading+" "+parseInt(100*e)+" %"},this),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel()}loadLevel(){this.levelList&&this.levelNo>=this.levelList.length||(this.registry.set("level",null),this.load.json("json/"+this.levelList[this.levelNo]),this.load.start())}restartLevel(t,e){if(e){let t=EventDispatcher.getInstance();t.shutdown(),t.on("GameStatus",this.gameStatus.bind(this))}this.scene.setVisible(!0),this.scene.bringToTop(),this.cameras.main.alpha=1,this.cameras.main.once("camerafadeoutcomplete",()=>{e&&this.scene.manager.scenes.forEach(function(t){t!==this&&this.scene.remove(t)},this),this.time.delayedCall(100,function(){this.startLevel()},[],this)}),this.cameras.main.fadeOut(t,255,255,255)}startLevel(){let t=this.cache.json.get("json/"+this.levelList[this.levelNo]);if(!t)return this.load.once("complete",function(){this.startLevel()},this),this.load.json("json/"+this.levelList[this.levelNo]),void this.load.start();this.registry.set("level",t),this.scene.setVisible(!1),this.scene.get("GameScene")?EventDispatcher.getInstance().emit("GameStatus",{restart:!0}):this.scene.add("GameScene",new GameScene("GameScene"),!0)}getImage(t,e,i,s){return this.cache.json.get("sprites").frames[s+".png"]?new Phaser.GameObjects.Image(t,e,i,"sprites-doodd",s):new Phaser.GameObjects.Image(t,e,i,s)}loadBitmap2(t,e){this.bitmaps={frames:[]},e.forEach(function(e){t===this||this.sprites.frames[e+".png"]||t.load.bitmapFont(e,"img/"+e+this.res+".png","img/"+e+this.res+".xml")},this)}loadImages(t,e,i="png"){this.sprites={frames:[]},e.forEach(function(e){t===this||this.sprites.frames[e+"."+i]||t.load.image(e,"img/"+e+this.res+"."+i)},this)}loadSpritesheets(t,e){e.forEach(function(e){let i=e.width?e.width:e.size,s=e.height?e.height:e.size;t.load.spritesheet(e.name,"img/"+e.name+this.res+".png",{frameWidth:i*this.game.resolution,frameHeight:s*this.game.resolution})},this)}}const TEAM_COLOR=[975857,9638133,6710886,6684774],TEAM_COLOR_BG=[1907968,51,3342336,1900573],ROUTE_COLOR=[3355443,3355443,16777215,3355443];class Player{constructor(t,e){this.id=t,this.color=TEAM_COLOR[this.id],this.routeColor=ROUTE_COLOR[this.id],this.bgColor=TEAM_COLOR_BG[this.id],this.unitScene=e}addHQ(t){this.HQ=t}setTeam(t){this.team=t,this.unitScene.addTeam(this.team.id)}}class PlayerTeam{constructor(t,e,i){this.id=t,this.cardScene=e,this.unitScene=i,this.players=[]}addPlayer(t){this.players.push(t),t.setTeam(this)}}class PriorityQueue{constructor(){this.collection=[]}enqueue(t){if(this.isEmpty())this.collection.push(t);else{let e=!1;for(let i=1;i<=this.collection.length;i++)if(t[1]<this.collection[i-1][1]){this.collection.splice(i-1,0,t),e=!0;break}e||this.collection.push(t)}}dequeue(){return 0===this.collection.length?null:this.collection.shift()}dequeueExpired(t){return 0===this.collection.length?null:t>=this.collection[0][1]?this.collection.shift():null}isEmpty(){return 0===this.collection.length}clear(t){for(let e=this.collection.length-1;e>=0;e--)t===this.collection[e][2]&&this.collection.splice(e,1)}destroy(){this.collection=[]}}var Text={id:"nanorogue",gameName:"NANO ROGUE",loading:"Loading",next:"NEXT",play:"PLAY",quit:"QUIT",pause:"PAUSE",resume:"RESUME",restart:"TRY\nAGAIN",gameOverCongratulations:"All levels passed.\n\nCongratulations!",win:"YOU WIN",wait:"Wait for computer,\nmay take a minute.",setLang(t){"fi"===t&&(this.gameName="NANOBOT LIFE",this.loading="Ladataan",this.next="JATKA",this.play="PELAA",this.quit="POISTU",this.pause="PAUSE",this.resume="RESUME",this.restart="ALOITA\nALUSTA",this.gameOverCongratulations="Kaikki tasot selvitetty.\n\nOnnittelut!",this.draw="TASAN",this.win="VOITIT",this.wait="Odota tietokonetta,\nvoi kestää minuutin.")}};class UIBrain extends Phaser.GameObjects.Graphics{constructor(t){super(t),t.add.existing(this);let e=4*this.scene.game.resolution,i=this.scene.textures.get("StatusBigBg").getSourceImage().width;this.status=new UIStatus(this.scene,t.cameras.main.width-i-e,e,"StatusBig","Brain",10027161),this.bot=t.add.image(0,0,"BrainBot"),this.teleports=[]}addTeleport(t){const e=this.scene.level.grid;let i=this.status.bg.getTopLeft(),s=i.x+e.x*this.scene.game.resolution,a=i.y+e.y*this.scene.game.resolution,n=2*e.w*this.scene.game.resolution,h=2*e.h*this.scene.game.resolution,o=this.scene.add.image(s,a,"BrainTeleport");o.connection=t.teleport,o.x+=t.x/t.scene.groundLayer.width*n,o.y+=t.y/t.scene.groundLayer.height*h;for(let t=0;t<this.teleports.length;t++){let e=this.teleports[t];o.connection.from===e.connection.to&&o.connection.to===e.connection.from&&(this.lineStyle(2*this.scene.game.resolution,16776960,.5),this.lineBetween(o.x,o.y,e.x,e.y))}this.teleports.push(o)}drawPath(t,e,i,s,a,n){t.draw(e,{x:i.x,y:i.y},s,a,n)}drawConnection(t,e){let i=[t,e],s=new Phaser.Curves.Spline(i);this.lineStyle(this.level.size/12,t.player.routeColor),s.draw(this)}update(t){const e=this.scene.level.grid;let i=this.status.bg.getTopLeft(),s=i.x+e.x*this.scene.game.resolution,a=i.y+e.y*this.scene.game.resolution,n=2*e.w*this.scene.game.resolution,h=2*e.h*this.scene.game.resolution,o=t.x/t.scene.groundLayer.width*n,r=t.y/t.scene.groundLayer.height*h;this.bot.x=s+o,this.bot.y=a+r,this.bot.rotation=t.rotation+Math.PI/2}}class UIControlPad{constructor(t){this.scene=t;let e=t.add.image(0,t.cameras.main.height,"ControlPadBg").setOrigin(.5,.5);e.x=.3*e.width,e.y-=.3*e.height,e.tint=8421504,this.padMoveBg=e,this.padMove=t.add.image(e.x,e.y,"ControlPadButton"),this.padMove.tint=10079385,this.padMove.step=this.padMove.width/4,e.setInteractive({useHandCursor:!0});let i=t.add.image(t.cameras.main.width-e.x,e.y,"ControlPadBg").setOrigin(.5,.5);i.tint=8421504,this.padButtonBg=i,this.padButton=t.add.image(i.x,i.y,"ControlPadButton"),this.padButton.tint=16751001,i.setInteractive({useHandCursor:!0}),this.reset()}reset(){this.swipe=!1,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1,this.button=!1}setUnit(t){this.unit=t,this.unit.control.pad=this}onPointermove(t,e){if(!this.unit)return;let i=null;if(this.button)i=this.padButtonBg;else{if(!this.move)return;i=this.padMoveBg,this.onPointerdown(t,e)}0===e.length&&(i.x+=(t.x-i.x)/8,i.y+=(t.y-i.y)/8,i===this.padMoveBg?(this.padMove.x=this.padMoveBg.x,this.padMove.y=this.padMoveBg.y):(this.padButton.x=this.padButtonBg.x,this.padButton.y=this.padButtonBg.y))}onPointerdown(t,e){if(this.unit)return this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.unit.setTargetPosition(null),e[0]===this.padMoveBg?(this.move=!0,t.y<this.padMoveBg.y-this.padMove.step?this.up=!0:t.y>this.padMoveBg.y+this.padMove.step&&(this.down=!0),t.x<this.padMoveBg.x-this.padMove.step?this.left=!0:t.x>this.padMoveBg.x+this.padMove.step&&(this.right=!0)):e[0]===this.padButtonBg&&(this.button=!0),this.move|this.button}onPointerup(t,e){if(!this.unit)return;this.up=!1,this.down=!1,this.left=!1,this.right=!1;let i=this.move|this.button;return this.move=!1,this.button=!1,e[0]===this.padButtonBg&&i&&this.select(),e.length>0}padActive(t){t||this.move?this.padMove.tint=10551200:this.padMove.tint=10079385}select(){this.scene.select()}static preload(t,e){Array.prototype.push.apply(t,["ControlTarget","ControlPadBg","ControlPadButton"])}}class UIScene extends Phaser.Scene{constructor(t){super({key:t}),this.selectTime=0,this.moveTime=0,this.updateControlTargetTime=0}init(){this.levelNo=parseInt(this.game.restore("levelNo")||1),this.level=this.registry.get("level")}preload(){this.load.path=this.registry.get("path");let t=this.scene.get("LoaderScene"),e=["StatusBg","StatusValue","StatusEnergy","StatusBody","BrainBot","BrainTeleport","StatusBigBg","StatusBigValue","StatusBigBrain"],i=[];UIControlPad.preload(e,i),t.loadImages(this,e),t.loadSpritesheets(this,i)}create(t){this.input.enabled=!1,this.input.setTopOnly(!0),this.input.addPointer(1),this.brain=new UIBrain(this);let e=4*this.game.resolution,i=e,s=e;this.energy=new UIStatus(this,i,s,"Status","Energy",10066176),s+=this.energy.bg.height+e,this.body=new UIStatus(this,i,s,"Status","Body",10066329),this.controlPad=new UIControlPad(this),this.input.dragDistanceThreshold=16,this.input.dragTimeThreshold=500,this.upPrev=!1,this.downPrev=!1,this.leftPrev=!1,this.rightPrev=!1,EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this));var a=this.input.keyboard.addKeys("W,S,A,D");this.keys=a;let n=this.input.keyboard.createCursorKeys();var h=this.input.keyboard.addKeys(["CTRL","SPACE"]);h[0].on("down",function(){this.controlPad.select()},this),h[1].on("down",function(){this.controlPad.select()},this),this.cursors=n,this.gamepad=null,this.input.gamepad.once("connected",function(t){this.gamepad=t,this.gamepad.on(Phaser.Input.Gamepad.Events.BUTTON_DOWN,function(t){this.gamepad.left||this.gamepad.right||this.controlPad.select()},this)},this),this.input.mouse&&this.input.mouse.disableContextMenu(),this.game.input.touch.capture=!1,this.input.on("pointerup",this.onPointerup,this),this.input.on("pointerdown",this.onPointerdown,this),this.input.on("pointermove",this.onPointermove,this),t.sceneCreated&&t.sceneCreated(this),this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5)}onPointermove(t,e){this.input.enabled&&this.controlPad.onPointermove(t,e)}onPointerdown(t,e){this.input.enabled&&(this.time.now<this.moveTime||this.controlPad.onPointerdown(t,e))}onPointerup(t,e){if(!this.input.enabled)return;if(this.controlPad.onPointerup(t,e))return;if(this.time.now<this.moveTime)return;this.moveTime=this.time.now+150;let i=t.upTime-t.downTime,s=t.upX-t.downX,a=t.upY-t.downY;if(i<200){let t=64*this.game.resolution,e=Math.abs(s),i=Math.abs(a);if(e>t||i>t)return this.controlPad.swipe=!0,e>t&&(s>0?this.controlPad.right=!0:this.controlPad.left=!0),void(i>t&&(a>0?this.controlPad.down=!0:this.controlPad.up=!0))}let n=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollX:0,h=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollY:0;this.bot.setTargetPosition([t.x+n,t.y+h]),this.bot.control.target.focus=this.updateControlTarget(0,{x:t.x+n,y:t.y+h}),this.bot.control.target.focus?(this.bot.control.target.focusImage.setPosition(this.bot.control.target.focus.x,this.bot.control.target.focus.y),this.bot.control.target.focusImage.visible=!0):this.bot.control.target.focusImage.visible=!1}updateControlTarget(t,e){if(0!==t){if(t<this.updateControlTargetTime)return this.bot.control.target.unit;this.updateControlTargetTime=t+50}let i=this.bot.width,s=this.unitScene.getUnits(e.x,e.y,i*i);if(this.bot.control.target.unit=null,s)for(let t=0;t<s.length;t++){let e=s[t];if(e.route)return e}return null}update(t,e){if(this.input.enabled&&this.bot&&this.input.enabled){this.brain.update(this.bot),this.bot.control.target.unit=this.updateControlTarget(t,this.bot),null!==this.bot.control.target.unit&&this.bot.control.target.unit===this.bot.control.target.focus&&this.controlPad.select();let e=!1,i=!1,s=!1,a=!1;if(this.keys){let t=this.keys;t.W.isDown&&(e=!0),t.S.isDown&&(i=!0),t.A.isDown&&(s=!0),t.D.isDown&&(a=!0)}if(this.cursors){let t=this.cursors;t.up.isDown&&(e=!0),t.down.isDown&&(i=!0),t.left.isDown&&(s=!0),t.right.isDown&&(a=!0)}this.gamepad&&((this.gamepad.up||this.gamepad.leftStick.y<=-.5||this.gamepad.rightStick.y<=-.5)&&(e=!0),(this.gamepad.down||this.gamepad.leftStick.y>=.5||this.gamepad.rightStick.y>=.5)&&(i=!0),(this.gamepad.left||this.gamepad.leftStick.x<=-.5||this.gamepad.rightStick.x<=-.5)&&(s=!0),(this.gamepad.right||this.gamepad.leftStick.x>=.5||this.gamepad.rightStick.x>=.5)&&(a=!0)),e||i||s||a?this.controlPad.reset():(e=this.controlPad.up,i=this.controlPad.down,s=this.controlPad.left,a=this.controlPad.right);let n=!1;this.upPrev===e&&this.downPrev===i||(n=!0,this.controlPad.padMove.y=this.controlPad.padMoveBg.y,e?this.controlPad.padMove.y-=this.controlPad.padMove.step:i&&(this.controlPad.padMove.y+=this.controlPad.padMove.step),this.upPrev=e,this.downPrev=i),this.leftPrev===s&&this.rightPrev===a||(n=!0,this.controlPad.padMove.x=this.controlPad.padMoveBg.x,s?this.controlPad.padMove.x-=this.controlPad.padMove.step:a&&(this.controlPad.padMove.x+=this.controlPad.padMove.step),this.leftPrev=s,this.rightPrev=a),this.bot.doControl(e,i,s,a,n)}}setUnitSceneLevel(t,e){this.up=this.upPrev=!1,this.down=this.downPrev=!1,this.left=this.leftPrev=!1,this.right=this.rightPrev=!1,this.input.keyboard.resetKeys(),this.controlPad.reset(),this.level=e,this.unitScene&&this.unitScene.scene.sleep(),this.unitScene=t}setPlayer(t){if(this.player=t,this.bot&&(this.bot.setActive(!1),t.bot&&(t.bot.rotation=this.bot.rotation)),this.bot=t.bot,this.level.teleport){let t=this.unitScene.getHqUnits();for(let e=t.length-1;e>=0;e--){let i=t[e];if(i instanceof UnitTeleport&&this.level.teleport.from===i.teleport.to){this.bot.setPosition(i.x,i.y);break}}}this.bot.setActive(!0),this.bot.doTeleportEffect(!0,this.bot),this.unitScene.children.bringToTop(this.bot),this.controlPad.setUnit(this.bot),this.unitScene.cameras.main.startFollow(this.bot),this.unitScene.children.bringToTop(this.bot),this.bot?(this.input.keyboard.enabled=!0,this.input.enabled=!0):(this.input.keyboard.enabled=!1,this.input.enabled=!1)}select(){this.input.enabled&&(this.time.now<this.selectTime||(this.selectTime=this.time.now+150,this.tweens.addCounter({from:204,to:153,duration:125,callbackScope:this,onUpdate:function(t){const e=Math.floor(t.getValue());this.controlPad.padButton.setTint(Phaser.Display.Color.GetColor(255,e,e))}},this),this.bot&&this.bot.action(),this.controlPad.reset()))}gameStatus(t){if(t.start){this.scene.get("UnitScene");this.time.delayedCall(500,function(){},[],this)}t.gameover,t.teleport&&(this.input.keyboard.enabled=!1,this.input.enabled=!1),t.restart&&this.time.delayedCall(500,function(){this.input.keyboard.enabled=!0,this.input.enabled=!0},[],this)}closeUI(){}gameOver(t){let e;this.closeUI(),this.levelFactory.destroy(),e=0!==t.id?"YOU WIN":"YOU LOSE",this.winnerTeam||(this.winnerTeam=e,this.children.each(function(t){t.destroy(!0)}),this.cameras.main.fadeOut(150,255,255,255,function(t,e){1===e&&(this.cameras.main.fadeIn(1500,255,255,255),EventDispatcher.getInstance().emit("GameStatus",{gameover:!0,win:!1}))},this),this.selectedCard&&this.selectedCard.card.stop(),this.level.data.players.forEach(function(t){},this))}}class UIStatus extends Phaser.GameObjects.Container{constructor(t,e,i,s,a,n,h=0,o=0,r=1){super(t),this.value=h,this.min=o,this.max=r;let l=t.add.image(e,i,s+"Bg");l.x+=l.width/2,l.y+=l.height/2,l.setDepth(-1),this.bg=l,this.maskImage=t.add.image(l.x,l.y,s+"Value"),this.maskImage.setTint(n),this.maskImage.setDepth(-1),this.color=n,this.image=t.add.image(l.x,l.y,s+a),this.image.setDepth(-1),this.update(0)}update(t){if(t>0&&this.value===this.max)return!1;if(t<0&&this.value===this.min)return!1;this.value+=t,this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max),this.maskImage.clearMask(!0);let e=this.bg.getBottomLeft(),i=this.scene.make.graphics().fillStyle(16777215).fillRect(e.x,e.y,this.bg.width,-this.bg.height*(this.value/this.max));return this.maskImage.setMask(i.createGeometryMask()),!0}}Unit.Type={Bot:UnitBot,Teleport:UnitTeleport,Energy:UnitEnergy};const ZOOMTIME=500;class UnitScene extends Phaser.Scene{constructor(t,e){super({key:t}),this.debug=!0,this.cardScene=e,this.unitSprites=[],this.bulletSprites=[],this.eventQueue=new PriorityQueue,this.loser=null}init(){this.zoomTween=null}preload(){this.load.path=this.registry.get("path");let t=["BgTileCell"],e=[];Unit.preload(t,e),Object.entries(Unit.Type).forEach(function(i){i[1].preload&&i[1].preload(t,e)});let i=this.scene.get("LoaderScene");i.loadImages(this,t),i.loadSpritesheets(this,e)}create(t){this.level=t,this.createBackground(),this.scene.sendToBack(),Object.entries(Unit.Type).forEach(function(t){if(t[1].animFrameRate){let e="Unit"+t[0];this.anims.create({key:e,frames:this.anims.generateFrameNumbers(e),frameRate:t[1].animFrameRate,repeat:-1,yoyo:!1})}},this),this.hqSprites=this.physics.add.group(),this.asteroids=this.physics.add.group(),this.physics.add.collider(this.asteroids,this.asteroids),this.physics.add.overlap(this.hqSprites,this.asteroids,this.overlapUnit,null,this),this.planets=this.physics.add.group(),this.physics.add.overlap(this.asteroids,this.planets,this.overlapUnit,null,this),this.fields=this.physics.add.group(),this.physics.add.overlap(this.fields,this.fields,this.overlapUnit,null,this),this.scene.sendToBack(),this.cameras.main.setBackgroundColor("#0b032d"),t.sceneCreated&&t.sceneCreated(this)}createBackground(){let t=64*this.game.resolution;var e=[];let i=this.textures.get("BgTileCell").getSourceImage().width/this.textures.get("BgTileCell").getSourceImage().height,s=this.level.grid.w,a=this.level.grid.h;for(let t=0;t<a;t++){e[t]=[];for(let n=0;n<s;n++){if(0===t||t===a-1){e[t][n]=3;continue}let s=Phaser.Math.Between(0,i-2);e[t][n]=s}e[t][0]=3,e[t][s-1]=3}let n=this.make.tilemap({data:e,tileWidth:t,tileHeight:t});var h=n.addTilesetImage("BgTileCell","BgTileCell",t,t);let o=n.createLayer(0,h);this.groundLayer=o,o.depth=-1,o.setCollisionBetween(3,i-1)}zoomTo(t,e,i){}addTeam(t){if(this.unitSprites[t])return;let e=this.physics.add.group();e.runChildUpdate=!1;let i=this.physics.add.group();i.runChildUpdate=!1;for(let t=0;t<this.unitSprites.length;t++)this.physics.add.collider(e,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.overlap(i,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.overlap(this.bulletSprites[t],e,this.overlapUnit,null,this);this.unitSprites[t]=e,this.bulletSprites[t]=i,this.physics.add.overlap(this.hqSprites,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.collider(this.asteroids,e,this.overlapUnit,null,this),this.physics.add.overlap(this.fields,e,this.overlapUnit,null,this),this.physics.add.overlap(this.asteroids,i,this.overlapUnit,null,this),this.physics.add.overlap(this.planets,e,this.overlapUnit,null,this)}addBullet(t,e){this.bulletSprites[t].add(e),e.scene=this,this.add.existing(e),this.debug&&(e.body.debugShowBody=!0,e.body.debugShowVelocity=!0)}overlapUnit(t,e){this.physics.world.isPaused||t.overlap(e)}scaleResolution(t){return t*this.game.resolution}explode(t){let e=this.add.particles("explode");e.createEmitter({frame:[2],x:t.x,y:t.y,speed:{start:this.scaleResolution(150),end:this.scaleResolution(-150)},quantity:5,ease:"Power2",lifespan:1500,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(100),end:this.scaleResolution(-100)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(75),end:this.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}});e.createGravityWell({x:t.x,y:t.y,power:2,epsilon:100,gravity:t.scene.scaleResolution(8)});this.time.delayedCall(2e3,function(){e.destroy()},this)}showGameOver(t,e,i,s,a,n,h){this.input.enabled=!1;let o=this.add.group();this.cardScene.input.once("pointerdown",function(){o.destroy(!0),o=null,this.input.enabled=!0},this);let r=this.add.graphics();if(o.add(r),r.fillStyle(0,.5),r.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),this.level.tutorial.img)return void this.add.image(this.cameras.main.centerX,this.cameras.main.centerY/3,"tutorial-drag-to-select");let l=-1===e?this.cameras.main.centerX:e*n,d=-1===i?this.cameras.main.centerY:i*h,c=o.create(l,d,"sprites","alice.png");if(c.setDepth(10),c.alpha=0,a){let t=o.create(a[0]*n,a[1]*h,"sprites","hand.png");t.x<this.cameras.main.width/2&&(t.scaleX=-1),this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:a.length>2?2:4,yoyo:!0,callbackScope:this,onComplete:function(){o&&(a.length>2?(t.scaleX=1,t.x=a[2]*n,t.y=a[3]*h,this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:1,yoyo:!0,callbackScope:this,onComplete:function(){}},this)):t.destroy())}},this)}this.tweens.add({targets:c,duration:400,alpha:1,delay:s/4,repeat:1,callbackScope:this,onComplete:function(){if(!o)return;let e=o.create(c.x,c.y+c.height/2,"sprites","dialog.png");e.setDepth(10);let i=e.width/12,s=this.add.text(e.x,e.y-e.width/26/2,t,{fontFamily:"Source Code Pro",fontSize:i,color:"#000",align:"center"}).setOrigin(.5);s.setDepth(10),o.add(s)}},this)}gameOver(t){if(!this.loser){if(0!==t.id){let t=!1;if(this.level.data.players.forEach(function(e){0!==e.id&&e.HQ&&(t=!0)},this),t)return}this.loser=t,this.cardScene.gameOver(t),this.time.removeAllEvents(),this.physics.pause(),this.eventQueue.destroy(),this.physics.world.colliders.destroy()}}destroyed(){for(let t=0;t<this.unitSprites.length;t++){let e=this.unitSprites[t];e.runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0)}let i=this.bulletSprites[t];i.runChildUpdate=!1;for(let t=0,e=i.getChildren().length;t<e;t++){i.getChildren()[t].destroy(!0)}}this.hqSprites.runChildUpdate=!1;for(let t=this.hqSprites.getChildren().length-1;t>=0;t--){this.hqSprites.getChildren()[t].destroy(!0)}this.planets.runChildUpdate=!1;for(let t=this.planets.getChildren().length-1;t>=0;t--){this.planets.getChildren()[t].destroy(!0)}this.asteroids.runChildUpdate=!1;for(let t=this.asteroids.getChildren().length-1;t>=0;t--){this.asteroids.getChildren()[t].destroy(!0)}this.eventQueue.destroy()}getHqUnits(){return this.hqSprites.getChildren()}getUnits(t,e,i){let s=[],a=this.hqSprites.getChildren();for(let n=a.length-1;n>=0;n--){let h=a[n];i?Phaser.Math.Distance.Squared(t,e,h.x,h.y)<i&&s.push(h):h.getBounds().contains(t,e)&&s.push(h)}for(let n=(a=this.fields.getChildren()).length-1;n>=0;n--){let h=a[n];i?Phaser.Math.Distance.Squared(t,e,h.x,h.y)<i&&s.push(h):h.getBounds().contains(t,e)&&s.push(h)}return s}addEvent(t,e,i){this.eventQueue.enqueue([t,this.time.now+e,i])}clearEvents(t){this.eventQueue.clear(t)}preUpdate(){}update(t,e){if(this.loser)return;let i=this.eventQueue.dequeueExpired(t);for(;null!==i;)i[0].call(i[2]),i=this.eventQueue.dequeueExpired(t)}}class MainGame extends Phaser.Game{constructor(t,e,i){let s=t.offsetWidth,a=t.offsetHeight;window.devicePixelRatio>=2||window.devicePixelRatio;super({key:t.id,type:Phaser.AUTO,parent:t,width:s,height:a,backgroundColor:"#202f53",audio:{noAudio:!0},physics:{default:"arcade",arcade:{debug:!1,fps:60}},render:{},scale:{zoom:1,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{touch:{capture:!0},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene(e)]});let n=document.getElementsByTagName("html")[0].getAttribute("lang");n&&Text.setLang(n),-1!==window.location.href.indexOf("localhost:8383")?(this.registry.set("debug",!0),this.registry.set("path","./")):(this.registry.set("release",!0),this.registry.set("path","/"+Text.id+"/")),this.registry.set("gameid",i)}clear(t){window.localStorage.removeItem(this.registry.get("gameid")+t)}save(t,e){window.localStorage.setItem(this.registry.get("gameid")+t,e)}restore(t){return window.localStorage.getItem(this.registry.get("gameid")+t)}}const LEVEL="";function createGame(){var t=new URL(window.location).searchParams.get("id")||"";window.game=new MainGame(document.getElementById("canvas"),["level-0","level-1","level-2","level-3","level-4","level-5","level-6"],Text.id+t)}function setGameConfig(t,e,i){}function log(t){console.log(t)}