/*! Copyright minimind 28-02-2021 */

let UnitActionConnect=t=>(class extends t{connectInit(t){this.connect=t;const e=this.connect;e.start=this.connectStart,e.stop=this.connectStop,e.started=!1,e.range=this.scene.scaleResolution(this.connect.range),e.rangeSquared=this.connect.range*this.connect.range,e.target=null;let i=this.scene.add.sprite(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY,"laser");this.scene.anims.create({key:"Laser",frames:this.scene.anims.generateFrameNumbers("Laser"),frameRate:8,repeat:-1,yoyo:!1}),i.anims.play("Laser"),i.visible=!1,i.setOrigin(0,.5),this.laser=i,this.laser.setTint(16724787)}connectDeinit(){this.laser.destroy(),this.connect.started&&this.connectStop()}connectStart(t){const e=this.connect;e.started=!0,e.target=t,e.target.addListener(this),this.connectDo(),this.laser.visible=!0}connectStop(){const t=this.connect;t.started=!1,this.lastX=this.x,this.lastY=this.y;let e=this.control.target.unit;e||(e=new UnitRoute(this.scene,this.lastX,this.lastY,this.player,{})),this.connect.target.addRoute(e),this.laser.visible=!1,t.target.removeListener(this),t.target=null}connectDo(){this.connect;this.laser.x=this.x,this.laser.y=this.y;let t=Phaser.Math.Angle.BetweenPoints(this.laser,this.connect.target);this.laser.setRotation(t);var e=Phaser.Math.Distance.Between(this.laser.x,this.laser.y,this.connect.target.x,this.connect.target.y);this.laser.scaleX=e/this.laser.width}}),UnitActionControl=t=>(class extends t{controlInit(t){this.control=t,this.control.started=!1,this.targetPosition=null,this.targetPositionImage=this.scene.add.image(0,0,"ControlTarget"),this.targetPositionImage.visible=!1,this.control.target={unit:null,focus:null,focusImage:this.scene.add.image(this.x,this.y,UnitBot.name+"Target"),img:this.scene.add.image(this.x,this.y,UnitBot.name+"Target")},this.control.target.img.visible=!1,this.control.target.focusImage.visible=!1,this.control.target.focusImage.tint=10066329,this.control.action=null}controlDeinit(){this.control.started&&this.controlStop()}controlStart(){const t=this.control;this.setDrag(1.5*this.body.maxSpeed),this.body.setAllowDrag(!0),t.started=!0}controlStop(){t.started=!1;const t=this.control}controlDo(t,e,i,s,n){const a=this.control;if(null===a.action){if(t||e||i||s){n&&this.controlResume(null);let h=this,r=this.x,o=this.y;t?o-=a.speed:e&&(o+=a.speed),i?r-=a.speed:s&&(r+=a.speed);let l=Phaser.Math.Angle.Between(h.x,h.y,r,o);h.rotation=Phaser.Math.Angle.RotateTo(h.rotation,l,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}else if(n)this.controlPause();else if(this.targetPosition){let t=Phaser.Math.Angle.Between(this.x,this.y,this.targetPosition[0],this.targetPosition[1]);this.rotation=Phaser.Math.Angle.RotateTo(this.rotation,t,a.turnSpeed),this.scene.physics.velocityFromRotation(this.rotation,this.body.maxSpeed,this.body.acceleration)}if(null!==this.targetPosition){Phaser.Math.Distance.Squared(this.x,this.y,this.targetPosition[0],this.targetPosition[1])<this.targetPositionProximity&&this.controlPause()}}else n&&(t||e||i||s)&&a.action.actionSelect(t,e,i,s)}controlPause(){this.setFrame(0),this.body.setAcceleration(0),null!==this.targetPosition&&(this.targetPositionImage.visible=!1,this.targetPosition=null)}controlResume(t){if(this.targetPosition=t,this.setFrame(1),t){this.targetPositionImage.setPosition(t[0],t[1]);let e=Phaser.Math.Distance.Squared(this.x,this.y,t[0],t[1]);this.targetPositionProximity=e/5,this.targetPositionProximity>this.width*this.width*2&&(this.targetPositionProximity=this.width*this.width*2)}this.targetPositionImage.visible=null!==t}controlPoint(t){if(null!==this.control.action)return this.controlPause(),!1;if(t){if(this.getBounds().contains(t[0],t[1]))return this.control.pad.select(),!0;this.controlResume(t)}else this.controlPause();return!0}controlAction(t){const e=this.control;return this.currentAction?(this.currentAction.stop.call(this),void(this.currentAction=null)):e.action?(e.action.actionActivate(),void(e.action=null)):(e.target.unit&&(this.currentAction||(e.action=e.target.unit,e.action.menuStart(this),e.target.unit=null,e.target.img.visible=!1,e.target.focus=null,e.target.focusImage.visible=!1)),void this.controlPause())}}),UnitActionMenu=t=>(class extends t{menuInit(t={}){this.action=t;const e=this.action;e.started=!1,e.list=t.actions,e.actions=[],e.selected=null}menuDeinit(){this.action.started&&this.menuStop()}menuStart(t){const e=this.action;if(e.started=!0,e.actions.push(new UIAction(this,"ActionCancel")),!this.unit.disabled)for(let i=0;i<e.list.length;i++){let s=e.list[i];s===Unit.Action.Connect&&e.actions.push(new UIAction(this,"ActionConnect",t,t.connect,"up")),s===Unit.Action.Teleport&&e.actions.push(new UIAction(this,"ActionTeleport",t,t.teleport,"right"))}e.selected=e.actions[0]}menuStop(){const t=this.action;for(t.started=!1;t.actions.length>0;){let e=t.actions.shift();this.scene.tweens.add({targets:[e.first,e.next],alpha:0,ease:"Power1",duration:750,onCompleteScope:this,onComplete:function(){e.destroy()}},this)}}menuSelect(t,e,i){const s=this.action;if(!s.started)return null;for(let i=0;i<s.actions.length;i++){let n=s.actions[i];if(n.first.setTexture("ActionBg"),n.first.getBounds().contains(t,e))return s.selected=n,this.actionActivate(),null}return this}actionSelect(t,e,i,s){const n=this.action;for(let t=0;t<n.actions.length;t++){n.actions[t].first.setTexture("ActionBg")}let a=0;n.selected!==n.actions[0]?a=0:(t?a=1:e&&(a=2),i&&(a=3),s&&(a=4)),a>=n.actions.length&&(a=n.actions.length-1),n.selected=n.actions[a],n.selected.first.setTexture("ActionBg-active")}actionActivate(){let t=this.action.selected;t.first.setTexture("ActionBg-active");this.scene.tweens.add({targets:[t.first,t.next],scale:1.25,ease:"Power1",duration:750,onCompleteScope:this,onComplete:function(){t.action&&t.actionUnit.activateAction(t.action,t.menuUnit)}},this),this.menuStop()}}),UnitActionProduce=t=>(class extends t{produceInit(t){this.produce=t,this.produce.started=!1,0===this.unit.damage&&this.produceStart()}produceDeinit(){produce.started&&this.produceStop()}produceStart(){this.produce.started=!0,this.produce.delay>0&&(this.produce.timeout=this.produce.delay,this.scene.addEvent(this.produceDo,this.produce.timeout,this))}produceStop(){this.produce.started=!1,this.produce.timeout=0}produceDo(){if(this.unit.disabled>0)return;if(this.produce.timeout>0&&this.scene.addEvent(this.produceDo,this.produce.timeout,this),0===this.route.connectHq.length)return;new UnitElement(this.scene,this.x,this.y,this.player,{parent:this}).unit.gravity=this}}),UnitActionRoute=t=>(class extends t{routeInit(t){this.route=t;const e=this.route;e.started=!1,e.rangeMin=this.width,e.rangeMinSquared=e.rangeMin*e.rangeMin,e.range=this.scene.scaleResolution(t.range),e.rangeSquared=e.range*e.range,e.sources=[],e.targets=[],e.connectHq=[]}routeDeinit(){this.route.started&&this.stopRoute()}startRoute(){this.route.started=!0}stopRoute(){this.route.started=!1,this.clearRoutes()}clearRoutes(){const t=this.route;t.sources.forEach(function(t){t.routeTargetRemove(this)},this),t.sources=[],t.targets.forEach(function(t){t.routeSourceRemove(this)},this),t.targets=[]}updateRoutes(){const t=this.route;this.stopRoute();const e=this.scene.hqSprites.getChildren();for(let i=e.length-1;i>=0;i--){let s=e[i];s!==this&&s.player.id===this.player.id&&(Phaser.Math.Distance.Squared(s.x,s.y,this.x,this.y),t.rangeSquared)}}addRoute(t){const e=this.route;for(let i=0;i<e.targets.length;i++){if(e.targets[i]===t)return;if(e.sources[i]===t)return}e.targets.push(t),t.route.sources.push(this),this.scene.unitMap.refresh(this)}routeTargetRemove(t){const e=this.route;for(let i=0;i<e.targets.length;i++)if(e.targets[i]===t){e.targets.splice(i,1),this.scene.unitMap.refresh();break}}routeSourceRemove(t){const e=this.route;for(let i=0;i<e.sources.length;i++)if(e.sources[i]===t){e.sources.splice(i,1),this.scene.unitMap.refresh();break}}drawRoute(t){const e=this.route;if(t){const t=this.scene;this.dragTexture&&this.dragTexture.destroy(),this.dragTexture=t.add.renderTexture(this.x,this.y,2*e.range,2*e.range),this.dragTexture.setOrigin(.5);let i=new Phaser.GameObjects.Graphics(t);i.fillStyle(16711935,.25),i.setBlendMode(Phaser.BlendModes.SCREEN),i.fillCircle(e.range,e.range,e.range),this.dragTexture.draw(i),i.destroy(),this.positionGraphics=t.add.graphics(),this.positionGraphics.setDepth(-2),this.invalidArea=t.add.graphics(),this.invalidArea.setDepth(-2),this.invalidArea.setBlendMode(Phaser.BlendModes.SCREEN),this.lastX=-1,this.lastY=-1}else this.dragTexture.visible=!1,this.positionGraphics.destroy(),this.invalidArea.destroy();this.routeEnabled=t}drawValidRouted(t){let e=null;this.positionGraphics.clear(),e=t.hqSprites.getChildren(),this.invalidArea.clear();for(let i=(e=t.hqSprites.getChildren()).length-1;i>=0;i--){let t=e[i];this.invalidArea.fillStyle(3342336,1),this.invalidArea.fillCircle(t.x,t.y,t.route.rangeMin)}for(let i=(e=t.planets.getChildren()).length-1;i>=0;i--){let t=e[i];this.invalidArea.fillStyle(3342336,1),this.invalidArea.fillCircle(t.x,t.y,t.width)}}uiAction(t){log("remove"),this.unit.damage>0?this.heal():t.bot.connectStart(this)}}),UnitActionTeleport=t=>(class extends t{teleportInit(t={}){this.teleport=t;const e=this.teleport;e.start=this.teleportStart,e.stop=this.teleportStop,e.started=!1,this.teleport.from=null,this.teleport.to=null}teleportDeinit(){this.teleport.started&&teleportStop()}teleportStart(t){this.teleport.started=!0,this.teleportDo(t)}teleportStop(){this.teleport.started=!1}teleportEffect(t,e){this.teleport;this.scene.time.addEvent({delay:200,callback:()=>{let t=this.scene.add.image(e.x,e.y,"EffectTeleport");this.scene.tweens.add({targets:t,scale:10,ease:"Linear",duration:1250,alpha:0,onComplete:function(){t.destroy()}})},callbackScope:this,repeat:1});t&&this.setScale(0),this.scene.tweens.add({targets:this,ease:"Quad.easeOut",duration:1250,scale:t?1:0,alpha:t?1:0})}teleportDo(t){this.teleport;if(t.unit.damage>0)return t.tint=10066329,void this.scene.time.addEvent({delay:500,callback:()=>{t.clearTint()},callbackScope:this});this.controlPoint(null),this.teleport.from=t,this.teleportEffect(!1,this.teleport.from),EventDispatcher.getInstance().emit("GameStatus",{teleport:!0,from:t}),this.x=this.teleport.from.x,this.y=this.teleport.from.y,this.body.setVelocity(0),this.body.setAcceleration(0),this.stop()}}),UnitActionWatch=t=>(class extends t{watchInit(t={}){this.watch=t;const e=this.watch;e.started=!1,e.rangeSquared=e.range*e.range}watchDeinit(){this.watch.started&&this.watchStop()}watchStart(){this.watch.started=!0}watchStop(){this.watch.started=!1}});class Unit extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,n,a){super(t,e,i,s),this.player=a,this.scene.anims.exists(s)&&this.anims.play(s),this.action=null,this.id=Unit.id++}toString(){return this.id}startUnit(t){this.unit=t,0===this.unit.damage?this.unit.disabled=!1:this.unit.disabled=!0,this.unit.listeners=[],this.unit.watchListeners=[],this.unit.tint=0,this.unit.freeze=0,this.unit.level=t.level||1,this.unit.damage=t.damage||0,this.unit.defenceFactor=t.defenceFactor||1,this.body.mass=t.mass||this.width,this.body.maxSpeed=this.scene.scaleResolution(t.maxSpeed||Unit.speedMax),this.body.allowDrag=!1,this.body.allowGravity=!1,this.unit.sizeSquared=this.width*this.width/2,t.damageSize&&(this.unit.levelMax>=2&&(this.unit.damageImage2=this.scene.add.image(this.x,this.y,"damage-"+(t.damageSize+10)),this.unit.damageImage2.setDepth(-1),this.unit.level<this.unit.levelMax?(this.unit.damageImage2.alpha=.25,this.unit.damageImage2.setFrame(this.unit.damageImage2.texture.frameTotal-2)):this.unit.damageImage2.setTint(this.player.color)),this.unit.damageImage=this.scene.add.image(this.x,this.y,"Unit-damage-"+t.damageSize,0),this.unit.damageImage.setDepth(-1),this.unit.damageImage.setTint(this.player.color),this.updateDamageImage())}stopUnit(){this.unit.damageImage&&this.unit.damageImage.destroy(),this.unit.damageImage2&&this.unit.damageImage2.destroy(),this.notify("stop"),this.unit.listeners=[],this.unit.watchListeners=[],this.scene.clearEvents(this)}addWatch(t){-1===this.unit.watchListeners.indexOf(t)&&this.unit.watchListeners.push(t)}removeWatch(t){let e=this.unit.watchListeners.indexOf(t);-1!==e&&this.unit.watchListeners.splice(e,1)}watchNotify(){for(let t=this.unit.watchListeners.length-1;t>=0;t--)this.unit.watchListeners[t].watchDo(this)}addListener(t){-1===this.unit.listeners.indexOf(t)&&this.unit.listeners.push(t)}removeListener(t){let e=this.unit.listeners.indexOf(t);-1!==e&&this.unit.listeners.splice(e,1)}notify(t){for(let e=this.unit.listeners.length-1;e>=0;e--)this.unit.listeners[e].event(this,t)}event(t,e){}updateDamageImage(){if(1===this.unit.level){let t=this.unit.damageImage.texture.frameTotal-2,e=Math.trunc(t*(this.unit.health-this.unit.damage)/this.unit.health);this.unit.damageImage.setFrame(e)}else{let t=this.unit.health/2;if(this.unit.damage<t){let e=this.unit.damageImage.texture.frameTotal-2;this.unit.damageImage.setFrame(e);let i=Math.trunc(e*(t-this.unit.damage)/t);this.unit.damageImage2.setFrame(i),this.unit.damageImage2.alpha=1}else{let e=this.unit.damageImage.texture.frameTotal-2;this.unit.damageImage2.setFrame(e-1),this.unit.damageImage2.alpha=.5;let i=Math.trunc(e*(this.unit.health-this.unit.damage)/t);this.unit.damageImage.setFrame(i)}}}setPlayer(t){0===t.id&&this.sound("claim"),0===this.player.id&&this.sound("lose"),this.notify("stop");let e=[this.unit.damageImage];this.scene.tweens.add({targets:e,duration:150,scaleX:0,callbackScope:this,rotation:Math.PI,onComplete:function(t){this.scene.tweens.add({targets:e,duration:150,scaleX:1,callbackScope:this,rotation:0,onComplete:function(t){this.unit.damageImage.setTint(this.player.color)}},this)}},this),this.player=t,this.unit.level=1,this.updateDamage(),this.updateRoutes(),this.unit.damageImage2&&(this.unit.damageImage2.alpha=.25,this.unit.damageImage2.setTint(16777215))}unitDamage(t){this.unit.damage;return this.unit.damage+=t*this.unit.defenceFactor,this.unit.damage>this.unit.health?(this.unit.damage=this.unit.health,!0):(this.updateDamage(),!1)}heal(){this.scene.cardScene.bot.spawnEnergy(this.scene.cardScene,this)}damageEnemy(t){if(this.player.team.id!==t.player.team.id){let e=t.unit.health-t.unit.damage;t.unitDamage(this.unit.health-this.unit.damage)&&t.destroy(),this.unitDamage(e)&&this.destroy()}}overlapEnemy(t){let e=t.unit.health-t.unit.damage;return t.unitDamage(this.unit.health-this.unit.damage)&&t.destroy(),!!this.unitDamage(e)&&(this.unit.damage=this.unit.health-(this.unit.damage-this.unit.health),!0)}overlapFriend(t){if(t instanceof UnitElement&&this.unit.damage>0){let e=t.unit.health-t.unit.damage;this.unit.level>1&&(e/=this.unit.level),e/=2,this.unit.damage-=e,this.unit.damage<0&&(this.unit.damage=0),t.destroy(),this.updateDamage()}}overlap(t){this.unit.damage&&(t.unit.activeDelay>0||(this.player.team.id===t.player.team.id?this.overlapFriend(t):this.damageEnemy(t)))}unitMapUpdated(){}explodeEffect(){let t=this.scene.add.particles("Unit-explode");t.createEmitter({frame:[2],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(112.5),end:this.scene.scaleResolution(-112.5)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),t.createEmitter({frame:[0],x:this.x,y:this.y,speed:{start:this.scene.scaleResolution(75),end:this.scene.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:750,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),this.scene.time.delayedCall(1e3,function(){t.destroy()},this)}uiAction(t){}sound(t){this.scene.cardScene.audio.play(t)}static preload(t,e){e.push({name:"Unit-damage-10",size:10});for(let t=40;t<=40;t+=10)e.push({name:"Unit-damage-"+t,size:t})}}Unit.id=1,Unit.speedMax=40,Unit.defaultHealth=100,Unit.defaultMass=100,Unit.defaultSpeed=150,Unit.Action={Connect:UnitActionConnect,Teleport:UnitActionTeleport};class UnitBot extends(UnitActionConnect(UnitActionTeleport(UnitActionControl(Unit)))){constructor(t,e,i,s,n){super(t,e,i,UnitBot.name,0,s),t.unitSprites[this.player.team.id].add(this,!0),this.startUnit({health:Unit.defaultHealth,mass:Unit.defaultMass,maxSpeed:Unit.defaultSpeed}),this.controlInit({speed:1,turnSpeed:.25}),this.controlStart(),this.teleportInit({}),this.connectInit({range:50}),this.body.setSize(this.width/2,this.height/2),this.scene.physics.add.collider(this,this.scene.groundLayer,this.collideGround.bind(this)),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.scene.cardScene.bot=null,this.connectDeinit(),this.teleportDeinit(),this.controlDeinit(),this.stopUnit()}event(t,e){"stop"===e&&t===this.shoot.target&&this.setShootTarget(null)}createElement(){new UnitElement(this.scene,this.x,this.y,this.player,{parent:this}).unit.gravity=this}updateDamage(){let t=this.damage.texture.frameTotal-1,e=t-Math.trunc(t*(this.unit.health-this.unit.damage-1)/this.unit.health);this.damage.setFrame(e-1)}shootUnit(t){this.shoot.target.unit.damage<this.shoot.target.unit.health?this.shoot.target.unitDamage(this.shoot.damage):(this.shoot.target.destroy(),this.laser.visible=!1)}collideGround(){}preUpdate2(){}menuSelect(t,e){this.control.action=this.control.action.menuSelect(t,e,this)}uiAction(t){this.controlAction(t)}spawnEnergy(t,e){let i=0;for(;t.energy.update(-1/24);)i+=500,this.scene.addEvent(this.createElement,i,e)}update(){this.watchNotify();let t=null,e=this.width,i=this.scene.getUnits(this.x,this.y,e*e);if(i)for(let e=0;e<i.length;e++){let s=i[e];if(s.action){t=s;break}}t!==this.control.target.unit&&(this.control.target.unit=t,t&&(this.control.target.img.x=t.x,this.control.target.img.y=t.y),this.control.target.img.visible=!!t),this.control.target.focus&&this.control.target.unit===this.control.target.focus&&(this.currentAction?(this.currentAction.stop.call(this),this.currentAction=null):this.control.pad.select(),this.control.target.focus=null,this.control.target.focusImage.visible=!1),this.connect.target&&this.connectDo()}activateAction(t,e){this.currentAction=t,t.start.call(this,e)}static preload(t,e){t.push("EffectTeleport"),t.push(UnitBot.name+"Target"),e.push({name:UnitBot.name,size:32}),e.push({name:"Laser",width:30,height:8})}}UnitBot.name="UnitBot";class UnitElement extends Unit{constructor(t,e,i,s,n){let a=n?n.frame:0;super(t,e,i,UnitElement.name,a,s),t.unitSprites[this.player.team.id].add(this,!0),this.body.setAllowRotation(!1),this.setTint(this.player.color),this.target=null,this.startUnit({health:n.health||UnitElement.health,parent:n.parent,gravity:n.parent,activeDelay:1500}),this.decay={timeout:300},this.followPath()||this.spawn(),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.decay.timeout=0,this.pathFollower&&this.pathFollower.destroy(!0),this.stopUnit();let t=this.scene.add.image(this.x,this.y,UnitElement.name+"-flash");this.scene.tweens.add({targets:t,duration:.5,alpha:0,onComplete:function(){t.destroy()}},this)}eventGravityDecay(){this.unit.activeDelay>0&&(this.unit.activeDelay-=this.decay,this.unit.activeDelay<0&&(this.unit.activeDelay=0)),this.unit.tint>0&&(this.unit.tint--,0===this.unit.tint&&this.setTint(this.player.color)),0!==this.decay.timeout&&(this.unit.damage+=.1,this.unit.damage>this.unit.health?this.destroy():(this.updateDamage(),this.scene.addEvent(this.eventGravityDecay,this.decay.timeout,this),this.unit.gravity.body&&this.scene.physics.accelerateToObject(this,this.unit.gravity,this.unit.gravity.body.mass)))}updateDamage(){let t=this.texture.frameTotal-1,e=t-Math.trunc(t*(this.unit.health-this.unit.damage-1)/this.unit.health);e>0&&e--,this.setFrame(e)}followPath(){if(this.unit.damage>0)return!1;let t=null,e=null;if(this.unit.parent.healPaths){let i=Object.keys(this.unit.parent.healPaths);for(let s=i.length-1;s>=0;s--){let n=this.unit.parent.healPaths[i[s]];n[n.length-1].damage>0&&(t=n,e=this.unit.parent.healCurve[i[s]])}}if(null===t&&this.unit.parent.paths){let i=Object.keys(this.unit.parent.paths);if(i.length>0){let s=i.length*Math.random()<<0;t=this.unit.parent.paths[i[s]],e=this.unit.parent.curve[i[s]]}}if(null===t||t.length<=1)return!1;this.unit.parent=t[t.length-1],this.body.enable=!1,this.visible=!1;let i=new Phaser.Curves.Path(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)i.lineTo(t[e].x,t[e].y);return this.pathFollower=this.scene.add.follower(i,t[0].x,t[0].y,UnitElement.name),this.pathFollower.setTint(13421772),this.pathFollower.startFollow({duration:500*t.length,onComplete:(e,i)=>{if(this.x=this.pathFollower.x,this.y=this.pathFollower.y,this.pathFollower.destroy(!0),this.pathFollower=null,0===this.decay.timeout)return this.destroy(),!1;this.followPath()||(this.unit.gravity=t[t.length-1],this.spawn())}}),!0}spawn(){this.scene.addEvent(this.eventGravityDecay,this.decay.timeout,this),this.body.enable=!0,this.visible=!0,this.alpha=1;let t=this.scene.scaleResolution(.75*Unit.speedMax);this.rotation=Phaser.Math.RND.rotation(),this.scene.physics.velocityFromRotation(this.rotation,t,this.body.velocity);this.setAngularAcceleration(Phaser.Math.RND.between(100,300)),this.setAngularVelocity(Phaser.Math.RND.between(100,300))}static preload(t,e){t.push(UnitElement.name+"-flash"),e.push({name:UnitElement.name,size:8})}}UnitElement.name="UnitElement",UnitElement.health=8;class UnitEmitter extends(UnitActionProduce(UnitActionRoute(UnitActionMenu(Unit)))){constructor(t,e,i,s,n){super(t,e,i,UnitEmitter.name,0,s),t.hqSprites.add(this,!0),this.body.move=!1,this.body.immovable=!0,this.startUnit({health:4*UnitElement.health,damage:0,damageSize:40,mass:200,levelMax:n.levelMax||1}),this.routeInit({range:100}),this.route.connectHq=[this],this.updateRoutes(),this.produceInit({delay:n.produceDelay||1e3}),this.menuInit({actions:[Unit.Action.Connect]}),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.rotateTween&&this.rotateTween.remove(),this.menuDeinit(),this.produceDeinit(),this.routeDeinit(),this.stopUnit()}NotUseduiAction2(t){this.unit.damage>0?this.heal():(this.drawRoute(!0),t.bot.connectStart(this))}updateDamage(){this.updateDamageImage(),0===this.unit.damage&&(this.produceStart(),this.rotateTween=this.scene.tweens.add({targets:this,duration:5e3,rotation:2*Math.PI,callbackScope:this,repeat:-1,onComplete:function(t){}},this))}damageEnemy(t){}unitMapUpdated(t){if(null!==t)for(let e=this.route.sources.length-1;e>=0;e--)t.drawConnection(this,this.route.sources[e])}unitMapUpdated2(t){if(null===t||!this.player.HQ)return this.produceStop(),void this.scene.clearEvents(this);if(this.route.connectHq=t.findUnitPath(this.player.HQ,this),this.route.connectHq.length>0){this.produceStart(),this.produce.timeout=this.produce.delay,t.drawConnectHq(this);for(let e=this.route.sources.length-1;e>=0;e--)t.drawConnection(this,this.route.sources[e]);this.route.connectHq=this.route.connectHq.reverse(),this.route.curveToHq=new Phaser.Curves.Spline(this.route.connectHq)}}upgradeLevel(){}static preload(t,e){e.push({name:UnitEmitter.name,size:32})}}UnitEmitter.name="UnitEmitter";class UnitEnergy extends(UnitActionWatch(Unit)){constructor(t,e,i,s,n){super(t,e,i,UnitEnergy.name,n.frame,s),t.fields.add(this,!0),this.body.move=!1,this.body.immovable=!0,this.startUnit({mass:0}),this.energy=!0,n.range=3*this.width,this.watchInit(n),this.watchStart(),s.bot.addWatch(this)}watchDo(t){if(Phaser.Math.Distance.Squared(this.x,this.y,t.x,t.y)<=this.watch.rangeSquared){let e=this.scene.cardScene.energy;e.update(.25)&&(t.removeWatch(this),this.consumeBy(t,e),this.destroy())}}consumeBy(t,e){{let i=this.scene.add.image(this.x,this.y,"UnitEnergy");e.bg.tint=0,this.scene.tweens.add({targets:i,ease:"Power1",duration:150,x:t.x,y:t.y,scale:0,angle:360,onComplete:function(){e.bg.clearTint(),i.destroy()}})}}unitDamage(){}static preload(t,e){e.push({name:UnitEnergy.name,size:16})}}UnitEnergy.name="UnitEnergy";class UnitRoute extends(UnitActionRoute(UnitActionMenu(Unit))){constructor(t,e,i,s,n){super(t,e,i,UnitRoute.name,0,s),t.hqSprites.add(this,!0),this.startUnit({health:UnitElement.health,damage:UnitElement.health,damageSize:10}),this.routeInit({range:100}),this.updateRoutes(),this.menuInit({actions:[Unit.Action.Connect]}),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.menuDeinit(),this.routeDeinit(),this.stopUnit()}updateDamage(){this.updateDamageImage()}unitMapUpdated2(t){if(null!==t&&this.player.HQ){this.route.connectHq=t.findUnitPath(this.player.HQ,this);for(let e=this.route.sources.length-1;e>=0;e--)t.drawConnection(this,this.route.sources[e])}}unitMapUpdated(t){if(null===t)return this.unit.disabled=!0,void this.scene.clearEvents(this);(this.route.sources.length>0||this.route.targets.length>0)&&(this.unit.disabled=!1);let e=this.scene.getHqUnits();for(let i=0;i<e.length;i++)e[i]instanceof UnitEmitter&&(this.route.connectHq=t.findUnitPath(e[i],this));for(let e=this.route.sources.length-1;e>=0;e--)t.drawConnection(this,this.route.sources[e])}static preload(t,e){t.push(UnitRoute.name)}}UnitRoute.name="UnitRoute";class UnitTeleport extends(UnitActionRoute(UnitActionWatch(UnitActionMenu(Unit)))){constructor(t,e,i,s,n){super(t,e,i,UnitTeleport.name,0,s),t.hqSprites.add(this,!0),this.teleport=n,this.body.move=!1,this.body.immovable=!0,this.startUnit({}),this.routeInit({range:100}),this.updateRoutes(),n.range=this.scene.cameras.main.centerX,this.watchInit(n),this.watchStart(),this.anims.pause(),this.menuInit({actions:[Unit.Action.Connect,Unit.Action.Teleport]}),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){this.menuDeinit(),this.watchDeinit(),this.routeDeinit(),this.stopUnit()}disabledBy(t){this.unit.disabled=t,this.unit.disabled.addListener(this),this.anims.pause()}event(t,e){t===this.unit.disabled&&"stop"===e&&(this.unit.disabled=!1,this.anims.resume())}watchDo(t){Phaser.Math.Distance.Squared(this.x,this.y,t.x,t.y)<=this.watch.rangeSquared&&(t.removeWatch(this),this.scene.cardScene.brain.addTeleport(this))}uiAction(t){this.anims.isPaused||t.bot.teleportDo(this)}updateDamage(){}unitMapUpdated(t){if(null===t)return this.unit.disabled=!0,this.anims.pause(),void this.scene.clearEvents(this);(this.route.sources.length>0||this.route.targets.length>0)&&(this.unit.disabled=!1,this.anims.resume());for(let e=this.route.sources.length-1;e>=0;e--)t.drawConnection(this,this.route.sources[e])}static preload(t,e){e.push({name:UnitTeleport.name,size:32})}}UnitTeleport.name="UnitTeleport",UnitTeleport.animFrameRate=30;class CardContainer extends Phaser.GameObjects.Container{constructor(t,e,i,s){super(t,e,i),this.origX=e,this.origY=i,t.add.existing(this),this.containerImage=t.add.image(0,0,"sprites","card-disabled.png"),this.setSize(this.containerImage.width,this.containerImage.height),this.add(this.containerImage),this.visible=!0,this.active=!1,this.deck=s,this.sprite=null}setCard(t){if(null===t){for(;this.getAt(1);)this.removeAt(1,!0);this.card=null}else this.card=t,this.add(new Phaser.GameObjects.Image(this.scene,0,0,"sprites",this.card.name+".png")),this.card.container=this,this.card.costImage=this.scene.add.image(this.width/2,this.height/2,"Card-costs",this.card.cost),this.card.costImage.x-=this.card.costImage.width/2,this.card.costImage.y-=this.card.costImage.height/2,this.add(this.card.costImage),this.card.costImage.visible=!0;this.active=null!==t}enabled(){return this.deck.energyValue>=this.card.cost}enable(t){this.input&&this.input.enabled===t||t&&this.card.started||(this.containerImage.setTexture("sprites",t?"card-enabled.png":"card-disabled.png"),t?(this.setInteractive(),this.scene.input.setDraggable(this)):this.disableInteractive())}select(t,e){this.card&&this.card.select(t,e),t?this.x+=this.width/5:this.x-=this.width/5}}class EventDispatcher extends Phaser.Events.EventEmitter{constructor(){super()}static getInstance(){return null===EventDispatcher.instance&&(EventDispatcher.instance=new EventDispatcher),EventDispatcher.instance}}EventDispatcher.instance=null;class GameScene extends Phaser.Scene{constructor(t){super({key:t}),this.teleports=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]]}init(){this.firstGameToday=!1,parseInt(0|this.game.restore("lastPlayTime"))+43200<(Date.now()/1e3|0)&&(this.firstGameToday=!0)}preload(){this.load.path=this.registry.get("path");this.scene.get("LoaderScene")}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5),this.cameras.main.setBackgroundColor("#666"),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.input.once(Phaser.Input.Events.POINTER_UP,()=>{this.startGame()}),this.input.keyboard.once("keyup",()=>{this.startGame()}),this.input.gamepad.once("connected",function(t){this.startGame()}),this.startLevel(),this.level.end||this.startGame()}startGame(){this.scene.sleep(),EventDispatcher.getInstance().emit("GameStatus",{start:!0});let t=this.registry.get("level");this.level=t,t.players&&this.startUIScene()}startLevel(){let t=this.registry.get("level");this.level=t,t.end}startUIScene(){let t=this.scene.get("UIScene");if(t)t.scene.wake(),this.sceneCreated(t);else{t=this.scene.add("UIScene",new UIScene("UIScene"));let e=0;this.scene.run(t,{sceneCreated:this.sceneCreated.bind(this),layout:{y:e,x:e,h:this.cameras.main.height-e,w:this.cameras.main.width-e}})}this.uiScene=t}sceneCreated(t){if(this.level.teleport=this.teleport,t===this.uiScene){let e=this.level,i="UnitScene-"+e.id,s=this.scene.get(i);s?(s.scene.wake(),this.uiScene.setUnitSceneLevel(s,this.level),this.uiScene.setPlayer(e.data.players[0])):(s=this.scene.add(i,new UnitScene(i,t)),e.sceneCreated=this.sceneCreated.bind(this),this.scene.run(s,e)),this.unitScene=s}else t===this.unitScene&&(this.uiScene.setUnitSceneLevel(t,this.level),this.unitScene.levelFactory||(this.unitScene.levelFactory=new LevelFactory(this.uiScene,this.unitScene,this.level,this.teleports)));this.scene.bringToTop()}gameStatus(t){if(t.start&&this.scene.setVisible(!1),t.restart&&(this.startLevel(),this.startGame()),t.teleport){this.registry.get("level");this.teleport=t.from.teleport;let e="UIScene";this.scene.get(e)}t.gameover}handleLoseFocus(){console.log("handleLoseFocus")}}class LevelFactory{constructor(t,e,i,s){this.units=[],this.events=[],i.data={players:[],playerTeams:[]};let n=-1;for(let s=0;s<i.players.length;s++)i.data.players[s]=new Player(s,e),i.data.players[s].id=s,i.players[s].team>=0?n=i.players[s].team:n++,i.data.playerTeams[n]||(i.data.playerTeams[n]=new PlayerTeam(n,t,e)),i.data.playerTeams[n].addPlayer(i.data.players[s]);let a=null;for(let t=0;t<i.players.length;t++){let s=i.players[t],n=i.data.players[t];a=this.createUnits(e,s.bot,UnitBot,n)[0]}let h=i.data.players[0];if(h.bot=a,i.event)for(let t=0;t<i.event.length;t++){let e=i.event[t],s=this.getUnitById(e.unit);e.disable&&(e.disableUnit=this.getUnitById(e.disable)),this.events.push(new LevelEvent(s,e))}for(let t=0;t<this.units.length;t++)this.units[t].notify("start");this.units=null;let r=[],o=this.createTeleports(e,i,s,h);Array.prototype.push.apply(r,o);this.createEmitters(e,i,0,h,o),this.createEnergy(e,i,[],h);let l=64*e.game.resolution,c=i.grid.w;i.grid.h;a.x=Phaser.Math.Between(2,c-2),a.x*=l,a.y=Phaser.Math.Between(2,c-2),a.y*=l,h.bot=a,t.setPlayer(h);for(let t=0;t<r.length;t++){let e=r[t];a.addWatch(e)}}createTeleports(t,e,i,s){let n=[];for(let a=0;a<i.length;a++){let h=i[a];if(h[0]===e.id||h[1]===e.id){let i=64*t.game.resolution,a=Phaser.Math.Between(2,e.grid.w-2)*i,r=Phaser.Math.Between(2,e.grid.h-2)*i,o=h[0]===e.id?h[1]:h[0],l=new UnitTeleport(t,a,r,s,{from:e.id,to:o});n.push(l)}}return n}createEmitters(t,e,i,s,n){for(let i=0;i<1;i++){let a=n[i],h=this.relocateUnit(t,e,a,2,5);new UnitEmitter(t,h.x,h.y,s,e)}}createEnergy(t,e,i,s){let n=[];for(let i=0;i<e.grid.w+e.grid.h;i+=5){let i=64*t.game.resolution,a=Phaser.Math.Between(2,e.grid.w-2)*i,h=Phaser.Math.Between(2,e.grid.h-2)*i,r=new UnitEnergy(t,a,h,s,e);n.push(r)}return n}relocateUnit(t,e,i,s,n){let a,h,r=64*t.game.resolution;do{a=i.x;let t=Phaser.Math.Between(s,n)*r;0===Phaser.Math.Between(0,1)&&(t=-t),a+=t}while(a<1*r||a>e.grid.w*r-r);do{h=i.y;let t=Phaser.Math.Between(s,n)*r;0===Phaser.Math.Between(0,1)&&(t=-t),h+=t}while(h<1*r||h>e.grid.w*r-r);return{x:a,y:h}}destroy(){for(let t=0;t<this.events.length;t++)this.events[t].destroy();this.events=null}createUnits(t,e,i,s){let n=[];if(e)for(let a=0;a<e.length;a++){let h=e[a];this.dx=100,this.dx2=0,this.dy=100,this.dy2=0;let r=new i(t,h.x*this.dx-this.dx2,h.y*this.dy-this.dy2,s,h);n.push(r),this.units.push(r),h.id&&(r.id=h.id)}return n}getUnitById(t){for(let e=0;e<this.units.length;e++)if(this.units[e].id===t)return this.units[e];return null}createUnits2(t,e,i,s,n){let a=[];if(e)for(let h=0;h<e.length;h++){let r=new i(t,s,n,e[h]);a.push(r.sprite)}return a}static preload(t,e){}}class LoaderScene extends Phaser.Scene{constructor(t){super({key:"LoaderScene",visible:!1}),this.loadProgress=0,this.levelList=t}init(){}preload(){this.load.path=this.registry.get("path"),this.game.getImage=this.getImage,this.game.config.width>=2560&&this.game.config.height>=1440?(this.res="",this.game.resolution=4):this.game.config.width>=1920&&this.game.config.height>=1080?(this.res="-L",this.game.resolution=3):this.game.config.width>=1280&&this.game.config.height>=720?(this.res="-M",this.game.resolution=2):(this.res="-S",this.game.resolution=1),this.game.res=this.res,this.levelNo=parseInt(this.game.restore("levelNo")||0);for(let t=0;t<this.levelList.length;t++)if(this.levelList[t]===LEVEL){this.levelNo=t,console.log("Level "+LEVEL);break}this.load.json("json/"+this.levelList[this.levelNo])}gameStatus(t){t.gameover&&this.restartLevel(5e3,!0),t.teleport&&(this.levelNo=t.from.teleport.to,this.restartLevel(1500,!1))}checkOriention(t,e){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE}create(){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY/2,"",{font:16*this.game.resolution+"px Arial",fill:"#ffff00"}).setOrigin(.5);let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,Text.loading,{font:16*this.game.resolution+"px Arial",fill:"#000000"}).setOrigin(.5);this.load.on("loadProgress",function(e){t.text=Text.loading+" "+parseInt(100*e)+" %"},this),EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this)),this.startLevel()}loadLevel(){this.levelList&&this.levelNo>=this.levelList.length||(this.registry.set("level",null),this.load.json("json/"+this.levelList[this.levelNo]),this.load.start())}restartLevel(t,e){if(e){let t=EventDispatcher.getInstance();t.shutdown(),t.on("GameStatus",this.gameStatus.bind(this))}this.scene.setVisible(!0),this.scene.bringToTop(),this.cameras.main.alpha=1,this.cameras.main.once("camerafadeoutcomplete",()=>{e&&this.scene.manager.scenes.forEach(function(t){t!==this&&this.scene.remove(t)},this),this.time.delayedCall(100,function(){this.startLevel()},[],this)}),this.cameras.main.fadeOut(t,255,255,255)}startLevel(){let t=this.cache.json.get("json/"+this.levelList[this.levelNo]);if(!t)return this.load.once("complete",function(){this.startLevel()},this),this.load.json("json/"+this.levelList[this.levelNo]),void this.load.start();this.registry.set("level",t),this.scene.setVisible(!1),this.scene.get("GameScene")?EventDispatcher.getInstance().emit("GameStatus",{restart:!0}):this.scene.add("GameScene",new GameScene("GameScene"),!0)}getImage(t,e,i,s){return this.cache.json.get("sprites").frames[s+".png"]?new Phaser.GameObjects.Image(t,e,i,"sprites-doodd",s):new Phaser.GameObjects.Image(t,e,i,s)}loadBitmap2(t,e){this.bitmaps={frames:[]},e.forEach(function(e){t===this||this.sprites.frames[e+".png"]||t.load.bitmapFont(e,"img/"+e+this.res+".png","img/"+e+this.res+".xml")},this)}loadImages(t,e,i="png"){this.sprites={frames:[]},e.forEach(function(e){if(t!==this&&!this.sprites.frames[e+"."+i]){let s="";this.registry.get("debug")&&(s="?t="+Date.now()),t.load.image(e,"img/"+e+this.res+"."+i+s)}},this)}loadSpritesheets(t,e){e.forEach(function(e){let i=e.width?e.width:e.size,s=e.height?e.height:e.size,n="";this.registry.get("debug")&&(n="?t="+Date.now()),t.load.spritesheet(e.name,"img/"+e.name+this.res+".png"+n,{frameWidth:i*this.game.resolution,frameHeight:s*this.game.resolution})},this)}}const TEAM_COLOR=[16777011,9638133,6710886,6684774],TEAM_COLOR_BG=[1907968,51,3342336,1900573],ROUTE_COLOR=[10066227,3355443,16777215,3355443];class Player{constructor(t,e){this.id=t,this.color=TEAM_COLOR[this.id],this.routeColor=ROUTE_COLOR[this.id],this.bgColor=TEAM_COLOR_BG[this.id],this.unitScene=e}addHQ(t){this.HQ=t}setTeam(t){this.team=t,this.unitScene.addTeam(this.team.id)}}class PlayerTeam{constructor(t,e,i){this.id=t,this.cardScene=e,this.unitScene=i,this.players=[]}addPlayer(t){this.players.push(t),t.setTeam(this)}}class PriorityQueue{constructor(){this.collection=[]}enqueue(t){if(this.isEmpty())this.collection.push(t);else{let e=!1;for(let i=1;i<=this.collection.length;i++)if(t[1]<this.collection[i-1][1]){this.collection.splice(i-1,0,t),e=!0;break}e||this.collection.push(t)}}dequeue(){return 0===this.collection.length?null:this.collection.shift()}dequeueExpired(t){return 0===this.collection.length?null:t>=this.collection[0][1]?this.collection.shift():null}isEmpty(){return 0===this.collection.length}clear(t){for(let e=this.collection.length-1;e>=0;e--)t===this.collection[e][2]&&this.collection.splice(e,1)}destroy(){this.collection=[]}}var Text={id:"minimind",gameName:"minimind",loading:"Loading",next:"NEXT",play:"PLAY",quit:"QUIT",pause:"PAUSE",resume:"RESUME",restart:"TRY\nAGAIN",gameOverCongratulations:"All levels passed.\n\nCongratulations!",win:"YOU WIN",wait:"Wait for computer,\nmay take a minute.",setLang(t){"fi"===t&&(this.gameName="NANOBOT LIFE",this.loading="Ladataan",this.next="JATKA",this.play="PELAA",this.quit="POISTU",this.pause="PAUSE",this.resume="RESUME",this.restart="ALOITA\nALUSTA",this.gameOverCongratulations="Kaikki tasot selvitetty.\n\nOnnittelut!",this.draw="TASAN",this.win="VOITIT",this.wait="Odota tietokonetta,\nvoi kestää minuutin.")}};class UIAction extends Phaser.GameObjects.Container{constructor(t,e,i=null,s=null,n="center"){let a=t.scene.cardScene;super(a),a.add.existing(this),this.menuUnit=t,this.actionUnit=i,this.action=s;let h=a.cameras.main.centerX,r=a.cameras.main.centerY,o=new Phaser.GameObjects.Image(a,h,r,"ActionCancel"===e?"ActionBg-active":"ActionBg");this.add(o);let l=new Phaser.GameObjects.Image(a,h,r,e);this.add(l),"up"===n?this.y-=1.25*o.height:"down"===n?this.y+=1.25*o.height:"left"===n?this.x-=1.25*o.width:"right"===n&&(this.x+=1.25*o.width),this.on(Phaser.GameObjects.Events.DESTROY,this.destroyed)}destroyed(){}}class UIBrain extends Phaser.GameObjects.Graphics{constructor(t){super(t),t.add.existing(this);let e=4*this.scene.game.resolution,i=this.scene.textures.get("StatusBigBg").getSourceImage().width;this.status=new UIStatus(this.scene,t.cameras.main.width-i-e,e,"StatusBig","Brain",10027161),this.bot=t.add.image(0,0,"BrainBot"),this.teleports=[],this.reset(this.scene.level.grid),this.lastUpdate=0}reset(t){let e=this.status.bg.getTopLeft();this.x0=e.x+t.x*this.scene.game.resolution,this.y0=e.y+t.y*this.scene.game.resolution,this.w0=2*t.w*this.scene.game.resolution,this.h0=2*t.h*this.scene.game.resolution,this.dd=0}addTeleport(t){let e=this.scene.add.image(this.x0,this.y0,"BrainTeleport");e.connection=t.teleport,e.x+=t.x/t.scene.groundLayer.width*this.w0,e.y+=t.y/t.scene.groundLayer.height*this.h0;for(let t=0;t<this.teleports.length;t++){let i=this.teleports[t];e.connection.from===i.connection.to&&e.connection.to===i.connection.from&&(this.lineStyle(2*this.scene.game.resolution,16776960,.5),this.lineBetween(e.x,e.y,i.x,i.y))}this.teleports.push(e)}update(t){if(this.scene.time.now<this.updateTime)return;this.updateTime=this.scene.time.now+340,0===this.dd&&(this.dd=this.w0/t.scene.groundLayer.width);let e=t.x*this.dd,i=t.y*this.dd;this.bot.x=this.x0+e,this.bot.y=this.y0+i,this.bot.rotation=t.rotation+Math.PI/2}}class UIControl{constructor(t){this.scene=t;let e=t.add.image(0,t.cameras.main.height,"ControlPadBg").setOrigin(.5,.5);e.x=.3*e.width,e.y-=.3*e.height,e.tint=8421504,this.padMoveBg=e,this.padMove=t.add.image(e.x,e.y,"ControlPadButton"),this.padMove.tint=10079385,this.padMove.step=this.padMove.width/4;let i=t.add.image(t.cameras.main.width-e.x,e.y,"ControlPadBg").setOrigin(.5,.5);i.tint=8421504,this.padButtonBg=i,this.padButton=t.add.image(i.x,i.y,"ControlPadButton"),this.padButton.tint=16751001,this.reset()}resetMove(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1}resetButton(){this.button=!1}reset(){this.resetMove(),this.resetButton()}setUnit(t){this.unit=t,this.unit.control.pad=this}isPointerOver(t){return this.padMoveBg.getBounds().contains(t.x,t.y)?this.padMoveBg:this.padButtonBg.getBounds().contains(t.x,t.y)?this.padButtonBg:null}onPointermove(t,e,i){if(!this.unit)return;let s=null;if(this.padButtonBg.pointerId===t.id){s=this.padButtonBg,this.isPointerOver(t)||(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padButton.x=this.padButtonBg.x,this.padButton.y=this.padButtonBg.y)}else if(this.padMoveBg.pointerId===t.id){s=this.padMoveBg,this.isPointerOver(t)?this.updatePadmove(t):(s.x+=(t.x-s.x)/8,s.y+=(t.y-s.y)/8,this.padMove.x=this.padMoveBg.x,this.padMove.y=this.padMoveBg.y)}else this.isPointerOver(t)||(this.padMove.tint=10551200,this.unit.controlPoint([t.x+e,t.y+i]))}onPointerdown(t){if(!this.unit)return;this.update(!1,!1,!1,!1),this.unit.controlPoint(null);let e=this.isPointerOver(t);return e===this.padMoveBg?(this.move=!0,e.pointerId=t.id):e===this.padButtonBg&&(e.pointerId=t.id,this.button=!0),this.move|this.button}updatePadmove(t){let e=!1,i=!1;t.y<this.padMoveBg.y-this.padMove.step?e=!0:t.y>this.padMoveBg.y+this.padMove.step&&(i=!0);let s=!1,n=!1;t.x<this.padMoveBg.x-this.padMove.step?s=!0:t.x>this.padMoveBg.x+this.padMove.step&&(n=!0),this.update(e,i,s,n)}onPointerup(t,e,i){if(!this.unit)return;this.update(!1,!1,!1,!1);this.move,this.button;this.padMoveBg.pointerId===t.id&&(this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.move=!1,this.padMoveBg.pointerId=-1),this.padButtonBg.pointerId===t.id&&(this.button=!1,this.padButtonBg.pointerId=-1);let s=this.isPointerOver(t);if(s)s===this.padButtonBg&&this.select();else if(this.unit.controlPoint([t.x+e,t.y+i])){this.unit.control.target.unit=null,this.unit.control.target.focus=null;let s=this.unit.width,n=this.unit.scene.getUnits(t.x+e,t.y+i,s*s);if(n)for(let t=0;t<n.length;t++){let e=n[t];if(e.action){this.unit.control.target.focus=e;break}}this.unit.control.target.focus?(this.unit.control.target.focusImage.setPosition(this.unit.control.target.focus.x,this.unit.control.target.focus.y),this.unit.control.target.focusImage.visible=!0):this.unit.control.target.focusImage.visible=!1}else this.unit.menuSelect(t.x,t.y),this.scene.input.enabled=!1,this.scene.time.delayedCall(250,function(){this.scene.input.enabled=!0},[],this)}padActive2(t){t||this.move?this.padMove.tint=10551200:this.padMove.tint=10079385}update(t,e,i,s){if(t!==this.up||e!==this.down||i!==this.left||s!==this.right){this.up=t,this.down=e,this.left=i,this.right=s,this.unit.controlPoint(null),this.padMove.y=this.padMoveBg.y,this.up?this.padMove.y-=this.padMove.step:this.down&&(this.padMove.y+=this.padMove.step),this.padMove.x=this.padMoveBg.x,this.left?this.padMove.x-=this.padMove.step:this.right&&(this.padMove.x+=this.padMove.step),this.unit.controlDo(t,e,i,s,!0);let n=t||e||i||s;this.padMove.tint=n?10551200:10079385}}refresh(){this.unit.controlDo(this.up,this.down,this.left,this.right,!1)}select(){this.scene.select()}static preload(t,e){Array.prototype.push.apply(t,["ControlTarget","ControlPadBg","ControlPadButton"])}}class UIScene extends Phaser.Scene{constructor(t){super({key:t}),this.selectTime=0,this.moveTime=0,this.updateControlTargetTime=0}init(){this.levelNo=parseInt(this.game.restore("levelNo")||1),this.level=this.registry.get("level")}preload(){this.load.path=this.registry.get("path");let t=this.scene.get("LoaderScene"),e=["ActionBg","ActionBg-active","ActionCancel","ActionConnect","ActionTeleport","StatusBg","StatusValue","StatusEnergy","StatusBody","BrainBot","BrainTeleport","StatusBigBg","StatusBigValue","StatusBigBrain"],i=[];UIControl.preload(e,i),t.loadImages(this,e),t.loadSpritesheets(this,i)}create(t){this.debugInfo=this.add.text(this.cameras.main.centerX,this.cameras.main.height,"",{font:16*this.game.resolution+"px Arial",fill:"#ffffff"}).setOrigin(.5),this.debugInfo.y-=this.debugInfo.height,this.input.enabled=!1,this.input.setTopOnly(!0),this.input.addPointer(1),this.brain=new UIBrain(this);let e=4*this.game.resolution,i=e,s=e;this.energy=new UIStatus(this,i,s,"Status","Energy",10066176),s+=this.energy.bg.height+e,this.body=new UIStatus(this,i,s,"Status","Body",10066329),this.controlPad=new UIControl(this),this.input.dragDistanceThreshold=16,this.input.dragTimeThreshold=500,this.upPrev=!1,this.downPrev=!1,this.leftPrev=!1,this.rightPrev=!1,EventDispatcher.getInstance().on("GameStatus",this.gameStatus.bind(this));var n=this.input.keyboard.addKeys("W,S,A,D");this.keys=n;let a=this.input.keyboard.createCursorKeys();var h=this.input.keyboard.addKeys(["CTRL","SPACE"]);h[0].on("down",function(){this.controlPad.select()},this),h[1].on("down",function(){this.controlPad.select()},this),this.cursors=a,this.gamepad=null,this.input.gamepad.once("connected",function(t){this.gamepad=t,this.gamepad.on(Phaser.Input.Gamepad.Events.BUTTON_DOWN,function(t){this.gamepad.left||this.gamepad.right||this.controlPad.select()},this)},this),this.input.mouse&&this.input.mouse.disableContextMenu(),this.game.input.touch.capture=!1,this.input.on("pointerup",this.onPointerup,this),this.input.on("pointerdown",this.onPointerdown,this),this.input.on("pointermove",this.onPointermove,this),t.sceneCreated&&t.sceneCreated(this)}onPointermove(t){if(!this.input.enabled)return;let e=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollX:0,i=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollY:0;this.controlPad.onPointermove(t,e,i)}onPointerdown(t){this.input.enabled&&(this.time.now<this.moveTime||this.controlPad.onPointerdown(t))}onPointerup(t){if(!this.input.enabled)return;if(this.time.now<this.moveTime)return;this.moveTime=this.time.now+150;let e=t.upTime-t.downTime,i=t.upX-t.downX,s=t.upY-t.downY;if(e<200){let t=64*this.game.resolution,e=Math.abs(i),n=Math.abs(s);if(e>t||n>t){let a=!1,h=!1,r=!1,o=!1;return e>t&&(i>0?a=!0:h=!0),n>t&&(s>0?o=!0:r=!0),void this.controlPad.update(r,o,h,a)}}let n=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollX:0,a=1===this.unitScene.cameras.main.zoom?this.unitScene.cameras.main.scrollY:0;this.controlPad.onPointerup(t,n,a)}updateControlTarget2(t,e){if(0!==t){if(t<this.updateControlTargetTime)return this.bot.control.target.unit;this.updateControlTargetTime=t+50}let i=this.bot.width,s=this.unitScene.getUnits(e.x,e.y,i*i);if(this.bot.control.target.unit=null,s)for(let t=0;t<s.length;t++){let e=s[t];if(e.action)return e}return null}update(t,e){if(this.debugInfo.text="FPS "+parseInt(this.game.loop.actualFps),this.input.enabled&&this.bot&&this.input.enabled){this.brain.update(this.bot),this.bot.update();let t=!1,e=!1,i=!1,s=!1;if(this.keys){let n=this.keys;n.W.isDown&&(t=!0),n.S.isDown&&(e=!0),n.A.isDown&&(i=!0),n.D.isDown&&(s=!0)}if(this.cursors){let n=this.cursors;n.up.isDown&&(t=!0),n.down.isDown&&(e=!0),n.left.isDown&&(i=!0),n.right.isDown&&(s=!0)}this.gamepad&&((this.gamepad.up||this.gamepad.leftStick.y<=-.5||this.gamepad.rightStick.y<=-.5)&&(t=!0),(this.gamepad.down||this.gamepad.leftStick.y>=.5||this.gamepad.rightStick.y>=.5)&&(e=!0),(this.gamepad.left||this.gamepad.leftStick.x<=-.5||this.gamepad.rightStick.x<=-.5)&&(i=!0),(this.gamepad.right||this.gamepad.leftStick.x>=.5||this.gamepad.rightStick.x>=.5)&&(s=!0)),this.upPrev===t&&this.downPrev===e&&this.leftPrev===i&&this.rightPrev===s||(this.upPrev=t,this.downPrev=e,this.leftPrev=i,this.rightPrev=s,this.controlPad.update(t,e,i,s)),this.controlPad.refresh()}}setUnitSceneLevel(t,e){this.up=this.upPrev=!1,this.down=this.downPrev=!1,this.left=this.leftPrev=!1,this.right=this.rightPrev=!1,this.input.keyboard.resetKeys(),this.controlPad.reset(),this.level=e,this.unitScene&&this.unitScene.scene.sleep(),this.unitScene=t}setPlayer(t){if(this.player=t,this.bot&&(this.bot.setActive(!1),t.bot&&(t.bot.rotation=this.bot.rotation)),this.bot=t.bot,this.level.teleport){let t=this.unitScene.getHqUnits();for(let e=t.length-1;e>=0;e--){let i=t[e];if(i instanceof UnitTeleport&&this.level.teleport.from===i.teleport.to){this.bot.setPosition(i.x,i.y);break}}}this.bot.setActive(!0),this.bot.teleportEffect(!0,this.bot),this.unitScene.children.bringToTop(this.bot),this.controlPad.setUnit(this.bot),this.unitScene.cameras.main.startFollow(this.bot),this.unitScene.children.bringToTop(this.bot),this.bot?(this.brain.reset(this.level.grid),this.input.keyboard.enabled=!0,this.input.enabled=!0):(this.input.keyboard.enabled=!1,this.input.enabled=!1)}select(){this.input.enabled&&(this.time.now<this.selectTime||(this.selectTime=this.time.now+150,this.tweens.addCounter({from:204,to:153,duration:125,callbackScope:this,onUpdate:function(t){const e=Math.floor(t.getValue());this.controlPad.padButton.setTint(Phaser.Display.Color.GetColor(255,e,e))}},this),this.bot&&this.bot.uiAction(this)))}gameStatus(t){if(t.start){this.scene.get("UnitScene");this.time.delayedCall(500,function(){},[],this)}t.gameover,t.teleport&&(this.input.keyboard.enabled=!1,this.input.enabled=!1),t.restart&&this.time.delayedCall(500,function(){this.input.keyboard.enabled=!0,this.input.enabled=!0},[],this)}closeUI(){}gameOver(t){let e;this.closeUI(),this.levelFactory.destroy(),e=0!==t.id?"YOU WIN":"YOU LOSE",this.winnerTeam||(this.winnerTeam=e,this.children.each(function(t){t.destroy(!0)}),this.cameras.main.fadeOut(150,255,255,255,function(t,e){1===e&&(this.cameras.main.fadeIn(1500,255,255,255),EventDispatcher.getInstance().emit("GameStatus",{gameover:!0,win:!1}))},this),this.selectedCard&&this.selectedCard.card.stop(),this.level.data.players.forEach(function(t){},this))}}class UIStatus extends Phaser.GameObjects.Container{constructor(t,e,i,s,n,a,h=0,r=0,o=1){super(t),this.value=h,this.min=r,this.max=o;let l=t.add.image(e,i,s+"Bg");l.x+=l.width/2,l.y+=l.height/2,l.setDepth(-1),this.bg=l,this.maskImage=t.add.image(l.x,l.y,s+"Value"),this.maskImage.setTint(a),this.maskImage.setDepth(-1),this.color=a,this.image=t.add.image(l.x,l.y,s+n),this.image.setDepth(-1),this.update(0)}update(t){return!(t>0&&this.value+t>this.max)&&(!(t<0&&this.value+t<this.min)&&(this.value+=t,this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max),!0))}reset(){return this.value}}class UnitMap extends Phaser.GameObjects.Group{constructor(t,e,i){super(t),this.level=e,t.add.existing(this),this.hqSprites=i,this.adjacencyList={},this.updateList=[]}refresh(t){this.updateList.length>0||(this.updateList.push(t),this.scene.addEvent(this.update,0,this))}findUnitPath(t,e){let i={},s={};this.hqSprites.getChildren().forEach(t=>{i[t]=1/0}),i[t]=0;let n=new PriorityQueue;n.enqueue([t,0]);let a=n.dequeue();for(;null!==a;){let t=a[0];if(null===t)break;for(let e=t.route.targets.length-1;e>=0;e--){let a=t.route.targets[e],h=1,r=i[t]+h;r<i[a]&&(i[a]=r,s[a]=t,n.enqueue([a,r]))}for(let e=t.route.sources.length-1;e>=0;e--){let a=t.route.sources[e],h=1,r=i[t]+h;r<i[a]&&(i[a]=r,s[a]=t,n.enqueue([a,r]))}a=n.dequeue()}let h=[e],r=e;for(;r!==t;)if(h.unshift(s[r]),!(r=s[r]))return[];return h}update(){this.updateList.pop(),this.clear();this.unconnectedSprites=[];this.connectedSprites=[];let t=this.scene.cardScene.selectedCard;t&&(t.card.select(!1),t.card.select(!0));let e=[];this.rotating=e;const i=this.hqSprites.getChildren();for(let t=i.length-1;t>=0;t--){i[t].unitMapUpdated(null)}const s=this.hqSprites.getChildren();for(let t=s.length-1;t>=0;t--){s[t].unitMapUpdated(this)}this.rotateTween&&this.rotateTween.remove(),this.rotateTween=this.scene.tweens.add({targets:e,duration:5e3,rotation:2*Math.PI,callbackScope:this,repeat:-1,onComplete:function(t){}},this)}drawPath2(t,e,i,s,n,a){t.draw(e,{x:i.x,y:i.y},s,n,a)}loopTargets(t){if(!0!==t.visited){t.visited=!0;for(let e=t.route.targets.length-1;e>=0;e--){let i=t.route.targets[e];i.isConnectedToHq=!0,this.connectedArr.push(i.sprite),this.tagConnected(i)}}}drawConnectHq(t){t.route.connectHq.length}drawConnection(t,e){let i=this.create(t.x,t.y,"UnitMapPipe");i.setOrigin(0,.5);let s=Phaser.Math.Angle.BetweenPoints(t,e);i.setRotation(s);var n=Phaser.Math.Distance.Between(i.x,i.y,e.x,e.y);i.scaleX=n/i.width,i.setDepth(-1),i.setTint(16777011)}}Unit.Type={Bot:UnitBot,Teleport:UnitTeleport,Energy:UnitEnergy,Emitter:UnitEmitter,Element:UnitElement,Route:UnitRoute};const ZOOMTIME=500;class UnitScene extends Phaser.Scene{constructor(t,e){super({key:t}),this.debug=!0,this.cardScene=e,this.unitSprites=[],this.bulletSprites=[],this.eventQueue=new PriorityQueue,this.loser=null}init(){this.zoomTween=null}preload(){this.load.path=this.registry.get("path");let t=["UnitMapPipe","BgTileCell"],e=[];Unit.preload(t,e),Object.entries(Unit.Type).forEach(function(i){i[1].preload&&i[1].preload(t,e)});let i=this.scene.get("LoaderScene");i.loadImages(this,t),i.loadSpritesheets(this,e)}create(t){this.level=t,this.createBackground(),this.scene.sendToBack(),Object.entries(Unit.Type).forEach(function(t){if(t[1].animFrameRate){let e="Unit"+t[0];this.anims.create({key:e,frames:this.anims.generateFrameNumbers(e),frameRate:t[1].animFrameRate,repeat:-1,yoyo:!1})}},this),this.hqSprites=this.physics.add.group(),this.asteroids=this.physics.add.group(),this.physics.add.collider(this.asteroids,this.asteroids),this.physics.add.overlap(this.hqSprites,this.asteroids,this.overlapUnit,null,this),this.planets=this.physics.add.group(),this.physics.add.overlap(this.asteroids,this.planets,this.overlapUnit,null,this),this.fields=this.physics.add.group(),this.unitMap=new UnitMap(this,this.level,this.hqSprites),this.scene.sendToBack(),this.cameras.main.setBackgroundColor("#0b032d"),t.sceneCreated&&t.sceneCreated(this)}createBackground(){let t=64*this.game.resolution;var e=[];let i=this.textures.get("BgTileCell").getSourceImage().width/this.textures.get("BgTileCell").getSourceImage().height,s=this.level.grid.w,n=this.level.grid.h;for(let t=0;t<n;t++){e[t]=[];for(let a=0;a<s;a++){if(0===t||t===n-1){e[t][a]=3;continue}let s=Phaser.Math.Between(0,i-2);e[t][a]=s}e[t][0]=3,e[t][s-1]=3}let a=this.make.tilemap({data:e,tileWidth:t,tileHeight:t});var h=a.addTilesetImage("BgTileCell","BgTileCell",t,t);let r=a.createLayer(0,h);this.groundLayer=r,r.depth=-1,r.setCollisionBetween(3,i-1)}createEnergy(){let t=64*this.game.resolution,e=Phaser.Math.Between(2,this.level.grid.w-2)*t,i=Phaser.Math.Between(2,this.level.grid.h-2)*t,s=new UnitEnergy(this,e,i,this.cardScene.player,this.level);s.setScale(0),this.tweens.add({targets:s,scale:1,ease:"Linear",duration:250}),this.addEvent(this.createEnergy,3e4,this)}zoomTo(t,e,i){}addTeam(t){if(this.unitSprites[t])return;let e=this.physics.add.group();e.runChildUpdate=!1;let i=this.physics.add.group();i.runChildUpdate=!1;for(let t=0;t<this.unitSprites.length;t++)this.physics.add.collider(e,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.overlap(i,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.overlap(this.bulletSprites[t],e,this.overlapUnit,null,this);this.unitSprites[t]=e,this.bulletSprites[t]=i,this.physics.add.overlap(this.hqSprites,this.unitSprites[t],this.overlapUnit,null,this),this.physics.add.collider(this.asteroids,e,this.overlapUnit,null,this),this.physics.add.overlap(this.asteroids,i,this.overlapUnit,null,this),this.physics.add.overlap(this.planets,e,this.overlapUnit,null,this)}addBullet(t,e){this.bulletSprites[t].add(e),e.scene=this,this.add.existing(e),this.debug&&(e.body.debugShowBody=!0,e.body.debugShowVelocity=!0)}overlapUnit(t,e){this.physics.world.isPaused||t.overlap(e)}scaleResolution(t){return t*this.game.resolution}explode(t){let e=this.add.particles("explode");e.createEmitter({frame:[2],x:t.x,y:t.y,speed:{start:this.scaleResolution(150),end:this.scaleResolution(-150)},quantity:5,ease:"Power2",lifespan:1500,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(100),end:this.scaleResolution(-100)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:100,blendMode:"SCREEN",alpha:{start:1,end:0}}),e.createEmitter({frame:[0],x:t.x,y:t.y,speed:{start:this.scaleResolution(75),end:this.scaleResolution(-75)},quantity:5,ease:"Power2",lifespan:1e3,maxParticles:50,blendMode:"SCREEN",alpha:{start:1,end:0}});e.createGravityWell({x:t.x,y:t.y,power:2,epsilon:100,gravity:t.scene.scaleResolution(8)});this.time.delayedCall(2e3,function(){e.destroy()},this)}showGameOver(t,e,i,s,n,a,h){this.input.enabled=!1;let r=this.add.group();this.cardScene.input.once("pointerdown",function(){r.destroy(!0),r=null,this.input.enabled=!0},this);let o=this.add.graphics();if(r.add(o),o.fillStyle(0,.5),o.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),this.level.tutorial.img)return void this.add.image(this.cameras.main.centerX,this.cameras.main.centerY/3,"tutorial-drag-to-select");let l=-1===e?this.cameras.main.centerX:e*a,c=-1===i?this.cameras.main.centerY:i*h,d=r.create(l,c,"sprites","alice.png");if(d.setDepth(10),d.alpha=0,n){let t=r.create(n[0]*a,n[1]*h,"sprites","hand.png");t.x<this.cameras.main.width/2&&(t.scaleX=-1),this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:n.length>2?2:4,yoyo:!0,callbackScope:this,onComplete:function(){r&&(n.length>2?(t.scaleX=1,t.x=n[2]*a,t.y=n[3]*h,this.tweens.add({targets:t,duration:400,x:t.x+20,delay:s,repeat:1,yoyo:!0,callbackScope:this,onComplete:function(){}},this)):t.destroy())}},this)}this.tweens.add({targets:d,duration:400,alpha:1,delay:s/4,repeat:1,callbackScope:this,onComplete:function(){if(!r)return;let e=r.create(d.x,d.y+d.height/2,"sprites","dialog.png");e.setDepth(10);let i=e.width/12,s=this.add.text(e.x,e.y-e.width/26/2,t,{fontFamily:"Source Code Pro",fontSize:i,color:"#000",align:"center"}).setOrigin(.5);s.setDepth(10),r.add(s)}},this)}gameOver(t){if(!this.loser){if(0!==t.id){let t=!1;if(this.level.data.players.forEach(function(e){0!==e.id&&e.HQ&&(t=!0)},this),t)return}this.loser=t,this.cardScene.gameOver(t),this.time.removeAllEvents(),this.physics.pause(),this.eventQueue.destroy(),this.physics.world.colliders.destroy()}}destroyed(){for(let t=0;t<this.unitSprites.length;t++){let e=this.unitSprites[t];e.runChildUpdate=!1;for(let t=e.getChildren().length-1;t>=0;t--){e.getChildren()[t].destroy(!0)}let i=this.bulletSprites[t];i.runChildUpdate=!1;for(let t=0,e=i.getChildren().length;t<e;t++){i.getChildren()[t].destroy(!0)}}this.hqSprites.runChildUpdate=!1;for(let t=this.hqSprites.getChildren().length-1;t>=0;t--){this.hqSprites.getChildren()[t].destroy(!0)}this.planets.runChildUpdate=!1;for(let t=this.planets.getChildren().length-1;t>=0;t--){this.planets.getChildren()[t].destroy(!0)}this.asteroids.runChildUpdate=!1;for(let t=this.asteroids.getChildren().length-1;t>=0;t--){this.asteroids.getChildren()[t].destroy(!0)}this.eventQueue.destroy()}getHqUnits(){return this.hqSprites.getChildren()}getUnits(t,e,i){let s=[],n=this.hqSprites.getChildren();for(let a=n.length-1;a>=0;a--){let h=n[a];i?Phaser.Math.Distance.Squared(t,e,h.x,h.y)<i&&s.push(h):h.getBounds().contains(t,e)&&s.push(h)}return s}addEvent(t,e,i){this.eventQueue.enqueue([t,this.time.now+e,i])}clearEvents(t){this.eventQueue.clear(t)}update(t,e){if(this.loser)return;let i=this.eventQueue.dequeueExpired(t);for(;null!==i;)i[0].call(i[2]),i=this.eventQueue.dequeueExpired(t)}}class MainGame extends Phaser.Game{constructor(t,e,i){let s=window.innerWidth,n=window.innerHeight;if(s<n){let t=s;s=n,n=t}window.devicePixelRatio>=2||window.devicePixelRatio;super({key:t.id,type:Phaser.AUTO,parent:t,width:s,height:n,backgroundColor:"#202f53",audio:{noAudio:!0},physics:{default:"arcade",arcade:{debug:!1,fps:60}},render:{},scale:{zoom:1,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{touch:{capture:!0},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene(e)]});let a=document.getElementsByTagName("html")[0].getAttribute("lang");a&&Text.setLang(a),-1!==window.location.href.indexOf("localhost:8383")?(this.registry.set("debug",!0),this.registry.set("path","./")):-1!==window.location.href.indexOf("test/")?(this.registry.set("release",!0),this.registry.set("path","/test-"+Text.id+"/")):(this.registry.set("release",!0),this.registry.set("path","/"+Text.id+"/")),this.registry.set("gameid",i)}clear(t){window.localStorage.removeItem(this.registry.get("gameid")+t)}save(t,e){window.localStorage.setItem(this.registry.get("gameid")+t,e)}restore(t){return window.localStorage.getItem(this.registry.get("gameid")+t)}}const LEVEL="";function createGame(){var t=new URL(window.location).searchParams.get("id")||"";window.game=new MainGame(document.getElementById("canvas"),["level-0","level-1","level-2","level-3","level-4","level-5","level-6","end"],Text.id+t)}function setGameConfig(t,e,i){}function log(t){console.log(t)}