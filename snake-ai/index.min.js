/*! Copyright minimindgames.com 23-09-2023 */

class Bug{constructor(t){this.scene=t;let e=t.physics.add.sprite(100,450,"snakehead");t.cameras.main.startFollow(e,!0,0,.1),e.body.setVelocity(300),e.body.setSize(e.width/2,e.height/2),this.head=e,this.body=[],this.body=[],this.path=[],this.pathRotation=[],this.path.push(new Phaser.Geom.Point(this.head.x,this.head.y)),this.pathRotation.push(this.head.rotation),this.pathSpacer=8;for(let e=0;e<15;e++){let i=t.physics.add.sprite(100,450,"snakebody");t.time.delayedCall(1e3*(e+1),this.addBody,[i],this),this.body.push(i);for(let t=0;t<this.pathSpacer;t++)this.path.push(new Phaser.Geom.Point(i.x,i.y)),this.pathRotation.push(this.head.rotation)}}addBody(t){this.scene.physics.add.collider(this.head,t,this.collideBody)}addBug(t){this.scene.physics.add.collider(this.head,t,this.doCollision);for(let e=0;e<8;e++)this.scene.physics.add.collider(this.body[e],t,this.collideBug)}collideBody(t,e){console.log("collision")}collideBug(t,e){e.destroy(),console.log("collision")}update(t,e){let i=this.head,s=this.body,o=this.path,h=this.pathSpacer;i.setAcceleration(0),i.setDrag(0),i.body.angularVelocity=0,(t.left.isDown||e.A.isDown)&&(i.body.angularVelocity=-200),(t.right.isDown||e.D.isDown)&&(i.body.angularVelocity=200),this.scene.physics.velocityFromRotation(i.rotation,i.body.speed,i.body.velocity);let a=this.path.pop();a.x=i.x,a.y=i.y,this.path.unshift(a);let d=this.pathRotation.pop();d=i.rotation,this.pathRotation.unshift(d);for(let t=0,e=s.length;t<e;t++)s[t].x=o[(t+1)*h].x,s[t].y=o[(t+1)*h].y,s[t].rotation=this.pathRotation[(t+1)*h]}}class Config{static initGame(t){console.log(t.config.width+"x"+t.config.height),t.config.width>=2560&&t.config.height>=1440?Config.resolution=4:t.config.width>=1920&&t.config.height>=1080?Config.resolution=3:t.config.width>=1280&&t.config.height>=720?Config.resolution=2:Config.resolution=1,-1===window.location.href.indexOf("localhost:8383")&&(Config.loadPath="/snake-ai/img/")}}Config.resolution=1,Config.loadPath="img/";class LoaderScene extends Phaser.Scene{constructor(){super({key:"LoaderScene",visible:!1}),this.loadProgress=0}preload(){this.load.path=Config.loadPath,this.resname=["-1","-2","-3",""][Config.resolution-1],this.loadSpriteSheet("asteroids",32,32),this.loadImage("snakehead"),this.loadImage("snakebite"),this.loadImage("snakebody"),this.loadImage("snakebody-bullet"),this.loadImage("bug"),this.loadImage("pepper3")}create(){this.barrierGroup=this.physics.add.staticGroup(),this.enemyGroup=this.physics.add.group(),this.snap=this.textures.get("asteroids").getSourceImage().height,this.width=2560/this.snap,this.height=2560/this.snap;let t=this.snap,e=t/2,i=this.textures.get("asteroids").frameTotal-2;for(let t=0;t<28;t++){this.barrierGroup.create(this.randomX(),this.randomY(),"asteroids",Phaser.Math.Between(0,i))}for(let s=0;s<this.width;s++)this.barrierGroup.create(e+t*s,e,"asteroids",Phaser.Math.Between(0,i)),this.barrierGroup.create(e+t*s,t*this.height-e,"asteroids",Phaser.Math.Between(0,i));for(let s=0;s<this.height;s++)this.barrierGroup.create(e,e+t*s,"asteroids",Phaser.Math.Between(0,i)),this.barrierGroup.create(t*this.width-e,e+t*s,"asteroids",Phaser.Math.Between(0,i));this.player=new Player(this),this.time.delayedCall(100,this.addBug,[],this),this.cursors=this.input.keyboard.createCursorKeys(),this.cursorsLeftHand=this.input.keyboard.addKeys("A,D"),this.text=this.add.text(10,10,"Cursors to move",{font:"16px Courier",fill:"#00ff00"}).setScrollFactor(0);let s=this.snap*this.width;this.cameras.main.setBounds(0,0,s,s),this.physics.world.setBounds(0,0,s,s),this.physics.add.collider(this.enemyGroup,this.barrierGroup)}update(){this.player.update(this.cursors,this.cursorsLeftHand),this.text.setText([`screen x: ${this.input.x}`,`screen y: ${this.input.y}`,`world x: ${this.input.mousePointer.worldX}`,`world y: ${this.input.mousePointer.worldY}`])}loadSpriteSheet(t,e,i){this.load.spritesheet(t,t+this.resname+".png",{frameWidth:e,frameHeight:i})}loadImage(t){this.load.image(t,t+this.resname+".png")}randomX(t){const e=this.snap,i=e/2;return Phaser.Math.Between(1,this.width-1)*e+i}randomY(t){const e=this.snap,i=e/2;return Phaser.Math.Between(1,this.height-1)*e+i}addBug(){var t=Phaser.Math.Between(1,2);let e=this.enemyGroup.create(this.randomX(),this.randomY(),1===t?"bug":"pepper3");e.rotation=Phaser.Math.Angle.Random(),e.type=t,e.setBounce(1,1),e.moveCallback=this.time.delayedCall(100,this.moveBug,[e],this),this.time.delayedCall(500,this.addBug,[this.player],this)}removeBug(t){this.time.removeEvent(t.moveCallback),t.destroy()}moveBug(t){t.rotation=Phaser.Math.Angle.Random(),t.body.setVelocity(Phaser.Math.Between(50,150)),t.body.angularVelocity=Phaser.Math.Between(-50,50),this.physics.velocityFromRotation(t.rotation,t.body.speed,t.body.velocity)}}class Player{constructor(t){this.scene=t;let e=t.physics.add.sprite(t.randomX(),t.randomY(),"snakehead");e.rotation=Phaser.Math.Angle.Random(),t.cameras.main.startFollow(e,!0,0,.05),e.setCollideWorldBounds(!0),e.body.setVelocity(300),e.body.setSize(e.width/2,e.height/2),this.head=e,this.bodyGroup=t.physics.add.group(),this.bulletGroup=t.physics.add.group(),this.path=[],this.pathRotation=[],this.path.push(new Phaser.Geom.Point(this.head.x,this.head.y)),this.pathRotation.push(this.head.rotation),this.pathSpacer=8;for(let t=0;t<15;t++)this.addBody();t.physics.add.collider(this.head,this.bodyGroup,this.collideHeadBody,null,this),t.physics.add.collider(this.head,t.barrierGroup),t.physics.add.collider(this.head,this.bulletGroup),t.physics.add.overlap(this.head,t.enemyGroup,this.collideHeadEnemy,null,this),t.physics.add.collider(this.bodyGroup,t.enemyGroup,this.collideBodyEnemy,null,this),t.physics.add.collider(this.bulletGroup,t.enemyGroup,this.collideBulletEnemy,null,this)}addBody(){let t=this.bodyGroup.getLast()||this.head,e=this.scene.physics.add.sprite(t.x,t.y,"snakebody");e.body.setSize(e.width/2,e.height/2),this.scene.time.delayedCall(200,function(){this.bodyGroup.add(e)},[e],this);for(let t=0;t<this.pathSpacer;t++)this.path.push(new Phaser.Geom.Point(e.x,e.y)),this.pathRotation.push(this.head.rotation)}collideHeadBody(t,e){if(0!==this.bodyGroup.getChildren().indexOf(e))for(let t=null;t!==e;){t=this.bodyGroup.getChildren().pop(),this.bulletGroup.add(t);for(let t=0;t<this.pathSpacer;t++)this.path.pop(),this.pathRotation.pop();t.setTexture("snakebody-bullet"),t.body.setVelocity(Phaser.Math.Between(50,150)),t.rotation=Phaser.Math.Angle.Random();this.scene.tweens.add({targets:t,duration:3e3,scale:0,ease:"Cubic.easeIn",callbackScope:this,onComplete:t=>{t.destroy()}})}}collideHeadEnemy(t,e){1===e.type?(this.scene.removeBug(e),this.addBody(),this.head.setScale(.6666),this.head.setTexture("snakebite"),this.scene.tweens.add({targets:this.head,duration:75,scale:1,yoyo:!0,callbackScope:this,onComplete:function(){this.head.setTexture("snakehead"),this.head.setScale(1)}})):this.scene.scene.restart()}collideBodyEnemy(t,e){2===e.type&&this.scene.removeBug(e)}collideBulletEnemy(t,e){2===e.type&&(t.destroy(),this.scene.removeBug(e))}update(t,e){let i=this.head,s=this.path,o=this.pathSpacer;i.setAcceleration(0),i.setDrag(0),i.body.angularVelocity=0,(t.left.isDown||e.A.isDown)&&(i.body.angularVelocity=-200),(t.right.isDown||e.D.isDown)&&(i.body.angularVelocity=200),this.scene.physics.velocityFromRotation(i.rotation,i.body.speed,i.body.velocity);let h=this.path.pop();h.x=i.x,h.y=i.y,this.path.unshift(h);let a=this.pathRotation.pop();a=i.rotation,this.pathRotation.unshift(a);let d=this.bodyGroup.getChildren();for(let t=0,e=d.length;t<e;t++)d[t].x=s[(t+1)*o].x,d[t].y=s[(t+1)*o].y,d[t].rotation=this.pathRotation[(t+1)*o]}}class MainGame extends Phaser.Game{constructor(t){let e=window.innerWidth,i=window.innerHeight;if(e<i){let t=e;e=i,i=t}super({key:t.id,type:Phaser.AUTO,parent:t,width:e,height:i,backgroundColor:"#202f53",audio:{noAudio:!0},physics:{default:"arcade",arcade:{debug:!1}},scale:{},input:{touch:{capture:!0},gamepad:!0},disableContextMenu:!0,scene:[new LoaderScene]})}}function createGame(){window.game=new MainGame(document.getElementById("canvas")),Config.initGame(window.game)}function log(t){console.log(t)}